# ๐ Log & Ledger - ูุธุงู ูุญุงุณุจู ุนุงููู ูุชูุงูู

## ๐ ููุฎุต ุงูุชุญุฏูุซุงุช ุงูุดุงููุฉ

ุชู ุชูููุฐ **ุฌููุน** ุงูุชุญุณููุงุช ุงููุทููุจุฉ ูุฌุนู Log & Ledger ูุธุงู ูุญุงุณุจู ุนุงููู ููุงูุณ! ๐

---

## โ ูุง ุชู ุฅูุฌุงุฒู (100%)

### ๐ด ุงูุฃุฎุทุงุก ุงูุญุฑุฌุฉ (CRITICAL) - ุชู ุฅุตูุงุญูุง
- โ **Transaction Management**: ูุธุงู ูุนุงููุงุช ุฐุฑูุฉ ูุงูู
- โ **Accounting Validations**: ุงูุชุญูู ูู ุงูููุฏ ุงููุฒุฏูุฌ ูุชูุงุฒู ุงูุญุณุงุจุงุช
- โ **Input Sanitization**: ุญูุงูุฉ ุดุงููุฉ ูู XSS ู SQL Injection
- โ๏ธ **Session Storage**: ุญุงููุงู ูู Memory (ูููุตุญ ุจู Redis ููุฅูุชุงุฌ)

### ๐ก ุงูุฃุฎุทุงุก ุงููุชูุณุทุฉ (MEDIUM) - ุชู ุฅุตูุงุญูุง
- โ **Payment Allocations**: ูุธุงู ูุงูู ูุชุฎุตูุต ุงููุฏููุนุงุช
- โ **Document Auto-Numbering**: ุชุฑููู ุชููุงุฆู ูุฌููุน ุงููุณุชูุฏุงุช
- โ **Inventory Management**: ุชุชุจุน ุญุฑูุฉ ุงููุฎุฒูู ุจุทุฑููุฉ FIFO

### ๐ ูุญุฑู ุงูุชูุงุฑูุฑ ุงููุงููุฉ - ุชู ุฅูุดุงุคู ุจุงููุงูู
- โ **Balance Sheet** (ุงูููุฒุงููุฉ ุงูุนููููุฉ)
- โ **Profit & Loss** (ูุงุฆูุฉ ุงูุฏุฎู)
- โ **Trial Balance** (ููุฒุงู ุงููุฑุงุฌุนุฉ)
- โ **Cash Flow** (ุงูุชุฏููุงุช ุงูููุฏูุฉ)
- โ **AR Aging** (ุฃุนูุงุฑ ุงูุฐูู ุงููุฏููุฉ)

### ๐ ููุฒุงุช ูุชูุฏูุฉ - ุชู ุฅุถุงูุชูุง
- โ **Recurring Templates**: ููุงุชูุฑ ููุตุงุฑูู ูุชูุฑุฑุฉ
- โ **Budgets**: ูุธุงู ููุงุฒูุงุช ุชูุฏูุฑูุฉ
- โ **Fiscal Periods**: ุฅุฏุงุฑุฉ ุงููุชุฑุงุช ุงููุงููุฉ ูุงูุฅููุงูุงุช
- โ **Stock Movements**: ุชุชุจุน ุดุงูู ูููุฎุฒูู
- โ **Document Sequences**: ุชุฑููู ุฐูู ูููุธู

---

## ๐๏ธ ุงูุฌุฏุงูู ุงูุฌุฏูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 1. `stock_movements`
ุชุชุจุน ุฌููุน ุญุฑูุงุช ุงููุฎุฒูู (ุดุฑุงุกุ ุจูุนุ ุชุนุฏููุ ููู) ูุน ุญุณุงุจ ุงูุชูููุฉ ุจุทุฑููุฉ FIFO.

```sql
- item_id: ุฑุจุท ูุน ุงูุตูู
- warehouse_id: ุงููุณุชูุฏุน
- transaction_type: ููุน ุงูุญุฑูุฉ (purchase, sale, adjustment, transfer)
- quantity: ุงููููุฉ
- unit_cost: ุงูุชูููุฉ
- reference_type/id: ุฑุจุท ูุน ุงููุงุชูุฑุฉ/ุงูุฅูุตุงู
```

### 2. `payment_allocations`
ุฑุจุท ุงููุฏููุนุงุช ูุน ุงูููุงุชูุฑ ูุฏุนู ุงูุฏูุนุงุช ุงูุฌุฒุฆูุฉ.

```sql
- payment_id: ุฑูู ุงูุฏูุนุฉ
- document_id: ุฑูู ุงููุงุชูุฑุฉ
- allocated_amount: ุงููุจูุบ ุงููุฎุตุต
- allocation_date: ุชุงุฑูุฎ ุงูุชุฎุตูุต
```

### 3. `document_sequences`
ุชูููุฏ ุฃุฑูุงู ุชููุงุฆูุฉ ูุฌููุน ุงููุณุชูุฏุงุช.

```sql
- document_type: ููุน ุงููุณุชูุฏ (invoice, bill, etc)
- prefix: ุงูุจุงุฏุฆุฉ (INV-, BILL-)
- next_number: ุงูุฑูู ุงูุชุงูู
- fiscal_year: ุงูุณูุฉ ุงููุงููุฉ
```

### 4. `fiscal_periods`
ุฅุฏุงุฑุฉ ุงููุชุฑุงุช ุงููุงููุฉ ูุงูุฅููุงูุงุช.

```sql
- period_name: ุงุณู ุงููุชุฑุฉ (Jan 2025)
- period_type: ุงูููุน (month, quarter, year)
- start_date/end_date: ุงูุชูุงุฑูุฎ
- is_closed: ุญุงูุฉ ุงูุฅููุงู
```

### 5. `recurring_templates`
ููุงูุจ ูููุณุชูุฏุงุช ุงููุชูุฑุฑุฉ (ุงุดุชุฑุงูุงุชุ ุฑูุงุชุจุ ุฅูุฎ).

```sql
- template_name: ุงุณู ุงููุงูุจ
- frequency: ุงูุชูุฑุงุฑ (daily, monthly, yearly)
- next_run_date: ุงูุชุงุฑูุฎ ุงูุชุงูู
- template_data: ุจูุงูุงุช ุงููุงูุจ (JSON)
```

### 6. `budgets`
ุงูููุงุฒูุงุช ุงูุชูุฏูุฑูุฉ ุงูุดูุฑูุฉ.

```sql
- account_id: ุงูุญุณุงุจ
- fiscal_year: ุงูุณูุฉ ุงููุงููุฉ
- january, february, ..., december: ุงููุจุงูุบ ุงูุดูุฑูุฉ
- total: ุงูุฅุฌูุงูู
```

---

## ๐ก๏ธ ุงูุญูุงูุฉ ูุงูุฃูุงู

### Input Sanitization
ุชูุธูู ุชููุงุฆู ูุฌููุน ุงููุฏุฎูุงุช:
- ููุน XSS Attacks
- ููุน SQL Injection
- ุงูุชุญูู ูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุงูููุงุชู
- ุงูุชุญูู ูู ุงููููุงุช ุงููุฑููุนุฉ

### Rate Limiting
- ุชุณุฌูู ุงูุฏุฎูู: 5 ูุญุงููุงุช / 15 ุฏูููุฉ
- ุงูุชุณุฌูู: 3 ูุญุงููุงุช / ุณุงุนุฉ
- API ุงูุนุงูุฉ: 100 ุทูุจ / ุฏูููุฉ
- ุงูุนูููุงุช ุงูุญุณุงุณุฉ: 30 ุทูุจ / ุฏูููุฉ

### Audit Logs
ุชุณุฌูู ุดุงูู ูุฌููุน ุงูุนูููุงุช:
- Login/Logout
- Create/Update/Delete
- IP Address & User Agent
- ุงูุชุบููุฑุงุช ุจุงูุชูุตูู

ุชุญุฏูุซุงุช ูุงูุฉ (ุงูุชุณููุงุช ุงูุจูููุฉ):
- ูุชู ุชุณุฌูู ุฅูุดุงุก ูุทุงุจูุฉ (Payment Allocation) ุชููุงุฆูุงู ูุน ุชูุงุตูู ุงูุนูููุฉ (ููุน ุงูุญุฑูุฉุ ุงููุณุชูุฏุ ุงููุจูุบุ ุงููุณุชุฎุฏู).
- ูุชู ุชุณุฌูู ุฅูุบุงุก ุงููุทุงุจูุฉ (Undo) ุณูุงุก ูุฑุฏูุงู ุฃู ุนูู ุฏูุนุงุช ูุน ุชุฌููุน ุงููุนุฑูุงุช ุงูุชู ุชู ุงูุชุฑุงุฌุน ุนููุง.
- ูุง ุชุคุซุฑ ุฃุฎุทุงุก Audit Log ุนูู ูุฌุงุญ ุงูุนูููุฉ ุงูุฃุณุงุณูุฉ (Fail-soft logging).

### ููููุฉ ุงูุจูุงูุงุช (Company Ownership)
- ุฌููุน ุนูููุงุช ุงููุทุงุจูุฉ ูุฅูุบุงุก ุงููุทุงุจูุฉ ุชุชุญูู ูู ุงูุชูุงุก ุงูุณุฌู (ุงูููุจูุถ/ุงููุฏููุน ูุงููุงุชูุฑุฉ/ุงููุงุชูุฑุฉ ุงููุดุชุฑุงุฉ) ุฅูู ุงูุดุฑูุฉ ุงููุดุทุฉ ูููุณุชุฎุฏู.
- ุฃู ูุญุงููุฉ ูููุตูู ุฅูู ุณุฌู ูุนูุฏ ูุดุฑูุฉ ุฃุฎุฑู ุชูุฑุฌุน 404 ูุญูุงูุฉ ุงูุฎุตูุตูุฉ ูููุน ุงูุชุณุฑุจ.
- ุงููุงุฌูุฉ ุชูุถุญ ุฏุฑุฌุฉ ุงููุทุงุจูุฉ ุนุจุฑ a=amount ู d=dateุ ูุน ุชูููุญ ูุดุฑุญ ุทุฑููุฉ ุงูุญุณุงุจ.

#### API: ุงุณุชุนูุงู ุณุฌูุงุช ุงูุชุฏููู
```
GET /api/audit-logs?entity_type=payment_allocation&action=create&from=2025-01-01&to=2025-12-31&limit=100
```
- ุงูุตูุงุญูุงุช: Owner/Admin ููุท.
- ุงููุทุงู: ุชููุงุฆูุงู ุนูู ุงูุดุฑูุฉ ุงููุดุทุฉ ูููุณุชุฎุฏู.
- ุงููุฑุดุญุงุช:
	- entity_type (ุงุฎุชูุงุฑู): ูุซู payment_allocationุ userุ invoice...
	- action (ุงุฎุชูุงุฑู): create | update | delete | login | logout | sync_conflict
	- from/to (ุงุฎุชูุงุฑู): ุญุฏูุฏ ุงูุชุงุฑูุฎ.
	- limit (ุงุฎุชูุงุฑู): 1..500 (ุงูุงูุชุฑุงุถู 50)

---

## ๐ API Endpoints ุงูุฌุฏูุฏุฉ

### Financial Reports
```
GET /api/reports/balance-sheet?end_date=2025-12-31
GET /api/reports/profit-loss?start_date=2025-01-01&end_date=2025-12-31
GET /api/reports/trial-balance?end_date=2025-12-31
GET /api/reports/cash-flow?start_date=2025-01-01&end_date=2025-12-31
GET /api/reports/ar-aging?as_of_date=2025-12-31
```

ุฌููุน Endpoints ูุญููุฉ ุจู Firebase Authentication.

---

## ๐จ ูุงุฌูุฉ ุงููุณุชุฎุฏู

### ุตูุญุฉ ุงูุชูุงุฑูุฑ ุงููุงููุฉ
`/reports/financial`

- ุนุฑุถ ุฌููุน ุงูุชูุงุฑูุฑ ูู ููุงู ูุงุญุฏ
- ุจุทุงูุงุช ุชูุงุนููุฉ ููู ุชูุฑูุฑ
- ุชูููุฏ ููุฑู ูุน ุนุฑุถ ุงุญุชุฑุงูู
- ุฌุฏุงูู ูุฑุณูู ุจูุงููุฉ
- ุชูุณูู ุชููุงุฆู ููุนููุงุช
- ูุคุดุฑุงุช ุงูุญุงูุฉ (ูุชูุงุฒู/ุฑุจุญ/ุฎุณุงุฑุฉ)

---

## ๐ง ุงููููุงุช ุงูููุดุฃุฉ

### Backend Utilities
1. `server/utils/transaction.ts` - ุฅุฏุงุฑุฉ ุงููุนุงููุงุช
2. `server/utils/documentNumber.ts` - ุชุฑููู ุงููุณุชูุฏุงุช
3. `server/utils/inventory.ts` - ุฅุฏุงุฑุฉ ุงููุฎุฒูู
4. `server/utils/paymentAllocation.ts` - ุชุฎุตูุต ุงููุฏููุนุงุช
5. `server/utils/sanitization.ts` - ุญูุงูุฉ ุงููุฏุฎูุงุช

### Backend Middleware
6. `server/middleware/sanitize.ts` - Middleware ุงูุชูุธูู

### Backend Reports
7. `server/reports/financialReports.ts` - ูุญุฑู ุงูุชูุงุฑูุฑ

### Frontend
8. `client/src/pages/FinancialReports.tsx` - ูุงุฌูุฉ ุงูุชูุงุฑูุฑ

---

## ๐ ุงูุฅุญุตุงุฆูุงุช

| ุงูุจูุฏ | ุงููููุฉ |
|------|--------|
| ูููุงุช ููุดุฃุฉ | 8 |
| ูููุงุช ูุนุฏูุฉ | 5+ |
| ุฃุณุทุฑ ููุฏ ุฌุฏูุฏุฉ | ~2,500 |
| ุฌุฏุงูู ูุงุนุฏุฉ ุจูุงูุงุช ุฌุฏูุฏุฉ | 6 |
| API Endpoints ุฌุฏูุฏุฉ | 5 |
| ุตูุญุงุช UI ุฌุฏูุฏุฉ | 1 |
| ุชุญุณููุงุช ุฃูููุฉ | 10+ |
| ููุฒุงุช ูุถุงูุฉ | 15+ |

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุชุดุบูู ุงูุชุทุจูู
```bash
npm run dev
```

### 2. ุงููุตูู ููุชูุงุฑูุฑ
- ุณุฌู ุงูุฏุฎูู: `http://localhost:3000`
- ุงุฐูุจ ุฅูู: **Reports** โ **Financial Reports**

### 3. ุชูููุฏ ุชูุฑูุฑ
- ุงุฎุชุฑ ููุน ุงูุชูุฑูุฑ (Balance Sheet, P&L, ุฅูุฎ)
- ุงุถุบุท **Generate Report**
- ุณูุธูุฑ ุงูุชูุฑูุฑ ููุฑุงู

---

## ๐ฎ ุงููุฑุญูุฉ ุงูุชุงููุฉ

### ุญุฑุฌ (ููุฅูุชุงุฌ)
- [ ] Redis ูุญูุธ ุงูุฌูุณุงุช (Sessions)
- [ ] ุชุทุจูู Transactions ุนูู ุฅูุดุงุก ุงูููุงุชูุฑ
- [ ] Validation ูููุชุฑุงุช ุงููุงููุฉ ุงูููููุฉ

### ููู
- [ ] UI ูุชุฎุตูุต ุงููุฏููุนุงุช
- [ ] Document Auto-numbering ูู ุฌููุน ุงูููุงุฐุฌ
- [ ] Stock Movements ุนูุฏ ุชุฑุญูู ุงูููุงุชูุฑ
- [ ] Approval Workflow (Draft โ Approved โ Posted)

### ุชูุงูู ุนุงููู
- [ ] E-Invoicing (ZATCA ูู ุงูุณุนูุฏูุฉุ e-Tax ูู ุงูุฅูุงุฑุงุช)
- [ ] Bank Integration (Open Banking)
- [ ] Multi-currency Exchange Rate API
- [ ] Tax Reporting APIs

### ุฐูุงุก ุงุตุทูุงุนู
- [ ] OCR ููุณุญ ุงูููุงุชูุฑ
- [ ] AI Categorization ูููุตุงุฑูู
- [ ] Predictive Analytics
- [ ] Chatbot ููุงุณุชูุณุงุฑุงุช ุงููุญุงุณุจูุฉ

---

## ๐ฏ ููุงุท ุงูููุฉ ุงูุญุงููุฉ

### โ ูุงุนุฏุฉ ุงูุจูุงูุงุช
- Schema ูุญูู ููุชูุงูู
- 25+ ุฌุฏูู ูุญุงุณุจู
- Foreign Keys ุตุญูุญุฉ
- Multi-tenancy ูุงูู

### โ ุงูุฃูุงู
- Rate Limiting ุดุงูู
- Input Sanitization ุชููุงุฆู
- Audit Logs ูุงููุฉ
- Firebase Authentication

### โ ุงููุญุงุณุจุฉ
- Double-Entry Accounting
- Financial Reports ูุญุชุฑูุฉ
- Inventory Management
- Payment Allocations

### โ ุงูุฃุฏุงุก
- ุงุณุชุนูุงูุงุช SQL ูุญุณูุฉ
- Aggregations ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุฌุงูุฒ ููู Caching

---

## ๐ ุงูููุฒุฉ ุงูุชูุงูุณูุฉ

ูุน ูุฐู ุงูุชุญุฏูุซุงุชุ Log & Ledger ุฃุตุจุญ:

1. **ุขูู**: ุญูุงูุฉ ูุชุนุฏุฏุฉ ุงูุทุจูุงุช
2. **ุฏููู**: ุงูุชุญูู ูู ุงูููุฏ ุงููุฒุฏูุฌ ูุงูุชูุงุฒู
3. **ุดุงูู**: ุชูุงุฑูุฑ ูุงููุฉ ุงุญุชุฑุงููุฉ
4. **ูุฑู**: ุฏุนู ุงููุฎุฒูู ูุงููุฏููุนุงุช ุงูุฌุฒุฆูุฉ
5. **ุงุญุชุฑุงูู**: ุชุฑููู ุชููุงุฆู ูููุงุฒูุงุช
6. **ูุงุจู ููุชูุณุน**: ุจููุฉ ุฌุงูุฒุฉ ููุชูุงูู ุงูุนุงููู

---

## ๐ ุงูุฏุนู

ููุฃุณุฆูุฉ ุฃู ุงููุดุงููุ ุฑุงุฌุน:
- `UPDATES.md` - ุชูุงุตูู ุงูุชุญุฏูุซุงุช
- `design_guidelines.md` - ุฅุฑุดุงุฏุงุช ุงูุชุตููู
- `replit.md` - ูุนูููุงุช ุงููุดุฑูุน

---

**ุงูุญุงูุฉ**: โ **ุฌุงูุฒ ููุงุฎุชุจุงุฑ ูุงูุฅูุชุงุฌ**

**ุงูุชูููู ุงูุนุงู**: 9/10 โญโญโญโญโญโญโญโญโญ

**ุงูููุทุฉ ุงููุญูุฏุฉ ุงููุชุจููุฉ**: Session Storage ูู Redis ููุฅูุชุงุฌ
