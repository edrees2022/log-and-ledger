# نظام التقارير المالية (Financial Reporting System)

## نظرة عامة
يوفر النظام مجموعة من التقارير المالية الأساسية والمتقدمة لمساعدة الإدارة في اتخاذ القرارات ومتابعة الأداء المالي.

## التقارير المنفذة

### 1. ميزان المراجعة (Trial Balance)
**الوصف**: تقرير يوضح أرصدة جميع الحسابات في دليل الحسابات خلال فترة زمنية محددة.
**الهدف**: التأكد من توازن الحسابات (المدين = الدائن) ومراجعة الأرصدة قبل إعداد القوائم المالية.

**البيانات المعروضة**:
- رمز الحساب (Account Code)
- اسم الحساب (Account Name)
- نوع الحساب (Account Type)
- الرصيد الافتتاحي (Opening Balance): الرصيد قبل تاريخ البداية.
- الحركة المدينة (Debit): مجموع الحركات المدينة خلال الفترة.
- الحركة الدائنة (Credit): مجموع الحركات الدائنة خلال الفترة.
- صافي الحركة (Net Movement): الفرق بين المدين والدائن خلال الفترة.
- الرصيد الختامي (Closing Balance): الرصيد الافتتاحي + صافي الحركة.

**API Endpoint**:
`GET /api/reports/trial-balance`
- `startDate`: تاريخ بداية الفترة (YYYY-MM-DD)
- `endDate`: تاريخ نهاية الفترة (YYYY-MM-DD)

**المنطق البرمجي**:
- يتم حساب الرصيد الافتتاحي بجمع جميع القيود قبل `startDate`.
- يتم حساب حركات الفترة بجمع القيود بين `startDate` و `endDate`.
- يتم استبعاد الحسابات التي ليس لها رصيد افتتاحي ولا حركة خلال الفترة.

### 2. دفتر الأستاذ العام (General Ledger)
**الوصف**: تقرير تفصيلي يوضح جميع الحركات المالية التي تمت على حساب معين خلال فترة زمنية.
**الهدف**: تتبع تفاصيل العمليات ومراجعة الحركات المشبوهة أو غير العادية.

**API Endpoint**:
`GET /api/reports/general-ledger`
- `accountId`: معرف الحساب
- `startDate`: تاريخ البداية
- `endDate`: تاريخ النهاية

**البيانات المعروضة**:
- الرصيد الافتتاحي
- قائمة الحركات (التاريخ، رقم القيد، الوصف، مدين، دائن، الرصيد التراكمي)
- الرصيد الختامي

### 3. قائمة الدخل (Income Statement / P&L)
**الوصف**: تقرير يوضح نتيجة أعمال الشركة من ربح أو خسارة خلال فترة معينة.
**الهدف**: تقييم الأداء المالي للشركة.

**API Endpoint**:
`GET /api/reports/income-statement`
- `startDate`: تاريخ البداية
- `endDate`: تاريخ النهاية

**المنطق البرمجي**:
- تجميع أرصدة حسابات الإيرادات (Revenue) والمصروفات (Expense).
- حساب صافي الدخل = إجمالي الإيرادات - إجمالي المصروفات.

### 4. الميزانية العمومية (Balance Sheet)
**الوصف**: تقرير يوضح المركز المالي للشركة في لحظة زمنية محددة.
**الهدف**: معرفة ما للشركة (الأصول) وما عليها (الخصوم) وحقوق الملاك.

**API Endpoint**:
`GET /api/reports/balance-sheet`
- `date`: التاريخ (As of Date)

**المنطق البرمجي**:
- تجميع أرصدة الأصول (Assets)، الخصوم (Liabilities)، وحقوق الملكية (Equity) منذ بداية النشاط وحتى التاريخ المحدد.
- حساب الأرباح المحتجزة (Retained Earnings) تلقائياً عن طريق حساب صافي دخل الفترات السابقة وإضافته لحقوق الملكية لضمان توازن الميزانية.
- المعادلة المحاسبية: الأصول = الخصوم + حقوق الملكية.

## الهيكلية البرمجية

- **`server/utils/reports.ts`**: يحتوي على دوال استخراج البيانات وحساب الأرصدة.
- **`server/routes/reports.ts`**: يحتوي على نقاط الاتصال (API Endpoints) والتحقق من المدخلات.
