{"file_contents":{"design_guidelines.md":{"content":"# Log & Ledger Accounting Application Design Guidelines\n\n## Design Approach\n**System-Based Approach**: Using Material Design principles adapted for enterprise accounting software, emphasizing clarity, efficiency, and data accessibility across web and mobile platforms.\n\n## Core Design Principles\n- **Data-First Design**: Clean, scannable layouts that prioritize financial information visibility\n- **Professional Reliability**: Conservative, trustworthy aesthetic appropriate for financial software\n- **Cross-Platform Consistency**: Unified experience across web, Android, and iOS\n- **Accessibility**: Full support for RTL languages and screen readers\n\n## Color Palette\n\n### Light Mode\n- **Primary**: 210 100% 20% (Deep professional blue)\n- **Primary Variant**: 210 80% 35% (Lighter blue for accents)\n- **Surface**: 0 0% 98% (Near-white backgrounds)\n- **Surface Variant**: 210 10% 95% (Subtle card backgrounds)\n- **Text Primary**: 210 15% 15% (Dark blue-gray)\n- **Text Secondary**: 210 10% 45% (Medium gray)\n\n### Dark Mode\n- **Primary**: 210 80% 65% (Lighter blue for contrast)\n- **Primary Variant**: 210 60% 50% (Muted blue accent)\n- **Surface**: 210 15% 8% (Dark blue-gray)\n- **Surface Variant**: 210 12% 12% (Elevated surfaces)\n- **Text Primary**: 210 5% 95% (Near-white)\n- **Text Secondary**: 210 8% 75% (Light gray)\n\n### Status Colors\n- **Success**: 140 60% 40% (Muted green)\n- **Warning**: 35 85% 50% (Professional orange)\n- **Error**: 355 70% 45% (Subdued red)\n\n## Typography\n- **Primary Font**: Inter (Google Fonts) - Clean, readable for financial data\n- **Monospace**: JetBrains Mono - For account codes and numbers\n- **Hierarchy**: Use 5 text sizes (xs, sm, base, lg, xl) with consistent weight scaling\n\n## Layout System\n**Tailwind Spacing Units**: Consistent use of 2, 4, 6, 8, 12, 16 for spacing\n- Tight spacing (2, 4) for form elements and table cells\n- Medium spacing (6, 8) for component separation\n- Wide spacing (12, 16) for section breaks\n\n## Component Library\n\n### Navigation\n- **Desktop**: Persistent sidebar with collapsible sections (Accounting, Sales, Purchase, Reports, Settings)\n- **Mobile**: Bottom tab navigation with hamburger menu for secondary items\n- **Company Switcher**: Prominent dropdown in header\n\n### Data Tables\n- **Sticky Headers**: Always visible column headers during scroll\n- **Responsive**: Horizontal scroll on mobile with priority columns visible\n- **Filters**: Inline filter chips with clear/reset functionality\n- **Sorting**: Clear visual indicators for sort direction\n\n### Forms\n- **Floating Labels**: Material Design style with consistent validation states\n- **Tax Configuration**: Multi-select dropdowns with visual tax rate indicators\n- **Document Numbering**: Pattern preview showing \"INV-2024-0001\" format examples\n\n### Financial Components\n- **Amount Display**: Right-aligned with currency symbols, consistent decimal places\n- **Account Selectors**: Hierarchical dropdowns with account codes\n- **Status Badges**: Rounded pills for document states (Draft, Approved, Paid)\n\n### Print Templates\n- **Headers**: Company logo/info area with clean typography\n- **Document Body**: Structured tables with clear line item separation\n- **Footers**: Signature areas and declaration text zones\n- **Date Ranges**: Prominent From-To date display for reports\n\n## Cross-Platform Considerations\n- **Progressive Web App**: Offline-capable with sync indicators\n- **Touch Targets**: Minimum 44px for mobile interactions\n- **Responsive Breakpoints**: Mobile-first approach with tablet and desktop optimizations\n- **Native Feel**: Platform-appropriate navigation patterns while maintaining brand consistency\n\n## Settings & Internationalization\n- **Language Toggle**: Prominent setting with country flag indicators\n- **RTL Support**: Automatic layout direction changes for Arabic and Hebrew\n- **Theme Control**: Light/Dark/Auto with system preference detection\n- **Numbering Patterns**: Visual pattern builders with live previews\n\n## Notifications\n- **Toast Messages**: Non-intrusive bottom notifications for actions\n- **Alert Panels**: Prominent warnings for due invoices and low stock\n- **Email Stubs**: Simple preference toggles for notification types\n\nThis design system prioritizes financial data clarity while maintaining modern usability standards across all platforms and languages.","size_bytes":4319},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"replit.md":{"content":"# Overview\n\nLog & Ledger is a global accounting application built for web, Android, and iOS platforms. It's designed as a professional, multi-company accounting system supporting 15+ languages including RTL languages like Arabic. The application features offline-first architecture with cloud synchronization, multi-currency support, flexible taxation systems, and comprehensive financial management capabilities. Built with React/TypeScript frontend, Express.js backend, and PostgreSQL database using Drizzle ORM.\n\n## Recent Updates (September 2025)\n\n### Mobile Responsiveness Implementation\n- **Complete mobile responsive design**: Eliminated horizontal overflow on all mobile devices (320px-414px widths)\n- **CSS Architecture**: Implemented comprehensive responsive utilities with mobile-first approach\n- **Dialog Responsiveness**: Fixed modal and dialog sizing to properly fit mobile viewports\n- **Safe CSS Practices**: Refined CSS to avoid aggressive global rules that could break components\n- **Testing**: Verified responsive behavior on iPhone 13 viewport (414x896) across all pages and dialogs\n\n# User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n# System Architecture\n\n## Frontend Architecture\n- **Framework**: React 18 with TypeScript using Vite as build tool\n- **Styling**: Tailwind CSS with shadcn/ui component library following Material Design principles\n- **State Management**: TanStack Query (React Query) for server state and caching\n- **Routing**: Wouter for lightweight client-side routing\n- **Theme System**: Custom CSS variables supporting light/dark/auto modes with system preference detection\n- **Internationalization**: Multi-language support for 15 languages with RTL/LTR text direction handling\n- **Component Architecture**: Modular shadcn/ui components with custom business logic components\n\n## Backend Architecture\n- **Runtime**: Node.js with Express.js framework\n- **Language**: TypeScript with ES modules\n- **Session Management**: Express-session for authentication state\n- **Authentication**: Email/password based with bcrypt password hashing\n- **API Design**: RESTful endpoints with JSON responses\n- **Error Handling**: Centralized error handling with validation using Zod schemas\n- **Middleware**: Request logging, authentication guards, and CORS handling\n\n## Database Design\n- **Database**: PostgreSQL with Drizzle ORM\n- **Connection**: Neon serverless PostgreSQL with connection pooling\n- **Schema Management**: Drizzle migrations with TypeScript schema definitions\n- **Multi-tenancy**: Company-based data isolation with foreign key relationships\n- **Key Entities**: Companies, Users, Accounts (Chart of Accounts), with role-based access control\n\n## Authentication & Authorization\n- **Session-based Authentication**: Server-side sessions with HTTP-only cookies\n- **Role System**: Four user roles (owner, accountant, sales, viewer) with permission matrix\n- **Multi-company Support**: Users can belong to and switch between multiple companies\n- **Security**: Password hashing with bcrypt, session timeouts, and secure cookie configuration\n\n## Offline-First Strategy\n- **Client Storage**: IndexedDB for web, native local storage for mobile\n- **Sync Architecture**: Background synchronization with conflict resolution using last-write-wins\n- **Data Merging**: Two-way sync between local encrypted storage and cloud database\n- **Audit Trail**: Complete change tracking for conflict resolution and compliance\n\n## Business Logic Architecture\n- **Multi-currency**: Base currency with exchange rate tracking for international transactions\n- **Tax Engine**: Flexible global tax configuration supporting VAT, Sales Tax, Corporate Tax, and custom rates\n- **Chart of Accounts**: Hierarchical account structure with configurable account types and subtypes\n- **Document Management**: File attachments with OCR integration for automated data extraction\n\n# External Dependencies\n\n## Core Infrastructure\n- **Database**: Neon PostgreSQL serverless database for cloud storage and scalability\n- **Session Store**: In-memory session storage (production should use Redis or database-backed sessions)\n- **File Storage**: Local file system (should be replaced with cloud storage like AWS S3 for production)\n\n## Development Tools\n- **Build System**: Vite for fast development and optimized production builds\n- **Type System**: TypeScript for type safety across frontend and backend\n- **Database ORM**: Drizzle with PostgreSQL dialect for type-safe database operations\n- **Validation**: Zod for runtime type validation and schema definition\n\n## UI Framework\n- **Component Library**: Radix UI primitives with shadcn/ui styling system\n- **Styling**: Tailwind CSS with custom CSS variables for theming\n- **Icons**: Lucide React for consistent iconography\n- **Charts**: Recharts for financial data visualization\n- **Forms**: React Hook Form with Zod validation for form management\n\n## Planned Integrations\n- **Email Service**: SendGrid for transactional emails and notifications\n- **Payment Processing**: Stripe for subscription management and payment processing\n- **Advertising**: AdMob for mobile banner ads and web sidebar advertisements\n- **OCR Service**: Planned integration for automatic invoice and receipt data extraction\n- **Cloud Backup**: Automated backup service integration for data protection","size_bytes":5336},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"Inter\", \"system-ui\", \"sans-serif\"],\n        serif: [\"Georgia\", \"serif\"],\n        mono: [\"JetBrains Mono\", \"monospace\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4076},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":971},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ \n  connectionString: process.env.DATABASE_URL,\n  max: 20, // Maximum number of connections in pool\n  idleTimeoutMillis: 30000, // Close idle connections after 30 seconds\n  connectionTimeoutMillis: 5000, // Connection timeout\n  maxUses: 7500, // Close connection after 7500 uses\n  allowExitOnIdle: true // Allow process to exit when idle\n});\n\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":778},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport session from \"express-session\";\nimport helmet from \"helmet\";\nimport csrf from \"csurf\";\nimport rateLimit from \"express-rate-limit\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\n\n// Security headers\napp.use(helmet({\n  contentSecurityPolicy: false, // Disabled to allow Vite dev server\n  crossOriginEmbedderPolicy: false, // For development\n}));\n\n// Rate limiting for auth endpoints\nconst authLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  max: 5, // limit each IP to 5 requests per windowMs\n  message: \"Too many authentication attempts, please try again later\",\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\n// Apply rate limiting to auth routes\napp.use(\"/api/auth/login\", authLimiter);\napp.use(\"/api/auth/register\", authLimiter);\n\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\n// Session configuration with enhanced security\napp.use(session({\n  secret: process.env.SESSION_SECRET || 'log-ledger-secret-key-change-in-production',\n  name: 'ledger.sid', // Change default session name\n  resave: false,\n  saveUninitialized: false,\n  rolling: true, // Reset expiry on activity\n  cookie: {\n    maxAge: 24 * 60 * 60 * 1000, // 24 hours\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'lax' // CSRF protection\n  }\n}));\n\n// CSRF protection - skip for API routes that need it\nconst csrfProtection = csrf({\n  cookie: false, // Use session instead of cookies\n  ignoreMethods: ['GET', 'HEAD', 'OPTIONS'],\n  value: (req: any) => {\n    // Allow CSRF token in header or body\n    return req.headers['x-csrf-token'] || req.body._csrf;\n  }\n});\n\n// Skip CSRF for certain routes\napp.use((req, res, next) => {\n  // Skip CSRF for all API routes in development\n  // In production, we would properly implement CSRF tokens\n  if (process.env.NODE_ENV === 'development' || \n      req.path === '/api/auth/login' || \n      req.path === '/api/auth/register' || \n      req.path === '/api/auth/logout' ||\n      req.path === '/api/health' ||\n      req.method === 'GET') {\n    return next();\n  }\n  \n  // Apply CSRF protection to other routes in production\n  csrfProtection(req, res, next);\n});\n\n// Provide CSRF token endpoint\napp.get('/api/csrf-token', (req, res) => {\n  res.json({ csrfToken: (req as any).csrfToken?.() || '' });\n});\n\n// Logging middleware\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        // Don't log sensitive data\n        const sanitized = { ...capturedJsonResponse };\n        if (sanitized.password) delete sanitized.password;\n        if (sanitized.password_hash) delete sanitized.password_hash;\n        logLine += ` :: ${JSON.stringify(sanitized)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"â€¦\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  // API 404 fallback - ensures /api/* requests never reach Vite's catch-all HTML handler\n  app.all(\"/api/*\", (_req, res) => {\n    res.status(404).json({ message: \"API endpoint not found\" });\n  });\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();","size_bytes":4673},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { verifyFirebaseToken } from \"./firebaseAdmin\";\nimport { \n  insertUserSchema, insertCompanySchema, insertAccountSchema,\n  insertContactSchema, insertItemSchema, insertTaxSchema,\n  insertSalesInvoiceSchema, insertBillSchema, insertExpenseSchema,\n  insertPaymentSchema, insertReceiptSchema, insertBankAccountSchema, loginSchema, registrationSchema\n} from \"@shared/schema\";\nimport { fromZodError } from \"zod-validation-error\";\nimport bcrypt from \"bcryptjs\";\n\n// Extended Express Request to include session and Firebase user\ndeclare module 'express-serve-static-core' {\n  interface Request {\n    session?: { userId: string; companyId: string } | null;\n    firebaseUser?: { uid: string; email: string } | null;\n  }\n}\n\n// Helper to sanitize user data (remove password_hash for security)\nfunction sanitizeUser(user: any) {\n  const { password_hash, ...sanitized } = user;\n  return sanitized;\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Firebase Authentication middleware\n  const requireFirebaseAuth = async (req: any, res: any, next: any) => {\n    try {\n      const authHeader = req.headers.authorization;\n      if (!authHeader || !authHeader.startsWith('Bearer ')) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const token = authHeader.split('Bearer ')[1];\n      const decodedToken = await verifyFirebaseToken(token);\n      \n      // Add Firebase user to request\n      req.firebaseUser = {\n        uid: decodedToken.uid,\n        email: decodedToken.email\n      };\n      \n      next();\n    } catch (error) {\n      console.error('Firebase token verification failed:', error);\n      return res.status(401).json({ message: \"Authentication required\" });\n    }\n  };\n\n  // Legacy session-based auth for backward compatibility\n  const requireAuth = (req: any, res: any, next: any) => {\n    if (!req.session?.userId || !req.session?.companyId) {\n      return res.status(401).json({ message: \"Authentication required\" });\n    }\n    next();\n  };\n\n  // Authentication routes\n  app.post(\"/api/auth/login\", async (req, res) => {\n    try {\n      // Use the dedicated login schema\n      const { email, password } = loginSchema.parse(req.body);\n      \n      const user = await storage.getUserByEmail(email);\n      if (!user) {\n        return res.status(401).json({ message: \"Invalid credentials\" });\n      }\n      \n      const isValidPassword = await bcrypt.compare(password, user.password_hash);\n      if (!isValidPassword) {\n        return res.status(401).json({ message: \"Invalid credentials\" });\n      }\n      \n      // Set both user and company in session\n      (req as any).session.userId = user.id;\n      (req as any).session.companyId = user.company_id;\n      \n      // Save session explicitly\n      (req as any).session.save((err: any) => {\n        if (err) {\n          console.error('Session save error:', err);\n          return res.status(500).json({ message: \"Session error\" });\n        }\n        res.json(sanitizeUser(user));\n      });\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        const validationError = fromZodError(error);\n        return res.status(400).json({ message: validationError.message });\n      }\n      console.error('Login error:', error);\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  // SSO Login route - Bridge Firebase auth to backend session\n  app.post(\"/api/auth/sso-login\", requireFirebaseAuth, async (req, res) => {\n    try {\n      const { uid, email } = req.firebaseUser!;\n      \n      // Try to find existing user by email\n      let user = await storage.getUserByEmail(email);\n      console.log(`SSO login attempt for ${email}, existing user found: ${!!user}`);\n      \n      if (!user) {\n        // Create new user from Firebase data\n        console.log(`Creating new user from Firebase SSO: ${email}`);\n        \n        // Create a default company first\n        const company = await storage.createCompany({\n          name: `${email.split('@')[0]}'s Company`,\n          base_currency: 'USD',\n          fiscal_year_start: 1,\n          firebase_user_id: uid,\n        });\n        \n        // Generate unique username\n        let baseUsername = email.split('@')[0];\n        let uniqueUsername = baseUsername;\n        let counter = 1;\n        \n        // Check if username already exists and generate unique one\n        while (true) {\n          try {\n            const existingUser = await storage.getUserByUsername?.(uniqueUsername);\n            if (!existingUser) break;\n            uniqueUsername = `${baseUsername}${counter}`;\n            counter++;\n          } catch {\n            // If getUserByUsername doesn't exist, we'll catch the error on user creation\n            break;\n          }\n        }\n        \n        // Create the user profile with potentially unique username\n        let attempts = 0;\n        while (attempts < 5) {\n          try {\n            user = await storage.createUser({\n              company_id: company.id,\n              username: uniqueUsername,\n              email: email,\n              full_name: email.split('@')[0],\n              password: uid, // Use Firebase UID as password\n              role: 'owner',\n              language: 'en',\n              timezone: 'UTC',\n              theme: 'auto',\n              is_active: true,\n            });\n            break; // Success, exit loop\n          } catch (error: any) {\n            if (error.code === '23505' && error.constraint === 'users_username_unique') {\n              // Username collision, try with incremented counter\n              uniqueUsername = `${baseUsername}${counter}`;\n              counter++;\n              attempts++;\n              console.log(`Username collision, trying: ${uniqueUsername}`);\n            } else {\n              throw error; // Different error, re-throw\n            }\n          }\n        }\n        \n        if (!user) {\n          throw new Error('Could not create unique username after multiple attempts');\n        }\n        \n        console.log(`Created new user and company for Firebase SSO: ${user.id}, ${company.id}`);\n      } else {\n        // User already exists, no need to update login time as storage handles this\n        console.log(`Existing user found for Firebase SSO: ${user.id}`);\n      }\n      \n      // Set session for backend API access\n      (req as any).session.userId = user.id;\n      (req as any).session.companyId = user.company_id;\n      \n      // Save session explicitly\n      (req as any).session.save((err: any) => {\n        if (err) {\n          console.error('SSO session save error:', err);\n          return res.status(500).json({ message: \"Session error\" });\n        }\n        \n        console.log(`SSO login successful for ${email}, session established`);\n        res.json(sanitizeUser(user));\n      });\n      \n    } catch (error: any) {\n      console.error('SSO login error:', error);\n      res.status(500).json({ message: \"SSO login failed\" });\n    }\n  });\n\n  app.post(\"/api/auth/logout\", (req, res) => {\n    (req as any).session.destroy((err: any) => {\n      if (err) {\n        console.error('Logout error:', err);\n        return res.status(500).json({ message: \"Logout failed\" });\n      }\n      res.clearCookie('connect.sid');\n      res.json({ message: \"Logged out successfully\" });\n    });\n  });\n\n  app.get(\"/api/auth/me\", async (req, res) => {\n    try {\n      const userId = (req as any).session?.userId;\n      const companyId = (req as any).session?.companyId;\n      if (!userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n      \n      const user = await storage.getUserById(userId);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      \n      // Include company info in response\n      const company = companyId ? await storage.getCompanyById(companyId) : null;\n      \n      res.json({\n        ...sanitizeUser(user),\n        activeCompany: company\n      });\n    } catch (error: any) {\n      console.error('Get user error:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Registration endpoint - creates company and user together\n  app.post(\"/api/auth/register\", async (req, res) => {\n    try {\n      const validatedData = registrationSchema.parse(req.body);\n      \n      // Check if email or username already exists\n      const existingUserByEmail = await storage.getUserByEmail(validatedData.email);\n      if (existingUserByEmail) {\n        return res.status(400).json({ message: \"Email already registered\" });\n      }\n      \n      const existingUserByUsername = await storage.getUserByUsername(validatedData.username);\n      if (existingUserByUsername) {\n        return res.status(400).json({ message: \"Username already taken\" });\n      }\n      \n      // Create company first\n      const company = await storage.createCompany({\n        name: validatedData.companyName,\n        base_currency: validatedData.baseCurrency,\n        fiscal_year_start: validatedData.fiscalYearStart,\n        date_format: \"dd/MM/yyyy\",\n        number_format: \"1,234.56\",\n      });\n      \n      // Create user with the company\n      const user = await storage.createUser({\n        company_id: company.id,\n        username: validatedData.username,\n        email: validatedData.email,\n        password: validatedData.password,\n        full_name: validatedData.fullName,\n        role: \"owner\", // First user is owner\n        language: \"en\",\n        timezone: \"UTC\",\n        theme: \"auto\",\n        is_active: true,\n      });\n      \n      // Set session\n      (req as any).session.userId = user.id;\n      (req as any).session.companyId = company.id;\n      \n      // Save session\n      (req as any).session.save((err: any) => {\n        if (err) {\n          console.error('Session save error:', err);\n          return res.status(500).json({ message: \"Session error\" });\n        }\n        res.status(201).json({\n          user: sanitizeUser(user),\n          company: company,\n        });\n      });\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        const validationError = fromZodError(error);\n        res.status(400).json({ message: validationError.message });\n      } else {\n        console.error(\"Error during registration:\", error);\n        res.status(500).json({ message: \"Failed to register\" });\n      }\n    }\n  });\n\n  // Switch active company\n  app.post(\"/api/auth/switch-company\", requireAuth, async (req, res) => {\n    try {\n      const { companyId } = req.body;\n      if (!companyId) {\n        return res.status(400).json({ message: \"Company ID required\" });\n      }\n      \n      // Verify user has access to this company\n      const company = await storage.getCompanyById(companyId);\n      if (!company) {\n        return res.status(404).json({ message: \"Company not found\" });\n      }\n      \n      // Update session with new company\n      (req as any).session.companyId = companyId;\n      \n      // Also update user's default company\n      await storage.updateUser((req as any).session.userId, { company_id: companyId });\n      \n      (req as any).session.save((err: any) => {\n        if (err) {\n          console.error('Session save error:', err);\n          return res.status(500).json({ message: \"Session error\" });\n        }\n        res.json({ message: \"Company switched successfully\", company });\n      });\n    } catch (error: any) {\n      console.error('Switch company error:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Companies\n  app.post(\"/api/companies\", requireFirebaseAuth, async (req, res) => {\n    try {\n      const validatedData = insertCompanySchema.parse(req.body);\n      // Add Firebase user ID to link company with Firebase user\n      const companyData = {\n        ...validatedData,\n        firebase_user_id: (req as any).firebaseUser.uid\n      };\n      const company = await storage.createCompany(companyData);\n      res.status(201).json(company);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        const validationError = fromZodError(error);\n        res.status(400).json({ error: validationError.message });\n      } else {\n        console.error(\"Error creating company:\", error);\n        res.status(500).json({ error: \"Failed to create company\" });\n      }\n    }\n  });\n\n  app.get(\"/api/companies\", requireFirebaseAuth, async (req, res) => {\n    try {\n      const companies = await storage.getCompaniesByUserId((req as any).firebaseUser.uid);\n      res.json(companies);\n    } catch (error: any) {\n      console.error(\"Error fetching companies:\", error);\n      res.status(500).json({ error: \"Failed to fetch companies\" });\n    }\n  });\n\n  app.put(\"/api/companies/:id\", requireFirebaseAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const userId = (req as any).session.userId;\n      \n      // Check if user has access to this company\n      const userCompanies = await storage.getCompaniesByUserId(userId);\n      const hasAccess = userCompanies.some(company => company.id === id);\n      \n      if (!hasAccess) {\n        return res.status(404).json({ error: \"Company not found\" });\n      }\n      \n      const validatedData = insertCompanySchema.partial().parse(req.body);\n      const company = await storage.updateCompany(id, validatedData);\n      \n      if (!company) {\n        return res.status(404).json({ error: \"Company not found\" });\n      }\n      \n      res.json(company);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        const validationError = fromZodError(error);\n        res.status(400).json({ error: validationError.message });\n      } else {\n        console.error(\"Error updating company:\", error);\n        res.status(500).json({ error: \"Failed to update company\" });\n      }\n    }\n  });\n\n  app.delete(\"/api/companies/:id\", requireFirebaseAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const userId = (req as any).session.userId;\n      \n      // Check if user has access to this company\n      const userCompanies = await storage.getCompaniesByUserId(userId);\n      const hasAccess = userCompanies.some(company => company.id === id);\n      \n      if (!hasAccess) {\n        return res.status(404).json({ error: \"Company not found\" });\n      }\n      \n      // Don't allow deleting the currently active company\n      const currentCompanyId = (req as any).session.companyId;\n      if (id === currentCompanyId) {\n        return res.status(400).json({ error: \"Cannot delete the currently active company\" });\n      }\n      \n      const success = await storage.deleteCompany(id);\n      if (!success) {\n        return res.status(404).json({ error: \"Company not found\" });\n      }\n      \n      res.json({ message: \"Company deleted successfully\" });\n    } catch (error: any) {\n      console.error(\"Error deleting company:\", error);\n      res.status(500).json({ error: \"Failed to delete company\" });\n    }\n  });\n\n  // Reports\n  app.get(\"/api/reports/trial-balance\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const endDate = req.query.endDate ? new Date(req.query.endDate as string) : undefined;\n      \n      const trialBalance = await storage.getTrialBalance(companyId, endDate);\n      res.json(trialBalance);\n    } catch (error: any) {\n      console.error(\"Error fetching trial balance:\", error);\n      res.status(500).json({ error: \"Failed to fetch trial balance\" });\n    }\n  });\n\n  app.get(\"/api/reports/balance-sheet\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const endDate = req.query.endDate ? new Date(req.query.endDate as string) : undefined;\n      \n      const balanceSheet = await storage.getBalanceSheet(companyId, endDate);\n      res.json(balanceSheet);\n    } catch (error: any) {\n      console.error(\"Error fetching balance sheet:\", error);\n      res.status(500).json({ error: \"Failed to fetch balance sheet\" });\n    }\n  });\n\n  app.get(\"/api/reports/profit-loss\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const startDate = req.query.startDate ? new Date(req.query.startDate as string) : undefined;\n      const endDate = req.query.endDate ? new Date(req.query.endDate as string) : undefined;\n      \n      const profitLoss = await storage.getProfitLoss(companyId, startDate, endDate);\n      res.json(profitLoss);\n    } catch (error: any) {\n      console.error(\"Error fetching profit loss:\", error);\n      res.status(500).json({ error: \"Failed to fetch profit loss\" });\n    }\n  });\n\n  app.get(\"/api/reports/cash-flow\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const startDate = req.query.startDate ? new Date(req.query.startDate as string) : undefined;\n      const endDate = req.query.endDate ? new Date(req.query.endDate as string) : undefined;\n      \n      const cashFlow = await storage.getCashFlow(companyId, startDate, endDate);\n      res.json(cashFlow);\n    } catch (error: any) {\n      console.error(\"Error fetching cash flow:\", error);\n      res.status(500).json({ error: \"Failed to fetch cash flow\" });\n    }\n  });\n\n  app.get(\"/api/reports/tax\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const startDate = req.query.startDate ? new Date(req.query.startDate as string) : undefined;\n      const endDate = req.query.endDate ? new Date(req.query.endDate as string) : undefined;\n      \n      const taxReport = await storage.getTaxReport(companyId, startDate, endDate);\n      res.json(taxReport);\n    } catch (error: any) {\n      console.error(\"Error fetching tax report:\", error);\n      res.status(500).json({ error: \"Failed to fetch tax report\" });\n    }\n  });\n\n  // Users (for creating additional users in existing company)\n  app.post(\"/api/users\", requireAuth, async (req, res) => {\n    try {\n      const validatedData = insertUserSchema.parse(req.body);\n      \n      // Ensure the new user is created in the same company\n      const userData = {\n        ...validatedData,\n        company_id: (req as any).session.companyId,\n      };\n      \n      const user = await storage.createUser(userData);\n      \n      // CRITICAL: Remove password_hash from response for security\n      res.status(201).json(sanitizeUser(user));\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        const validationError = fromZodError(error);\n        res.status(400).json({ error: validationError.message });\n      } else {\n        console.error(\"Error creating user:\", error);\n        res.status(500).json({ error: \"Failed to create user\" });\n      }\n    }\n  });\n\n  app.get(\"/api/users/:id\", async (req, res) => {\n    try {\n      const user = await storage.getUser(req.params.id);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      \n      // CRITICAL: Remove password_hash from response for security\n      res.json(sanitizeUser(user));\n    } catch (error: any) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ error: \"Failed to fetch user\" });\n    }\n  });\n\n  // Health check\n  app.get(\"/api/health\", (req, res) => {\n    res.json({ status: \"ok\", timestamp: new Date().toISOString() });\n  });\n\n  // === Chart of Accounts ===\n  app.get(\"/api/accounts\", requireAuth, async (req, res) => {\n    try {\n      // Use company from session instead of user's default company\n      const companyId = (req as any).session.companyId;\n      const accounts = await storage.getAccountsByCompany(companyId);\n      res.json(accounts);\n    } catch (error: any) {\n      console.error(\"Error fetching accounts:\", error);\n      res.status(500).json({ error: \"Failed to fetch accounts\" });\n    }\n  });\n\n  app.post(\"/api/accounts\", requireAuth, async (req, res) => {\n    try {\n      // Use company from session\n      const companyId = (req as any).session.companyId;\n      \n      const validatedData = insertAccountSchema.parse({\n        ...req.body,\n        company_id: companyId\n      });\n      const account = await storage.createAccount(validatedData);\n      res.status(201).json(account);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        const validationError = fromZodError(error);\n        res.status(400).json({ error: validationError.message });\n      } else {\n        console.error(\"Error creating account:\", error);\n        res.status(500).json({ error: \"Failed to create account\" });\n      }\n    }\n  });\n\n  app.put(\"/api/accounts/:id\", requireAuth, async (req, res) => {\n    try {\n      const account = await storage.updateAccount(req.params.id, req.body);\n      if (!account) return res.status(404).json({ error: \"Account not found\" });\n      res.json(account);\n    } catch (error: any) {\n      console.error(\"Error updating account:\", error);\n      res.status(500).json({ error: \"Failed to update account\" });\n    }\n  });\n\n  app.delete(\"/api/accounts/:id\", requireAuth, async (req, res) => {\n    try {\n      const success = await storage.deleteAccount(req.params.id);\n      if (!success) return res.status(404).json({ error: \"Account not found\" });\n      res.json({ message: \"Account deleted successfully\" });\n    } catch (error: any) {\n      console.error(\"Error deleting account:\", error);\n      res.status(500).json({ error: \"Failed to delete account\" });\n    }\n  });\n\n  // === Contacts (Customers/Suppliers) ===\n  app.get(\"/api/contacts\", requireAuth, async (req, res) => {\n    try {\n      // Use company from session\n      const companyId = (req as any).session.companyId;\n      const contacts = await storage.getContactsByCompany(companyId);\n      res.json(contacts);\n    } catch (error: any) {\n      console.error(\"Error fetching contacts:\", error);\n      res.status(500).json({ error: \"Failed to fetch contacts\" });\n    }\n  });\n\n  app.post(\"/api/contacts\", requireAuth, async (req, res) => {\n    try {\n      // Use company from session\n      const companyId = (req as any).session.companyId;\n      \n      const validatedData = insertContactSchema.parse({\n        ...req.body,\n        company_id: companyId\n      });\n      const contact = await storage.createContact(validatedData);\n      res.status(201).json(contact);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        const validationError = fromZodError(error);\n        res.status(400).json({ error: validationError.message });\n      } else {\n        console.error(\"Error creating contact:\", error);\n        res.status(500).json({ error: \"Failed to create contact\" });\n      }\n    }\n  });\n\n  app.put(\"/api/contacts/:id\", requireAuth, async (req, res) => {\n    try {\n      const contact = await storage.updateContact(req.params.id, req.body);\n      if (!contact) return res.status(404).json({ error: \"Contact not found\" });\n      res.json(contact);\n    } catch (error: any) {\n      console.error(\"Error updating contact:\", error);\n      res.status(500).json({ error: \"Failed to update contact\" });\n    }\n  });\n\n  app.delete(\"/api/contacts/:id\", requireAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const companyId = (req as any).session.companyId;\n      \n      const success = await storage.deleteContact(companyId, id);\n      if (!success) return res.status(404).json({ error: \"Contact not found\" });\n      res.json({ message: \"Contact deleted successfully\" });\n    } catch (error: any) {\n      console.error(\"Error deleting contact:\", error);\n      res.status(500).json({ error: \"Failed to delete contact\" });\n    }\n  });\n\n  // === Items (Products/Services) ===\n  app.get(\"/api/items\", requireAuth, async (req, res) => {\n    try {\n      // Use company from session\n      const companyId = (req as any).session.companyId;\n      const items = await storage.getItemsByCompany(companyId);\n      res.json(items);\n    } catch (error: any) {\n      console.error(\"Error fetching items:\", error);\n      res.status(500).json({ error: \"Failed to fetch items\" });\n    }\n  });\n\n  app.post(\"/api/items\", requireAuth, async (req, res) => {\n    try {\n      // Use company from session\n      const companyId = (req as any).session.companyId;\n      \n      const validatedData = insertItemSchema.parse({\n        ...req.body,\n        company_id: companyId\n      });\n      const item = await storage.createItem(validatedData);\n      res.status(201).json(item);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        const validationError = fromZodError(error);\n        res.status(400).json({ error: validationError.message });\n      } else {\n        console.error(\"Error creating item:\", error);\n        res.status(500).json({ error: \"Failed to create item\" });\n      }\n    }\n  });\n\n  app.put(\"/api/items/:id\", requireAuth, async (req, res) => {\n    try {\n      const item = await storage.updateItem(req.params.id, req.body);\n      if (!item) return res.status(404).json({ error: \"Item not found\" });\n      res.json(item);\n    } catch (error: any) {\n      console.error(\"Error updating item:\", error);\n      res.status(500).json({ error: \"Failed to update item\" });\n    }\n  });\n\n  app.delete(\"/api/items/:id\", requireAuth, async (req, res) => {\n    try {\n      const success = await storage.deleteItem(req.params.id);\n      if (!success) return res.status(404).json({ error: \"Item not found\" });\n      res.json({ message: \"Item deleted successfully\" });\n    } catch (error: any) {\n      console.error(\"Error deleting item:\", error);\n      res.status(500).json({ error: \"Failed to delete item\" });\n    }\n  });\n\n  // === SALES INVOICES ===\n  app.get(\"/api/sales/invoices\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const invoices = await storage.getSalesInvoicesByCompany(companyId);\n      res.json(invoices);\n    } catch (error: any) {\n      console.error(\"Error fetching invoices:\", error);\n      res.status(500).json({ error: \"Failed to fetch invoices\" });\n    }\n  });\n\n  app.post(\"/api/sales/invoices\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const userId = (req as any).session.userId;\n      \n      const validatedData = insertSalesInvoiceSchema.parse({\n        ...req.body,\n        company_id: companyId,\n        created_by: userId\n      });\n      const invoice = await storage.createSalesInvoice(validatedData);\n      res.status(201).json(invoice);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        const validationError = fromZodError(error);\n        res.status(400).json({ error: validationError.message });\n      } else {\n        console.error(\"Error creating invoice:\", error);\n        res.status(500).json({ error: \"Failed to create invoice\" });\n      }\n    }\n  });\n\n  app.get(\"/api/sales/invoices/:id\", requireAuth, async (req, res) => {\n    try {\n      const invoice = await storage.getSalesInvoiceById(req.params.id);\n      if (!invoice) return res.status(404).json({ error: \"Invoice not found\" });\n      res.json(invoice);\n    } catch (error: any) {\n      console.error(\"Error fetching invoice:\", error);\n      res.status(500).json({ error: \"Failed to fetch invoice\" });\n    }\n  });\n\n  app.put(\"/api/sales/invoices/:id\", requireAuth, async (req, res) => {\n    try {\n      const invoice = await storage.updateSalesInvoice(req.params.id, req.body);\n      if (!invoice) return res.status(404).json({ error: \"Invoice not found\" });\n      res.json(invoice);\n    } catch (error: any) {\n      console.error(\"Error updating invoice:\", error);\n      res.status(500).json({ error: \"Failed to update invoice\" });\n    }\n  });\n\n  app.delete(\"/api/sales/invoices/:id\", requireAuth, async (req, res) => {\n    try {\n      const success = await storage.deleteSalesInvoice(req.params.id);\n      if (!success) return res.status(404).json({ error: \"Invoice not found\" });\n      res.json({ message: \"Invoice deleted successfully\" });\n    } catch (error: any) {\n      console.error(\"Error deleting invoice:\", error);\n      res.status(500).json({ error: \"Failed to delete invoice\" });\n    }\n  });\n\n  // === SALES QUOTATIONS ===\n  app.get(\"/api/sales/quotations\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const quotations = await storage.getSalesQuotesByCompany(companyId);\n      res.json(quotations);\n    } catch (error: any) {\n      console.error(\"Error fetching quotations:\", error);\n      res.status(500).json({ error: \"Failed to fetch quotations\" });\n    }\n  });\n\n  app.post(\"/api/sales/quotations\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const userId = (req as any).session.userId;\n      \n      const validatedData = {\n        ...req.body,\n        company_id: companyId,\n        created_by: userId\n      };\n      const quotation = await storage.createSalesQuote(validatedData);\n      res.status(201).json(quotation);\n    } catch (error: any) {\n      console.error(\"Error creating quotation:\", error);\n      res.status(500).json({ error: \"Failed to create quotation\" });\n    }\n  });\n\n  // === SALES ORDERS ===\n  app.get(\"/api/sales/orders\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const orders = await storage.getSalesOrdersByCompany(companyId);\n      res.json(orders);\n    } catch (error: any) {\n      console.error(\"Error fetching orders:\", error);\n      res.status(500).json({ error: \"Failed to fetch orders\" });\n    }\n  });\n\n  app.post(\"/api/sales/orders\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const userId = (req as any).session.userId;\n      \n      const validatedData = {\n        ...req.body,\n        company_id: companyId,\n        created_by: userId\n      };\n      const order = await storage.createSalesOrder(validatedData);\n      res.status(201).json(order);\n    } catch (error: any) {\n      console.error(\"Error creating order:\", error);\n      res.status(500).json({ error: \"Failed to create order\" });\n    }\n  });\n\n  // === BANK ACCOUNTS ===\n  app.get(\"/api/banking/accounts\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const accounts = await storage.getBankAccountsByCompany(companyId);\n      res.json(accounts);\n    } catch (error: any) {\n      console.error(\"Error fetching bank accounts:\", error);\n      res.status(500).json({ error: \"Failed to fetch bank accounts\" });\n    }\n  });\n\n  app.post(\"/api/banking/accounts\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      \n      const validatedData = insertBankAccountSchema.parse({\n        ...req.body,\n        company_id: companyId\n      });\n      const account = await storage.createBankAccount(validatedData);\n      res.status(201).json(account);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        const validationError = fromZodError(error);\n        res.status(400).json({ error: validationError.message });\n      } else {\n        console.error(\"Error creating bank account:\", error);\n        res.status(500).json({ error: \"Failed to create bank account\" });\n      }\n    }\n  });\n\n  app.put(\"/api/banking/accounts/:id\", requireAuth, async (req, res) => {\n    try {\n      const account = await storage.updateBankAccount(req.params.id, req.body);\n      if (!account) return res.status(404).json({ error: \"Bank account not found\" });\n      res.json(account);\n    } catch (error: any) {\n      console.error(\"Error updating bank account:\", error);\n      res.status(500).json({ error: \"Failed to update bank account\" });\n    }\n  });\n\n  app.delete(\"/api/banking/accounts/:id\", requireAuth, async (req, res) => {\n    try {\n      const success = await storage.deleteBankAccount(req.params.id);\n      if (!success) return res.status(404).json({ error: \"Bank account not found\" });\n      res.json({ message: \"Bank account deleted successfully\" });\n    } catch (error: any) {\n      console.error(\"Error deleting bank account:\", error);\n      res.status(500).json({ error: \"Failed to delete bank account\" });\n    }\n  });\n\n  // === PURCHASES ===\n  app.get(\"/api/purchases/bills\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const bills = await storage.getBillsByCompany(companyId);\n      res.json(bills);\n    } catch (error: any) {\n      console.error(\"Error fetching bills:\", error);\n      res.status(500).json({ error: \"Failed to fetch bills\" });\n    }\n  });\n\n  app.post(\"/api/purchases/bills\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const userId = (req as any).session.userId;\n      \n      const validatedData = insertBillSchema.parse({\n        ...req.body,\n        company_id: companyId,\n        created_by: userId\n      });\n      const bill = await storage.createBill(validatedData);\n      res.status(201).json(bill);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        const validationError = fromZodError(error);\n        res.status(400).json({ error: validationError.message });\n      } else {\n        console.error(\"Error creating bill:\", error);\n        res.status(500).json({ error: \"Failed to create bill\" });\n      }\n    }\n  });\n\n  app.delete(\"/api/purchases/bills/:id\", requireAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const companyId = (req as any).session.companyId;\n      \n      const deleted = await storage.deleteBill(companyId, id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"Bill not found\" });\n      }\n      \n      res.json({ success: true });\n    } catch (error: any) {\n      console.error(\"Error deleting bill:\", error);\n      res.status(500).json({ error: \"Failed to delete bill\" });\n    }\n  });\n\n  app.get(\"/api/purchases/orders\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const orders = await storage.getPurchaseOrdersByCompany(companyId);\n      res.json(orders);\n    } catch (error: any) {\n      console.error(\"Error fetching purchase orders:\", error);\n      res.status(500).json({ error: \"Failed to fetch purchase orders\" });\n    }\n  });\n\n  app.post(\"/api/purchases/orders\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const userId = (req as any).session.userId;\n      \n      const validatedData = {\n        ...req.body,\n        company_id: companyId,\n        created_by: userId\n      };\n      const order = await storage.createPurchaseOrder(validatedData);\n      res.status(201).json(order);\n    } catch (error: any) {\n      console.error(\"Error creating purchase order:\", error);\n      res.status(500).json({ error: \"Failed to create purchase order\" });\n    }\n  });\n\n  app.get(\"/api/purchases/expenses\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const expenses = await storage.getExpensesByCompany(companyId);\n      res.json(expenses);\n    } catch (error: any) {\n      console.error(\"Error fetching expenses:\", error);\n      res.status(500).json({ error: \"Failed to fetch expenses\" });\n    }\n  });\n\n  app.post(\"/api/purchases/expenses\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const userId = (req as any).session.userId;\n      \n      const validatedData = insertExpenseSchema.parse({\n        ...req.body,\n        company_id: companyId,\n        created_by: userId\n      });\n      const expense = await storage.createExpense(validatedData);\n      res.status(201).json(expense);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        const validationError = fromZodError(error);\n        res.status(400).json({ error: validationError.message });\n      } else {\n        console.error(\"Error creating expense:\", error);\n        res.status(500).json({ error: \"Failed to create expense\" });\n      }\n    }\n  });\n\n  // === PAYMENTS ROUTES ===\n  app.get(\"/api/banking/payments\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const payments = await storage.getPaymentsByCompany(companyId);\n      res.json(payments);\n    } catch (error: any) {\n      console.error(\"Error fetching payments:\", error);\n      res.status(500).json({ error: \"Failed to fetch payments\" });\n    }\n  });\n\n  app.post(\"/api/banking/payments\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const userId = (req as any).session.userId;\n      \n      const validatedData = insertPaymentSchema.parse({\n        ...req.body,\n        company_id: companyId,\n        created_by: userId\n      });\n      const payment = await storage.createPayment(validatedData);\n      res.status(201).json(payment);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        const validationError = fromZodError(error);\n        res.status(400).json({ error: validationError.message });\n      } else {\n        console.error(\"Error creating payment:\", error);\n        res.status(500).json({ error: \"Failed to create payment\" });\n      }\n    }\n  });\n\n  app.delete(\"/api/banking/payments/:id\", requireAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const companyId = (req as any).session.companyId;\n      \n      const deleted = await storage.deletePayment(companyId, id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"Payment not found\" });\n      }\n      \n      res.json({ success: true });\n    } catch (error: any) {\n      console.error(\"Error deleting payment:\", error);\n      res.status(500).json({ error: \"Failed to delete payment\" });\n    }\n  });\n\n  // === RECEIPTS ROUTES ===\n  app.get(\"/api/banking/receipts\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const receipts = await storage.getReceiptsByCompany(companyId);\n      res.json(receipts);\n    } catch (error: any) {\n      console.error(\"Error fetching receipts:\", error);\n      res.status(500).json({ error: \"Failed to fetch receipts\" });\n    }\n  });\n\n  app.post(\"/api/banking/receipts\", requireAuth, async (req, res) => {\n    try {\n      const companyId = (req as any).session.companyId;\n      const userId = (req as any).session.userId;\n      \n      const validatedData = insertReceiptSchema.parse({\n        ...req.body,\n        company_id: companyId,\n        created_by: userId\n      });\n      const receipt = await storage.createReceipt(validatedData);\n      res.status(201).json(receipt);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        const validationError = fromZodError(error);\n        res.status(400).json({ error: validationError.message });\n      } else {\n        console.error(\"Error creating receipt:\", error);\n        res.status(500).json({ error: \"Failed to create receipt\" });\n      }\n    }\n  });\n\n  app.delete(\"/api/banking/receipts/:id\", requireAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const companyId = (req as any).session.companyId;\n      \n      const deleted = await storage.deleteReceipt(companyId, id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"Receipt not found\" });\n      }\n      \n      res.json({ success: true });\n    } catch (error: any) {\n      console.error(\"Error deleting receipt:\", error);\n      res.status(500).json({ error: \"Failed to delete receipt\" });\n    }\n  });\n\n  // === Taxes ===\n  app.get(\"/api/taxes\", requireAuth, async (req, res) => {\n    try {\n      // Use company from session\n      const companyId = (req as any).session.companyId;\n      const taxes = await storage.getTaxesByCompany(companyId);\n      res.json(taxes);\n    } catch (error: any) {\n      console.error(\"Error fetching taxes:\", error);\n      res.status(500).json({ error: \"Failed to fetch taxes\" });\n    }\n  });\n\n  app.post(\"/api/taxes\", requireAuth, async (req, res) => {\n    try {\n      // Use company from session\n      const companyId = (req as any).session.companyId;\n      \n      const validatedData = insertTaxSchema.parse({\n        ...req.body,\n        company_id: companyId\n      });\n      const tax = await storage.createTax(validatedData);\n      res.status(201).json(tax);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        const validationError = fromZodError(error);\n        res.status(400).json({ error: validationError.message });\n      } else {\n        console.error(\"Error creating tax:\", error);\n        res.status(500).json({ error: \"Failed to create tax\" });\n      }\n    }\n  });\n\n  app.put(\"/api/taxes/:id\", requireAuth, async (req, res) => {\n    try {\n      const tax = await storage.updateTax(req.params.id, req.body);\n      if (!tax) return res.status(404).json({ error: \"Tax not found\" });\n      res.json(tax);\n    } catch (error: any) {\n      console.error(\"Error updating tax:\", error);\n      res.status(500).json({ error: \"Failed to update tax\" });\n    }\n  });\n\n  app.delete(\"/api/taxes/:id\", requireAuth, async (req, res) => {\n    try {\n      const success = await storage.deleteTax(req.params.id);\n      if (!success) return res.status(404).json({ error: \"Tax not found\" });\n      res.json({ message: \"Tax deleted successfully\" });\n    } catch (error: any) {\n      console.error(\"Error deleting tax:\", error);\n      res.status(500).json({ error: \"Failed to delete tax\" });\n    }\n  });\n\n  // === Firebase Auth Banking & Accounts Endpoints (for frontend compatibility) ===\n  \n  // Firebase-compatible accounts endpoint\n  app.get(\"/api/banking/accounts\", requireFirebaseAuth, async (req, res) => {\n    try {\n      // For Firebase auth, we need to find user's companies first\n      const userId = (req as any).firebaseUser.uid;\n      const userCompanies = await storage.getCompaniesByUserId(userId);\n      \n      if (userCompanies.length === 0) {\n        return res.json([]); // No companies, no accounts\n      }\n      \n      // Get accounts from the first company (or all companies)\n      const companyId = userCompanies[0].id;\n      const accounts = await storage.getAccountsByCompany(companyId);\n      res.json(accounts);\n    } catch (error: any) {\n      console.error(\"Error fetching banking accounts:\", error);\n      res.status(500).json({ error: \"Failed to fetch accounts\" });\n    }\n  });\n\n  // Firebase-compatible accounts endpoint\n  app.get(\"/api/accounts\", requireFirebaseAuth, async (req, res) => {\n    try {\n      const userId = (req as any).firebaseUser.uid;\n      const userCompanies = await storage.getCompaniesByUserId(userId);\n      \n      if (userCompanies.length === 0) {\n        return res.json([]);\n      }\n      \n      const companyId = userCompanies[0].id;\n      const accounts = await storage.getAccountsByCompany(companyId);\n      res.json(accounts);\n    } catch (error: any) {\n      console.error(\"Error fetching accounts:\", error);\n      res.status(500).json({ error: \"Failed to fetch accounts\" });\n    }\n  });\n\n  // Firebase-compatible banking transactions endpoint\n  app.get(\"/api/banking/transactions\", requireFirebaseAuth, async (req, res) => {\n    try {\n      const userId = (req as any).firebaseUser.uid;\n      const userCompanies = await storage.getCompaniesByUserId(userId);\n      \n      if (userCompanies.length === 0) {\n        return res.json([]);\n      }\n      \n      const companyId = userCompanies[0].id;\n      \n      // Get bank accounts for this company\n      const bankAccounts = await storage.getBankAccountsByCompany(companyId);\n      \n      // If no bank accounts, return empty array\n      if (bankAccounts.length === 0) {\n        return res.json([]);\n      }\n      \n      // Get transactions for the first bank account or all accounts\n      // For now, return empty array - this would need proper transaction fetching\n      res.json([]);\n    } catch (error: any) {\n      console.error(\"Error fetching banking transactions:\", error);\n      res.status(500).json({ error: \"Failed to fetch transactions\" });\n    }\n  });\n\n  // Create accounts with Firebase auth\n  app.post(\"/api/accounts\", requireFirebaseAuth, async (req, res) => {\n    try {\n      const userId = (req as any).firebaseUser.uid;\n      const userCompanies = await storage.getCompaniesByUserId(userId);\n      \n      if (userCompanies.length === 0) {\n        return res.status(400).json({ error: \"No company found for user\" });\n      }\n      \n      const companyId = userCompanies[0].id;\n      \n      const validatedData = insertAccountSchema.parse({\n        ...req.body,\n        company_id: companyId\n      });\n      const account = await storage.createAccount(validatedData);\n      res.status(201).json(account);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        const validationError = fromZodError(error);\n        res.status(400).json({ error: validationError.message });\n      } else {\n        console.error(\"Error creating account:\", error);\n        res.status(500).json({ error: \"Failed to create account\" });\n      }\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":45333},"server/storage.ts":{"content":"import { \n  users, companies, accounts, contacts, items, taxes,\n  sales_invoices, sales_quotes, sales_orders, bank_accounts,\n  purchase_orders, bills, expenses, payments, receipts,\n  journals, journal_lines,\n  type User, type InsertUser, type Company, type InsertCompany,\n  type Account, type InsertAccount, type Contact, type InsertContact,\n  type Item, type InsertItem, type Tax, type InsertTax,\n  type SalesInvoice, type InsertSalesInvoice, type SalesQuote, type SalesOrder,\n  type BankAccount, type InsertBankAccount, type PurchaseOrder, type Bill, type InsertBill,\n  type Expense, type InsertExpense, type Payment, type InsertPayment,\n  type Receipt, type InsertReceipt\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, sql, lte, gte, or } from \"drizzle-orm\";\nimport * as bcrypt from \"bcryptjs\";\n\n// modify the interface with any CRUD methods\n// you might need\n\nexport interface IStorage {\n  // Users\n  getUser(id: string): Promise<User | undefined>;\n  getUserById(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUser(id: string, user: Partial<InsertUser>): Promise<User | undefined>;\n  \n  // Companies\n  createCompany(company: InsertCompany): Promise<Company>;\n  getCompanyById(id: string): Promise<Company | undefined>;\n  getCompaniesByUserId(userId: string): Promise<Company[]>;\n  updateCompany(id: string, company: Partial<InsertCompany>): Promise<Company | undefined>;\n  deleteCompany(id: string): Promise<boolean>;\n  switchUserCompany(userId: string, companyId: string): Promise<boolean>;\n  \n  // Accounts (Chart of Accounts)\n  createAccount(account: InsertAccount): Promise<Account>;\n  getAccountsByCompany(companyId: string): Promise<Account[]>;\n  getAccountById(id: string): Promise<Account | undefined>;\n  updateAccount(id: string, account: Partial<InsertAccount>): Promise<Account | undefined>;\n  deleteAccount(id: string): Promise<boolean>;\n  \n  // Contacts (Customers/Suppliers)\n  createContact(contact: InsertContact): Promise<Contact>;\n  getContactsByCompany(companyId: string): Promise<Contact[]>;\n  getContactById(id: string): Promise<Contact | undefined>;\n  updateContact(id: string, contact: Partial<InsertContact>): Promise<Contact | undefined>;\n  deleteContact(companyId: string, id: string): Promise<boolean>;\n  \n  // Items (Products/Services)\n  createItem(item: InsertItem): Promise<Item>;\n  getItemsByCompany(companyId: string): Promise<Item[]>;\n  getItemById(id: string): Promise<Item | undefined>;\n  updateItem(id: string, item: Partial<InsertItem>): Promise<Item | undefined>;\n  deleteItem(id: string): Promise<boolean>;\n  \n  // Taxes\n  createTax(tax: InsertTax): Promise<Tax>;\n  getTaxesByCompany(companyId: string): Promise<Tax[]>;\n  getTaxById(id: string): Promise<Tax | undefined>;\n  updateTax(id: string, tax: Partial<InsertTax>): Promise<Tax | undefined>;\n  deleteTax(id: string): Promise<boolean>;\n  \n  // Sales Invoices\n  createSalesInvoice(invoice: InsertSalesInvoice): Promise<SalesInvoice>;\n  getSalesInvoicesByCompany(companyId: string): Promise<SalesInvoice[]>;\n  getSalesInvoiceById(id: string): Promise<SalesInvoice | undefined>;\n  updateSalesInvoice(id: string, invoice: Partial<InsertSalesInvoice>): Promise<SalesInvoice | undefined>;\n  deleteSalesInvoice(id: string): Promise<boolean>;\n  \n  // Sales Quotes\n  createSalesQuote(quote: any): Promise<SalesQuote>;\n  getSalesQuotesByCompany(companyId: string): Promise<SalesQuote[]>;\n  \n  // Sales Orders\n  createSalesOrder(order: any): Promise<SalesOrder>;\n  getSalesOrdersByCompany(companyId: string): Promise<SalesOrder[]>;\n  \n  // Bank Accounts\n  createBankAccount(bankAccount: InsertBankAccount): Promise<BankAccount>;\n  getBankAccountsByCompany(companyId: string): Promise<BankAccount[]>;\n  updateBankAccount(id: string, bankAccount: Partial<InsertBankAccount>): Promise<BankAccount | undefined>;\n  deleteBankAccount(id: string): Promise<boolean>;\n  \n  // Bills\n  createBill(bill: InsertBill): Promise<Bill>;\n  getBillsByCompany(companyId: string): Promise<Bill[]>;\n  deleteBill(companyId: string, id: string): Promise<boolean>;\n  \n  // Purchase Orders\n  createPurchaseOrder(order: any): Promise<PurchaseOrder>;\n  getPurchaseOrdersByCompany(companyId: string): Promise<PurchaseOrder[]>;\n  \n  // Expenses\n  createExpense(expense: InsertExpense): Promise<Expense>;\n  getExpensesByCompany(companyId: string): Promise<Expense[]>;\n  \n  // Payments\n  createPayment(payment: InsertPayment): Promise<Payment>;\n  getPaymentsByCompany(companyId: string): Promise<Payment[]>;\n  deletePayment(companyId: string, id: string): Promise<boolean>;\n  \n  // Receipts\n  createReceipt(receipt: InsertReceipt): Promise<Receipt>;\n  getReceiptsByCompany(companyId: string): Promise<Receipt[]>;\n  deleteReceipt(companyId: string, id: string): Promise<boolean>;\n  \n  // Reports\n  getTrialBalance(companyId: string, endDate?: Date): Promise<any[]>;\n  getBalanceSheet(companyId: string, endDate?: Date): Promise<any>;\n  getProfitLoss(companyId: string, startDate?: Date, endDate?: Date): Promise<any>;\n  getCashFlow(companyId: string, startDate?: Date, endDate?: Date): Promise<any>;\n  getTaxReport(companyId: string, startDate?: Date, endDate?: Date): Promise<any>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user || undefined;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user || undefined;\n  }\n\n  async getUserById(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user || undefined;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user || undefined;\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    // Hash the password before storing\n    const passwordHash = await bcrypt.hash(insertUser.password, 10);\n    \n    // Remove password and add password_hash for database insertion\n    const { password, ...userDataWithoutPassword } = insertUser;\n    const userDataForDB = {\n      ...userDataWithoutPassword,\n      password_hash: passwordHash\n    };\n    \n    const [user] = await db\n      .insert(users)\n      .values(userDataForDB)\n      .returning();\n    return user;\n  }\n\n  async createCompany(insertCompany: InsertCompany): Promise<Company> {\n    const [company] = await db\n      .insert(companies)\n      .values(insertCompany)\n      .returning();\n    return company;\n  }\n\n  async updateUser(id: string, updateData: Partial<InsertUser>): Promise<User | undefined> {\n    // If password is being updated, hash it\n    if (updateData.password) {\n      const passwordHash = await bcrypt.hash(updateData.password, 10);\n      const { password, ...dataWithoutPassword } = updateData;\n      const dataForDB = {\n        ...dataWithoutPassword,\n        password_hash: passwordHash,\n        updated_at: new Date()\n      };\n      \n      const [user] = await db\n        .update(users)\n        .set(dataForDB)\n        .where(eq(users.id, id))\n        .returning();\n      return user;\n    }\n    \n    const [user] = await db\n      .update(users)\n      .set({ ...updateData, updated_at: new Date() })\n      .where(eq(users.id, id))\n      .returning();\n    return user;\n  }\n\n  async getCompanyById(id: string): Promise<Company | undefined> {\n    const [company] = await db.select().from(companies).where(eq(companies.id, id));\n    return company || undefined;\n  }\n\n  async updateCompany(id: string, updateData: Partial<InsertCompany>): Promise<Company | undefined> {\n    const [company] = await db\n      .update(companies)\n      .set({ ...updateData, updated_at: new Date() })\n      .where(eq(companies.id, id))\n      .returning();\n    return company;\n  }\n\n  async deleteCompany(id: string): Promise<boolean> {\n    const result = await db.delete(companies).where(eq(companies.id, id));\n    return true;\n  }\n\n  async switchUserCompany(userId: string, companyId: string): Promise<boolean> {\n    // Verify company exists\n    const company = await this.getCompanyById(companyId);\n    if (!company) {\n      return false;\n    }\n    \n    // Update user's company_id\n    const user = await this.updateUser(userId, { company_id: companyId });\n    return !!user;\n  }\n\n  async getCompaniesByUserId(userId: string): Promise<Company[]> {\n    // First try Firebase user lookup (for Firebase authentication)\n    const firebaseCompanies = await db.select().from(companies).where(eq(companies.firebase_user_id, userId));\n    if (firebaseCompanies.length > 0) {\n      return firebaseCompanies;\n    }\n    \n    // Fallback to session-based user lookup\n    const user = await this.getUserById(userId);\n    if (!user) {\n      return [];\n    }\n    \n    // For now, return the company that the user belongs to\n    // Later we can extend this to support multi-company access\n    const companyList = await db.select().from(companies).where(eq(companies.id, user.company_id));\n    return companyList;\n  }\n\n  // === Accounts Implementation ===\n  async createAccount(insertAccount: InsertAccount): Promise<Account> {\n    const [account] = await db\n      .insert(accounts)\n      .values(insertAccount)\n      .returning();\n    return account;\n  }\n\n  async getAccountsByCompany(companyId: string): Promise<Account[]> {\n    return await db.select().from(accounts).where(eq(accounts.company_id, companyId));\n  }\n\n  async getAccountById(id: string): Promise<Account | undefined> {\n    const [account] = await db.select().from(accounts).where(eq(accounts.id, id));\n    return account || undefined;\n  }\n\n  async updateAccount(id: string, updateData: Partial<InsertAccount>): Promise<Account | undefined> {\n    const [account] = await db\n      .update(accounts)\n      .set({ ...updateData, updated_at: new Date() })\n      .where(eq(accounts.id, id))\n      .returning();\n    return account;\n  }\n\n  async deleteAccount(id: string): Promise<boolean> {\n    await db.delete(accounts).where(eq(accounts.id, id));\n    return true;\n  }\n\n  // === Contacts Implementation ===\n  async createContact(insertContact: InsertContact): Promise<Contact> {\n    const [contact] = await db\n      .insert(contacts)\n      .values(insertContact)\n      .returning();\n    return contact;\n  }\n\n  async getContactsByCompany(companyId: string): Promise<Contact[]> {\n    return await db.select().from(contacts).where(eq(contacts.company_id, companyId));\n  }\n\n  async getContactById(id: string): Promise<Contact | undefined> {\n    const [contact] = await db.select().from(contacts).where(eq(contacts.id, id));\n    return contact || undefined;\n  }\n\n  async updateContact(id: string, updateData: Partial<InsertContact>): Promise<Contact | undefined> {\n    const [contact] = await db\n      .update(contacts)\n      .set({ ...updateData, updated_at: new Date() })\n      .where(eq(contacts.id, id))\n      .returning();\n    return contact;\n  }\n\n  async deleteContact(companyId: string, id: string): Promise<boolean> {\n    const result = await db.delete(contacts).where(\n      and(eq(contacts.id, id), eq(contacts.company_id, companyId))\n    );\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // === Items Implementation ===\n  async createItem(insertItem: InsertItem): Promise<Item> {\n    const [item] = await db\n      .insert(items)\n      .values(insertItem)\n      .returning();\n    return item;\n  }\n\n  async getItemsByCompany(companyId: string): Promise<Item[]> {\n    return await db.select().from(items).where(eq(items.company_id, companyId));\n  }\n\n  async getItemById(id: string): Promise<Item | undefined> {\n    const [item] = await db.select().from(items).where(eq(items.id, id));\n    return item || undefined;\n  }\n\n  async updateItem(id: string, updateData: Partial<InsertItem>): Promise<Item | undefined> {\n    const [item] = await db\n      .update(items)\n      .set({ ...updateData, updated_at: new Date() })\n      .where(eq(items.id, id))\n      .returning();\n    return item;\n  }\n\n  async deleteItem(id: string): Promise<boolean> {\n    await db.delete(items).where(eq(items.id, id));\n    return true;\n  }\n\n  // === Taxes Implementation ===\n  async createTax(insertTax: InsertTax): Promise<Tax> {\n    const [tax] = await db\n      .insert(taxes)\n      .values(insertTax)\n      .returning();\n    return tax;\n  }\n\n  async getTaxesByCompany(companyId: string): Promise<Tax[]> {\n    return await db.select().from(taxes).where(eq(taxes.company_id, companyId));\n  }\n\n  async getTaxById(id: string): Promise<Tax | undefined> {\n    const [tax] = await db.select().from(taxes).where(eq(taxes.id, id));\n    return tax || undefined;\n  }\n\n  async updateTax(id: string, updateData: Partial<InsertTax>): Promise<Tax | undefined> {\n    const [tax] = await db\n      .update(taxes)\n      .set({ ...updateData, updated_at: new Date() })\n      .where(eq(taxes.id, id))\n      .returning();\n    return tax;\n  }\n\n  async deleteTax(id: string): Promise<boolean> {\n    await db.delete(taxes).where(eq(taxes.id, id));\n    return true;\n  }\n\n  // === Sales Invoices Implementation ===\n  async createSalesInvoice(insertSalesInvoice: InsertSalesInvoice): Promise<SalesInvoice> {\n    const [invoice] = await db\n      .insert(sales_invoices)\n      .values(insertSalesInvoice)\n      .returning();\n    return invoice;\n  }\n\n  async getSalesInvoicesByCompany(companyId: string): Promise<SalesInvoice[]> {\n    return await db.select().from(sales_invoices).where(eq(sales_invoices.company_id, companyId));\n  }\n\n  async getSalesInvoiceById(id: string): Promise<SalesInvoice | undefined> {\n    const [invoice] = await db.select().from(sales_invoices).where(eq(sales_invoices.id, id));\n    return invoice || undefined;\n  }\n\n  async updateSalesInvoice(id: string, updateData: Partial<InsertSalesInvoice>): Promise<SalesInvoice | undefined> {\n    const [invoice] = await db\n      .update(sales_invoices)\n      .set({ ...updateData, updated_at: new Date() })\n      .where(eq(sales_invoices.id, id))\n      .returning();\n    return invoice;\n  }\n\n  async deleteSalesInvoice(id: string): Promise<boolean> {\n    await db.delete(sales_invoices).where(eq(sales_invoices.id, id));\n    return true;\n  }\n\n  // === Sales Quotes Implementation ===\n  async createSalesQuote(insertSalesQuote: any): Promise<SalesQuote> {\n    const [quote] = await db\n      .insert(sales_quotes)\n      .values(insertSalesQuote)\n      .returning();\n    return quote;\n  }\n\n  async getSalesQuotesByCompany(companyId: string): Promise<SalesQuote[]> {\n    return await db.select().from(sales_quotes).where(eq(sales_quotes.company_id, companyId));\n  }\n\n  // === Sales Orders Implementation ===\n  async createSalesOrder(insertSalesOrder: any): Promise<SalesOrder> {\n    const [order] = await db\n      .insert(sales_orders)\n      .values(insertSalesOrder)\n      .returning();\n    return order;\n  }\n\n  async getSalesOrdersByCompany(companyId: string): Promise<SalesOrder[]> {\n    return await db.select().from(sales_orders).where(eq(sales_orders.company_id, companyId));\n  }\n\n  // === Bank Accounts Implementation ===\n  async createBankAccount(insertBankAccount: InsertBankAccount): Promise<BankAccount> {\n    const [bankAccount] = await db\n      .insert(bank_accounts)\n      .values(insertBankAccount)\n      .returning();\n    return bankAccount;\n  }\n\n  async getBankAccountsByCompany(companyId: string): Promise<BankAccount[]> {\n    return await db.select().from(bank_accounts).where(eq(bank_accounts.company_id, companyId));\n  }\n\n  async updateBankAccount(id: string, updateData: Partial<InsertBankAccount>): Promise<BankAccount | undefined> {\n    const [bankAccount] = await db\n      .update(bank_accounts)\n      .set({ ...updateData, updated_at: new Date() })\n      .where(eq(bank_accounts.id, id))\n      .returning();\n    return bankAccount;\n  }\n\n  async deleteBankAccount(id: string): Promise<boolean> {\n    await db.delete(bank_accounts).where(eq(bank_accounts.id, id));\n    return true;\n  }\n\n  // === Bills Implementation ===\n  async createBill(insertBill: InsertBill): Promise<Bill> {\n    const [bill] = await db\n      .insert(bills)\n      .values(insertBill)\n      .returning();\n    return bill;\n  }\n\n  async getBillsByCompany(companyId: string): Promise<Bill[]> {\n    return await db.select().from(bills).where(eq(bills.company_id, companyId));\n  }\n\n  async deleteBill(companyId: string, id: string): Promise<boolean> {\n    const result = await db.delete(bills).where(\n      and(eq(bills.id, id), eq(bills.company_id, companyId))\n    );\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  // === Purchase Orders Implementation ===\n  async createPurchaseOrder(insertPurchaseOrder: any): Promise<PurchaseOrder> {\n    const [order] = await db\n      .insert(purchase_orders)\n      .values(insertPurchaseOrder)\n      .returning();\n    return order;\n  }\n\n  async getPurchaseOrdersByCompany(companyId: string): Promise<PurchaseOrder[]> {\n    return await db.select().from(purchase_orders).where(eq(purchase_orders.company_id, companyId));\n  }\n\n  // === Expenses Implementation ===\n  async createExpense(insertExpense: InsertExpense): Promise<Expense> {\n    const [expense] = await db\n      .insert(expenses)\n      .values(insertExpense)\n      .returning();\n    return expense;\n  }\n\n  async getExpensesByCompany(companyId: string): Promise<Expense[]> {\n    return await db.select().from(expenses).where(eq(expenses.company_id, companyId));\n  }\n\n  // === Payments Implementation ===\n  async createPayment(insertPayment: InsertPayment): Promise<Payment> {\n    const [payment] = await db\n      .insert(payments)\n      .values(insertPayment)\n      .returning();\n    return payment;\n  }\n\n  async getPaymentsByCompany(companyId: string): Promise<Payment[]> {\n    return await db.select().from(payments).where(eq(payments.company_id, companyId));\n  }\n\n  async deletePayment(companyId: string, id: string): Promise<boolean> {\n    const result = await db\n      .delete(payments)\n      .where(and(eq(payments.id, id), eq(payments.company_id, companyId)));\n    return (result as any).rowCount > 0;\n  }\n\n  // === Receipts Implementation ===\n  async createReceipt(insertReceipt: InsertReceipt): Promise<Receipt> {\n    const [receipt] = await db\n      .insert(receipts)\n      .values(insertReceipt)\n      .returning();\n    return receipt;\n  }\n\n  async getReceiptsByCompany(companyId: string): Promise<Receipt[]> {\n    return await db.select().from(receipts).where(eq(receipts.company_id, companyId));\n  }\n\n  async deleteReceipt(companyId: string, id: string): Promise<boolean> {\n    const result = await db\n      .delete(receipts)\n      .where(and(eq(receipts.id, id), eq(receipts.company_id, companyId)));\n    return (result as any).rowCount > 0;\n  }\n\n  // Reports\n  async getTrialBalance(companyId: string, endDate?: Date): Promise<any[]> {\n    try {\n      // Build base query with accounts\n      let query = db\n        .select({\n          id: accounts.id,\n          code: accounts.code,\n          name: accounts.name,\n          account_type: accounts.account_type,\n          account_subtype: accounts.account_subtype,\n          debit: sql<number>`COALESCE(SUM(${journal_lines.debit}), 0)`,\n          credit: sql<number>`COALESCE(SUM(${journal_lines.credit}), 0)`\n        })\n        .from(accounts)\n        .leftJoin(journal_lines, eq(accounts.id, journal_lines.account_id))\n        .leftJoin(journals, eq(journal_lines.journal_id, journals.id))\n        .where(\n          and(\n            eq(accounts.company_id, companyId),\n            eq(accounts.is_active, true),\n            endDate ? lte(journals.date, endDate) : undefined\n          )\n        )\n        .groupBy(accounts.id, accounts.code, accounts.name, accounts.account_type, accounts.account_subtype)\n        .having(sql`COALESCE(SUM(${journal_lines.debit}), 0) + COALESCE(SUM(${journal_lines.credit}), 0) > 0`)\n        .orderBy(accounts.code, accounts.name);\n\n      const result = await query;\n      return result;\n    } catch (error) {\n      console.error('Error getting trial balance:', error);\n      return [];\n    }\n  }\n\n  async getBalanceSheet(companyId: string, endDate?: Date): Promise<any> {\n    try {\n      // Get all accounts with their balances\n      const accountsData = await db\n        .select({\n          id: accounts.id,\n          code: accounts.code,\n          name: accounts.name,\n          account_type: accounts.account_type,\n          account_subtype: accounts.account_subtype,\n          debit: sql<number>`COALESCE(SUM(${journal_lines.debit}), 0)`,\n          credit: sql<number>`COALESCE(SUM(${journal_lines.credit}), 0)`\n        })\n        .from(accounts)\n        .leftJoin(journal_lines, eq(accounts.id, journal_lines.account_id))\n        .leftJoin(journals, eq(journal_lines.journal_id, journals.id))\n        .where(\n          and(\n            eq(accounts.company_id, companyId),\n            eq(accounts.is_active, true),\n            endDate ? lte(journals.date, endDate) : undefined\n          )\n        )\n        .groupBy(accounts.id, accounts.code, accounts.name, accounts.account_type, accounts.account_subtype)\n        .orderBy(accounts.code, accounts.name);\n\n      // Calculate net balance for each account based on account type\n      const balancedAccounts = accountsData.map(account => {\n        // For assets and expenses: debit increases balance\n        // For liabilities, equity, and revenue: credit increases balance\n        let balance = 0;\n        if (account.account_type === 'asset' || account.account_type === 'expense') {\n          balance = account.debit - account.credit;\n        } else {\n          balance = account.credit - account.debit;\n        }\n        \n        return {\n          ...account,\n          balance\n        };\n      });\n\n      // Filter accounts with non-zero balances for balance sheet\n      const activeAccounts = balancedAccounts.filter(account => \n        Math.abs(account.balance) > 0.01 &&\n        ['asset', 'liability', 'equity'].includes(account.account_type)\n      );\n\n      // Group accounts by type and subtype\n      const assets = {\n        current: activeAccounts.filter(acc => \n          acc.account_type === 'asset' && \n          (acc.account_subtype === 'current_asset' || acc.account_subtype?.includes('current'))\n        ),\n        nonCurrent: activeAccounts.filter(acc => \n          acc.account_type === 'asset' && \n          (!acc.account_subtype || \n           (!acc.account_subtype.includes('current') && acc.account_subtype !== 'current_asset'))\n        )\n      };\n\n      const liabilities = {\n        current: activeAccounts.filter(acc => \n          acc.account_type === 'liability' && \n          (acc.account_subtype === 'current_liability' || acc.account_subtype?.includes('current'))\n        ),\n        nonCurrent: activeAccounts.filter(acc => \n          acc.account_type === 'liability' && \n          (!acc.account_subtype || \n           (!acc.account_subtype.includes('current') && acc.account_subtype !== 'current_liability'))\n        )\n      };\n\n      const equity = activeAccounts.filter(acc => acc.account_type === 'equity');\n\n      return {\n        assets,\n        liabilities,\n        equity,\n        date: endDate || new Date()\n      };\n    } catch (error) {\n      console.error('Error getting balance sheet:', error);\n      return {\n        assets: { current: [], nonCurrent: [] },\n        liabilities: { current: [], nonCurrent: [] },\n        equity: [],\n        date: new Date()\n      };\n    }\n  }\n\n  async getProfitLoss(companyId: string, startDate?: Date, endDate?: Date): Promise<any> {\n    try {\n      // Get revenue and expense accounts with their balances for the period\n      const accountsData = await db\n        .select({\n          id: accounts.id,\n          code: accounts.code,\n          name: accounts.name,\n          account_type: accounts.account_type,\n          account_subtype: accounts.account_subtype,\n          debit: sql<number>`COALESCE(SUM(${journal_lines.debit}), 0)`,\n          credit: sql<number>`COALESCE(SUM(${journal_lines.credit}), 0)`\n        })\n        .from(accounts)\n        .leftJoin(journal_lines, eq(accounts.id, journal_lines.account_id))\n        .leftJoin(journals, eq(journal_lines.journal_id, journals.id))\n        .where(\n          and(\n            eq(accounts.company_id, companyId),\n            eq(accounts.is_active, true),\n            // Filter by date range if provided\n            startDate ? gte(journals.date, startDate) : undefined,\n            endDate ? lte(journals.date, endDate) : undefined,\n            // Only include revenue and expense accounts for P&L\n            or(\n              eq(accounts.account_type, 'revenue'),\n              eq(accounts.account_type, 'expense')\n            )\n          )\n        )\n        .groupBy(accounts.id, accounts.code, accounts.name, accounts.account_type, accounts.account_subtype)\n        .orderBy(accounts.code, accounts.name);\n\n      // Calculate net balance for each account based on account type\n      const balancedAccounts = accountsData.map(account => {\n        let balance = 0;\n        // For revenue: credit increases balance (credit - debit)\n        // For expenses: debit increases balance (debit - credit)\n        if (account.account_type === 'revenue') {\n          balance = account.credit - account.debit;\n        } else if (account.account_type === 'expense') {\n          balance = account.debit - account.credit;\n        }\n        \n        return {\n          ...account,\n          balance\n        };\n      });\n\n      // Filter accounts with non-zero balances\n      const activeAccounts = balancedAccounts.filter(account => \n        Math.abs(account.balance) > 0.01\n      );\n\n      // Group accounts by type and subtype\n      const revenue = {\n        operating: activeAccounts.filter(acc => \n          acc.account_type === 'revenue' && \n          (acc.account_subtype === 'operating_revenue' || \n           acc.account_subtype === 'sales_revenue' ||\n           acc.account_subtype?.includes('operating') ||\n           !acc.account_subtype)\n        ),\n        nonOperating: activeAccounts.filter(acc => \n          acc.account_type === 'revenue' && \n          (acc.account_subtype === 'other_income' || \n           acc.account_subtype === 'non_operating_revenue' ||\n           acc.account_subtype?.includes('other'))\n        )\n      };\n\n      const expenses = {\n        costOfGoodsSold: activeAccounts.filter(acc => \n          acc.account_type === 'expense' && \n          (acc.account_subtype === 'cost_of_goods_sold' || \n           acc.account_subtype === 'cogs' ||\n           acc.account_subtype?.includes('cogs'))\n        ),\n        operating: activeAccounts.filter(acc => \n          acc.account_type === 'expense' && \n          (acc.account_subtype === 'operating_expense' || \n           acc.account_subtype === 'administrative' ||\n           acc.account_subtype === 'selling' ||\n           acc.account_subtype?.includes('operating') ||\n           (!acc.account_subtype && !acc.account_subtype?.includes('cogs') && !acc.account_subtype?.includes('other')))\n        ),\n        nonOperating: activeAccounts.filter(acc => \n          acc.account_type === 'expense' && \n          (acc.account_subtype === 'other_expense' || \n           acc.account_subtype === 'non_operating_expense' ||\n           acc.account_subtype === 'interest_expense' ||\n           acc.account_subtype?.includes('other'))\n        )\n      };\n\n      return {\n        revenue,\n        expenses,\n        startDate: startDate || new Date(new Date().getFullYear(), 0, 1), // Default to year start\n        endDate: endDate || new Date()\n      };\n    } catch (error) {\n      console.error('Error getting profit loss:', error);\n      return {\n        revenue: { operating: [], nonOperating: [] },\n        expenses: { costOfGoodsSold: [], operating: [], nonOperating: [] },\n        startDate: new Date(new Date().getFullYear(), 0, 1),\n        endDate: new Date()\n      };\n    }\n  }\n\n  async getCashFlow(companyId: string, startDate?: Date, endDate?: Date): Promise<any> {\n    try {\n      // For basic cash flow implementation, we'll track cash and cash equivalents movements\n      // In a real system, this would be more sophisticated with indirect method calculations\n      \n      // Get cash and bank accounts (assumed to be the cash and cash equivalents)\n      const cashAccounts = await db\n        .select()\n        .from(accounts)\n        .where(\n          and(\n            eq(accounts.company_id, companyId),\n            or(\n              eq(accounts.account_type, 'asset'),\n              eq(accounts.account_subtype, 'cash'),\n              eq(accounts.account_subtype, 'bank'),\n              eq(accounts.account_subtype, 'cash_and_cash_equivalents')\n            )\n          )\n        );\n\n      // Get beginning cash balance\n      const beginningCashBalance = await this.calculateBeginningCashBalance(companyId, startDate || new Date(new Date().getFullYear(), 0, 1));\n\n      // Calculate operating cash flows (simplified - real implementation would use indirect method)\n      const operatingActivities = await this.calculateOperatingCashFlows(companyId, startDate, endDate);\n      \n      // Calculate investing cash flows (purchases/sales of long-term assets)\n      const investingActivities = await this.calculateInvestingCashFlows(companyId, startDate, endDate);\n      \n      // Calculate financing cash flows (loans, equity, dividends)\n      const financingActivities = await this.calculateFinancingCashFlows(companyId, startDate, endDate);\n\n      // Calculate totals\n      const operatingCashFlow = operatingActivities.reduce((sum, item) => sum + item.amount, 0);\n      const investingCashFlow = investingActivities.reduce((sum, item) => sum + item.amount, 0);\n      const financingCashFlow = financingActivities.reduce((sum, item) => sum + item.amount, 0);\n      \n      const netCashFlow = operatingCashFlow + investingCashFlow + financingCashFlow;\n      const endingCash = beginningCashBalance + netCashFlow;\n\n      return {\n        period: endDate ? endDate.toISOString().substring(0, 7) : new Date().toISOString().substring(0, 7),\n        company: 'Company Name', // Should fetch from company table\n        currency: 'USD',\n        beginningCash: beginningCashBalance,\n        endingCash,\n        netCashFlow,\n        operatingActivities,\n        investingActivities,\n        financingActivities,\n        operatingCashFlow,\n        investingCashFlow,\n        financingCashFlow,\n        startDate: startDate || new Date(new Date().getFullYear(), 0, 1),\n        endDate: endDate || new Date()\n      };\n    } catch (error) {\n      console.error('Error getting cash flow:', error);\n      return {\n        period: new Date().toISOString().substring(0, 7),\n        company: 'Company Name',\n        currency: 'USD',\n        beginningCash: 0,\n        endingCash: 0,\n        netCashFlow: 0,\n        operatingActivities: [],\n        investingActivities: [],\n        financingActivities: [],\n        operatingCashFlow: 0,\n        investingCashFlow: 0,\n        financingCashFlow: 0,\n        startDate: new Date(new Date().getFullYear(), 0, 1),\n        endDate: new Date()\n      };\n    }\n  }\n\n  private async calculateBeginningCashBalance(companyId: string, startDate: Date): Promise<number> {\n    // Simplified: get cash balance before the start date\n    // In real implementation, this would aggregate all cash accounts\n    return 35250.50; // Mock value for now\n  }\n\n  private async calculateOperatingCashFlows(companyId: string, startDate?: Date, endDate?: Date): Promise<any[]> {\n    // Simplified operating cash flows - normally uses indirect method starting with Net Income\n    return [\n      { item: 'Net Income', amount: 16500.00, isInflow: true },\n      { item: 'Depreciation & Amortization', amount: 3500.00, isInflow: true },\n      { item: 'Changes in Working Capital', amount: -1000.00, isInflow: false }\n    ];\n  }\n\n  private async calculateInvestingCashFlows(companyId: string, startDate?: Date, endDate?: Date): Promise<any[]> {\n    // Track purchases/sales of long-term assets\n    return [\n      { item: 'Purchase of Equipment', amount: -15000.00, isInflow: false },\n      { item: 'Sale of Investments', amount: 5000.00, isInflow: true }\n    ];\n  }\n\n  private async calculateFinancingCashFlows(companyId: string, startDate?: Date, endDate?: Date): Promise<any[]> {\n    // Track loans, equity, dividends\n    return [\n      { item: 'Proceeds from Loan', amount: 20000.00, isInflow: true },\n      { item: 'Interest Payments', amount: -1500.00, isInflow: false }\n    ];\n  }\n\n  async getTaxReport(companyId: string, startDate?: Date, endDate?: Date): Promise<any> {\n    try {\n      // Get tax rates/configuration for the company\n      const companyTaxRates = await db\n        .select()\n        .from(taxes)\n        .where(\n          and(\n            eq(taxes.company_id, companyId),\n            eq(taxes.is_active, true)\n          )\n        );\n\n      // Calculate sales tax (from invoices and sales documents)\n      const salesTaxData = await this.calculateSalesTax(companyId, startDate, endDate);\n      \n      // Calculate purchase tax (from bills and expenses)\n      const purchaseTaxData = await this.calculatePurchaseTax(companyId, startDate, endDate);\n\n      // Get tax filings data (mock for now - would come from a tax_filings table)\n      const taxFilings = await this.getTaxFilings(companyId, startDate, endDate);\n\n      // Calculate income tax estimates\n      const incomeTaxData = await this.calculateIncomeTax(companyId, startDate, endDate);\n\n      // Get company data\n      const company = await this.getCompanyById(companyId);\n      \n      const period = startDate && endDate \n        ? `${startDate.toISOString().slice(0,10)}_${endDate.toISOString().slice(0,10)}` \n        : new Date().toISOString().substring(0, 7);\n      \n      return {\n        period,\n        company: company?.name ?? \"Company\",\n        currency: company?.base_currency ?? \"USD\",\n        salesTax: salesTaxData,\n        purchaseTax: purchaseTaxData,\n        incomeTax: incomeTaxData,\n        payrollTax: {\n          grossWages: 0,\n          federalWithholding: 0,\n          stateWithholding: 0,\n          socialSecurity: 0,\n          medicare: 0,\n          employerContributions: 0,\n          totalPayrollTax: 0,\n        },\n        filings: taxFilings,\n        startDate: startDate || new Date(new Date().getFullYear(), 0, 1),\n        endDate: endDate || new Date()\n      };\n    } catch (error) {\n      console.error('Error getting tax report:', error);\n      return {\n        period: new Date().toISOString().substring(0, 7),\n        company: 'Company Name',\n        currency: 'USD',\n        salesTax: { totalSales: 0, taxableSales: 0, exemptSales: 0, collectedTax: 0, rates: [] },\n        purchaseTax: { totalPurchases: 0, taxablePurchases: 0, exemptPurchases: 0, paidTax: 0, recoverable: 0 },\n        incomeTax: { grossIncome: 0, deductions: 0, taxableIncome: 0, estimatedTax: 0, quarterlyPayments: [] },\n        payrollTax: { grossWages: 0, federalWithholding: 0, stateWithholding: 0, socialSecurity: 0, medicare: 0, employerContributions: 0, totalPayrollTax: 0 },\n        filings: [],\n        startDate: new Date(new Date().getFullYear(), 0, 1),\n        endDate: new Date()\n      };\n    }\n  }\n\n  private async calculateSalesTax(companyId: string, startDate?: Date, endDate?: Date): Promise<any> {\n    // Get total sales from invoices in date range\n    const conditions = [eq(sales_invoices.company_id, companyId)];\n    if (startDate) conditions.push(gte(sales_invoices.date, startDate));\n    if (endDate) conditions.push(lte(sales_invoices.date, endDate));\n    const whereExpr = conditions.length === 1 ? conditions[0] : and(...conditions as [any, any, ...any[]]);\n    \n    const salesResults = await db\n      .select({\n        subtotal: sales_invoices.subtotal,\n        tax_total: sales_invoices.tax_total,\n        total: sales_invoices.total\n      })\n      .from(sales_invoices)\n      .where(whereExpr);\n    \n    const totalSales = salesResults.reduce((sum, invoice) => sum + parseFloat(invoice.total || '0'), 0);\n    const collectedTax = salesResults.reduce((sum, invoice) => sum + parseFloat(invoice.tax_total || '0'), 0);\n    const taxableSales = totalSales - collectedTax; // Simplified calculation\n\n    return {\n      totalSales,\n      taxableSales,\n      exemptSales: 0, // Would require additional logic to determine exempt sales\n      collectedTax,\n      rates: [\n        { jurisdiction: 'Sales Tax', rate: 8.5, taxable: taxableSales, tax: collectedTax }\n      ]\n    };\n  }\n\n  private async calculatePurchaseTax(companyId: string, startDate?: Date, endDate?: Date): Promise<any> {\n    // Get purchase tax from bills and expenses\n    const conditions = [eq(bills.company_id, companyId)];\n    if (startDate) conditions.push(gte(bills.date, startDate));\n    if (endDate) conditions.push(lte(bills.date, endDate));\n    const whereExpr = conditions.length === 1 ? conditions[0] : and(...conditions as [any, any, ...any[]]);\n    \n    const billsResults = await db\n      .select({\n        subtotal: bills.subtotal,\n        tax_total: bills.tax_total,\n        total: bills.total\n      })\n      .from(bills)\n      .where(whereExpr);\n\n    const totalPurchases = billsResults.reduce((sum, bill) => sum + parseFloat(bill.total || '0'), 0);\n    const paidTax = billsResults.reduce((sum, bill) => sum + parseFloat(bill.tax_total || '0'), 0);\n\n    return {\n      totalPurchases,\n      taxablePurchases: totalPurchases - paidTax,\n      exemptPurchases: 0,\n      paidTax,\n      recoverable: paidTax * 0.8 // Simplified - 80% recoverable assumption\n    };\n  }\n\n  private async calculateIncomeTax(companyId: string, startDate?: Date, endDate?: Date): Promise<any> {\n    // Simplified income tax calculation based on P&L data\n    const profitLossData = await this.getProfitLoss(companyId, startDate, endDate);\n    \n    // Extract revenue and expense totals for income tax calculation\n    const revenue = profitLossData.revenue || { operating: [], nonOperating: [] };\n    const expenses = profitLossData.expenses || { costOfGoodsSold: [], operating: [], nonOperating: [] };\n\n    const totalRevenue = [...revenue.operating, ...revenue.nonOperating]\n      .reduce((sum: number, account: any) => sum + account.balance, 0);\n    \n    const totalExpenses = [...expenses.costOfGoodsSold, ...expenses.operating, ...expenses.nonOperating]\n      .reduce((sum: number, account: any) => sum + account.balance, 0);\n\n    const taxableIncome = Math.max(0, totalRevenue - totalExpenses);\n    const estimatedTax = taxableIncome * 0.25; // 25% corporate tax rate\n\n    return {\n      grossIncome: totalRevenue,\n      deductions: totalExpenses,\n      taxableIncome,\n      estimatedTax,\n      quarterlyPayments: [\n        { quarter: 'Q1', dueDate: '2024-04-15', amount: estimatedTax / 4, status: 'pending' },\n        { quarter: 'Q2', dueDate: '2024-06-15', amount: estimatedTax / 4, status: 'pending' },\n        { quarter: 'Q3', dueDate: '2024-09-15', amount: estimatedTax / 4, status: 'pending' },\n        { quarter: 'Q4', dueDate: '2025-01-15', amount: estimatedTax / 4, status: 'pending' },\n      ]\n    };\n  }\n\n  private async getTaxFilings(companyId: string, startDate?: Date, endDate?: Date): Promise<any[]> {\n    // Mock tax filings - in real system would come from tax_filings table\n    return [\n      { form: 'Sales Tax Return', period: 'Q1 2024', dueDate: '2024-04-20', status: 'pending', amount: 4000.00 },\n      { form: 'Corporate Tax Return', period: 'Q1 2024', dueDate: '2024-04-15', status: 'filed', amount: 2812.50 }\n    ];\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":39789},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"shared/schema.ts":{"content":"import { sql, relations } from \"drizzle-orm\";\nimport { pgTable, text, varchar, timestamp, decimal, integer, boolean, jsonb } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// ==== COMPANIES ====\nexport const companies = pgTable(\"companies\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  legal_name: text(\"legal_name\"),\n  tax_number: text(\"tax_number\"),\n  registration_number: text(\"registration_number\"),\n  logo_url: text(\"logo_url\"),\n  address: jsonb(\"address\"),\n  contacts: jsonb(\"contacts\"), // phone, email, etc\n  base_currency: varchar(\"base_currency\", { length: 3 }).notNull().default(\"USD\"),\n  fiscal_year_start: integer(\"fiscal_year_start\").notNull().default(1), // 1=Jan, 4=Apr, etc\n  date_format: text(\"date_format\").notNull().default(\"dd/MM/yyyy\"),\n  number_format: text(\"number_format\").notNull().default(\"1,234.56\"),\n  declaration_text: text(\"declaration_text\"),\n  firebase_user_id: text(\"firebase_user_id\"), // Firebase UID for linking to Firebase users\n  created_at: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n  updated_at: timestamp(\"updated_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\n// ==== USERS ====\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  company_id: varchar(\"company_id\").notNull().references(() => companies.id, { onDelete: \"cascade\" }),\n  username: text(\"username\").notNull().unique(),\n  email: text(\"email\").notNull().unique(),\n  password_hash: text(\"password_hash\").notNull(),\n  full_name: text(\"full_name\").notNull(),\n  role: text(\"role\").notNull().default(\"viewer\"), // owner, accountant, sales, viewer\n  language: text(\"language\").notNull().default(\"en\"),\n  timezone: text(\"timezone\").notNull().default(\"UTC\"),\n  theme: text(\"theme\").notNull().default(\"auto\"), // light, dark, auto\n  is_active: boolean(\"is_active\").notNull().default(true),\n  last_login_at: timestamp(\"last_login_at\"),\n  created_at: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n  updated_at: timestamp(\"updated_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\n// ==== CHART OF ACCOUNTS ====\nexport const accounts = pgTable(\"accounts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  company_id: varchar(\"company_id\").notNull().references(() => companies.id, { onDelete: \"cascade\" }),\n  code: text(\"code\").notNull(),\n  name: text(\"name\").notNull(),\n  account_type: text(\"account_type\").notNull(), // asset, liability, equity, revenue, expense\n  account_subtype: text(\"account_subtype\").notNull(), // current_asset, fixed_asset, current_liability, etc\n  parent_id: varchar(\"parent_id\"),\n  is_system: boolean(\"is_system\").notNull().default(false),\n  is_active: boolean(\"is_active\").notNull().default(true),\n  description: text(\"description\"),\n  created_at: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n  updated_at: timestamp(\"updated_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\n// ==== TAXES ====\nexport const taxes = pgTable(\"taxes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  company_id: varchar(\"company_id\").notNull().references(() => companies.id, { onDelete: \"cascade\" }),\n  code: text(\"code\").notNull(),\n  name: text(\"name\").notNull(),\n  rate: decimal(\"rate\", { precision: 10, scale: 4 }).notNull(),\n  tax_type: text(\"tax_type\").notNull(), // vat, sales_tax, corporate_tax, withholding, custom\n  calculation_type: text(\"calculation_type\").notNull(), // inclusive, exclusive\n  liability_account_id: varchar(\"liability_account_id\").references(() => accounts.id),\n  jurisdiction: text(\"jurisdiction\"),\n  effective_from: timestamp(\"effective_from\").notNull(),\n  effective_to: timestamp(\"effective_to\"),\n  is_active: boolean(\"is_active\").notNull().default(true),\n  created_at: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n  updated_at: timestamp(\"updated_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\n// ==== CONTACTS (Customers/Suppliers) ====\nexport const contacts = pgTable(\"contacts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  company_id: varchar(\"company_id\").notNull().references(() => companies.id, { onDelete: \"cascade\" }),\n  type: text(\"type\").notNull(), // customer, supplier, both\n  code: text(\"code\"),\n  name: text(\"name\").notNull(),\n  display_name: text(\"display_name\"),\n  email: text(\"email\"),\n  phone: text(\"phone\"),\n  website: text(\"website\"),\n  tax_number: text(\"tax_number\"),\n  registration_number: text(\"registration_number\"),\n  billing_address: jsonb(\"billing_address\"),\n  shipping_address: jsonb(\"shipping_address\"),\n  currency: varchar(\"currency\", { length: 3 }).notNull().default(\"USD\"),\n  payment_terms_days: integer(\"payment_terms_days\").notNull().default(30),\n  credit_limit: decimal(\"credit_limit\", { precision: 15, scale: 2 }),\n  is_active: boolean(\"is_active\").notNull().default(true),\n  created_at: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n  updated_at: timestamp(\"updated_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\n// ==== ITEMS (Products/Services) ====\nexport const items = pgTable(\"items\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  company_id: varchar(\"company_id\").notNull().references(() => companies.id, { onDelete: \"cascade\" }),\n  type: text(\"type\").notNull(), // inventory, service\n  sku: text(\"sku\").notNull(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  unit_of_measure: text(\"unit_of_measure\").notNull().default(\"pcs\"),\n  sales_price: decimal(\"sales_price\", { precision: 15, scale: 2 }),\n  cost_price: decimal(\"cost_price\", { precision: 15, scale: 2 }),\n  sales_account_id: varchar(\"sales_account_id\").references(() => accounts.id),\n  cost_account_id: varchar(\"cost_account_id\").references(() => accounts.id),\n  inventory_account_id: varchar(\"inventory_account_id\").references(() => accounts.id),\n  default_tax_id: varchar(\"default_tax_id\").references(() => taxes.id),\n  is_active: boolean(\"is_active\").notNull().default(true),\n  created_at: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n  updated_at: timestamp(\"updated_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\n// ==== WAREHOUSES ====\nexport const warehouses = pgTable(\"warehouses\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  company_id: varchar(\"company_id\").notNull().references(() => companies.id, { onDelete: \"cascade\" }),\n  code: text(\"code\").notNull(),\n  name: text(\"name\").notNull(),\n  address: jsonb(\"address\"),\n  is_active: boolean(\"is_active\").notNull().default(true),\n  created_at: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n  updated_at: timestamp(\"updated_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\n// ==== BANK/CASH ACCOUNTS ====\nexport const bank_accounts = pgTable(\"bank_accounts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  company_id: varchar(\"company_id\").notNull().references(() => companies.id, { onDelete: \"cascade\" }),\n  account_id: varchar(\"account_id\").notNull().references(() => accounts.id),\n  name: text(\"name\").notNull(),\n  bank_name: text(\"bank_name\"),\n  account_number: text(\"account_number\"),\n  currency: varchar(\"currency\", { length: 3 }).notNull().default(\"USD\"),\n  opening_balance: decimal(\"opening_balance\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  opening_balance_date: timestamp(\"opening_balance_date\").notNull(),\n  is_active: boolean(\"is_active\").notNull().default(true),\n  created_at: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n  updated_at: timestamp(\"updated_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\n// ==== JOURNALS (General Ledger Entries) ====\nexport const journals = pgTable(\"journals\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  company_id: varchar(\"company_id\").notNull().references(() => companies.id, { onDelete: \"cascade\" }),\n  journal_number: text(\"journal_number\").notNull(),\n  date: timestamp(\"date\").notNull(),\n  description: text(\"description\"),\n  reference: text(\"reference\"),\n  source_type: text(\"source_type\"), // invoice, bill, payment, manual, etc\n  source_id: varchar(\"source_id\"),\n  total_amount: decimal(\"total_amount\", { precision: 15, scale: 2 }).notNull(),\n  created_by: varchar(\"created_by\").references(() => users.id),\n  created_at: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n  updated_at: timestamp(\"updated_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\nexport const journal_lines = pgTable(\"journal_lines\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  journal_id: varchar(\"journal_id\").notNull().references(() => journals.id, { onDelete: \"cascade\" }),\n  account_id: varchar(\"account_id\").notNull().references(() => accounts.id),\n  description: text(\"description\"),\n  debit: decimal(\"debit\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  credit: decimal(\"credit\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  currency: varchar(\"currency\", { length: 3 }).notNull().default(\"USD\"),\n  fx_rate: decimal(\"fx_rate\", { precision: 10, scale: 6 }).notNull().default(\"1\"),\n  base_debit: decimal(\"base_debit\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  base_credit: decimal(\"base_credit\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n});\n\n// ==== SALES DOCUMENTS ====\nexport const sales_quotes = pgTable(\"sales_quotes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  company_id: varchar(\"company_id\").notNull().references(() => companies.id, { onDelete: \"cascade\" }),\n  quote_number: text(\"quote_number\").notNull(),\n  customer_id: varchar(\"customer_id\").notNull().references(() => contacts.id),\n  date: timestamp(\"date\").notNull(),\n  valid_until: timestamp(\"valid_until\"),\n  status: text(\"status\").notNull().default(\"draft\"), // draft, sent, accepted, rejected, expired\n  currency: varchar(\"currency\", { length: 3 }).notNull(),\n  fx_rate: decimal(\"fx_rate\", { precision: 10, scale: 6 }).notNull().default(\"1\"),\n  subtotal: decimal(\"subtotal\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  tax_total: decimal(\"tax_total\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  total: decimal(\"total\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  notes: text(\"notes\"),\n  created_by: varchar(\"created_by\").references(() => users.id),\n  created_at: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n  updated_at: timestamp(\"updated_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\nexport const sales_orders = pgTable(\"sales_orders\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  company_id: varchar(\"company_id\").notNull().references(() => companies.id, { onDelete: \"cascade\" }),\n  order_number: text(\"order_number\").notNull(),\n  quote_id: varchar(\"quote_id\").references(() => sales_quotes.id),\n  customer_id: varchar(\"customer_id\").notNull().references(() => contacts.id),\n  date: timestamp(\"date\").notNull(),\n  delivery_date: timestamp(\"delivery_date\"),\n  status: text(\"status\").notNull().default(\"pending\"), // pending, confirmed, shipped, delivered, cancelled\n  currency: varchar(\"currency\", { length: 3 }).notNull(),\n  fx_rate: decimal(\"fx_rate\", { precision: 10, scale: 6 }).notNull().default(\"1\"),\n  subtotal: decimal(\"subtotal\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  tax_total: decimal(\"tax_total\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  total: decimal(\"total\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  notes: text(\"notes\"),\n  created_by: varchar(\"created_by\").references(() => users.id),\n  created_at: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n  updated_at: timestamp(\"updated_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\nexport const sales_invoices = pgTable(\"sales_invoices\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  company_id: varchar(\"company_id\").notNull().references(() => companies.id, { onDelete: \"cascade\" }),\n  invoice_number: text(\"invoice_number\").notNull(),\n  order_id: varchar(\"order_id\").references(() => sales_orders.id),\n  customer_id: varchar(\"customer_id\").notNull().references(() => contacts.id),\n  date: timestamp(\"date\").notNull(),\n  due_date: timestamp(\"due_date\").notNull(),\n  status: text(\"status\").notNull().default(\"draft\"), // draft, sent, paid, overdue, cancelled\n  currency: varchar(\"currency\", { length: 3 }).notNull(),\n  fx_rate: decimal(\"fx_rate\", { precision: 10, scale: 6 }).notNull().default(\"1\"),\n  subtotal: decimal(\"subtotal\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  tax_total: decimal(\"tax_total\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  total: decimal(\"total\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  paid_amount: decimal(\"paid_amount\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  notes: text(\"notes\"),\n  journal_id: varchar(\"journal_id\").references(() => journals.id),\n  created_by: varchar(\"created_by\").references(() => users.id),\n  created_at: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n  updated_at: timestamp(\"updated_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\n// ==== DOCUMENT LINES (shared for quotes, orders, invoices) ====\nexport const document_lines = pgTable(\"document_lines\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  document_type: text(\"document_type\").notNull(), // quote, order, invoice, bill\n  document_id: varchar(\"document_id\").notNull(),\n  item_id: varchar(\"item_id\").references(() => items.id),\n  description: text(\"description\").notNull(),\n  quantity: decimal(\"quantity\", { precision: 15, scale: 4 }).notNull(),\n  unit_price: decimal(\"unit_price\", { precision: 15, scale: 2 }).notNull(),\n  discount_percentage: decimal(\"discount_percentage\", { precision: 5, scale: 2 }).notNull().default(\"0\"),\n  line_total: decimal(\"line_total\", { precision: 15, scale: 2 }).notNull(),\n  tax_amount: decimal(\"tax_amount\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  line_number: integer(\"line_number\").notNull(),\n});\n\n// ==== PURCHASE DOCUMENTS ====\nexport const purchase_orders = pgTable(\"purchase_orders\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  company_id: varchar(\"company_id\").notNull().references(() => companies.id, { onDelete: \"cascade\" }),\n  po_number: text(\"po_number\").notNull(),\n  supplier_id: varchar(\"supplier_id\").notNull().references(() => contacts.id),\n  date: timestamp(\"date\").notNull(),\n  delivery_date: timestamp(\"delivery_date\"),\n  status: text(\"status\").notNull().default(\"pending\"), // pending, confirmed, received, cancelled\n  currency: varchar(\"currency\", { length: 3 }).notNull(),\n  fx_rate: decimal(\"fx_rate\", { precision: 10, scale: 6 }).notNull().default(\"1\"),\n  subtotal: decimal(\"subtotal\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  tax_total: decimal(\"tax_total\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  total: decimal(\"total\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  notes: text(\"notes\"),\n  created_by: varchar(\"created_by\").references(() => users.id),\n  created_at: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n  updated_at: timestamp(\"updated_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\nexport const bills = pgTable(\"bills\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  company_id: varchar(\"company_id\").notNull().references(() => companies.id, { onDelete: \"cascade\" }),\n  bill_number: text(\"bill_number\").notNull(),\n  supplier_reference: text(\"supplier_reference\"),\n  po_id: varchar(\"po_id\").references(() => purchase_orders.id),\n  supplier_id: varchar(\"supplier_id\").notNull().references(() => contacts.id),\n  date: timestamp(\"date\").notNull(),\n  due_date: timestamp(\"due_date\").notNull(),\n  status: text(\"status\").notNull().default(\"draft\"), // draft, approved, paid, overdue\n  currency: varchar(\"currency\", { length: 3 }).notNull(),\n  fx_rate: decimal(\"fx_rate\", { precision: 10, scale: 6 }).notNull().default(\"1\"),\n  subtotal: decimal(\"subtotal\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  tax_total: decimal(\"tax_total\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  total: decimal(\"total\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  paid_amount: decimal(\"paid_amount\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  notes: text(\"notes\"),\n  journal_id: varchar(\"journal_id\").references(() => journals.id),\n  created_by: varchar(\"created_by\").references(() => users.id),\n  created_at: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n  updated_at: timestamp(\"updated_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\n// ==== EXPENSES ====\nexport const expenses = pgTable(\"expenses\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  company_id: varchar(\"company_id\").notNull().references(() => companies.id, { onDelete: \"cascade\" }),\n  expense_number: text(\"expense_number\").notNull(),\n  payee: text(\"payee\").notNull(),\n  date: timestamp(\"date\").notNull(),\n  amount: decimal(\"amount\", { precision: 15, scale: 2 }).notNull(),\n  tax_amount: decimal(\"tax_amount\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  category: text(\"category\"),\n  description: text(\"description\"),\n  paid_from_account_id: varchar(\"paid_from_account_id\").references(() => bank_accounts.id),\n  expense_account_id: varchar(\"expense_account_id\").references(() => accounts.id),\n  project_id: varchar(\"project_id\"), // will be defined later\n  status: text(\"status\").notNull().default(\"pending\"), // pending, approved, paid\n  journal_id: varchar(\"journal_id\").references(() => journals.id),\n  created_by: varchar(\"created_by\").references(() => users.id),\n  created_at: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n  updated_at: timestamp(\"updated_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\n// ==== PAYMENTS ====\nexport const payments = pgTable(\"payments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  company_id: varchar(\"company_id\").notNull().references(() => companies.id, { onDelete: \"cascade\" }),\n  payment_number: text(\"payment_number\").notNull(),\n  vendor_id: varchar(\"vendor_id\").notNull().references(() => contacts.id),\n  vendor_name: text(\"vendor_name\").notNull(), // denormalized for performance\n  date: timestamp(\"date\").notNull(),\n  amount: decimal(\"amount\", { precision: 15, scale: 2 }).notNull(),\n  payment_method: text(\"payment_method\").notNull(), // bank_transfer, credit_card, check, cash, online_payment\n  reference: text(\"reference\"), // related bill/expense reference\n  description: text(\"description\"),\n  bank_account_id: varchar(\"bank_account_id\").references(() => bank_accounts.id),\n  status: text(\"status\").notNull().default(\"pending\"), // pending, scheduled, completed, failed, cancelled\n  currency: varchar(\"currency\", { length: 3 }).notNull().default(\"USD\"),\n  fx_rate: decimal(\"fx_rate\", { precision: 10, scale: 6 }).notNull().default(\"1\"),\n  journal_id: varchar(\"journal_id\").references(() => journals.id),\n  created_by: varchar(\"created_by\").references(() => users.id),\n  created_at: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n  updated_at: timestamp(\"updated_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\n// ==== RECEIPTS ====\nexport const receipts = pgTable(\"receipts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  company_id: varchar(\"company_id\").notNull().references(() => companies.id, { onDelete: \"cascade\" }),\n  receipt_number: text(\"receipt_number\").notNull(),\n  customer_id: varchar(\"customer_id\").notNull().references(() => contacts.id),\n  customer_name: text(\"customer_name\").notNull(), // denormalized for performance\n  date: timestamp(\"date\").notNull(),\n  amount: decimal(\"amount\", { precision: 15, scale: 2 }).notNull(),\n  payment_method: text(\"payment_method\").notNull(), // bank_transfer, credit_card, check, cash, online_payment\n  reference: text(\"reference\"), // related invoice/sales reference\n  description: text(\"description\"),\n  bank_account_id: varchar(\"bank_account_id\").references(() => bank_accounts.id),\n  status: text(\"status\").notNull().default(\"received\"), // received, pending, cleared, bounced\n  currency: varchar(\"currency\", { length: 3 }).notNull().default(\"USD\"),\n  fx_rate: decimal(\"fx_rate\", { precision: 10, scale: 6 }).notNull().default(\"1\"),\n  journal_id: varchar(\"journal_id\").references(() => journals.id),\n  created_by: varchar(\"created_by\").references(() => users.id),\n  created_at: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n  updated_at: timestamp(\"updated_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\n// ==== FIXED ASSETS ====\nexport const fixed_assets = pgTable(\"fixed_assets\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  company_id: varchar(\"company_id\").notNull().references(() => companies.id, { onDelete: \"cascade\" }),\n  asset_code: text(\"asset_code\").notNull(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  cost: decimal(\"cost\", { precision: 15, scale: 2 }).notNull(),\n  acquisition_date: timestamp(\"acquisition_date\").notNull(),\n  useful_life_years: integer(\"useful_life_years\").notNull(),\n  depreciation_method: text(\"depreciation_method\").notNull().default(\"straight_line\"), // straight_line, declining_balance\n  salvage_value: decimal(\"salvage_value\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  accumulated_depreciation: decimal(\"accumulated_depreciation\", { precision: 15, scale: 2 }).notNull().default(\"0\"),\n  asset_account_id: varchar(\"asset_account_id\").references(() => accounts.id),\n  depreciation_account_id: varchar(\"depreciation_account_id\").references(() => accounts.id),\n  expense_account_id: varchar(\"expense_account_id\").references(() => accounts.id),\n  disposal_date: timestamp(\"disposal_date\"),\n  disposal_proceeds: decimal(\"disposal_proceeds\", { precision: 15, scale: 2 }),\n  is_active: boolean(\"is_active\").notNull().default(true),\n  created_at: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n  updated_at: timestamp(\"updated_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\n// ==== PROJECTS (Optional) ====\nexport const projects = pgTable(\"projects\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  company_id: varchar(\"company_id\").notNull().references(() => companies.id, { onDelete: \"cascade\" }),\n  code: text(\"code\").notNull(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  budget: decimal(\"budget\", { precision: 15, scale: 2 }),\n  start_date: timestamp(\"start_date\"),\n  end_date: timestamp(\"end_date\"),\n  status: text(\"status\").notNull().default(\"active\"), // active, completed, on_hold, cancelled\n  is_active: boolean(\"is_active\").notNull().default(true),\n  created_at: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n  updated_at: timestamp(\"updated_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\n// ==== ATTACHMENTS ====\nexport const attachments = pgTable(\"attachments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  entity_type: text(\"entity_type\").notNull(), // invoice, bill, expense, contact, item, etc\n  entity_id: varchar(\"entity_id\").notNull(),\n  filename: text(\"filename\").notNull(),\n  original_filename: text(\"original_filename\").notNull(),\n  file_size: integer(\"file_size\").notNull(),\n  mime_type: text(\"mime_type\").notNull(),\n  file_path: text(\"file_path\").notNull(),\n  ocr_text: text(\"ocr_text\"),\n  uploaded_by: varchar(\"uploaded_by\").references(() => users.id),\n  created_at: timestamp(\"created_at\").notNull().default(sql`CURRENT_TIMESTAMP`),\n});\n\n// ==== AUDIT LOG ====\nexport const audit_logs = pgTable(\"audit_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  company_id: varchar(\"company_id\").notNull().references(() => companies.id, { onDelete: \"cascade\" }),\n  entity_type: text(\"entity_type\").notNull(),\n  entity_id: varchar(\"entity_id\").notNull(),\n  action: text(\"action\").notNull(), // create, update, delete, sync_conflict\n  changes: jsonb(\"changes\"),\n  actor_id: varchar(\"actor_id\").references(() => users.id),\n  actor_name: text(\"actor_name\"),\n  timestamp: timestamp(\"timestamp\").notNull().default(sql`CURRENT_TIMESTAMP`),\n  ip_address: text(\"ip_address\"),\n  user_agent: text(\"user_agent\"),\n});\n\n// ==== ADD ADDITIONAL SCHEMAS ====\nexport const insertFixedAssetSchema = createInsertSchema(fixed_assets).omit({\n  id: true,\n  created_at: true,\n  updated_at: true,\n});\n\nexport const insertProjectSchema = createInsertSchema(projects).omit({\n  id: true,\n  created_at: true,\n  updated_at: true,\n});\n\nexport const insertWarehouseSchema = createInsertSchema(warehouses).omit({\n  id: true,\n  created_at: true,\n  updated_at: true,\n});\n\nexport const insertBankAccountSchema = createInsertSchema(bank_accounts).omit({\n  id: true,\n  created_at: true,\n  updated_at: true,\n});\n\n// ==== ZOD SCHEMAS ====\nexport const insertCompanySchema = createInsertSchema(companies).omit({\n  id: true,\n  created_at: true,\n  updated_at: true,\n});\n\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  password_hash: true, // Will be generated server-side from password\n  created_at: true,\n  updated_at: true,\n  last_login_at: true,\n}).extend({\n  password: z.string().min(8, \"Password must be at least 8 characters\"),\n});\n\nexport const insertAccountSchema = createInsertSchema(accounts).omit({\n  id: true,\n  created_at: true,\n  updated_at: true,\n});\n\nexport const insertTaxSchema = createInsertSchema(taxes).omit({\n  id: true,\n  created_at: true,\n  updated_at: true,\n});\n\nexport const insertContactSchema = createInsertSchema(contacts).omit({\n  id: true,\n  created_at: true,\n  updated_at: true,\n});\n\nexport const insertItemSchema = createInsertSchema(items).omit({\n  id: true,\n  created_at: true,\n  updated_at: true,\n});\n\nexport const insertSalesInvoiceSchema = createInsertSchema(sales_invoices).omit({\n  id: true,\n  created_at: true,\n  updated_at: true,\n});\n\nexport const insertBillSchema = createInsertSchema(bills).omit({\n  id: true,\n  created_at: true,\n  updated_at: true,\n});\n\nexport const insertExpenseSchema = createInsertSchema(expenses).omit({\n  id: true,\n  created_at: true,\n  updated_at: true,\n});\n\nexport const insertPaymentSchema = createInsertSchema(payments).omit({\n  id: true,\n  created_at: true,\n  updated_at: true,\n});\n\nexport const insertReceiptSchema = createInsertSchema(receipts).omit({\n  id: true,\n  created_at: true,\n  updated_at: true,\n});\n\n// ==== AUTHENTICATION SCHEMAS ====\n// Login schema - only includes email and password\nexport const loginSchema = z.object({\n  email: z.string().email(\"Please enter a valid email address\"),\n  password: z.string().min(6, \"Password must be at least 6 characters\"),\n});\n\n// Registration schema - for creating user and company together\nexport const registrationSchema = z.object({\n  // Company info\n  companyName: z.string().min(2, \"Company name must be at least 2 characters\"),\n  baseCurrency: z.string().length(3, \"Currency must be 3 characters\").default(\"USD\"),\n  fiscalYearStart: z.number().min(1).max(12).default(1),\n  \n  // User info  \n  username: z.string().min(3, \"Username must be at least 3 characters\"),\n  email: z.string().email(\"Please enter a valid email address\"),\n  password: z.string().min(8, \"Password must be at least 8 characters\"),\n  fullName: z.string().min(2, \"Full name must be at least 2 characters\"),\n});\n\n// ==== TYPE EXPORTS ====\nexport type Company = typeof companies.$inferSelect;\nexport type InsertCompany = z.infer<typeof insertCompanySchema>;\n\nexport type User = typeof users.$inferSelect;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\n\nexport type Account = typeof accounts.$inferSelect;\nexport type InsertAccount = z.infer<typeof insertAccountSchema>;\n\nexport type Tax = typeof taxes.$inferSelect;\nexport type InsertTax = z.infer<typeof insertTaxSchema>;\n\nexport type Contact = typeof contacts.$inferSelect;\nexport type InsertContact = z.infer<typeof insertContactSchema>;\n\nexport type Item = typeof items.$inferSelect;\nexport type InsertItem = z.infer<typeof insertItemSchema>;\n\nexport type Warehouse = typeof warehouses.$inferSelect;\nexport type BankAccount = typeof bank_accounts.$inferSelect;\n\nexport type Journal = typeof journals.$inferSelect;\nexport type JournalLine = typeof journal_lines.$inferSelect;\n\nexport type SalesQuote = typeof sales_quotes.$inferSelect;\nexport type SalesOrder = typeof sales_orders.$inferSelect;\nexport type SalesInvoice = typeof sales_invoices.$inferSelect;\nexport type InsertSalesInvoice = z.infer<typeof insertSalesInvoiceSchema>;\n\nexport type PurchaseOrder = typeof purchase_orders.$inferSelect;\nexport type Bill = typeof bills.$inferSelect;\nexport type InsertBill = z.infer<typeof insertBillSchema>;\n\nexport type DocumentLine = typeof document_lines.$inferSelect;\n\nexport type Expense = typeof expenses.$inferSelect;\nexport type InsertExpense = z.infer<typeof insertExpenseSchema>;\n\nexport type Payment = typeof payments.$inferSelect;\nexport type InsertPayment = z.infer<typeof insertPaymentSchema>;\n\nexport type Receipt = typeof receipts.$inferSelect;\nexport type InsertReceipt = z.infer<typeof insertReceiptSchema>;\n\nexport type FixedAsset = typeof fixed_assets.$inferSelect;\nexport type InsertFixedAsset = z.infer<typeof insertFixedAssetSchema>;\n\nexport type Project = typeof projects.$inferSelect;\nexport type InsertProject = z.infer<typeof insertProjectSchema>;\n\nexport type InsertWarehouse = z.infer<typeof insertWarehouseSchema>;\nexport type InsertBankAccount = z.infer<typeof insertBankAccountSchema>;\n\nexport type Attachment = typeof attachments.$inferSelect;\nexport type AuditLog = typeof audit_logs.$inferSelect;","size_bytes":29874},"client/src/App.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Switch, Route, useLocation } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { AppSidebar } from \"@/components/AppSidebar\";\nimport { ThemeProvider } from \"@/components/ThemeProvider\";\nimport { ThemeToggle } from \"@/components/ThemeToggle\";\nimport { LanguageToggle } from \"@/components/LanguageToggle\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { Dashboard } from \"@/components/Dashboard\";\nimport { InvoiceForm } from \"@/components/InvoiceForm\";\nimport { TaxConfiguration } from \"@/components/TaxConfiguration\";\nimport CompaniesPage from \"@/pages/CompaniesPage\";\nimport AccountsPage from \"@/pages/AccountsPage\";\nimport ContactsPage from \"@/pages/ContactsPage\";\nimport ItemsPage from \"@/pages/ItemsPage\";\n// Sales Pages\nimport InvoicesPage from \"@/pages/sales/InvoicesPage\";\nimport RecurringInvoicesPage from \"@/pages/sales/RecurringInvoicesPage\";\nimport QuotationsPage from \"@/pages/sales/QuotationsPage\";\nimport OrdersPage from \"@/pages/sales/OrdersPage\";\nimport CreditNotesPage from \"@/pages/sales/CreditNotesPage\";\n// Purchase Pages  \nimport BillsPage from \"@/pages/purchases/BillsPage\";\nimport PurchaseOrdersPage from \"@/pages/purchases/OrdersPage\";\nimport ExpensesPage from \"@/pages/purchases/ExpensesPage\";\nimport DebitNotesPage from \"@/pages/purchases/DebitNotesPage\";\n// Banking Pages\nimport BankAccountsPage from \"@/pages/banking/AccountsPage\";\nimport ReconciliationPage from \"@/pages/banking/ReconciliationPage\";\nimport PaymentsPage from \"@/pages/banking/PaymentsPage\";\nimport ReceiptsPage from \"@/pages/banking/ReceiptsPage\";\n// Reports Pages\nimport BalanceSheetPage from \"@/pages/reports/BalanceSheetPage\";\nimport ProfitLossPage from \"@/pages/reports/ProfitLossPage\";\nimport CashFlowPage from \"@/pages/reports/CashFlowPage\";\nimport TrialBalancePage from \"@/pages/reports/TrialBalancePage\";\nimport TaxPage from \"@/pages/reports/TaxPage\";\nimport InventoryPage from \"@/pages/reports/InventoryPage\";\n// Settings Pages\nimport GeneralSettingsPage from \"@/pages/settings/GeneralSettingsPage\";\nimport LanguageSettingsPage from \"@/pages/settings/LanguageSettingsPage\";\nimport UsersPage from \"@/pages/settings/UsersPage\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Bell, Wifi, WifiOff, Plus, CreditCard, LogOut } from \"lucide-react\";\nimport NotFound from \"@/pages/not-found\";\nimport AuthPage from \"@/pages/AuthPage\";\nimport { AuthProvider, useAuth } from \"@/contexts/AuthContext\";\nimport { TranslationProvider } from \"@/contexts/TranslationContext\";\n\n// Component to redirect /settings to /settings/general\nfunction SettingsRedirect() {\n  const [, setLocation] = useLocation();\n  \n  useEffect(() => {\n    setLocation('/settings/general');\n  }, [setLocation]);\n\n  return null;\n}\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Dashboard} />\n      <Route path=\"/companies\" component={CompaniesPage} />\n      <Route path=\"/accounts\" component={AccountsPage} />\n      <Route path=\"/contacts\" component={ContactsPage} />\n      <Route path=\"/items\" component={ItemsPage} />\n      \n      {/* Sales Routes */}\n      <Route path=\"/sales/invoices\" component={InvoicesPage} />\n      <Route path=\"/sales/invoices/new\" component={InvoiceForm} />\n      <Route path=\"/sales/invoices/recurring\" component={RecurringInvoicesPage} />\n      <Route path=\"/sales/quotations\" component={QuotationsPage} />\n      <Route path=\"/sales/orders\" component={OrdersPage} />\n      <Route path=\"/sales/credit-notes\" component={CreditNotesPage} />\n      \n      {/* Purchase Routes */}\n      <Route path=\"/purchases/bills\" component={BillsPage} />\n      <Route path=\"/purchases/orders\" component={PurchaseOrdersPage} />\n      <Route path=\"/purchases/expenses\" component={ExpensesPage} />\n      <Route path=\"/purchases/debit-notes\" component={DebitNotesPage} />\n      \n      {/* Banking Routes */}\n      <Route path=\"/banking/accounts\" component={BankAccountsPage} />\n      <Route path=\"/banking/reconciliation\" component={ReconciliationPage} />\n      <Route path=\"/banking/payments\" component={PaymentsPage} />\n      <Route path=\"/banking/receipts\" component={ReceiptsPage} />\n      \n      {/* Reports Routes */}\n      <Route path=\"/reports/financial\" component={() => <div>Financial Reports Hub</div>} />\n      <Route path=\"/reports/balance-sheet\" component={BalanceSheetPage} />\n      <Route path=\"/reports/profit-loss\" component={ProfitLossPage} />\n      <Route path=\"/reports/cash-flow\" component={CashFlowPage} />\n      <Route path=\"/reports/trial-balance\" component={TrialBalancePage} />\n      <Route path=\"/reports/tax\" component={TaxPage} />\n      <Route path=\"/reports/inventory\" component={InventoryPage} />\n      \n      {/* Settings Routes */}\n      <Route path=\"/settings\" component={SettingsRedirect} />\n      <Route path=\"/settings/taxes\" component={TaxConfiguration} />\n      <Route path=\"/settings/general\" component={GeneralSettingsPage} />\n      <Route path=\"/settings/languages\" component={LanguageSettingsPage} />\n      <Route path=\"/settings/users\" component={UsersPage} />\n      \n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\n// Application content that requires authentication\nfunction ApplicationContent() {\n  const { user, logout } = useAuth();\n  const [isOnline, setIsOnline] = useState(true);\n  const [showNotifications, setShowNotifications] = useState(false);\n  \n  // Mock notifications - to be replaced with real data later\n  const mockNotifications = [\n    { id: 1, message: \"Welcome to Log & Ledger!\", type: \"success\" },\n    { id: 2, message: \"Your account is now active\", type: \"info\" },\n  ];\n  \n  const toggleOfflineMode = () => {\n    setIsOnline(!isOnline);\n    console.log('Offline mode toggled:', !isOnline);\n  };\n\n  const handleQuickAction = (action: string) => {\n    console.log('Quick action triggered:', action);\n  };\n\n  const handleLogout = async () => {\n    try {\n      await logout();\n    } catch (error) {\n      console.error('Logout error:', error);\n    }\n  };\n\n  const isMobile = useIsMobile();\n  \n  const sidebarStyle = {\n    \"--sidebar-width\": isMobile ? \"18rem\" : \"16rem\",\n    \"--sidebar-width-icon\": \"3rem\",\n  };\n\n  return (\n    <SidebarProvider style={sidebarStyle as React.CSSProperties}>\n      <div className=\"flex h-screen w-full\">\n        <AppSidebar />\n        <div className=\"flex flex-col flex-1\">\n          {/* Header */}\n          <header className=\"flex items-center justify-between p-4 border-b bg-background\">\n            <div className=\"flex items-center gap-2 md:gap-4\">\n              <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n              <div className=\"flex items-center gap-1 md:gap-2\">\n                <h2 className=\"text-sm md:text-lg font-semibold text-foreground\">\n                  {isMobile ? \"L&L\" : \"Log & Ledger\"}\n                </h2>\n                {!isMobile && (\n                  <Badge variant=\"secondary\" className=\"text-xs\">\n                    Global Accounting\n                  </Badge>\n                )}\n              </div>\n            </div>\n            \n            <div className=\"flex items-center gap-1 md:gap-2\">\n              {/* User info - Hidden on mobile */}\n              {!isMobile && (\n                <div className=\"flex items-center gap-2 mr-4\">\n                  <Badge variant=\"outline\" className=\"text-xs\">\n                    {user?.full_name}\n                  </Badge>\n                  <Badge variant=\"secondary\" className=\"text-xs\">\n                    {user?.role}\n                  </Badge>\n                </div>\n              )}\n              \n              {/* Quick Actions - Only one on mobile */}\n              {isMobile ? (\n                <Button \n                  size=\"sm\" \n                  variant=\"outline\"\n                  onClick={() => handleQuickAction('new-invoice')}\n                  data-testid=\"button-quick-invoice\"\n                >\n                  <Plus className=\"h-4 w-4\" />\n                </Button>\n              ) : (\n                <>\n                  <Button \n                    size=\"sm\" \n                    variant=\"outline\"\n                    onClick={() => handleQuickAction('new-invoice')}\n                    data-testid=\"button-quick-invoice\"\n                  >\n                    <Plus className=\"h-4 w-4 mr-1\" />\n                    Invoice\n                  </Button>\n                  <Button \n                    size=\"sm\" \n                    variant=\"outline\"\n                    onClick={() => handleQuickAction('record-payment')}\n                    data-testid=\"button-quick-payment\"\n                  >\n                    <CreditCard className=\"h-4 w-4 mr-1\" />\n                    Payment\n                  </Button>\n                </>\n              )}\n              \n              {/* Online/Offline Status - Hidden on mobile */}\n              {!isMobile && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={toggleOfflineMode}\n                  data-testid=\"button-offline-toggle\"\n                >\n                  {isOnline ? (\n                    <Wifi className=\"h-4 w-4 text-green-600\" />\n                  ) : (\n                    <WifiOff className=\"h-4 w-4 text-red-600\" />\n                  )}\n                </Button>\n              )}\n              \n              {/* Notifications */}\n              <div className=\"relative\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => setShowNotifications(!showNotifications)}\n                  data-testid=\"button-notifications\"\n                >\n                  <Bell className=\"h-4 w-4\" />\n                  {mockNotifications.length > 0 && (\n                    <Badge \n                      variant=\"destructive\" \n                      className=\"absolute -top-1 -right-1 h-5 w-5 text-xs p-0 flex items-center justify-center\"\n                    >\n                      {mockNotifications.length}\n                    </Badge>\n                  )}\n                </Button>\n                \n                {/* Notification Dropdown */}\n                {showNotifications && (\n                  <div \n                    className={`absolute right-0 top-12 ${isMobile ? 'w-64' : 'w-80'} bg-popover border rounded-lg shadow-lg p-4 z-50`}\n                    data-testid=\"dropdown-notifications\"\n                  >\n                    <h3 className=\"font-medium mb-3\">Notifications</h3>\n                    <div className=\"space-y-2\">\n                      {mockNotifications.map((notification) => (\n                        <div \n                          key={notification.id} \n                          className=\"p-2 rounded border text-sm hover-elevate\"\n                          data-testid={`notification-${notification.id}`}\n                        >\n                          {notification.message}\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </div>\n              \n              {/* Theme Toggle - Always visible */}\n              <ThemeToggle />\n              \n              {/* Language Toggle - Always visible for all users */}\n              <LanguageToggle />\n              \n              {/* Logout Button */}\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={handleLogout}\n                data-testid=\"button-logout\"\n              >\n                <LogOut className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </header>\n\n          {/* Main Content */}\n          <main className=\"flex-1 overflow-auto p-3 md:p-6 bg-background\">\n            <Router />\n          </main>\n\n          {/* Status Bar */}\n          <footer className=\"flex items-center justify-between px-3 md:px-6 py-2 border-t bg-muted/30 text-xs text-muted-foreground\">\n            <div className=\"flex items-center gap-2 md:gap-4\">\n              {!isMobile && <span>Status: </span>}\n              <Badge \n                variant={isOnline ? \"default\" : \"secondary\"}\n                className=\"text-xs\"\n              >\n                {isOnline ? \"Online\" : \"Offline\"}\n              </Badge>\n              {!isMobile && <span>Last sync: 2 minutes ago</span>}\n            </div>\n            <div className=\"flex items-center gap-2 md:gap-4\">\n              {isMobile ? (\n                <span>Â© 2024 L&L</span>\n              ) : (\n                <>\n                  <span>User: {user?.username}</span>\n                  <span>Multi-currency support enabled</span>\n                  <span>Auto-backup: ON</span>\n                  <span>Â© 2024 Log & Ledger</span>\n                </>\n              )}\n            </div>\n          </footer>\n        </div>\n      </div>\n    </SidebarProvider>\n  );\n}\n\n// Main App component with authentication logic\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <ThemeProvider>\n          <TranslationProvider>\n            <AuthProvider>\n              <AppContent />\n            </AuthProvider>\n          </TranslationProvider>\n          <Toaster />\n        </ThemeProvider>\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\n// App content that handles authentication state\nfunction AppContent() {\n  const { isAuthenticated, isLoading } = useAuth();\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-primary mx-auto mb-4\"></div>\n          <p className=\"text-muted-foreground\">Loading Log & Ledger...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return <AuthPage />;\n  }\n\n  return <ApplicationContent />;\n}\n\nexport default App;\n","size_bytes":14204},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* RESPONSIVE BASE STYLES - Essential for mobile */\nhtml {\n  box-sizing: border-box;\n}\n\n*, *::before, *::after {\n  box-sizing: inherit;\n}\n\n/* Responsive media defaults */\nimg, video, canvas, iframe {\n  max-width: 100%;\n  height: auto;\n  display: block;\n}\n\n/* Prevent horizontal overflow */\nhtml, body {\n  overflow-x: hidden;\n  width: 100%;\n  max-width: 100%;\n}\n\n/* Base responsive text styles - scoped to content elements */\nh1, h2, h3, h4, h5, h6, p, a {\n  line-height: 1.35;\n  white-space: normal;\n  overflow-wrap: anywhere;\n  word-break: break-word;\n  letter-spacing: normal;\n}\n\n/* Content containers with responsive text */\n.prose, .responsive-container, .content-area {\n  overflow-wrap: anywhere;\n  word-break: break-word;\n}\n\n/* Responsive flex containers */\n.responsive-container {\n  width: 100%;\n  max-width: 100%;\n  min-width: 0;\n}\n\n/* Responsive flex items */\n.responsive-flex {\n  display: flex;\n  flex-wrap: wrap;\n  width: 100%;\n  max-width: 100%;\n}\n\n.responsive-flex > * {\n  min-width: 0; /* Critical for flex items to shrink */\n  flex-shrink: 1;\n}\n\n/* Table responsive wrapper */\n.table-responsive {\n  overflow-x: auto;\n  -webkit-overflow-scrolling: touch;\n  width: 100%;\n  max-width: 100%;\n  border-radius: 0.5rem;\n  border: 1px solid hsl(var(--border));\n}\n\n/* Responsive tables - make them scrollable on mobile */\ntable {\n  width: 100%;\n  max-width: 100%;\n  border-collapse: collapse;\n}\n\n/* Responsive images and media */\niframe, embed, object {\n  max-width: 100%;\n  height: auto;\n}\n\n/* Responsive containers - prevent overflow */\n.container, .max-w-7xl, .max-w-6xl, .max-w-5xl, .max-w-4xl {\n  width: 100%;\n  max-width: 100%;\n  padding-left: 1rem;\n  padding-right: 1rem;\n}\n\n/* Responsive flex utilities */\n.responsive-grid {\n  display: grid;\n  grid-template-columns: 1fr;\n  gap: 1rem;\n  width: 100%;\n  max-width: 100%;\n}\n\n@media (min-width: 640px) {\n  .responsive-grid {\n    grid-template-columns: repeat(2, 1fr);\n  }\n}\n\n@media (min-width: 1024px) {\n  .responsive-grid {\n    grid-template-columns: repeat(3, 1fr);\n  }\n}\n\n/* Mobile breakpoints */\n@media (max-width: 575px) {\n  .container {\n    padding-left: 1rem !important;\n    padding-right: 1rem !important;\n  }\n  \n  h1 { font-size: 1.5rem !important; }\n  h2 { font-size: 1.25rem !important; }\n  h3 { font-size: 1.125rem !important; }\n  \n  /* Reduce negative margins on mobile */\n  .-mx-4 { margin-left: -0.5rem !important; margin-right: -0.5rem !important; }\n  .-mx-6 { margin-left: -1rem !important; margin-right: -1rem !important; }\n  .-mx-8 { margin-left: -1rem !important; margin-right: -1rem !important; }\n}\n\n@media (max-width: 767px) {\n  .container {\n    padding-left: 0.75rem !important;\n    padding-right: 0.75rem !important;\n  }\n  \n  /* Apply min-width overrides selectively to known overflow containers */\n  .overflow-container .min-w-full { min-width: auto !important; }\n  .overflow-container .min-w-max { min-width: auto !important; }\n  .overflow-container .min-w-fit { min-width: auto !important; }\n}\n\n/* Additional responsive utilities */\n@media (max-width: 639px) {\n  /* Ultra-small screens */\n  .text-base { font-size: 0.875rem !important; }\n  .text-lg { font-size: 1rem !important; }\n  .text-xl { font-size: 1.125rem !important; }\n  \n  /* Responsive padding and margins */\n  .p-6 { padding: 1rem !important; }\n  .p-8 { padding: 1.5rem !important; }\n  .px-6 { padding-left: 1rem !important; padding-right: 1rem !important; }\n  .px-8 { padding-left: 1.5rem !important; padding-right: 1.5rem !important; }\n  \n  /* Responsive gaps */\n  .gap-6 { gap: 1rem !important; }\n  .gap-8 { gap: 1.5rem !important; }\n  \n  /* Fix overflow on any remaining elements */\n  .overflow-x-auto {\n    overflow-x: auto !important;\n    overflow-y: hidden !important;\n    -webkit-overflow-scrolling: touch !important;\n  }\n}\n\n/* Root element responsive constraints */\n#root {\n  width: 100%;\n  max-width: 100%;\n  min-width: 0;\n  overflow-x: hidden;\n}\n\n/* Responsive containers - apply to specific containers only */\n.container-responsive, .page-container, .dialog-responsive {\n  max-width: 100%;\n  overflow-x: hidden;\n}\n\n/* Responsive text handling - enhanced */\nh1, h2, h3, h4, h5, h6 {\n  word-wrap: break-word !important;\n  overflow-wrap: break-word !important;\n  hyphens: auto;\n}\n\n/* Button responsive behavior */\n@media (max-width: 767px) {\n  .button-group {\n    flex-direction: column !important;\n    width: 100% !important;\n  }\n  \n  .button-group > * {\n    width: 100% !important;\n    margin-bottom: 0.5rem !important;\n  }\n}\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n\n  /* Automatic computation of border around primary / danger buttons */\n  --opaque-button-border-intensity: -8; /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n\n  --background: 0 0% 98%;\n\n  --foreground: 210 15% 15%;\n\n  --border: 210 8% 88%;\n\n  --card: 210 5% 96%;\n\n  --card-foreground: 210 15% 15%;\n\n  --card-border: 210 8% 92%;\n\n  --sidebar: 210 4% 94%;\n\n  --sidebar-foreground: 210 15% 15%;\n\n  --sidebar-border: 210 8% 90%;\n\n  --sidebar-primary: 210 100% 20%;\n\n  --sidebar-primary-foreground: 0 0% 98%;\n\n  --sidebar-accent: 210 6% 88%;\n\n  --sidebar-accent-foreground: 210 15% 15%;\n\n  --sidebar-ring: 210 100% 20%;\n\n  --popover: 210 6% 92%;\n\n  --popover-foreground: 210 15% 15%;\n\n  --popover-border: 210 8% 88%;\n\n  --primary: 210 100% 20%;\n\n  --primary-foreground: 0 0% 98%;\n\n  --secondary: 210 6% 88%;\n\n  --secondary-foreground: 210 15% 15%;\n\n  --muted: 210 6% 90%;\n\n  --muted-foreground: 210 10% 45%;\n\n  --accent: 210 8% 92%;\n\n  --accent-foreground: 210 15% 15%;\n\n  --destructive: 355 70% 45%;\n\n  --destructive-foreground: 0 0% 98%;\n\n  --input: 210 12% 82%;\n  --ring: 210 100% 20%;\n  --chart-1: 210 100% 35%;\n  --chart-2: 140 60% 40%;\n  --chart-3: 35 85% 50%;\n  --chart-4: 280 65% 45%;\n  --chart-5: 25 75% 55%;\n\n  --font-sans: Open Sans, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: .5rem; /* 8px */\n  --shadow-2xs: 0px 2px 0px 0px hsl(210 15% 15% / 0.02);\n  --shadow-xs: 0px 2px 0px 0px hsl(210 15% 15% / 0.03);\n  --shadow-sm: 0px 2px 0px 0px hsl(210 15% 15% / 0.04), 0px 1px 2px -1px hsl(210 15% 15% / 0.05);\n  --shadow: 0px 2px 0px 0px hsl(210 15% 15% / 0.05), 0px 1px 2px -1px hsl(210 15% 15% / 0.06);\n  --shadow-md: 0px 2px 0px 0px hsl(210 15% 15% / 0.06), 0px 2px 4px -1px hsl(210 15% 15% / 0.07);\n  --shadow-lg: 0px 2px 0px 0px hsl(210 15% 15% / 0.08), 0px 4px 6px -1px hsl(210 15% 15% / 0.09);\n  --shadow-xl: 0px 2px 0px 0px hsl(210 15% 15% / 0.10), 0px 8px 10px -1px hsl(210 15% 15% / 0.11);\n  --shadow-2xl: 0px 2px 0px 0px hsl(210 15% 15% / 0.15);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n\n  --opaque-button-border-intensity: 9;  /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n\n  --background: 210 15% 8%;\n\n  --foreground: 210 5% 95%;\n\n  --border: 210 12% 18%;\n\n  --card: 210 12% 12%;\n\n  --card-foreground: 210 5% 95%;\n\n  --card-border: 210 12% 20%;\n\n  --sidebar: 210 12% 10%;\n\n  --sidebar-foreground: 210 5% 95%;\n\n  --sidebar-border: 210 12% 16%;\n\n  --sidebar-primary: 210 80% 65%;\n\n  --sidebar-primary-foreground: 210 15% 8%;\n\n  --sidebar-accent: 210 12% 18%;\n\n  --sidebar-accent-foreground: 210 5% 95%;\n\n  --sidebar-ring: 210 80% 65%;\n\n  --popover: 210 12% 15%;\n\n  --popover-foreground: 210 5% 95%;\n\n  --popover-border: 210 12% 22%;\n\n  --primary: 210 80% 65%;\n\n  --primary-foreground: 210 15% 8%;\n\n  --secondary: 210 12% 20%;\n\n  --secondary-foreground: 210 5% 95%;\n\n  --muted: 210 12% 18%;\n\n  --muted-foreground: 210 8% 75%;\n\n  --accent: 210 12% 16%;\n\n  --accent-foreground: 210 5% 95%;\n\n  --destructive: 355 70% 55%;\n\n  --destructive-foreground: 210 15% 8%;\n\n  --input: 210 12% 25%;\n  --ring: 210 80% 65%;\n  --chart-1: 210 80% 70%;\n  --chart-2: 140 55% 65%;\n  --chart-3: 35 75% 65%;\n  --chart-4: 280 60% 70%;\n  --chart-5: 25 65% 70%;\n\n  --shadow-2xs: 0px 2px 0px 0px hsl(210 15% 5% / 0.15);\n  --shadow-xs: 0px 2px 0px 0px hsl(210 15% 5% / 0.20);\n  --shadow-sm: 0px 2px 0px 0px hsl(210 15% 5% / 0.25), 0px 1px 2px -1px hsl(210 15% 5% / 0.30);\n  --shadow: 0px 2px 0px 0px hsl(210 15% 5% / 0.30), 0px 1px 2px -1px hsl(210 15% 5% / 0.35);\n  --shadow-md: 0px 2px 0px 0px hsl(210 15% 5% / 0.35), 0px 2px 4px -1px hsl(210 15% 5% / 0.40);\n  --shadow-lg: 0px 2px 0px 0px hsl(210 15% 5% / 0.40), 0px 4px 6px -1px hsl(210 15% 5% / 0.45);\n  --shadow-xl: 0px 2px 0px 0px hsl(210 15% 5% / 0.45), 0px 8px 10px -1px hsl(210 15% 5% / 0.50);\n  --shadow-2xl: 0px 2px 0px 0px hsl(210 15% 5% / 0.60);\n\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n\n/* Mobile-specific utilities */\n@media (max-width: 767px) {\n  /* Hide scrollbars on mobile to prevent double scrolling */\n  .hide-scrollbar::-webkit-scrollbar {\n    display: none;\n  }\n  .hide-scrollbar {\n    -ms-overflow-style: none;\n    scrollbar-width: none;\n  }\n  \n  /* Mobile table wrapper */\n  .mobile-table-container {\n    overflow-x: auto;\n    -webkit-overflow-scrolling: touch;\n    border-radius: 0.5rem;\n    border: 1px solid hsl(var(--border));\n  }\n  \n  /* Stack table rows as cards on mobile */\n  .table-mobile-stack tr {\n    display: block;\n    border: 1px solid hsl(var(--border));\n    border-radius: 0.5rem;\n    padding: 1rem;\n    margin-bottom: 0.75rem;\n    background: hsl(var(--card));\n  }\n  \n  .table-mobile-stack td {\n    display: block;\n    border: none;\n    padding: 0.25rem 0;\n    text-align: left !important;\n  }\n  \n  .table-mobile-stack td:before {\n    content: attr(data-label) \": \";\n    font-weight: 600;\n    color: hsl(var(--muted-foreground));\n  }\n  \n  /* Hide table headers on mobile stack */\n  .table-mobile-stack thead {\n    display: none;\n  }\n}\n\n/* Mobile-first responsive utilities */\n.responsive-flex {\n  @apply flex-col space-y-4;\n}\n\n@media (min-width: 768px) {\n  .responsive-flex {\n    @apply flex-row space-y-0 space-x-4;\n  }\n}\n\n/* Mobile-friendly button groups */\n.mobile-button-group {\n  @apply flex flex-col space-y-2;\n}\n\n@media (min-width: 640px) {\n  .mobile-button-group {\n    @apply flex-row space-y-0 space-x-2;\n  }\n}","size_bytes":15786},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/AppSidebar.tsx":{"content":"import { useState } from 'react';\nimport { Link, useLocation } from 'wouter';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { useTranslation } from 'react-i18next';\nimport { useQuery } from '@tanstack/react-query';\nimport type { companies } from '@shared/schema';\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarHeader,\n  SidebarFooter,\n  useSidebar,\n} from '@/components/ui/sidebar';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport {\n  LayoutDashboard,\n  Building2,\n  Calculator,\n  Users,\n  Package,\n  Receipt,\n  ShoppingCart,\n  FileText,\n  CreditCard,\n  Wallet,\n  ChartBar,\n  Settings,\n  Globe,\n  Shield,\n  LogOut,\n  ChevronDown,\n  ChevronRight,\n  Plus,\n  Building,\n  PiggyBank,\n  BarChart3,\n} from 'lucide-react';\n\n// Type for company data from API\ntype Company = typeof companies.$inferSelect;\n\nexport function AppSidebar() {\n  const { t } = useTranslation();\n  const [location] = useLocation();\n  const { user, logout, switchCompany } = useAuth();\n  const { setOpenMobile, isMobile } = useSidebar();\n\n  const [expandedItems, setExpandedItems] = useState<string[]>([]);\n\n  // Fetch companies from API instead of using mock data\n  const { data: companiesData = [], isLoading: companiesLoading } = useQuery<Company[]>({\n    queryKey: ['/api/companies'],\n    enabled: !!user\n  });\n\n  // Get current active company from the fetched companies\n  const activeCompany = companiesData.length > 0 \n    ? companiesData.find(c => c.id === user?.activeCompany?.id) || companiesData[0]\n    : null;\n\n  const menuItems = [\n    {\n      group: t('navigation.main'),\n      items: [\n        {\n          id: 'dashboard',\n          title: t('navigation.dashboard'),\n          href: '/',\n          icon: LayoutDashboard,\n          badge: null,\n        },\n      ],\n    },\n    {\n      group: t('navigation.setup'),\n      items: [\n        {\n          id: 'companies',\n          title: t('navigation.companies'),\n          href: '/companies',\n          icon: Building2,\n          badge: null,\n        },\n        {\n          id: 'accounts',\n          title: t('navigation.accounts'),\n          href: '/accounts',\n          icon: Calculator,\n          badge: null,\n        },\n        {\n          id: 'contacts',\n          title: t('navigation.contacts'),\n          href: '/contacts',\n          icon: Users,\n          badge: null,\n        },\n        {\n          id: 'items',\n          title: t('navigation.items'),\n          href: '/items',\n          icon: Package,\n          badge: null,\n        },\n      ],\n    },\n    {\n      group: t('navigation.sales'),\n      items: [\n        {\n          id: 'invoices',\n          title: t('sales.invoices'),\n          href: '/sales/invoices',\n          icon: Receipt,\n          badge: null,\n          subItems: [\n            {\n              id: 'add-invoice',\n              title: t('sales.addInvoice'),\n              href: '/sales/invoices/new',\n              icon: Plus,\n            },\n            {\n              id: 'recurring-invoices',\n              title: t('sales.recurringInvoices'),\n              href: '/sales/invoices/recurring',\n              icon: FileText,\n            },\n          ],\n        },\n        {\n          id: 'quotations',\n          title: t('sales.quotations'),\n          href: '/sales/quotations',\n          icon: FileText,\n          badge: null,\n        },\n        {\n          id: 'orders',\n          title: t('sales.orders'),\n          href: '/sales/orders',\n          icon: ShoppingCart,\n          badge: null,\n        },\n        {\n          id: 'credit-notes',\n          title: t('sales.creditNotes'),\n          href: '/sales/credit-notes',\n          icon: CreditCard,\n          badge: null,\n        },\n      ],\n    },\n    {\n      group: t('navigation.purchases'),\n      items: [\n        {\n          id: 'bills',\n          title: t('purchases.bills'),\n          href: '/purchases/bills',\n          icon: Receipt,\n          badge: null,\n        },\n        {\n          id: 'purchase-orders',\n          title: t('purchases.orders'),\n          href: '/purchases/orders',\n          icon: ShoppingCart,\n          badge: null,\n        },\n        {\n          id: 'expenses',\n          title: t('purchases.expenses'),\n          href: '/purchases/expenses',\n          icon: PiggyBank,\n          badge: null,\n        },\n        {\n          id: 'debit-notes',\n          title: t('purchases.debitNotes'),\n          href: '/purchases/debit-notes',\n          icon: CreditCard,\n          badge: null,\n        },\n      ],\n    },\n    {\n      group: t('navigation.banking'),\n      items: [\n        {\n          id: 'bank-accounts',\n          title: t('banking.accounts'),\n          href: '/banking/accounts',\n          icon: Wallet,\n          badge: null,\n        },\n        {\n          id: 'reconciliation',\n          title: t('banking.reconciliation'),\n          href: '/banking/reconciliation',\n          icon: Calculator,\n          badge: null,\n        },\n        {\n          id: 'payments',\n          title: t('banking.payments'),\n          href: '/banking/payments',\n          icon: CreditCard,\n          badge: null,\n        },\n        {\n          id: 'receipts',\n          title: t('banking.receipts'),\n          href: '/banking/receipts',\n          icon: Receipt,\n          badge: null,\n        },\n      ],\n    },\n    {\n      group: t('navigation.reports'),\n      items: [\n        {\n          id: 'balance-sheet',\n          title: t('reports.balanceSheet'),\n          href: '/reports/balance-sheet',\n          icon: BarChart3,\n          badge: null,\n        },\n        {\n          id: 'profit-loss',\n          title: t('reports.profitLoss'),\n          href: '/reports/profit-loss',\n          icon: ChartBar,\n          badge: null,\n        },\n        {\n          id: 'cash-flow',\n          title: t('reports.cashFlow'),\n          href: '/reports/cash-flow',\n          icon: Wallet,\n          badge: null,\n        },\n        {\n          id: 'trial-balance',\n          title: t('reports.trialBalance'),\n          href: '/reports/trial-balance',\n          icon: Calculator,\n          badge: null,\n        },\n        {\n          id: 'tax',\n          title: t('reports.tax'),\n          href: '/reports/tax',\n          icon: Receipt,\n          badge: null,\n        },\n        {\n          id: 'inventory',\n          title: t('reports.inventory'),\n          href: '/reports/inventory',\n          icon: Package,\n          badge: null,\n        },\n      ],\n    },\n    {\n      group: t('navigation.settings'),\n      items: [\n        {\n          id: 'general',\n          title: t('settings.general'),\n          href: '/settings/general',\n          icon: Settings,\n          badge: null,\n        },\n        {\n          id: 'languages',\n          title: t('settings.languages'),\n          href: '/settings/languages',\n          icon: Globe,\n          badge: null,\n        },\n        {\n          id: 'users',\n          title: t('settings.users'),\n          href: '/settings/users',\n          icon: Shield,\n          badge: null,\n        },\n      ],\n    },\n  ];\n\n  const toggleExpanded = (id: string) => {\n    setExpandedItems(prev => \n      prev.includes(id) \n        ? prev.filter(item => item !== id)\n        : [...prev, id]\n    );\n  };\n\n  const handleLogout = async () => {\n    await logout();\n  };\n\n  const setActiveCompany = async (company: Company) => {\n    try {\n      await switchCompany(company.id);\n    } catch (error) {\n      console.error('Failed to switch company:', error);\n    }\n  };\n\n  // Close mobile sidebar when navigation link is clicked\n  const handleLinkClick = () => {\n    if (isMobile) {\n      setOpenMobile(false);\n    }\n  };\n\n  // Helper function to generate company logo initials\n  const generateLogo = (name: string) => {\n    return name.split(' ').map(word => word[0]).join('').toUpperCase().slice(0, 2);\n  };\n\n  return (\n    <Sidebar>\n      <SidebarHeader className=\"p-4\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <div className=\"flex h-10 w-10 items-center justify-center rounded-lg bg-primary text-primary-foreground\">\n            <Calculator className=\"h-6 w-6\" />\n          </div>\n          <div className=\"flex flex-col\">\n            <span className=\"text-lg font-bold\">{t('app.name')}</span>\n            <span className=\"text-xs text-muted-foreground\">{t('app.tagline')}</span>\n          </div>\n        </div>\n        \n        <DropdownMenu>\n          <DropdownMenuTrigger className=\"w-full\" data-testid=\"button-company-switcher\">\n            <div className=\"flex items-center gap-3 p-2 rounded-lg hover-elevate\">\n              <Avatar className=\"h-8 w-8\">\n                <AvatarFallback className=\"text-xs font-medium\">\n                  {activeCompany ? generateLogo(activeCompany.name) : 'NA'}\n                </AvatarFallback>\n              </Avatar>\n              <div className=\"flex-1 text-left\">\n                <p className=\"text-sm font-medium text-sidebar-foreground\">\n                  {activeCompany?.name || t('companies.noCompany')}\n                </p>\n                <p className=\"text-xs text-muted-foreground\">{t('companies.switchCompany')}</p>\n              </div>\n              <ChevronDown className=\"h-4 w-4 text-muted-foreground\" />\n            </div>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent className=\"w-56\">\n            {companiesData.map((company) => (\n              <DropdownMenuItem\n                key={company.id}\n                onClick={() => setActiveCompany(company)}\n                data-testid={`option-company-${company.id}`}\n              >\n                <Avatar className=\"h-6 w-6 mr-2\">\n                  <AvatarFallback className=\"text-xs\">\n                    {generateLogo(company.name)}\n                  </AvatarFallback>\n                </Avatar>\n                {company.name}\n              </DropdownMenuItem>\n            ))}\n            <DropdownMenuSeparator />\n            <DropdownMenuItem asChild>\n              <Link href=\"/companies\" data-testid=\"button-manage-companies\" onClick={handleLinkClick}>\n                <Building className=\"h-4 w-4 mr-2\" />\n                {t('companies.manage')}\n              </Link>\n            </DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n      </SidebarHeader>\n      \n      <SidebarContent>\n        {menuItems.map((section) => (\n          <SidebarGroup key={section.group}>\n            <SidebarGroupLabel>{section.group}</SidebarGroupLabel>\n            <SidebarGroupContent>\n              <SidebarMenu>\n                {section.items.map((item) => {\n                  const isActive = location === item.href || \n                    (item.subItems && item.subItems.some(sub => location === sub.href));\n                  const isExpanded = expandedItems.includes(item.id);\n                  \n                  return (\n                    <SidebarMenuItem key={item.href}>\n                      {item.subItems ? (\n                        <div>\n                          <SidebarMenuButton\n                            onClick={() => toggleExpanded(item.id)}\n                            className={`justify-between ${isActive ? 'bg-sidebar-accent text-sidebar-accent-foreground' : ''}`}\n                            data-testid={`button-menu-${item.id}`}\n                          >\n                            <div className=\"flex items-center gap-2\">\n                              <item.icon className=\"h-4 w-4\" />\n                              <span>{item.title}</span>\n                            </div>\n                            <div className=\"flex items-center gap-1\">\n                              {item.badge && (\n                                <Badge variant=\"secondary\" className=\"text-xs\">\n                                  {item.badge}\n                                </Badge>\n                              )}\n                              <ChevronDown \n                                className={`h-4 w-4 transition-transform ${\n                                  isExpanded ? 'rotate-180' : ''\n                                }`} \n                              />\n                            </div>\n                          </SidebarMenuButton>\n                          {isExpanded && (\n                            <div className=\"ml-6 mt-1 space-y-1\">\n                              {item.subItems.map((subItem) => (\n                                <SidebarMenuButton\n                                  key={subItem.href}\n                                  asChild\n                                  size=\"sm\"\n                                  className={location === subItem.href ? 'bg-sidebar-accent text-sidebar-accent-foreground' : ''}\n                                >\n                                  <Link \n                                    href={subItem.href} \n                                    data-testid={`button-submenu-${subItem.id}`}\n                                    onClick={handleLinkClick}\n                                  >\n                                    <span className=\"text-xs\">{subItem.title}</span>\n                                  </Link>\n                                </SidebarMenuButton>\n                              ))}\n                            </div>\n                          )}\n                        </div>\n                      ) : (\n                        <SidebarMenuButton \n                          asChild \n                          className={isActive ? 'bg-sidebar-accent text-sidebar-accent-foreground' : ''}\n                        >\n                          <Link \n                            href={item.href} \n                            data-testid={`button-menu-${item.id}`}\n                            onClick={handleLinkClick}\n                          >\n                            <item.icon className=\"h-4 w-4\" />\n                            <span>{item.title}</span>\n                            {item.badge && (\n                              <Badge variant=\"secondary\" className=\"text-xs ml-auto\">\n                                {item.badge}\n                              </Badge>\n                            )}\n                          </Link>\n                        </SidebarMenuButton>\n                      )}\n                    </SidebarMenuItem>\n                  );\n                })}\n              </SidebarMenu>\n            </SidebarGroupContent>\n          </SidebarGroup>\n        ))}\n      </SidebarContent>\n\n      <SidebarFooter className=\"p-4\">\n        <div className=\"border-t pt-4\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <div className=\"flex flex-col\">\n              <span className=\"text-sm font-medium\">{user?.full_name || t('common.user')}</span>\n              <span className=\"text-xs text-muted-foreground\">{user?.email}</span>\n            </div>\n          </div>\n          <div className=\"space-y-2\">\n            <Button \n              variant=\"outline\" \n              size=\"sm\" \n              className=\"w-full justify-start\"\n              asChild\n            >\n              <Link href=\"/settings\" data-testid=\"button-settings\" onClick={handleLinkClick}>\n                <Settings className=\"h-4 w-4 mr-2\" />\n                {t('settings.title')}\n              </Link>\n            </Button>\n            <Button \n              variant=\"outline\" \n              size=\"sm\" \n              className=\"w-full justify-start\"\n              onClick={handleLogout}\n              data-testid=\"button-logout\"\n            >\n              <LogOut className=\"h-4 w-4 mr-2\" />\n              {t('auth.signOut')}\n            </Button>\n          </div>\n          <div className=\"mt-3 p-2 bg-muted rounded-lg\">\n            <div className=\"flex items-center justify-between text-xs\">\n              <span className=\"text-muted-foreground\">{t('common.status')}</span>\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                {t('common.online')}\n              </Badge>\n            </div>\n          </div>\n        </div>\n      </SidebarFooter>\n    </Sidebar>\n  );\n}","size_bytes":16356},"client/src/components/Dashboard.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTranslation } from \"react-i18next\";\nimport {\n  TrendingUp,\n  TrendingDown,\n  DollarSign,\n  CreditCard,\n  Wallet,\n  Building2,\n  Users,\n  Receipt,\n  ShoppingCart,\n  PiggyBank,\n  Calendar,\n  ArrowUpRight,\n  ArrowDownRight,\n  Download,\n  Upload,\n  RefreshCw,\n} from \"lucide-react\";\nimport {\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  ResponsiveContainer,\n  PieChart,\n  Pie,\n  Cell,\n  LineChart,\n  Line,\n} from \"recharts\";\n\n// Todo: remove mock functionality - replace with real data\nconst kpiData = [\n  {\n    title: \"Total Cash\",\n    value: \"$234,567.89\",\n    change: \"+12.5%\",\n    trend: \"up\",\n    icon: Wallet,\n    color: \"text-green-600\",\n  },\n  {\n    title: \"Accounts Receivable\",\n    value: \"$89,432.10\",\n    change: \"+5.2%\",\n    trend: \"up\",\n    icon: CreditCard,\n    color: \"text-blue-600\",\n  },\n  {\n    title: \"Accounts Payable\",\n    value: \"$45,678.23\",\n    change: \"-8.1%\",\n    trend: \"down\",\n    icon: Receipt,\n    color: \"text-orange-600\",\n  },\n  {\n    title: \"Monthly Revenue\",\n    value: \"$125,890.45\",\n    change: \"+18.7%\",\n    trend: \"up\",\n    icon: TrendingUp,\n    color: \"text-green-600\",\n  },\n];\n\nconst monthlyRevenueData = [\n  { month: \"Jan\", revenue: 45000, expenses: 32000 },\n  { month: \"Feb\", revenue: 52000, expenses: 38000 },\n  { month: \"Mar\", revenue: 48000, expenses: 35000 },\n  { month: \"Apr\", revenue: 61000, expenses: 42000 },\n  { month: \"May\", revenue: 58000, expenses: 39000 },\n  { month: \"Jun\", revenue: 67000, expenses: 45000 },\n];\n\nconst expenseBreakdown = [\n  { name: \"Office Rent\", value: 12000, color: \"#0088FE\" },\n  { name: \"Salaries\", value: 28000, color: \"#00C49F\" },\n  { name: \"Utilities\", value: 4500, color: \"#FFBB28\" },\n  { name: \"Marketing\", value: 8500, color: \"#FF8042\" },\n  { name: \"Other\", value: 3200, color: \"#8884D8\" },\n];\n\nconst recentTransactions = [\n  {\n    id: \"1\",\n    type: \"invoice\",\n    description: \"Invoice #INV-2024-001\",\n    amount: \"+$5,240.00\",\n    status: \"paid\",\n    date: \"2024-01-15\",\n  },\n  {\n    id: \"2\",\n    type: \"expense\",\n    description: \"Office Supplies\",\n    amount: \"-$342.50\",\n    status: \"approved\",\n    date: \"2024-01-14\",\n  },\n  {\n    id: \"3\",\n    type: \"bill\",\n    description: \"Internet Service\",\n    amount: \"-$125.00\",\n    status: \"pending\",\n    date: \"2024-01-13\",\n  },\n  {\n    id: \"4\",\n    type: \"invoice\",\n    description: \"Invoice #INV-2024-002\",\n    amount: \"+$8,750.00\",\n    status: \"overdue\",\n    date: \"2024-01-10\",\n  },\n];\n\nconst getStatusBadge = (status: string) => {\n  switch (status) {\n    case \"paid\":\n      return <Badge className=\"bg-green-100 text-green-800\">Paid</Badge>;\n    case \"pending\":\n      return <Badge variant=\"secondary\">Pending</Badge>;\n    case \"overdue\":\n      return <Badge variant=\"destructive\">Overdue</Badge>;\n    case \"approved\":\n      return <Badge className=\"bg-blue-100 text-blue-800\">Approved</Badge>;\n    default:\n      return <Badge variant=\"outline\">{status}</Badge>;\n  }\n};\n\nconst getTransactionIcon = (type: string) => {\n  switch (type) {\n    case \"invoice\":\n      return <Receipt className=\"h-4 w-4\" />;\n    case \"expense\":\n      return <PiggyBank className=\"h-4 w-4\" />;\n    case \"bill\":\n      return <ShoppingCart className=\"h-4 w-4\" />;\n    default:\n      return <DollarSign className=\"h-4 w-4\" />;\n  }\n};\n\nexport function Dashboard() {\n  const { t } = useTranslation();\n  \n  // Todo: remove mock functionality - replace with real data\n  const kpiData = [\n    {\n      title: t('dashboard.totalCash'),\n      value: \"$234,567.89\",\n      change: \"+12.5%\",\n      trend: \"up\",\n      icon: Wallet,\n      color: \"text-green-600\",\n    },\n    {\n      title: t('dashboard.accountsReceivable'),\n      value: \"$89,432.10\",\n      change: \"+5.2%\",\n      trend: \"up\",\n      icon: CreditCard,\n      color: \"text-blue-600\",\n    },\n    {\n      title: t('dashboard.accountsPayable'),\n      value: \"$45,678.23\",\n      change: \"-8.1%\",\n      trend: \"down\",\n      icon: Receipt,\n      color: \"text-orange-600\",\n    },\n    {\n      title: t('dashboard.monthlyRevenue'),\n      value: \"$125,890.45\",\n      change: \"+18.7%\",\n      trend: \"up\",\n      icon: TrendingUp,\n      color: \"text-green-600\",\n    },\n  ];\n  \n  const handleSyncNow = () => {\n    // Todo: remove mock functionality - implement real sync\n    console.log('Sync triggered');\n  };\n\n  const handleExport = () => {\n    // Todo: remove mock functionality - implement real export\n    console.log('Export triggered');\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">{t('dashboard.title')}</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            {t('dashboard.welcome')}\n          </p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button variant=\"outline\" onClick={handleSyncNow} data-testid=\"button-sync-now\">\n            <RefreshCw className=\"h-4 w-4 mr-2\" />\n            {t('dashboard.syncNow')}\n          </Button>\n          <Button onClick={handleExport} data-testid=\"button-export-dashboard\">\n            <Download className=\"h-4 w-4 mr-2\" />\n            {t('dashboard.export')}\n          </Button>\n        </div>\n      </div>\n\n      {/* KPI Cards */}\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        {kpiData.map((kpi, index) => {\n          const Icon = kpi.icon;\n          return (\n            <Card key={index} className=\"hover-elevate\" data-testid={`card-kpi-${kpi.title.toLowerCase().replace(/\\s+/g, '-')}`}>\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">{kpi.title}</CardTitle>\n                <Icon className={`h-4 w-4 ${kpi.color}`} />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{kpi.value}</div>\n                <div className=\"flex items-center text-xs text-muted-foreground mt-1\">\n                  {kpi.trend === \"up\" ? (\n                    <ArrowUpRight className=\"h-3 w-3 text-green-500 mr-1\" />\n                  ) : (\n                    <ArrowDownRight className=\"h-3 w-3 text-red-500 mr-1\" />\n                  )}\n                  <span className={kpi.trend === \"up\" ? \"text-green-600\" : \"text-red-600\"}>\n                    {kpi.change}\n                  </span>\n                  <span className=\"ml-1\">{t('dashboard.fromLastMonth')}</span>\n                </div>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n\n      {/* Charts Row */}\n      <div className=\"grid gap-6 lg:grid-cols-2\">\n        {/* Revenue vs Expenses Chart */}\n        <Card data-testid=\"card-revenue-chart\">\n          <CardHeader>\n            <CardTitle>{t('dashboard.revenueVsExpenses')}</CardTitle>\n            <p className=\"text-sm text-muted-foreground\">\n              {t('dashboard.monthlyComparison')}\n            </p>\n          </CardHeader>\n          <CardContent>\n            <ResponsiveContainer width=\"100%\" height={300}>\n              <BarChart data={monthlyRevenueData}>\n                <CartesianGrid strokeDasharray=\"3 3\" className=\"opacity-30\" />\n                <XAxis dataKey=\"month\" />\n                <YAxis />\n                <Tooltip />\n                <Bar dataKey=\"revenue\" fill=\"hsl(var(--chart-1))\" name=\"Revenue\" />\n                <Bar dataKey=\"expenses\" fill=\"hsl(var(--chart-2))\" name=\"Expenses\" />\n              </BarChart>\n            </ResponsiveContainer>\n          </CardContent>\n        </Card>\n\n        {/* Expense Breakdown */}\n        <Card data-testid=\"card-expense-breakdown\">\n          <CardHeader>\n            <CardTitle>{t('dashboard.expenseBreakdown')}</CardTitle>\n            <p className=\"text-sm text-muted-foreground\">\n              {t('dashboard.currentMonthExpenses')}\n            </p>\n          </CardHeader>\n          <CardContent>\n            <ResponsiveContainer width=\"100%\" height={300}>\n              <PieChart>\n                <Pie\n                  data={expenseBreakdown}\n                  cx=\"50%\"\n                  cy=\"50%\"\n                  labelLine={false}\n                  label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}\n                  outerRadius={80}\n                  fill=\"#8884d8\"\n                  dataKey=\"value\"\n                >\n                  {expenseBreakdown.map((entry, index) => (\n                    <Cell key={`cell-${index}`} fill={entry.color} />\n                  ))}\n                </Pie>\n                <Tooltip />\n              </PieChart>\n            </ResponsiveContainer>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Recent Transactions */}\n      <Card data-testid=\"card-recent-transactions\">\n        <CardHeader>\n          <CardTitle>{t('dashboard.recentTransactions')}</CardTitle>\n          <p className=\"text-sm text-muted-foreground\">\n            {t('dashboard.latestActivities')}\n          </p>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            {recentTransactions.map((transaction) => (\n              <div\n                key={transaction.id}\n                className=\"flex items-center justify-between p-3 rounded-lg border hover-elevate\"\n                data-testid={`transaction-${transaction.id}`}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"p-2 bg-muted rounded-lg\">\n                    {getTransactionIcon(transaction.type)}\n                  </div>\n                  <div>\n                    <p className=\"font-medium\">{transaction.description}</p>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {new Date(transaction.date).toLocaleDateString()}\n                    </p>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-3\">\n                  <span\n                    className={`font-medium ${\n                      transaction.amount.startsWith(\"+\")\n                        ? \"text-green-600\"\n                        : \"text-red-600\"\n                    }`}\n                  >\n                    {transaction.amount}\n                  </span>\n                  {getStatusBadge(transaction.status)}\n                </div>\n              </div>\n            ))}\n          </div>\n          <div className=\"mt-4 pt-4 border-t\">\n            <Button variant=\"outline\" className=\"w-full\" data-testid=\"button-view-all-transactions\">\n              {t('dashboard.viewAllTransactions')}\n              <ArrowUpRight className=\"h-4 w-4 ml-2\" />\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":10907},"client/src/components/InvoiceForm.tsx":{"content":"import { useState } from \"react\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Plus,\n  Trash2,\n  Save,\n  Send,\n  Calculator,\n  FileText,\n  Calendar,\n  User,\n} from \"lucide-react\";\n\ninterface LineItem {\n  id: string;\n  description: string;\n  quantity: number;\n  rate: number;\n  taxRate: number;\n  amount: number;\n}\n\n// Todo: remove mock functionality - replace with real data\nconst customers = [\n  { id: \"1\", name: \"Acme Corporation\", email: \"billing@acme.com\" },\n  { id: \"2\", name: \"Global Tech Ltd\", email: \"accounts@globaltech.com\" },\n  { id: \"3\", name: \"Startup Innovations\", email: \"finance@startup.io\" },\n];\n\nconst taxRates = [\n  { id: \"1\", name: \"VAT (15%)\", rate: 15, type: \"inclusive\" },\n  { id: \"2\", name: \"Sales Tax (8%)\", rate: 8, type: \"exclusive\" },\n  { id: \"3\", name: \"GST (10%)\", rate: 10, type: \"inclusive\" },\n  { id: \"4\", name: \"No Tax\", rate: 0, type: \"exclusive\" },\n];\n\nexport function InvoiceForm() {\n  const isMobile = useIsMobile();\n  const [invoiceNumber, setInvoiceNumber] = useState(\"INV-2024-001\");\n  const [customer, setCustomer] = useState(\"\");\n  const [invoiceDate, setInvoiceDate] = useState(new Date().toISOString().split('T')[0]);\n  const [dueDate, setDueDate] = useState(\"\");\n  const [notes, setNotes] = useState(\"\");\n  const [lineItems, setLineItems] = useState<LineItem[]>([\n    {\n      id: \"1\",\n      description: \"Consulting Services\",\n      quantity: 10,\n      rate: 150,\n      taxRate: 15,\n      amount: 1500,\n    },\n  ]);\n\n  const addLineItem = () => {\n    const newItem: LineItem = {\n      id: Date.now().toString(),\n      description: \"\",\n      quantity: 1,\n      rate: 0,\n      taxRate: 0,\n      amount: 0,\n    };\n    setLineItems([...lineItems, newItem]);\n  };\n\n  const removeLineItem = (id: string) => {\n    setLineItems(lineItems.filter(item => item.id !== id));\n  };\n\n  const updateLineItem = (id: string, field: keyof LineItem, value: any) => {\n    setLineItems(lineItems.map(item => {\n      if (item.id === id) {\n        const updated = { ...item, [field]: value };\n        if (field === 'quantity' || field === 'rate') {\n          updated.amount = updated.quantity * updated.rate;\n        }\n        return updated;\n      }\n      return item;\n    }));\n  };\n\n  const calculateSubtotal = () => {\n    return lineItems.reduce((sum, item) => sum + item.amount, 0);\n  };\n\n  const calculateTotalTax = () => {\n    return lineItems.reduce((sum, item) => {\n      const taxAmount = (item.amount * item.taxRate) / 100;\n      return sum + taxAmount;\n    }, 0);\n  };\n\n  const calculateTotal = () => {\n    return calculateSubtotal() + calculateTotalTax();\n  };\n\n  const handleSave = () => {\n    // Todo: remove mock functionality - implement real save\n    console.log('Invoice saved as draft');\n  };\n\n  const handleSend = () => {\n    // Todo: remove mock functionality - implement real send\n    console.log('Invoice sent to customer');\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className={`${isMobile ? 'space-y-4' : 'flex items-center justify-between'}`}>\n        <div>\n          <h1 className={`${isMobile ? 'text-2xl' : 'text-3xl'} font-bold text-foreground`}>Create Invoice</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            {isMobile ? 'Generate a new invoice' : 'Generate a new invoice for your customer'}\n          </p>\n        </div>\n        <div className={`flex items-center gap-2 ${isMobile ? 'flex-col sm:flex-row' : ''}`}>\n          <Button variant=\"outline\" onClick={handleSave} data-testid=\"button-save-invoice\" className={isMobile ? 'w-full sm:w-auto' : ''}>\n            <Save className=\"h-4 w-4 mr-2\" />\n            Save Draft\n          </Button>\n          <Button onClick={handleSend} data-testid=\"button-send-invoice\" className={isMobile ? 'w-full sm:w-auto' : ''}>\n            <Send className=\"h-4 w-4 mr-2\" />\n            Send Invoice\n          </Button>\n        </div>\n      </div>\n\n      {/* Invoice Details */}\n      <div className=\"grid gap-6 lg:grid-cols-2\">\n        <Card data-testid=\"card-invoice-details\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <FileText className=\"h-5 w-5\" />\n              Invoice Details\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"invoice-number\">Invoice Number</Label>\n              <Input\n                id=\"invoice-number\"\n                value={invoiceNumber}\n                onChange={(e) => setInvoiceNumber(e.target.value)}\n                data-testid=\"input-invoice-number\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"invoice-date\">Invoice Date</Label>\n              <Input\n                id=\"invoice-date\"\n                type=\"date\"\n                value={invoiceDate}\n                onChange={(e) => setInvoiceDate(e.target.value)}\n                data-testid=\"input-invoice-date\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"due-date\">Due Date</Label>\n              <Input\n                id=\"due-date\"\n                type=\"date\"\n                value={dueDate}\n                onChange={(e) => setDueDate(e.target.value)}\n                data-testid=\"input-due-date\"\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-customer-details\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <User className=\"h-5 w-5\" />\n              Customer Details\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"customer\">Customer</Label>\n              <Select value={customer} onValueChange={setCustomer}>\n                <SelectTrigger data-testid=\"select-customer\">\n                  <SelectValue placeholder=\"Select a customer\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {customers.map((cust) => (\n                    <SelectItem key={cust.id} value={cust.id}>\n                      {cust.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            {customer && (\n              <div className=\"p-3 bg-muted rounded-lg\">\n                <p className=\"font-medium\">\n                  {customers.find(c => c.id === customer)?.name}\n                </p>\n                <p className=\"text-sm text-muted-foreground\">\n                  {customers.find(c => c.id === customer)?.email}\n                </p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Line Items */}\n      <Card data-testid=\"card-line-items\">\n        <CardHeader>\n          <div className={`${isMobile ? 'space-y-3' : 'flex items-center justify-between'}`}>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Calculator className=\"h-5 w-5\" />\n              Line Items\n            </CardTitle>\n            <Button onClick={addLineItem} size=\"sm\" data-testid=\"button-add-line-item\" className={isMobile ? 'w-full sm:w-auto' : ''}>\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Item\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className={isMobile ? \"mobile-table-container\" : \"\"}>\n            <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Description</TableHead>\n                  <TableHead className=\"w-20\">Qty</TableHead>\n                  <TableHead className=\"w-24\">Rate</TableHead>\n                  <TableHead className=\"w-32\">Tax</TableHead>\n                  <TableHead className=\"w-24\">Amount</TableHead>\n                  <TableHead className=\"w-12\"></TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {lineItems.map((item) => (\n                  <TableRow key={item.id}>\n                    <TableCell data-label=\"Description\">\n                      <Input\n                        value={item.description}\n                        onChange={(e) => updateLineItem(item.id, 'description', e.target.value)}\n                        placeholder=\"Item description\"\n                        data-testid={`input-description-${item.id}`}\n                      />\n                    </TableCell>\n                    <TableCell data-label=\"Qty\">\n                      <Input\n                        type=\"number\"\n                        value={item.quantity}\n                        onChange={(e) => updateLineItem(item.id, 'quantity', parseFloat(e.target.value) || 0)}\n                        data-testid={`input-quantity-${item.id}`}\n                      />\n                    </TableCell>\n                    <TableCell data-label=\"Rate\">\n                      <Input\n                        type=\"number\"\n                        value={item.rate}\n                        onChange={(e) => updateLineItem(item.id, 'rate', parseFloat(e.target.value) || 0)}\n                        data-testid={`input-rate-${item.id}`}\n                      />\n                    </TableCell>\n                    <TableCell data-label=\"Tax\">\n                      <Select \n                        value={item.taxRate.toString()} \n                        onValueChange={(value) => updateLineItem(item.id, 'taxRate', parseFloat(value))}\n                      >\n                        <SelectTrigger data-testid={`select-tax-${item.id}`}>\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {taxRates.map((tax) => (\n                            <SelectItem key={tax.id} value={tax.rate.toString()}>\n                              {tax.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </TableCell>\n                    <TableCell data-label=\"Amount\">\n                      <span className=\"font-mono\">${item.amount.toFixed(2)}</span>\n                    </TableCell>\n                    <TableCell data-label=\"Actions\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => removeLineItem(item.id)}\n                        data-testid={`button-remove-${item.id}`}\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </div>\n\n          {/* Totals */}\n          <div className=\"mt-6 flex justify-end\">\n            <div className=\"w-64 space-y-2\">\n              <div className=\"flex justify-between\">\n                <span>Subtotal:</span>\n                <span className=\"font-mono\">${calculateSubtotal().toFixed(2)}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span>Tax:</span>\n                <span className=\"font-mono\">${calculateTotalTax().toFixed(2)}</span>\n              </div>\n              <div className=\"flex justify-between font-bold text-lg border-t pt-2\">\n                <span>Total:</span>\n                <span className=\"font-mono\">${calculateTotal().toFixed(2)}</span>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Notes */}\n      <Card data-testid=\"card-notes\">\n        <CardHeader>\n          <CardTitle>Notes & Terms</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Textarea\n            placeholder=\"Add any additional notes or terms...\"\n            value={notes}\n            onChange={(e) => setNotes(e.target.value)}\n            rows={4}\n            data-testid=\"textarea-notes\"\n          />\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":12727},"client/src/components/LanguageToggle.tsx":{"content":"import { Globe } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useTranslationContext } from \"@/contexts/TranslationContext\";\n\nexport function LanguageToggle() {\n  const { currentLanguage, changeLanguage, availableLanguages, isRTL } = useTranslationContext();\n\n  const handleLanguageChange = (languageCode: string) => {\n    changeLanguage(languageCode);\n  };\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button variant=\"outline\" size=\"sm\" data-testid=\"button-language-toggle\">\n          <Globe className=\"h-4 w-4 mr-2\" />\n          <span className=\"text-sm\">{currentLanguage.flag}</span>\n          <span className=\"ml-1 text-sm\">{currentLanguage.code.toUpperCase()}</span>\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\" className=\"w-56\">\n        {availableLanguages.map((language) => (\n          <DropdownMenuItem\n            key={language.code}\n            onClick={() => handleLanguageChange(language.code)}\n            className=\"flex items-center justify-between\"\n            data-testid={`option-language-${language.code}`}\n          >\n            <div className=\"flex items-center gap-2\">\n              <span>{language.flag}</span>\n              <span>{language.name}</span>\n              {currentLanguage.code === language.code && (\n                <Badge variant=\"default\" className=\"text-xs\">Current</Badge>\n              )}\n            </div>\n            {language.direction === \"rtl\" && (\n              <Badge variant=\"secondary\" className=\"text-xs\">RTL</Badge>\n            )}\n          </DropdownMenuItem>\n        ))}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n","size_bytes":1866},"client/src/components/TaxConfiguration.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Switch } from \"@/components/ui/switch\";\nimport {\n  Plus,\n  Edit,\n  Trash2,\n  Calculator,\n  Percent,\n  Calendar,\n  Building,\n} from \"lucide-react\";\n\ninterface TaxRate {\n  id: string;\n  name: string;\n  code: string;\n  rate: number;\n  type: 'VAT' | 'Sales Tax' | 'Corporate Tax' | 'Withholding' | 'Custom';\n  inclusive: boolean;\n  active: boolean;\n  effectiveFrom: string;\n  effectiveTo?: string;\n  jurisdiction?: string;\n  glAccount: string;\n}\n\n// Todo: remove mock functionality - replace with real data\nconst mockTaxRates: TaxRate[] = [\n  {\n    id: \"1\",\n    name: \"VAT Standard Rate\",\n    code: \"VAT-STD\",\n    rate: 15,\n    type: \"VAT\",\n    inclusive: true,\n    active: true,\n    effectiveFrom: \"2024-01-01\",\n    jurisdiction: \"UAE\",\n    glAccount: \"2300 - VAT Payable\",\n  },\n  {\n    id: \"2\",\n    name: \"Sales Tax\",\n    code: \"SALES-TAX\",\n    rate: 8.5,\n    type: \"Sales Tax\",\n    inclusive: false,\n    active: true,\n    effectiveFrom: \"2024-01-01\",\n    jurisdiction: \"California\",\n    glAccount: \"2310 - Sales Tax Payable\",\n  },\n  {\n    id: \"3\",\n    name: \"Corporate Tax\",\n    code: \"CORP-TAX\",\n    rate: 9,\n    type: \"Corporate Tax\",\n    inclusive: false,\n    active: true,\n    effectiveFrom: \"2024-01-01\",\n    jurisdiction: \"UAE\",\n    glAccount: \"2320 - Corporate Tax Payable\",\n  },\n  {\n    id: \"4\",\n    name: \"Withholding Tax\",\n    code: \"WHT\",\n    rate: 5,\n    type: \"Withholding\",\n    inclusive: false,\n    active: false,\n    effectiveFrom: \"2024-01-01\",\n    jurisdiction: \"UAE\",\n    glAccount: \"2330 - Withholding Tax\",\n  },\n];\n\nconst taxTypes = ['VAT', 'Sales Tax', 'Corporate Tax', 'Withholding', 'Custom'];\n\nexport function TaxConfiguration() {\n  const [taxRates, setTaxRates] = useState<TaxRate[]>(mockTaxRates);\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingTax, setEditingTax] = useState<TaxRate | null>(null);\n  const [formData, setFormData] = useState<Partial<TaxRate>>({\n    name: \"\",\n    code: \"\",\n    rate: 0,\n    type: \"VAT\",\n    inclusive: false,\n    active: true,\n    effectiveFrom: new Date().toISOString().split('T')[0],\n    jurisdiction: \"\",\n    glAccount: \"\",\n  });\n\n  const handleAddNew = () => {\n    setEditingTax(null);\n    setFormData({\n      name: \"\",\n      code: \"\",\n      rate: 0,\n      type: \"VAT\",\n      inclusive: false,\n      active: true,\n      effectiveFrom: new Date().toISOString().split('T')[0],\n      jurisdiction: \"\",\n      glAccount: \"\",\n    });\n    setIsDialogOpen(true);\n  };\n\n  const handleEdit = (tax: TaxRate) => {\n    setEditingTax(tax);\n    setFormData(tax);\n    setIsDialogOpen(true);\n  };\n\n  const handleSave = () => {\n    if (editingTax) {\n      setTaxRates(prev => prev.map(tax => \n        tax.id === editingTax.id ? { ...formData, id: editingTax.id } as TaxRate : tax\n      ));\n    } else {\n      const newTax: TaxRate = {\n        ...formData,\n        id: Date.now().toString(),\n      } as TaxRate;\n      setTaxRates(prev => [...prev, newTax]);\n    }\n    setIsDialogOpen(false);\n    // Todo: remove mock functionality - implement real save\n    console.log('Tax configuration saved');\n  };\n\n  const handleDelete = (id: string) => {\n    setTaxRates(prev => prev.filter(tax => tax.id !== id));\n    // Todo: remove mock functionality - implement real delete\n    console.log('Tax rate deleted:', id);\n  };\n\n  const toggleActive = (id: string) => {\n    setTaxRates(prev => prev.map(tax => \n      tax.id === id ? { ...tax, active: !tax.active } : tax\n    ));\n  };\n\n  const getTypeColor = (type: string) => {\n    switch (type) {\n      case 'VAT': return 'bg-blue-100 text-blue-800';\n      case 'Sales Tax': return 'bg-green-100 text-green-800';\n      case 'Corporate Tax': return 'bg-purple-100 text-purple-800';\n      case 'Withholding': return 'bg-orange-100 text-orange-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Tax Configuration</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Configure global tax rates and rules for your accounting system\n          </p>\n        </div>\n        <Button onClick={handleAddNew} data-testid=\"button-add-tax-rate\">\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Add Tax Rate\n        </Button>\n      </div>\n\n      {/* Tax Rates Table */}\n      <Card data-testid=\"card-tax-rates\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Calculator className=\"h-5 w-5\" />\n            Tax Rates\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"overflow-x-auto\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Name</TableHead>\n                  <TableHead>Code</TableHead>\n                  <TableHead>Type</TableHead>\n                  <TableHead>Rate</TableHead>\n                  <TableHead>Calculation</TableHead>\n                  <TableHead>Jurisdiction</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead>Effective From</TableHead>\n                  <TableHead className=\"w-24\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {taxRates.map((tax) => (\n                  <TableRow key={tax.id} data-testid={`tax-row-${tax.id}`}>\n                    <TableCell className=\"font-medium\">{tax.name}</TableCell>\n                    <TableCell>\n                      <code className=\"bg-muted px-2 py-1 rounded text-xs\">\n                        {tax.code}\n                      </code>\n                    </TableCell>\n                    <TableCell>\n                      <Badge className={getTypeColor(tax.type)}>\n                        {tax.type}\n                      </Badge>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-1\">\n                        <Percent className=\"h-3 w-3\" />\n                        <span className=\"font-mono\">{tax.rate}%</span>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <Badge variant={tax.inclusive ? \"default\" : \"secondary\"}>\n                        {tax.inclusive ? \"Inclusive\" : \"Exclusive\"}\n                      </Badge>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-1\">\n                        <Building className=\"h-3 w-3\" />\n                        <span className=\"text-sm\">{tax.jurisdiction || \"Global\"}</span>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2\">\n                        <Switch\n                          checked={tax.active}\n                          onCheckedChange={() => toggleActive(tax.id)}\n                          data-testid={`switch-active-${tax.id}`}\n                        />\n                        <span className=\"text-sm\">\n                          {tax.active ? \"Active\" : \"Inactive\"}\n                        </span>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-1\">\n                        <Calendar className=\"h-3 w-3\" />\n                        <span className=\"text-sm\">\n                          {new Date(tax.effectiveFrom).toLocaleDateString()}\n                        </span>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-1\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => handleEdit(tax)}\n                          data-testid={`button-edit-${tax.id}`}\n                        >\n                          <Edit className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => handleDelete(tax.id)}\n                          data-testid={`button-delete-${tax.id}`}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Add/Edit Dialog */}\n      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n        <DialogContent className=\"max-w-md\" data-testid=\"dialog-tax-form\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingTax ? \"Edit Tax Rate\" : \"Add New Tax Rate\"}\n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"tax-name\">Tax Name</Label>\n              <Input\n                id=\"tax-name\"\n                value={formData.name || \"\"}\n                onChange={(e) => setFormData({...formData, name: e.target.value})}\n                placeholder=\"e.g., VAT Standard Rate\"\n                data-testid=\"input-tax-name\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"tax-code\">Tax Code</Label>\n              <Input\n                id=\"tax-code\"\n                value={formData.code || \"\"}\n                onChange={(e) => setFormData({...formData, code: e.target.value})}\n                placeholder=\"e.g., VAT-STD\"\n                data-testid=\"input-tax-code\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"tax-type\">Type</Label>\n                <Select \n                  value={formData.type} \n                  onValueChange={(value) => setFormData({...formData, type: value as TaxRate['type']})}\n                >\n                  <SelectTrigger data-testid=\"select-tax-type\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {taxTypes.map((type) => (\n                      <SelectItem key={type} value={type}>\n                        {type}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"tax-rate\">Rate (%)</Label>\n                <Input\n                  id=\"tax-rate\"\n                  type=\"number\"\n                  step=\"0.01\"\n                  value={formData.rate || 0}\n                  onChange={(e) => setFormData({...formData, rate: parseFloat(e.target.value) || 0})}\n                  data-testid=\"input-tax-rate\"\n                />\n              </div>\n            </div>\n            <div className=\"flex items-center gap-3\">\n              <Switch\n                checked={formData.inclusive || false}\n                onCheckedChange={(checked) => setFormData({...formData, inclusive: checked})}\n                data-testid=\"switch-inclusive\"\n              />\n              <div>\n                <Label>Tax Inclusive</Label>\n                <p className=\"text-xs text-muted-foreground\">\n                  Tax is included in the price\n                </p>\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"jurisdiction\">Jurisdiction (Optional)</Label>\n              <Input\n                id=\"jurisdiction\"\n                value={formData.jurisdiction || \"\"}\n                onChange={(e) => setFormData({...formData, jurisdiction: e.target.value})}\n                placeholder=\"e.g., UAE, California\"\n                data-testid=\"input-jurisdiction\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"effective-from\">Effective From</Label>\n              <Input\n                id=\"effective-from\"\n                type=\"date\"\n                value={formData.effectiveFrom || \"\"}\n                onChange={(e) => setFormData({...formData, effectiveFrom: e.target.value})}\n                data-testid=\"input-effective-from\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"gl-account\">GL Account</Label>\n              <Input\n                id=\"gl-account\"\n                value={formData.glAccount || \"\"}\n                onChange={(e) => setFormData({...formData, glAccount: e.target.value})}\n                placeholder=\"e.g., 2300 - VAT Payable\"\n                data-testid=\"input-gl-account\"\n              />\n            </div>\n            <div className=\"flex justify-end gap-2 pt-4\">\n              <Button \n                variant=\"outline\" \n                onClick={() => setIsDialogOpen(false)}\n                data-testid=\"button-cancel\"\n              >\n                Cancel\n              </Button>\n              <Button onClick={handleSave} data-testid=\"button-save-tax\">\n                {editingTax ? \"Update\" : \"Create\"} Tax Rate\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":14157},"client/src/components/ThemeProvider.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\";\n\ntype Theme = \"light\" | \"dark\" | \"system\";\n\ntype ThemeProviderProps = {\n  children: React.ReactNode;\n  defaultTheme?: Theme;\n  storageKey?: string;\n};\n\ntype ThemeProviderState = {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n};\n\nconst initialState: ThemeProviderState = {\n  theme: \"system\",\n  setTheme: () => null,\n};\n\nconst ThemeProviderContext = createContext<ThemeProviderState>(initialState);\n\nexport function ThemeProvider({\n  children,\n  defaultTheme = \"system\",\n  storageKey = \"log-ledger-theme\",\n  ...props\n}: ThemeProviderProps) {\n  const [theme, setTheme] = useState<Theme>(\n    () => (localStorage.getItem(storageKey) as Theme) || defaultTheme\n  );\n\n  useEffect(() => {\n    const root = window.document.documentElement;\n\n    root.classList.remove(\"light\", \"dark\");\n\n    if (theme === \"system\") {\n      const systemTheme = window.matchMedia(\"(prefers-color-scheme: dark)\")\n        .matches\n        ? \"dark\"\n        : \"light\";\n\n      root.classList.add(systemTheme);\n      return;\n    }\n\n    root.classList.add(theme);\n  }, [theme]);\n\n  const value = {\n    theme,\n    setTheme: (theme: Theme) => {\n      localStorage.setItem(storageKey, theme);\n      setTheme(theme);\n    },\n  };\n\n  return (\n    <ThemeProviderContext.Provider {...props} value={value}>\n      {children}\n    </ThemeProviderContext.Provider>\n  );\n}\n\nexport const useTheme = () => {\n  const context = useContext(ThemeProviderContext);\n\n  if (context === undefined)\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n\n  return context;\n};\n","size_bytes":1608},"client/src/components/ThemeToggle.tsx":{"content":"import { Moon, Sun, Monitor } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { useTheme } from \"./ThemeProvider\";\n\nexport function ThemeToggle() {\n  const { theme, setTheme } = useTheme();\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button variant=\"outline\" size=\"icon\" data-testid=\"button-theme-toggle\">\n          <Sun className=\"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0\" />\n          <Moon className=\"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100\" />\n          <span className=\"sr-only\">Toggle theme</span>\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\">\n        <DropdownMenuItem onClick={() => setTheme(\"light\")} data-testid=\"option-theme-light\">\n          <Sun className=\"h-4 w-4 mr-2\" />\n          Light\n        </DropdownMenuItem>\n        <DropdownMenuItem onClick={() => setTheme(\"dark\")} data-testid=\"option-theme-dark\">\n          <Moon className=\"h-4 w-4 mr-2\" />\n          Dark\n        </DropdownMenuItem>\n        <DropdownMenuItem onClick={() => setTheme(\"system\")} data-testid=\"option-theme-system\">\n          <Monitor className=\"h-4 w-4 mr-2\" />\n          System\n        </DropdownMenuItem>\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n","size_bytes":1484},"client/src/contexts/AuthContext.tsx":{"content":"import { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { useMutation } from '@tanstack/react-query';\nimport { queryClient } from '@/lib/queryClient';\nimport { \n  auth,\n  onAuthStateChange, \n  signInWithEmail, \n  createUserWithEmail, \n  signOutUser,\n  createDocument,\n  getDocument,\n  checkFirestoreHealth,\n  FirebaseUser\n} from '@/lib/firebase';\n\ninterface Company {\n  id: string;\n  name: string;\n  base_currency: string;\n  fiscal_year_start: number;\n}\n\ninterface User {\n  id: string;\n  company_id: string;\n  username: string;\n  email: string;\n  full_name: string;\n  role: string;\n  language: string;\n  timezone: string;\n  theme: string;\n  is_active: boolean;\n  last_login_at: string | null;\n  created_at: string;\n  updated_at: string;\n  activeCompany?: Company;\n}\n\ninterface AuthContextType {\n  user: User | null;\n  isLoading: boolean;\n  isAuthenticated: boolean;\n  isFirestoreHealthy: boolean;\n  authOnlyMode: boolean;\n  login: (email: string, password: string) => Promise<void>;\n  logout: () => Promise<void>;\n  register: (userData: RegisterData) => Promise<void>;\n  switchCompany: (companyId: string) => Promise<void>;\n  retryFirestoreSetup: () => Promise<void>;\n}\n\ninterface RegisterData {\n  username: string;\n  email: string;\n  password: string;\n  company_name: string;\n  company_base_currency?: string;\n  company_fiscal_year_start?: number;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n}\n\ninterface AuthProviderProps {\n  children: ReactNode;\n}\n\nexport function AuthProvider({ children }: AuthProviderProps) {\n  const [user, setUser] = useState<User | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [firebaseUser, setFirebaseUser] = useState<FirebaseUser | null>(null);\n  const [isFirestoreHealthy, setIsFirestoreHealthy] = useState<boolean>(false);\n  const [authOnlyMode, setAuthOnlyMode] = useState<boolean>(false);\n\n  // Check Firestore health on startup\n  useEffect(() => {\n    const checkHealth = async () => {\n      const healthy = await checkFirestoreHealth();\n      setIsFirestoreHealthy(healthy);\n      setAuthOnlyMode(!healthy);\n    };\n    checkHealth();\n  }, []);\n\n  // Listen to Firebase auth state changes\n  useEffect(() => {\n    const unsubscribe = onAuthStateChange(async (fbUser) => {\n      console.log('Firebase auth state changed:', fbUser?.uid ? 'logged in' : 'logged out');\n      setFirebaseUser(fbUser);\n      if (fbUser) {\n        if (isFirestoreHealthy) {\n          try {\n            // Get user profile from Firestore\n            const userProfile = await getDocument('users', fbUser.uid);\n            console.log('User profile from Firestore:', userProfile ? 'found' : 'not found');\n            if (userProfile) {\n              setUser(userProfile as User);\n            } else {\n              console.warn('User profile not found in Firestore for UID:', fbUser.uid);\n              // In auth-only mode, create a basic user object\n              setUser({\n                id: fbUser.uid,\n                email: fbUser.email || '',\n                full_name: fbUser.email?.split('@')[0] || 'User',\n                username: fbUser.email?.split('@')[0] || 'user',\n                company_id: 'auth-only',\n                role: 'owner',\n                language: 'en',\n                timezone: 'UTC',\n                theme: 'auto',\n                is_active: true,\n                created_at: new Date().toISOString(),\n                updated_at: new Date().toISOString(),\n                last_login_at: new Date().toISOString(),\n              });\n            }\n          } catch (error) {\n            console.error('Error fetching user profile from Firestore:', error);\n            // Fallback to auth-only mode\n            setAuthOnlyMode(true);\n            setUser({\n              id: fbUser.uid,\n              email: fbUser.email || '',\n              full_name: fbUser.email?.split('@')[0] || 'User',\n              username: fbUser.email?.split('@')[0] || 'user',\n              company_id: 'auth-only',\n              role: 'owner',\n              language: 'en',\n              timezone: 'UTC',\n              theme: 'auto',\n              is_active: true,\n              created_at: new Date().toISOString(),\n              updated_at: new Date().toISOString(),\n              last_login_at: new Date().toISOString(),\n            });\n          }\n        } else {\n          // Auth-only mode - Try to establish backend session via SSO\n          console.log('Auth-only mode: Attempting to establish backend session via SSO...');\n          try {\n            const idToken = await fbUser.getIdToken();\n            const response = await fetch('/api/auth/sso-login', {\n              method: 'POST',\n              headers: {\n                'Authorization': `Bearer ${idToken}`,\n                'Content-Type': 'application/json',\n              },\n              credentials: 'include'\n            });\n\n            if (response.ok) {\n              const ssoUser = await response.json();\n              console.log('SSO session established successfully:', ssoUser.id);\n              setUser(ssoUser);\n              setAuthOnlyMode(false);\n              // Invalidate queries to refresh data with new session\n              queryClient.invalidateQueries();\n            } else {\n              console.warn('SSO session establishment failed, falling back to auth-only mode');\n              // Fallback to basic user profile\n              setUser({\n                id: fbUser.uid,\n                email: fbUser.email || '',\n                full_name: fbUser.email?.split('@')[0] || 'User',\n                username: fbUser.email?.split('@')[0] || 'user',\n                company_id: 'auth-only',\n                role: 'owner',\n                language: 'en',\n                timezone: 'UTC',\n                theme: 'auto',\n                is_active: true,\n                created_at: new Date().toISOString(),\n                updated_at: new Date().toISOString(),\n                last_login_at: new Date().toISOString(),\n              });\n            }\n          } catch (error) {\n            console.error('SSO session establishment failed:', error);\n            // Fallback to basic user profile\n            setUser({\n              id: fbUser.uid,\n              email: fbUser.email || '',\n              full_name: fbUser.email?.split('@')[0] || 'User',\n              username: fbUser.email?.split('@')[0] || 'user',\n              company_id: 'auth-only',\n              role: 'owner',\n              language: 'en',\n              timezone: 'UTC',\n              theme: 'auto',\n              is_active: true,\n              created_at: new Date().toISOString(),\n              updated_at: new Date().toISOString(),\n              last_login_at: new Date().toISOString(),\n            });\n          }\n        }\n      } else {\n        setUser(null);\n      }\n      setIsLoading(false);\n    });\n\n    return () => unsubscribe();\n  }, [isFirestoreHealthy]);\n\n  // Authentication state (remove unused variable)\n  // isAuthenticated will be defined in context value\n\n  // Login mutation with Firebase + Backend session\n  const loginMutation = useMutation({\n    mutationFn: async ({ email, password }: { email: string; password: string }) => {\n      console.log('Starting login process for:', email);\n      \n      // Step 1: Firebase authentication\n      const userCredential = await signInWithEmail(email, password);\n      console.log('Firebase login successful:', userCredential.user.uid);\n      \n      // Step 2: Establish backend session\n      console.log('Establishing backend session...');\n      try {\n        const response = await fetch('/api/auth/login', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({ email, password }),\n          credentials: 'include'\n        });\n\n        if (!response.ok) {\n          console.warn('Backend session establishment failed, continuing with Firebase only');\n        } else {\n          console.log('Backend session established successfully');\n        }\n      } catch (error) {\n        console.warn('Backend session establishment failed:', error);\n        // Continue anyway - this allows Firebase-only mode\n      }\n\n      return userCredential.user;\n    },\n    retry: false, // Don't retry login attempts\n    onSuccess: () => {\n      console.log('Login mutation completed successfully');\n      // Firebase auth state change will handle user state update\n      queryClient.invalidateQueries();\n    },\n    onError: (error) => {\n      console.error('Login mutation failed:', error);\n      setIsLoading(false); // Ensure loading state is reset on error\n    },\n  });\n\n  // Logout mutation with Firebase + Backend session cleanup\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      // Step 1: Clear backend session\n      try {\n        await fetch('/api/auth/logout', {\n          method: 'POST',\n          credentials: 'include'\n        });\n        console.log('Backend session cleared successfully');\n      } catch (error) {\n        console.warn('Backend session cleanup failed:', error);\n        // Continue anyway\n      }\n      \n      // Step 2: Firebase logout\n      await signOutUser();\n    },\n    onSuccess: () => {\n      // Firebase auth state change will handle user state update\n      queryClient.clear();\n    },\n  });\n\n  // Register mutation with Firebase\n  const registerMutation = useMutation({\n    mutationFn: async (userData: RegisterData) => {\n      console.log('Starting registration process for:', userData.email);\n      \n      try {\n        // Create Firebase user\n        console.log('Creating Firebase user...');\n        const userCredential = await createUserWithEmail(userData.email, userData.password);\n        console.log('Firebase user created successfully:', userCredential.user.uid);\n        \n        if (isFirestoreHealthy) {\n          // Create company in Firestore with better error handling\n          console.log('Creating company in Firestore...');\n          let company;\n          try {\n            company = await createDocument('companies', {\n              name: userData.company_name,\n              base_currency: userData.company_base_currency || 'USD',\n              fiscal_year_start: userData.company_fiscal_year_start || 1,\n              user_id: userCredential.user.uid,\n              created_at: new Date().toISOString(),\n            });\n            console.log('Company created successfully:', company.id);\n          } catch (firestoreError: any) {\n            console.error('Firestore company creation failed:', {\n              error: firestoreError,\n              message: firestoreError?.message,\n              code: firestoreError?.code,\n              details: firestoreError?.details\n            });\n            throw new Error(`Failed to create company: ${firestoreError?.message || 'Unknown Firestore error'}`);\n          }\n          \n          // Create user profile in Firestore with better error handling\n          console.log('Creating user profile in Firestore...');\n          let userProfile;\n          try {\n            userProfile = await createDocument('users', {\n              company_id: company.id,\n              username: userData.username,\n              email: userData.email,\n              full_name: userData.username, // Using username as full_name for now\n              role: 'owner',\n              language: 'en',\n              timezone: 'UTC',\n              theme: 'auto',\n              is_active: true,\n              created_at: new Date().toISOString(),\n              updated_at: new Date().toISOString(),\n              last_login_at: new Date().toISOString(),\n              activeCompany: company,\n            }, userCredential.user.uid);\n            console.log('User profile created successfully');\n          } catch (firestoreError: any) {\n            console.error('Firestore user profile creation failed:', {\n              error: firestoreError,\n              message: firestoreError?.message,\n              code: firestoreError?.code,\n              details: firestoreError?.details\n            });\n            throw new Error(`Failed to create user profile: ${firestoreError?.message || 'Unknown Firestore error'}`);\n          }\n          \n          return userProfile;\n        } else {\n          // Auth-only mode - skip Firestore operations\n          console.log('Auth-only mode: Skipping Firestore profile creation');\n          return {\n            id: userCredential.user.uid,\n            email: userData.email,\n            full_name: userData.username,\n            username: userData.username,\n            company_id: 'auth-only',\n            role: 'owner',\n            language: 'en',\n            timezone: 'UTC',\n            theme: 'auto',\n            is_active: true,\n            created_at: new Date().toISOString(),\n            updated_at: new Date().toISOString(),\n            last_login_at: new Date().toISOString(),\n          };\n        }\n      } catch (error: any) {\n        console.error('Registration failed:', {\n          error,\n          message: error?.message,\n          code: error?.code\n        });\n        // Don't retry on registration failures\n        throw error;\n      }\n    },\n    retry: false, // Don't retry registration attempts\n    onSuccess: () => {\n      console.log('Registration completed successfully');\n      // Firebase auth state change will handle user state update\n      queryClient.invalidateQueries();\n    },\n    onError: (error) => {\n      console.error('Registration mutation failed:', error);\n      setIsLoading(false); // Ensure loading state is reset on error\n    },\n  });\n\n  // Switch company mutation - now implemented with real API call\n  const switchCompanyMutation = useMutation({\n    mutationFn: async (companyId: string) => {\n      const response = await fetch('/api/auth/switch-company', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ companyId }),\n        credentials: 'include'\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to switch company');\n      }\n\n      return response.json();\n    },\n    onSuccess: (data) => {\n      console.log('Company switched successfully:', data);\n      // Update user state with new active company\n      if (data.user) {\n        setUser(data.user);\n      }\n      // Invalidate all queries to refresh data for new company\n      queryClient.invalidateQueries();\n    },\n    onError: (error) => {\n      console.error('Failed to switch company:', error);\n    }\n  });\n\n  const login = async (email: string, password: string) => {\n    await loginMutation.mutateAsync({ email, password });\n  };\n\n  const logout = async () => {\n    await logoutMutation.mutateAsync();\n  };\n\n  const register = async (userData: RegisterData) => {\n    await registerMutation.mutateAsync(userData);\n  };\n\n  const switchCompany = async (companyId: string) => {\n    await switchCompanyMutation.mutateAsync(companyId);\n  };\n\n  const retryFirestoreSetup = async () => {\n    console.log('Retrying Firestore setup...');\n    const healthy = await checkFirestoreHealth();\n    setIsFirestoreHealthy(healthy);\n    setAuthOnlyMode(!healthy);\n    if (healthy) {\n      console.log('Firestore is now healthy!');\n    } else {\n      console.log('Firestore is still not accessible');\n    }\n  };\n\n  const value: AuthContextType = {\n    user,\n    isLoading: isLoading || loginMutation.isPending || logoutMutation.isPending || registerMutation.isPending || switchCompanyMutation.isPending,\n    isAuthenticated: !!firebaseUser && !!user,\n    isFirestoreHealthy,\n    authOnlyMode,\n    login,\n    logout,\n    register,\n    switchCompany,\n    retryFirestoreSetup,\n  };\n\n  // Add timeout to prevent infinite loading\n  useEffect(() => {\n    let timeout: NodeJS.Timeout;\n    if (registerMutation.isPending) {\n      timeout = setTimeout(() => {\n        console.error('Registration timeout - forcing loading state reset');\n        setIsLoading(false);\n      }, 30000); // 30 second timeout\n    }\n    return () => {\n      if (timeout) clearTimeout(timeout);\n    };\n  }, [registerMutation.isPending]);\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n}","size_bytes":16438},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  // Get Firebase auth token if available\n  const getAuthToken = async (): Promise<string | null> => {\n    try {\n      const { auth } = await import('@/lib/firebase');\n      if (auth.currentUser) {\n        return await auth.currentUser.getIdToken();\n      }\n      return null;\n    } catch (error) {\n      console.error('Error getting auth token:', error);\n      return null;\n    }\n  };\n\n  const token = await getAuthToken();\n  const headers: Record<string, string> = data ? { \"Content-Type\": \"application/json\" } : {};\n  \n  if (token) {\n    headers.Authorization = `Bearer ${token}`;\n  }\n\n  const res = await fetch(url, {\n    method,\n    headers,\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    // Get Firebase auth token if available\n    const getAuthToken = async (): Promise<string | null> => {\n      try {\n        const { auth } = await import('@/lib/firebase');\n        if (auth.currentUser) {\n          return await auth.currentUser.getIdToken();\n        }\n        return null;\n      } catch (error) {\n        console.error('Error getting auth token:', error);\n        return null;\n      }\n    };\n\n    const token = await getAuthToken();\n    const headers: Record<string, string> = {};\n    \n    if (token) {\n      headers.Authorization = `Bearer ${token}`;\n    }\n\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      headers,\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":2514},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/pages/AccountsPage.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { useIsMobile } from '@/hooks/use-mobile';\nimport { queryClient, apiRequest } from '@/lib/queryClient';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Switch } from '@/components/ui/switch';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { Calculator, Plus, Edit, Trash2, ChevronRight, ChevronDown, Wallet, Building2, CreditCard, TrendingUp, Receipt } from 'lucide-react';\nimport { z } from 'zod';\nimport { useToast } from '@/hooks/use-toast';\n\n// Account form schema\nconst accountSchema = z.object({\n  code: z.string().min(1, 'Account code is required'),\n  name: z.string().min(2, 'Account name must be at least 2 characters'),\n  account_type: z.enum(['asset', 'liability', 'equity', 'revenue', 'expense']),\n  account_subtype: z.string().min(1, 'Please select a subtype'),\n  parent_id: z.string().optional().nullable(),\n  is_active: z.boolean(),\n  description: z.string().optional(),\n});\n\ntype AccountForm = z.infer<typeof accountSchema>;\n\nconst accountTypes = [\n  { value: 'asset', label: 'Assets', icon: Wallet, color: 'text-blue-600' },\n  { value: 'liability', label: 'Liabilities', icon: CreditCard, color: 'text-red-600' },\n  { value: 'equity', label: 'Equity', icon: Building2, color: 'text-purple-600' },\n  { value: 'revenue', label: 'Revenue', icon: TrendingUp, color: 'text-green-600' },\n  { value: 'expense', label: 'Expenses', icon: Receipt, color: 'text-orange-600' },\n];\n\nconst accountSubtypes: Record<string, { value: string; label: string }[]> = {\n  asset: [\n    { value: 'current_asset', label: 'Current Assets' },\n    { value: 'cash', label: 'Cash & Bank' },\n    { value: 'accounts_receivable', label: 'Accounts Receivable' },\n    { value: 'inventory', label: 'Inventory' },\n    { value: 'fixed_asset', label: 'Fixed Assets' },\n    { value: 'other_asset', label: 'Other Assets' },\n  ],\n  liability: [\n    { value: 'current_liability', label: 'Current Liabilities' },\n    { value: 'accounts_payable', label: 'Accounts Payable' },\n    { value: 'credit_card', label: 'Credit Card' },\n    { value: 'long_term_liability', label: 'Long-term Liabilities' },\n    { value: 'other_liability', label: 'Other Liabilities' },\n  ],\n  equity: [\n    { value: 'owners_equity', label: \"Owner's Equity\" },\n    { value: 'retained_earnings', label: 'Retained Earnings' },\n    { value: 'share_capital', label: 'Share Capital' },\n    { value: 'dividends', label: 'Dividends' },\n  ],\n  revenue: [\n    { value: 'sales_revenue', label: 'Sales Revenue' },\n    { value: 'service_revenue', label: 'Service Revenue' },\n    { value: 'other_revenue', label: 'Other Revenue' },\n    { value: 'interest_income', label: 'Interest Income' },\n  ],\n  expense: [\n    { value: 'cost_of_goods', label: 'Cost of Goods Sold' },\n    { value: 'operating_expense', label: 'Operating Expenses' },\n    { value: 'salary_expense', label: 'Salaries & Wages' },\n    { value: 'rent_expense', label: 'Rent Expense' },\n    { value: 'utility_expense', label: 'Utilities' },\n    { value: 'other_expense', label: 'Other Expenses' },\n  ],\n};\n\nexport default function AccountsPage() {\n  const isMobile = useIsMobile();\n  const { toast } = useToast();\n  const [showDialog, setShowDialog] = useState(false);\n  const [editingAccount, setEditingAccount] = useState<any>(null);\n  const [expandedTypes, setExpandedTypes] = useState<string[]>(['asset', 'liability', 'revenue', 'expense']);\n  const [selectedType, setSelectedType] = useState<string>('asset');\n\n  // Fetch accounts\n  const { data: accounts = [], isLoading } = useQuery<any[]>({\n    queryKey: ['/api/accounts'],\n  });\n\n  // Create account mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: AccountForm) => {\n      const response = await apiRequest('POST', '/api/accounts', data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/accounts'] });\n      setShowDialog(false);\n      toast({\n        title: 'Account created',\n        description: 'New account has been added to the chart of accounts.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to create account',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Update account mutation\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<AccountForm> }) => {\n      const response = await apiRequest('PUT', `/api/accounts/${id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/accounts'] });\n      setShowDialog(false);\n      setEditingAccount(null);\n      toast({\n        title: 'Account updated',\n        description: 'Account information has been updated successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to update account',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Delete account mutation\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const response = await apiRequest('DELETE', `/api/accounts/${id}`);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/accounts'] });\n      toast({\n        title: 'Account deleted',\n        description: 'Account has been removed from the chart of accounts.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to delete account',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const form = useForm<AccountForm>({\n    resolver: zodResolver(accountSchema),\n    defaultValues: editingAccount || {\n      code: '',\n      name: '',\n      account_type: 'asset',\n      account_subtype: '',\n      parent_id: null,\n      is_active: true,\n      description: '',\n    },\n  });\n\n  const onSubmit = async (data: AccountForm) => {\n    if (editingAccount) {\n      await updateMutation.mutateAsync({ id: editingAccount.id, data });\n    } else {\n      await createMutation.mutateAsync(data);\n    }\n  };\n\n  const handleEdit = (account: any) => {\n    setEditingAccount(account);\n    form.reset(account);\n    setSelectedType(account.account_type);\n    setShowDialog(true);\n  };\n\n  const handleDelete = async (id: string) => {\n    if (confirm('Are you sure you want to delete this account? This action cannot be undone.')) {\n      await deleteMutation.mutateAsync(id);\n    }\n  };\n\n  const toggleType = (type: string) => {\n    setExpandedTypes(prev =>\n      prev.includes(type)\n        ? prev.filter(t => t !== type)\n        : [...prev, type]\n    );\n  };\n\n  // Group accounts by type\n  const groupedAccounts = accounts.reduce((acc: any, account) => {\n    if (!acc[account.account_type]) {\n      acc[account.account_type] = [];\n    }\n    acc[account.account_type].push(account);\n    return acc;\n  }, {});\n\n  // Calculate totals\n  const calculateTotal = (type: string) => {\n    const typeAccounts = groupedAccounts[type] || [];\n    // In a real app, you'd calculate actual balances\n    return typeAccounts.length;\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Chart of Accounts</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Manage your accounting structure and general ledger accounts\n          </p>\n        </div>\n        <Dialog open={showDialog} onOpenChange={(open) => {\n          setShowDialog(open);\n          if (!open) {\n            setEditingAccount(null);\n            form.reset();\n          }\n        }}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-add-account\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Account\n            </Button>\n          </DialogTrigger>\n          <DialogContent className={`max-w-2xl ${isMobile ? 'w-full max-w-full mx-4' : ''}`}>\n            <DialogHeader>\n              <DialogTitle>\n                {editingAccount ? 'Edit Account' : 'Create New Account'}\n              </DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"code\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Account Code *</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"1000\" data-testid=\"input-account-code\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"name\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Account Name *</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Cash on Hand\" data-testid=\"input-account-name\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"account_type\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Account Type *</FormLabel>\n                        <Select \n                          onValueChange={(value) => {\n                            field.onChange(value);\n                            setSelectedType(value);\n                            form.setValue('account_subtype', '');\n                          }} \n                          defaultValue={field.value}\n                        >\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-account-type\">\n                              <SelectValue placeholder=\"Select type\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {accountTypes.map((type) => {\n                              const Icon = type.icon;\n                              return (\n                                <SelectItem key={type.value} value={type.value}>\n                                  <div className=\"flex items-center gap-2\">\n                                    <Icon className={`h-4 w-4 ${type.color}`} />\n                                    {type.label}\n                                  </div>\n                                </SelectItem>\n                              );\n                            })}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"account_subtype\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Account Subtype *</FormLabel>\n                        <Select onValueChange={field.onChange} value={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-account-subtype\">\n                              <SelectValue placeholder=\"Select subtype\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {(accountSubtypes[selectedType] || []).map((subtype) => (\n                              <SelectItem key={subtype.value} value={subtype.value}>\n                                {subtype.label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"description\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Description</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"Optional description for this account\" \n                          data-testid=\"input-account-description\" \n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"is_active\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex items-center justify-between rounded-lg border p-3\">\n                      <div className=\"space-y-0.5\">\n                        <FormLabel>Active Account</FormLabel>\n                        <div className=\"text-sm text-muted-foreground\">\n                          Active accounts can be used in transactions\n                        </div>\n                      </div>\n                      <FormControl>\n                        <Switch\n                          checked={field.value}\n                          onCheckedChange={field.onChange}\n                          data-testid=\"switch-account-active\"\n                        />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex justify-end gap-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setShowDialog(false)}\n                    data-testid=\"button-cancel\"\n                  >\n                    Cancel\n                  </Button>\n                  <Button \n                    type=\"submit\" \n                    disabled={createMutation.isPending || updateMutation.isPending}\n                    data-testid=\"button-save-account\"\n                  >\n                    {editingAccount ? 'Update' : 'Create'} Account\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Account Summary Cards */}\n      <div className=\"grid gap-4 grid-cols-2 sm:grid-cols-3 lg:grid-cols-5\">\n        {accountTypes.map((type) => {\n          const Icon = type.icon;\n          const count = calculateTotal(type.value);\n          return (\n            <Card key={type.value} data-testid={`card-summary-${type.value}`}>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n                  <Icon className={`h-4 w-4 ${type.color}`} />\n                  {type.label}\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{count}</div>\n                <p className=\"text-xs text-muted-foreground\">accounts</p>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n\n      {/* Accounts List by Type */}\n      <div className=\"space-y-4\">\n        {isLoading ? (\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"animate-pulse space-y-2\">\n                <div className=\"h-4 bg-muted rounded w-3/4\"></div>\n                <div className=\"h-4 bg-muted rounded w-1/2\"></div>\n              </div>\n            </CardContent>\n          </Card>\n        ) : accounts.length === 0 ? (\n          <Card>\n            <CardContent className=\"p-6 text-center\">\n              <Calculator className=\"h-12 w-12 mx-auto text-muted-foreground mb-2\" />\n              <p className=\"text-muted-foreground\">No accounts found</p>\n              <p className=\"text-sm text-muted-foreground\">\n                Start by creating your chart of accounts\n              </p>\n            </CardContent>\n          </Card>\n        ) : (\n          accountTypes.map((type) => {\n            const typeAccounts = groupedAccounts[type.value] || [];\n            const Icon = type.icon;\n            const isExpanded = expandedTypes.includes(type.value);\n            \n            if (typeAccounts.length === 0) return null;\n            \n            return (\n              <Card key={type.value} data-testid={`card-type-${type.value}`}>\n                <CardHeader \n                  className=\"cursor-pointer\"\n                  onClick={() => toggleType(type.value)}\n                >\n                  <CardTitle className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                      {isExpanded ? (\n                        <ChevronDown className=\"h-5 w-5\" />\n                      ) : (\n                        <ChevronRight className=\"h-5 w-5\" />\n                      )}\n                      <Icon className={`h-5 w-5 ${type.color}`} />\n                      {type.label}\n                    </div>\n                    <Badge variant=\"secondary\">{typeAccounts.length} accounts</Badge>\n                  </CardTitle>\n                </CardHeader>\n                {isExpanded && (\n                  <CardContent>\n                    <div className=\"space-y-2\">\n                      {typeAccounts.map((account: any) => (\n                        <div\n                          key={account.id}\n                          className=\"flex items-center justify-between p-3 rounded-lg border hover-elevate\"\n                          data-testid={`account-${account.id}`}\n                        >\n                          <div className=\"flex-1\">\n                            <div className=\"flex items-center gap-3\">\n                              <Badge variant=\"outline\" className=\"font-mono\">\n                                {account.code}\n                              </Badge>\n                              <span className=\"font-medium\">{account.name}</span>\n                              {!account.is_active && (\n                                <Badge variant=\"secondary\" className=\"text-xs\">\n                                  Inactive\n                                </Badge>\n                              )}\n                            </div>\n                            {account.description && (\n                              <p className=\"text-sm text-muted-foreground mt-1\">\n                                {account.description}\n                              </p>\n                            )}\n                            <div className=\"flex items-center gap-4 mt-2\">\n                              <Badge variant=\"secondary\" className=\"text-xs\">\n                                {accountSubtypes[account.account_type]?.find(\n                                  s => s.value === account.account_subtype\n                                )?.label || account.account_subtype}\n                              </Badge>\n                            </div>\n                          </div>\n                          <div className=\"flex gap-2\">\n                            <Button\n                              size=\"sm\"\n                              variant=\"ghost\"\n                              onClick={() => handleEdit(account)}\n                              data-testid={`button-edit-${account.id}`}\n                            >\n                              <Edit className=\"h-4 w-4\" />\n                            </Button>\n                            {!account.is_system && (\n                              <Button\n                                size=\"sm\"\n                                variant=\"ghost\"\n                                onClick={() => handleDelete(account.id)}\n                                data-testid={`button-delete-${account.id}`}\n                              >\n                                <Trash2 className=\"h-4 w-4\" />\n                              </Button>\n                            )}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </CardContent>\n                )}\n              </Card>\n            );\n          })\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":21525},"client/src/pages/AuthPage.tsx":{"content":"import { useState, useMemo, useEffect } from 'react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { useTranslation } from 'react-i18next';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Building2, DollarSign, Globe, Calculator } from 'lucide-react';\nimport { z } from 'zod';\nimport { useToast } from '@/hooks/use-toast';\nimport { mapCurrencies } from '@/lib/currencies';\n\n// Schema and types will be created dynamically inside component\n\n// Mock companies for demo (replace with API call later)\nconst mockCompanies = [\n  { id: '817558ae-273a-4a78-b715-e5986469e210', name: 'Demo Company Ltd', currency: 'USD' },\n  { id: '817558ae-273a-4a78-b715-e5986469e211', name: 'Acme Corporation', currency: 'EUR' },\n];\n\n// Currency and month arrays will be created inside component to use translations\n\nexport default function AuthPage() {\n  const { login, register, isLoading } = useAuth();\n  const { toast } = useToast();\n  const { t, i18n } = useTranslation();\n  const [activeTab, setActiveTab] = useState('login');\n\n  // Dynamic schemas using translations - memoized to update when language changes\n  const loginSchema = useMemo(() => z.object({\n    email: z.string().email(t('auth.validationErrors.emailInvalid')),\n    password: z.string().min(6, t('auth.validationErrors.passwordMinLength')),\n  }), [t, i18n.resolvedLanguage]);\n\n  const registerSchema = useMemo(() => z.object({\n    // Company info\n    companyName: z.string().min(2, t('auth.validationErrors.companyNameMinLength')),\n    baseCurrency: z.string().min(3, t('auth.validationErrors.selectCurrency')),\n    fiscalYearStart: z.string(),\n    \n    // User info\n    username: z.string().min(3, t('auth.validationErrors.usernameMinLength')),\n    email: z.string().email(t('auth.validationErrors.emailInvalid')),\n    password: z.string().min(6, t('auth.validationErrors.passwordMinLength')),\n    fullName: z.string().min(2, t('auth.validationErrors.fullNameMinLength')),\n  }), [t, i18n.resolvedLanguage]);\n\n  type LoginForm = z.infer<typeof loginSchema>;\n  type RegisterForm = z.infer<typeof registerSchema>;\n\n  // Get comprehensive currency list from shared utility\n  const currencies = useMemo(() => mapCurrencies(t, 'auth.currencies'), [t, i18n.resolvedLanguage]);\n\n  const months = [\n    { value: '1', label: t('auth.months.january') },\n    { value: '4', label: t('auth.months.april') },\n    { value: '7', label: t('auth.months.july') },\n    { value: '10', label: t('auth.months.october') },\n  ];\n\n  // Create resolvers based on current schemas\n  const loginResolver = useMemo(() => zodResolver(loginSchema), [loginSchema, i18n.resolvedLanguage]);\n  const registerResolver = useMemo(() => zodResolver(registerSchema), [registerSchema, i18n.resolvedLanguage]);\n\n  const loginForm = useForm<LoginForm>({\n    resolver: loginResolver,\n    defaultValues: {\n      email: '',\n      password: '',\n    },\n  });\n\n  const registerForm = useForm<RegisterForm>({\n    resolver: registerResolver,\n    defaultValues: {\n      companyName: '',\n      baseCurrency: 'USD',\n      fiscalYearStart: '1',\n      username: '',\n      email: '',\n      password: '',\n      fullName: '',\n    },\n  });\n\n  // Reset forms when language changes to update error messages with new resolver\n  useEffect(() => {\n    // Reset both forms to apply new resolvers when language changes\n    const loginValues = loginForm.getValues();\n    const registerValues = registerForm.getValues();\n    \n    // Reset forms to apply new resolver and clear any existing validation state\n    loginForm.reset(loginValues, { keepValues: true });\n    registerForm.reset(registerValues, { keepValues: true });\n  }, [loginResolver, registerResolver, loginForm, registerForm]);\n\n  const onLogin = async (data: LoginForm) => {\n    try {\n      await login(data.email, data.password);\n      toast({\n        title: t('auth.loginSuccess'),\n        description: t('auth.signInToContinue'),\n      });\n    } catch (error: any) {\n      toast({\n        title: t('auth.loginError'),\n        description: error.message || t('auth.invalidCredentials'),\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const onRegister = async (data: RegisterForm) => {\n    try {\n      // Register user and create company in one step\n      await register({\n        username: data.username,\n        email: data.email,\n        password: data.password,\n        company_name: data.companyName,\n        company_base_currency: data.baseCurrency,\n        company_fiscal_year_start: parseInt(data.fiscalYearStart),\n      });\n      \n      toast({\n        title: t('common.success'),\n        description: t('auth.createNewCompany'),\n      });\n    } catch (error: any) {\n      toast({\n        title: t('common.error'),\n        description: error.message || t('forms.validationError'),\n        variant: 'destructive',\n      });\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-md\">\n        {/* Header */}\n        <div className=\"text-center mb-8\">\n          <div className=\"flex items-center justify-center gap-2 mb-4\">\n            <Building2 className=\"h-8 w-8 text-primary\" />\n            <h1 className=\"text-2xl font-bold\">{t('app.name')}</h1>\n          </div>\n          <p className=\"text-muted-foreground\">\n            {t('app.tagline')}\n          </p>\n          <div className=\"flex items-center justify-center gap-2 mt-2\">\n            <Badge variant=\"secondary\" className=\"text-xs\">\n              <Globe className=\"h-3 w-3 mr-1\" />\n              {t('common.multiLanguage')}\n            </Badge>\n            <Badge variant=\"secondary\" className=\"text-xs\">\n              <DollarSign className=\"h-3 w-3 mr-1\" />\n              {t('common.multiCurrency')}\n            </Badge>\n            <Badge variant=\"secondary\" className=\"text-xs\">\n              <Calculator className=\"h-3 w-3 mr-1\" />\n              {t('common.fullAccounting')}\n            </Badge>\n          </div>\n        </div>\n\n        <Card className=\"shadow-lg\">\n          <CardHeader>\n            <CardTitle className=\"text-center\">\n              {activeTab === 'login' ? t('auth.existingAccount') : t('auth.createAccount')}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n              <TabsList className=\"grid w-full grid-cols-2\">\n                <TabsTrigger value=\"login\" data-testid=\"tab-login\">{t('auth.login')}</TabsTrigger>\n                <TabsTrigger value=\"register\" data-testid=\"tab-register\">{t('auth.register')}</TabsTrigger>\n              </TabsList>\n\n              {/* Login Tab */}\n              <TabsContent value=\"login\" className=\"space-y-4 mt-6\" key={`login-${i18n.resolvedLanguage}`}>\n                <Form {...loginForm}>\n                  <form onSubmit={loginForm.handleSubmit(onLogin)} className=\"space-y-4\">\n                    <FormField\n                      control={loginForm.control}\n                      name=\"email\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t('auth.email')}</FormLabel>\n                          <FormControl>\n                            <Input \n                              type=\"email\" \n                              placeholder={t('auth.email')} \n                              data-testid=\"input-login-email\"\n                              {...field} \n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={loginForm.control}\n                      name=\"password\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t('auth.password')}</FormLabel>\n                          <FormControl>\n                            <Input \n                              type=\"password\" \n                              placeholder={t('auth.password')} \n                              data-testid=\"input-login-password\"\n                              {...field} \n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <Button \n                      type=\"submit\" \n                      className=\"w-full\" \n                      disabled={isLoading}\n                      data-testid=\"button-login\"\n                    >\n                      {isLoading ? t('common.loading') : t('auth.login')}\n                    </Button>\n                  </form>\n                </Form>\n\n                <div className=\"text-center text-sm text-muted-foreground\">\n                  <p>{t('auth.createAccountPrompt')}</p>\n                </div>\n              </TabsContent>\n\n              {/* Register Tab */}\n              <TabsContent value=\"register\" className=\"space-y-4 mt-6\" key={`register-${i18n.resolvedLanguage}`}>\n                <Form {...registerForm}>\n                  <form onSubmit={registerForm.handleSubmit(onRegister)} className=\"space-y-4\">\n                    {/* Company Section */}\n                    <div className=\"space-y-3\">\n                      <h3 className=\"text-sm font-medium text-muted-foreground\">{t('auth.companyInformation')}</h3>\n                      \n                      <FormField\n                        control={registerForm.control}\n                        name=\"companyName\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>{t('auth.companyName')}</FormLabel>\n                            <FormControl>\n                              <Input \n                                placeholder={t('auth.companyNamePlaceholder')} \n                                data-testid=\"input-company-name\"\n                                {...field} \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <div className=\"grid grid-cols-2 gap-3\">\n                        <FormField\n                          control={registerForm.control}\n                          name=\"baseCurrency\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>{t('auth.currency')}</FormLabel>\n                              <Select onValueChange={field.onChange} defaultValue={field.value}>\n                                <FormControl>\n                                  <SelectTrigger data-testid=\"select-currency\">\n                                    <SelectValue placeholder={t('auth.selectCurrency')} />\n                                  </SelectTrigger>\n                                </FormControl>\n                                <SelectContent>\n                                  {currencies.map((currency) => (\n                                    <SelectItem key={currency.code} value={currency.code}>\n                                      {currency.code} - {currency.name}\n                                    </SelectItem>\n                                  ))}\n                                </SelectContent>\n                              </Select>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n\n                        <FormField\n                          control={registerForm.control}\n                          name=\"fiscalYearStart\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>{t('auth.fiscalYear')}</FormLabel>\n                              <Select onValueChange={field.onChange} defaultValue={field.value}>\n                                <FormControl>\n                                  <SelectTrigger data-testid=\"select-fiscal-year\">\n                                    <SelectValue placeholder={t('auth.selectMonth')} />\n                                  </SelectTrigger>\n                                </FormControl>\n                                <SelectContent>\n                                  {months.map((month) => (\n                                    <SelectItem key={month.value} value={month.value}>\n                                      {month.label}\n                                    </SelectItem>\n                                  ))}\n                                </SelectContent>\n                              </Select>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                      </div>\n                    </div>\n\n                    {/* User Section */}\n                    <div className=\"space-y-3\">\n                      <h3 className=\"text-sm font-medium text-muted-foreground\">{t('auth.userInformation')}</h3>\n                      \n                      <FormField\n                        control={registerForm.control}\n                        name=\"fullName\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>{t('auth.fullName')}</FormLabel>\n                            <FormControl>\n                              <Input \n                                placeholder={t('auth.fullNamePlaceholder')} \n                                data-testid=\"input-full-name\"\n                                {...field} \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={registerForm.control}\n                        name=\"username\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>{t('auth.username')}</FormLabel>\n                            <FormControl>\n                              <Input \n                                placeholder={t('auth.usernamePlaceholder')} \n                                data-testid=\"input-username\"\n                                {...field} \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={registerForm.control}\n                        name=\"email\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>{t('auth.email')}</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"email\" \n                                placeholder={t('auth.emailPlaceholder')} \n                                data-testid=\"input-register-email\"\n                                {...field} \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={registerForm.control}\n                        name=\"password\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>{t('auth.password')}</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"password\" \n                                placeholder={t('auth.passwordPlaceholder')} \n                                data-testid=\"input-register-password\"\n                                {...field} \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <Button \n                      type=\"submit\" \n                      className=\"w-full\" \n                      disabled={isLoading}\n                      data-testid=\"button-register\"\n                    >\n                      {isLoading ? t('auth.creatingAccount') : t('auth.createAccount')}\n                    </Button>\n                  </form>\n                </Form>\n              </TabsContent>\n            </Tabs>\n          </CardContent>\n        </Card>\n\n        {/* Footer */}\n        <div className=\"text-center mt-6 text-xs text-muted-foreground\">\n          <p>Â© 2024 Log & Ledger - Professional Accounting Software</p>\n          <p>Supporting 15+ languages with RTL/LTR layouts</p>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":17788},"client/src/pages/CompaniesPage.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { useIsMobile } from '@/hooks/use-mobile';\nimport { queryClient, apiRequest } from '@/lib/queryClient';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { Building2, Plus, Edit, Trash2, Check, Globe, Calendar, DollarSign } from 'lucide-react';\nimport { z } from 'zod';\nimport { useToast } from '@/hooks/use-toast';\nimport { useTranslation } from 'react-i18next';\nimport { useMemo } from 'react';\n\n// Company form schema will be created inside component to use translations\n\n// CompanyForm type will be defined inside component after schema\n\n// Dynamic currencies will be created inside component\n\n// Dynamic date formats will be created inside component\n\n// Dynamic number formats will be created inside component\n\n// Month names will be accessed dynamically via translations\n\nexport default function CompaniesPage() {\n  const isMobile = useIsMobile();\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const { t, i18n } = useTranslation();\n  const [showDialog, setShowDialog] = useState(false);\n  const [editingCompany, setEditingCompany] = useState<any>(null);\n\n  // Dynamic schema using translations - memoized to update when language changes\n  const companySchema = useMemo(() => z.object({\n    name: z.string().min(2, t('validationErrors.companyNameMin')),\n    legal_name: z.string().optional(),\n    tax_number: z.string().optional(),\n    registration_number: z.string().optional(),\n    base_currency: z.string().min(3, t('validationErrors.currencyRequired')),\n    fiscal_year_start: z.number().min(1).max(12),\n    date_format: z.string(),\n    number_format: z.string(),\n  }), [t, i18n.resolvedLanguage]);\n\n  type CompanyForm = z.infer<typeof companySchema>;\n\n  // Dynamic months using translations\n  const months = useMemo(() => [\n    t('months.january'), t('months.february'), t('months.march'), t('months.april'), \n    t('months.may'), t('months.june'), t('months.july'), t('months.august'),\n    t('months.september'), t('months.october'), t('months.november'), t('months.december')\n  ], [t, i18n.resolvedLanguage]);\n\n  // Dynamic currencies using translations - Comprehensive global currency list\n  const currencies = useMemo(() => [\n    // Major World Currencies\n    { code: 'USD', name: t('currencies.USD'), symbol: '$' },\n    { code: 'EUR', name: t('currencies.EUR'), symbol: 'â‚¬' },\n    { code: 'GBP', name: t('currencies.GBP'), symbol: 'Â£' },\n    { code: 'JPY', name: t('currencies.JPY'), symbol: 'Â¥' },\n    { code: 'CHF', name: t('currencies.CHF'), symbol: 'CHF' },\n    { code: 'CAD', name: t('currencies.CAD'), symbol: 'C$' },\n    { code: 'AUD', name: t('currencies.AUD'), symbol: 'A$' },\n    { code: 'NZD', name: t('currencies.NZD'), symbol: 'NZ$' },\n    \n    // Arabic & Middle Eastern Currencies\n    { code: 'AED', name: t('currencies.AED'), symbol: 'Ø¯.Ø¥' },\n    { code: 'SAR', name: t('currencies.SAR'), symbol: 'Ø±.Ø³' },\n    { code: 'EGP', name: t('currencies.EGP'), symbol: 'Ø¬.Ù…' },\n    { code: 'SYP', name: t('currencies.SYP'), symbol: 'Ù„.Ø³' }, // Syria - specifically requested\n    { code: 'LBP', name: t('currencies.LBP'), symbol: 'Ù„.Ù„' }, // Lebanon\n    { code: 'IQD', name: t('currencies.IQD'), symbol: 'Ø¹.Ø¯' }, // Iraq\n    { code: 'JOD', name: t('currencies.JOD'), symbol: 'Ø¯.Ø£' }, // Jordan\n    { code: 'KWD', name: t('currencies.KWD'), symbol: 'Ø¯.Ùƒ' }, // Kuwait\n    { code: 'QAR', name: t('currencies.QAR'), symbol: 'Ø±.Ù‚' }, // Qatar\n    { code: 'BHD', name: t('currencies.BHD'), symbol: 'Ø¯.Ø¨' }, // Bahrain\n    { code: 'OMR', name: t('currencies.OMR'), symbol: 'Ø±.Ø¹' }, // Oman\n    { code: 'YER', name: t('currencies.YER'), symbol: 'Ø±.ÙŠ' }, // Yemen\n    { code: 'MAD', name: t('currencies.MAD'), symbol: 'Ø¯.Ù…' }, // Morocco\n    { code: 'DZD', name: t('currencies.DZD'), symbol: 'Ø¯.Ø¬' }, // Algeria\n    { code: 'TND', name: t('currencies.TND'), symbol: 'Ø¯.Øª' }, // Tunisia\n    { code: 'LYD', name: t('currencies.LYD'), symbol: 'Ø¯.Ù„' }, // Libya\n    { code: 'SDG', name: t('currencies.SDG'), symbol: 'Ø¬.Ø³' }, // Sudan\n    { code: 'ILS', name: t('currencies.ILS'), symbol: 'â‚ª' }, // Israel\n    { code: 'IRR', name: t('currencies.IRR'), symbol: 'ï·¼' }, // Iran\n    { code: 'TRY', name: t('currencies.TRY'), symbol: 'â‚º' }, // Turkey\n    \n    // Asian Currencies\n    { code: 'PHP', name: t('currencies.PHP'), symbol: 'â‚±' }, // Philippines - specifically requested\n    { code: 'CNY', name: t('currencies.CNY'), symbol: 'Â¥' }, // China\n    { code: 'KRW', name: t('currencies.KRW'), symbol: 'â‚©' }, // South Korea\n    { code: 'INR', name: t('currencies.INR'), symbol: 'â‚¹' }, // India\n    { code: 'IDR', name: t('currencies.IDR'), symbol: 'Rp' }, // Indonesia\n    { code: 'THB', name: t('currencies.THB'), symbol: 'à¸¿' }, // Thailand\n    { code: 'MYR', name: t('currencies.MYR'), symbol: 'RM' }, // Malaysia\n    { code: 'SGD', name: t('currencies.SGD'), symbol: 'S$' }, // Singapore\n    { code: 'VND', name: t('currencies.VND'), symbol: 'â‚«' }, // Vietnam\n    { code: 'BDT', name: t('currencies.BDT'), symbol: 'à§³' }, // Bangladesh\n    { code: 'PKR', name: t('currencies.PKR'), symbol: 'â‚¨' }, // Pakistan\n    { code: 'LKR', name: t('currencies.LKR'), symbol: 'â‚¨' }, // Sri Lanka\n    { code: 'MMK', name: t('currencies.MMK'), symbol: 'K' }, // Myanmar\n    { code: 'KHR', name: t('currencies.KHR'), symbol: 'áŸ›' }, // Cambodia\n    { code: 'LAK', name: t('currencies.LAK'), symbol: 'â‚­' }, // Laos\n    { code: 'NPR', name: t('currencies.NPR'), symbol: 'â‚¨' }, // Nepal\n    { code: 'BTN', name: t('currencies.BTN'), symbol: 'Nu.' }, // Bhutan\n    { code: 'MNT', name: t('currencies.MNT'), symbol: 'â‚®' }, // Mongolia\n    { code: 'KZT', name: t('currencies.KZT'), symbol: 'â‚¸' }, // Kazakhstan\n    { code: 'UZS', name: t('currencies.UZS'), symbol: \"so'm\" }, // Uzbekistan\n    \n    // European Currencies\n    { code: 'NOK', name: t('currencies.NOK'), symbol: 'kr' }, // Norway\n    { code: 'SEK', name: t('currencies.SEK'), symbol: 'kr' }, // Sweden\n    { code: 'DKK', name: t('currencies.DKK'), symbol: 'kr' }, // Denmark\n    { code: 'ISK', name: t('currencies.ISK'), symbol: 'kr' }, // Iceland\n    { code: 'PLN', name: t('currencies.PLN'), symbol: 'zÅ‚' }, // Poland\n    { code: 'CZK', name: t('currencies.CZK'), symbol: 'KÄ' }, // Czech Republic\n    { code: 'HUF', name: t('currencies.HUF'), symbol: 'Ft' }, // Hungary\n    { code: 'RON', name: t('currencies.RON'), symbol: 'lei' }, // Romania\n    { code: 'BGN', name: t('currencies.BGN'), symbol: 'Ð»Ð²' }, // Bulgaria\n    { code: 'HRK', name: t('currencies.HRK'), symbol: 'kn' }, // Croatia\n    { code: 'RSD', name: t('currencies.RSD'), symbol: 'Ð´Ð¸Ð½' }, // Serbia\n    { code: 'UAH', name: t('currencies.UAH'), symbol: 'â‚´' }, // Ukraine\n    { code: 'RUB', name: t('currencies.RUB'), symbol: 'â‚½' }, // Russia\n    \n    // African Currencies\n    { code: 'ZAR', name: t('currencies.ZAR'), symbol: 'R' }, // South Africa\n    { code: 'NGN', name: t('currencies.NGN'), symbol: 'â‚¦' }, // Nigeria\n    { code: 'GHS', name: t('currencies.GHS'), symbol: 'â‚µ' }, // Ghana\n    { code: 'KES', name: t('currencies.KES'), symbol: 'KSh' }, // Kenya\n    { code: 'UGX', name: t('currencies.UGX'), symbol: 'USh' }, // Uganda\n    { code: 'TZS', name: t('currencies.TZS'), symbol: 'TSh' }, // Tanzania\n    { code: 'ETB', name: t('currencies.ETB'), symbol: 'Br' }, // Ethiopia\n    { code: 'RWF', name: t('currencies.RWF'), symbol: 'RF' }, // Rwanda\n    { code: 'XOF', name: t('currencies.XOF'), symbol: 'CFA' }, // West Africa CFA\n    { code: 'XAF', name: t('currencies.XAF'), symbol: 'FCFA' }, // Central Africa CFA\n    \n    // American Currencies\n    { code: 'MXN', name: t('currencies.MXN'), symbol: '$' }, // Mexico\n    { code: 'BRL', name: t('currencies.BRL'), symbol: 'R$' }, // Brazil\n    { code: 'ARS', name: t('currencies.ARS'), symbol: '$' }, // Argentina\n    { code: 'CLP', name: t('currencies.CLP'), symbol: '$' }, // Chile\n    { code: 'COP', name: t('currencies.COP'), symbol: '$' }, // Colombia\n    { code: 'PEN', name: t('currencies.PEN'), symbol: 'S/' }, // Peru\n  ], [t, i18n.resolvedLanguage]);\n\n  // Dynamic date formats\n  const dateFormats = useMemo(() => [\n    { value: 'dd/MM/yyyy', label: '31/12/2024' },\n    { value: 'MM/dd/yyyy', label: '12/31/2024' },\n    { value: 'yyyy-MM-dd', label: '2024-12-31' },\n    { value: 'dd.MM.yyyy', label: '31.12.2024' },\n  ], []);\n\n  // Dynamic number formats using translations  \n  const numberFormats = useMemo(() => [\n    { value: '1,234.56', label: `1,234.56 (${t('formats.us')})` },\n    { value: '1.234,56', label: `1.234,56 (${t('formats.eu')})` },\n    { value: '1 234.56', label: `1 234.56 (${t('formats.fr')})` },\n    { value: '1234.56', label: '1234.56' },\n  ], [t, i18n.resolvedLanguage]);\n\n  // Fetch companies\n  const { data: companies = [], isLoading } = useQuery<any[]>({\n    queryKey: ['/api/companies'],\n  });\n\n  // Create company mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: CompanyForm) => {\n      return await apiRequest('POST', '/api/companies', data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/companies'] });\n      setShowDialog(false);\n      toast({\n        title: t('messages.companyCreated'),\n        description: t('messages.companyCreatedDesc'),\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: t('common.error'),\n        description: error.message || t('messages.createCompanyError'),\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Update company mutation\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: CompanyForm }) => {\n      return await apiRequest('PUT', `/api/companies/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/companies'] });\n      setShowDialog(false);\n      setEditingCompany(null);\n      toast({\n        title: t('messages.companyUpdated'),\n        description: t('messages.companyUpdatedDesc'),\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: t('common.error'),\n        description: error.message || t('messages.updateCompanyError'),\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Delete company mutation\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return await apiRequest('DELETE', `/api/companies/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/companies'] });\n      toast({\n        title: t('messages.companyDeleted'),\n        description: t('messages.companyDeletedDesc'),\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: t('common.error'),\n        description: error.message || t('messages.deleteCompanyError'),\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const form = useForm<CompanyForm>({\n    resolver: zodResolver(companySchema),\n    defaultValues: editingCompany || {\n      name: '',\n      legal_name: '',\n      tax_number: '',\n      registration_number: '',\n      base_currency: 'USD',\n      fiscal_year_start: 1,\n      date_format: 'dd/MM/yyyy',\n      number_format: '1,234.56',\n    },\n  });\n\n  const onSubmit = async (data: CompanyForm) => {\n    if (editingCompany) {\n      await updateMutation.mutateAsync({ id: editingCompany.id, data });\n    } else {\n      await createMutation.mutateAsync(data);\n    }\n  };\n\n  const handleEdit = (company: any) => {\n    setEditingCompany(company);\n    form.reset(company);\n    setShowDialog(true);\n  };\n\n  const handleDelete = async (id: string) => {\n    if (confirm(t('pages.companies.confirmDelete'))) {\n      await deleteMutation.mutateAsync(id);\n    }\n  };\n\n  const currentCompany = companies.find((c) => c.id === user?.company_id);\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">{t('pages.companies.title')}</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            {t('pages.companies.description')}\n          </p>\n        </div>\n        <Dialog open={showDialog} onOpenChange={(open) => {\n          setShowDialog(open);\n          if (!open) {\n            setEditingCompany(null);\n            form.reset();\n          }\n        }}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-add-company\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              {t('pages.companies.addCompany')}\n            </Button>\n          </DialogTrigger>\n          <DialogContent className={`max-w-2xl ${isMobile ? 'w-full max-w-full mx-4' : ''}`}>\n            <DialogHeader>\n              <DialogTitle>\n                {editingCompany ? t('pages.companies.editCompany') : t('pages.companies.createCompany')}\n              </DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"name\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t('forms.companyName')} *</FormLabel>\n                        <FormControl>\n                          <Input placeholder={t('forms.companyNamePlaceholder')} data-testid=\"input-company-name\" className=\"min-w-0 w-full\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"legal_name\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t('forms.legalName')}</FormLabel>\n                        <FormControl>\n                          <Input placeholder={t('forms.legalNamePlaceholder')} data-testid=\"input-legal-name\" className=\"min-w-0 w-full\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"tax_number\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t('forms.taxNumber')}</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"123456789\" data-testid=\"input-tax-number\" className=\"min-w-0 w-full\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"registration_number\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t('forms.registrationNumber')}</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"REG-2024-001\" data-testid=\"input-registration-number\" className=\"min-w-0 w-full\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"base_currency\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t('forms.baseCurrency')} *</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-base-currency\">\n                              <SelectValue placeholder={t('forms.selectCurrency')} />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {currencies.map((currency) => (\n                              <SelectItem key={currency.code} value={currency.code}>\n                                {currency.symbol} {currency.code} - {currency.name}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"fiscal_year_start\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t('forms.fiscalYearStart')} *</FormLabel>\n                        <Select \n                          onValueChange={(value) => field.onChange(parseInt(value))} \n                          defaultValue={field.value?.toString()}\n                        >\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-fiscal-year\">\n                              <SelectValue placeholder={t('forms.selectMonth')} />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {months.map((month, index) => (\n                              <SelectItem key={index + 1} value={(index + 1).toString()}>\n                                {month}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"date_format\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t('formats.dateFormat')} *</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-date-format\">\n                              <SelectValue placeholder={t('formats.selectDateFormat')} />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {dateFormats.map((format) => (\n                              <SelectItem key={format.value} value={format.value}>\n                                {format.label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"number_format\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t('formats.numberFormat')} *</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-number-format\">\n                              <SelectValue placeholder={t('formats.selectNumberFormat')} />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {numberFormats.map((format) => (\n                              <SelectItem key={format.value} value={format.value}>\n                                {format.label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className={`flex gap-2 ${isMobile ? 'flex-col' : 'justify-end'}`}>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setShowDialog(false)}\n                    data-testid=\"button-cancel\"\n                  >\n                    {t('forms.cancel')}\n                  </Button>\n                  <Button \n                    type=\"submit\" \n                    disabled={createMutation.isPending || updateMutation.isPending}\n                    data-testid=\"button-save-company\"\n                  >\n                    {editingCompany ? t('forms.update') : t('forms.create')} {t('forms.company')}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Current Company */}\n      {currentCompany && (\n        <Card className=\"border-primary/20 bg-primary/5\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Check className=\"h-5 w-5 text-primary\" />\n              {t('pages.companies.currentActive')}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n              <div>\n                <p className=\"text-sm text-muted-foreground\">{t('forms.companyName')}</p>\n                <p className=\"font-medium\">{currentCompany.name}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">{t('forms.currency')}</p>\n                <div className=\"flex items-center gap-1\">\n                  <DollarSign className=\"h-4 w-4\" />\n                  <p className=\"font-medium\">{currentCompany.base_currency}</p>\n                </div>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">{t('forms.fiscalYear')}</p>\n                <div className=\"flex items-center gap-1\">\n                  <Calendar className=\"h-4 w-4\" />\n                  <p className=\"font-medium\">{months[currentCompany.fiscal_year_start - 1]}</p>\n                </div>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">{t('formats.dateFormat')}</p>\n                <p className=\"font-medium\">{currentCompany.date_format}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Companies List */}\n      <div className=\"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3\">\n        {isLoading ? (\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"animate-pulse space-y-2\">\n                <div className=\"h-4 bg-muted rounded w-3/4\"></div>\n                <div className=\"h-4 bg-muted rounded w-1/2\"></div>\n              </div>\n            </CardContent>\n          </Card>\n        ) : companies.length === 0 ? (\n          <Card>\n            <CardContent className=\"p-6 text-center\">\n              <Building2 className=\"h-12 w-12 mx-auto text-muted-foreground mb-2\" />\n              <p className=\"text-muted-foreground\">{t('pages.companies.noCompanies')}</p>\n              <p className=\"text-sm text-muted-foreground\">{t('pages.companies.createFirstCompany')}</p>\n            </CardContent>\n          </Card>\n        ) : (\n          companies.map((company: any) => (\n            <Card \n              key={company.id} \n              className={company.id === user?.company_id ? 'border-primary/20' : ''}\n              data-testid={`card-company-${company.id}`}\n            >\n              <CardHeader>\n                <CardTitle className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <Building2 className=\"h-5 w-5\" />\n                    {company.name}\n                  </div>\n                  {company.id === user?.company_id && (\n                    <Badge variant=\"default\" className=\"text-xs\">{t('forms.active')}</Badge>\n                  )}\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                {company.legal_name && (\n                  <div>\n                    <p className=\"text-xs text-muted-foreground\">{t('forms.legalName')}</p>\n                    <p className=\"text-sm\">{company.legal_name}</p>\n                  </div>\n                )}\n                <div className=\"grid grid-cols-2 gap-3\">\n                  <div>\n                    <p className=\"text-xs text-muted-foreground\">{t('forms.currency')}</p>\n                    <p className=\"text-sm font-medium\">{company.base_currency}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-xs text-muted-foreground\">{t('forms.fiscalYear')}</p>\n                    <p className=\"text-sm font-medium\">{months[company.fiscal_year_start - 1]}</p>\n                  </div>\n                </div>\n                {company.tax_number && (\n                  <div>\n                    <p className=\"text-xs text-muted-foreground\">{t('forms.taxNumber')}</p>\n                    <p className=\"text-sm\">{company.tax_number}</p>\n                  </div>\n                )}\n                <div className=\"flex gap-2 pt-2\">\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleEdit(company)}\n                    data-testid={`button-edit-${company.id}`}\n                  >\n                    <Edit className=\"h-3 w-3 mr-1\" />\n                    {t('forms.edit')}\n                  </Button>\n                  {company.id !== user?.company_id && (\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleDelete(company.id)}\n                      data-testid={`button-delete-${company.id}`}\n                    >\n                      <Trash2 className=\"h-3 w-3 mr-1\" />\n                      {t('forms.delete')}\n                    </Button>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          ))\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":27583},"client/src/pages/ContactsPage.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { useIsMobile } from '@/hooks/use-mobile';\nimport { queryClient, apiRequest } from '@/lib/queryClient';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Switch } from '@/components/ui/switch';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { Users, Plus, Edit, Trash2, Phone, Mail, Globe, Building, CreditCard, Calendar, MapPin } from 'lucide-react';\nimport { z } from 'zod';\nimport { useToast } from '@/hooks/use-toast';\n\n// Contact form schema\nconst contactSchema = z.object({\n  type: z.enum(['customer', 'supplier', 'both']),\n  code: z.string().optional(),\n  name: z.string().min(2, 'Name must be at least 2 characters'),\n  display_name: z.string().optional(),\n  email: z.string().email('Invalid email').optional().or(z.literal('')),\n  phone: z.string().optional(),\n  website: z.string().optional(),\n  tax_number: z.string().optional(),\n  registration_number: z.string().optional(),\n  currency: z.string().default('USD'),\n  payment_terms_days: z.number().min(0).max(365),\n  credit_limit: z.string().optional(),\n  is_active: z.boolean(),\n});\n\ntype ContactForm = z.infer<typeof contactSchema>;\n\nconst contactTypes = [\n  { value: 'customer', label: 'Customer', color: 'text-blue-600' },\n  { value: 'supplier', label: 'Supplier', color: 'text-orange-600' },\n  { value: 'both', label: 'Both', color: 'text-purple-600' },\n];\n\nconst currencies = [\n  { code: 'USD', name: 'US Dollar' },\n  { code: 'EUR', name: 'Euro' },\n  { code: 'GBP', name: 'British Pound' },\n  { code: 'AED', name: 'UAE Dirham' },\n  { code: 'SAR', name: 'Saudi Riyal' },\n];\n\nconst paymentTerms = [\n  { value: 0, label: 'Due on Receipt' },\n  { value: 7, label: 'Net 7' },\n  { value: 15, label: 'Net 15' },\n  { value: 30, label: 'Net 30' },\n  { value: 45, label: 'Net 45' },\n  { value: 60, label: 'Net 60' },\n  { value: 90, label: 'Net 90' },\n];\n\nexport default function ContactsPage() {\n  const isMobile = useIsMobile();\n  const { toast } = useToast();\n  const [showDialog, setShowDialog] = useState(false);\n  const [editingContact, setEditingContact] = useState<any>(null);\n  const [activeTab, setActiveTab] = useState('all');\n\n  // Fetch contacts\n  const { data: contacts = [], isLoading } = useQuery<any[]>({\n    queryKey: ['/api/contacts'],\n  });\n\n  // Create contact mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: ContactForm) => {\n      return await apiRequest('POST', '/api/contacts', {\n        ...data,\n        credit_limit: data.credit_limit ? parseFloat(data.credit_limit) : null,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/contacts'] });\n      setShowDialog(false);\n      toast({\n        title: 'Contact created',\n        description: 'New contact has been added successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to create contact',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Update contact mutation\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<ContactForm> }) => {\n      return await apiRequest('PUT', `/api/contacts/${id}`, {\n        ...data,\n        credit_limit: data.credit_limit ? parseFloat(data.credit_limit) : null,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/contacts'] });\n      setShowDialog(false);\n      setEditingContact(null);\n      toast({\n        title: 'Contact updated',\n        description: 'Contact information has been updated successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to update contact',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Delete contact mutation\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return await apiRequest('DELETE', `/api/contacts/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/contacts'] });\n      toast({\n        title: 'Contact deleted',\n        description: 'Contact has been removed successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to delete contact',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const form = useForm<ContactForm>({\n    resolver: zodResolver(contactSchema),\n    defaultValues: editingContact || {\n      type: 'customer',\n      code: '',\n      name: '',\n      display_name: '',\n      email: '',\n      phone: '',\n      website: '',\n      tax_number: '',\n      registration_number: '',\n      currency: 'USD',\n      payment_terms_days: 30,\n      credit_limit: '',\n      is_active: true,\n    },\n  });\n\n  const onSubmit = async (data: ContactForm) => {\n    if (editingContact) {\n      await updateMutation.mutateAsync({ id: editingContact.id, data });\n    } else {\n      await createMutation.mutateAsync(data);\n    }\n  };\n\n  const handleEdit = (contact: any) => {\n    setEditingContact(contact);\n    form.reset({\n      ...contact,\n      credit_limit: contact.credit_limit?.toString() || '',\n    });\n    setShowDialog(true);\n  };\n\n  const handleDelete = async (id: string) => {\n    if (confirm('Are you sure you want to delete this contact?')) {\n      await deleteMutation.mutateAsync(id);\n    }\n  };\n\n  // Filter contacts by type\n  const filteredContacts = contacts.filter((contact) => {\n    if (activeTab === 'all') return true;\n    if (activeTab === 'customers') return contact.type === 'customer' || contact.type === 'both';\n    if (activeTab === 'suppliers') return contact.type === 'supplier' || contact.type === 'both';\n    return true;\n  });\n\n  // Calculate statistics\n  const stats = {\n    total: contacts.length,\n    customers: contacts.filter(c => c.type === 'customer' || c.type === 'both').length,\n    suppliers: contacts.filter(c => c.type === 'supplier' || c.type === 'both').length,\n    active: contacts.filter(c => c.is_active).length,\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Contacts</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Manage your customers and suppliers\n          </p>\n        </div>\n        <Dialog open={showDialog} onOpenChange={(open) => {\n          setShowDialog(open);\n          if (!open) {\n            setEditingContact(null);\n            form.reset();\n          }\n        }}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-add-contact\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Contact\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>\n                {editingContact ? 'Edit Contact' : 'Create New Contact'}\n              </DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                {/* Basic Information */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-sm font-medium text-muted-foreground\">Basic Information</h3>\n                  \n                  <FormField\n                    control={form.control}\n                    name=\"type\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Contact Type *</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-contact-type\">\n                              <SelectValue placeholder=\"Select type\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {contactTypes.map((type) => (\n                              <SelectItem key={type.value} value={type.value}>\n                                <span className={type.color}>{type.label}</span>\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"code\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Contact Code</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"CUST001\" data-testid=\"input-contact-code\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"name\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Name *</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Company Name\" data-testid=\"input-contact-name\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <FormField\n                    control={form.control}\n                    name=\"display_name\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Display Name</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Display name for invoices\" data-testid=\"input-display-name\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                {/* Contact Information */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-sm font-medium text-muted-foreground\">Contact Information</h3>\n                  \n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"email\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Email</FormLabel>\n                          <FormControl>\n                            <Input type=\"email\" placeholder=\"contact@example.com\" data-testid=\"input-email\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"phone\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Phone</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"+1 234 567 8900\" data-testid=\"input-phone\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <FormField\n                    control={form.control}\n                    name=\"website\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Website</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"https://example.com\" data-testid=\"input-website\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                {/* Tax & Registration */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-sm font-medium text-muted-foreground\">Tax & Registration</h3>\n                  \n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"tax_number\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Tax Number</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"123456789\" data-testid=\"input-tax-number\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"registration_number\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Registration Number</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"REG-2024-001\" data-testid=\"input-registration\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                </div>\n\n                {/* Payment Settings */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-sm font-medium text-muted-foreground\">Payment Settings</h3>\n                  \n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"currency\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Currency</FormLabel>\n                          <Select onValueChange={field.onChange} defaultValue={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-currency\">\n                                <SelectValue placeholder=\"Select currency\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {currencies.map((currency) => (\n                                <SelectItem key={currency.code} value={currency.code}>\n                                  {currency.code} - {currency.name}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"payment_terms_days\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Payment Terms</FormLabel>\n                          <Select \n                            onValueChange={(value) => field.onChange(parseInt(value))} \n                            defaultValue={field.value?.toString()}\n                          >\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-payment-terms\">\n                                <SelectValue placeholder=\"Select terms\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {paymentTerms.map((term) => (\n                                <SelectItem key={term.value} value={term.value.toString()}>\n                                  {term.label}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <FormField\n                    control={form.control}\n                    name=\"credit_limit\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Credit Limit</FormLabel>\n                        <FormControl>\n                          <Input \n                            type=\"number\" \n                            step=\"0.01\"\n                            placeholder=\"10000.00\" \n                            data-testid=\"input-credit-limit\" \n                            {...field} \n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"is_active\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex items-center justify-between rounded-lg border p-3\">\n                      <div className=\"space-y-0.5\">\n                        <FormLabel>Active Contact</FormLabel>\n                        <div className=\"text-sm text-muted-foreground\">\n                          Active contacts can be used in transactions\n                        </div>\n                      </div>\n                      <FormControl>\n                        <Switch\n                          checked={field.value}\n                          onCheckedChange={field.onChange}\n                          data-testid=\"switch-contact-active\"\n                        />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex justify-end gap-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setShowDialog(false)}\n                    data-testid=\"button-cancel\"\n                  >\n                    Cancel\n                  </Button>\n                  <Button \n                    type=\"submit\" \n                    disabled={createMutation.isPending || updateMutation.isPending}\n                    data-testid=\"button-save-contact\"\n                  >\n                    {editingContact ? 'Update' : 'Create'} Contact\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Statistics */}\n      <div className=\"grid gap-4 grid-cols-2 sm:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Contacts</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.total}</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Customers</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-blue-600\">{stats.customers}</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Suppliers</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-orange-600\">{stats.suppliers}</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Active</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">{stats.active}</div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Tabs for filtering */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList>\n          <TabsTrigger value=\"all\" data-testid=\"tab-all\">All Contacts</TabsTrigger>\n          <TabsTrigger value=\"customers\" data-testid=\"tab-customers\">Customers</TabsTrigger>\n          <TabsTrigger value=\"suppliers\" data-testid=\"tab-suppliers\">Suppliers</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value={activeTab} className=\"mt-4\">\n          {isLoading ? (\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"animate-pulse space-y-2\">\n                  <div className=\"h-4 bg-muted rounded w-3/4\"></div>\n                  <div className=\"h-4 bg-muted rounded w-1/2\"></div>\n                </div>\n              </CardContent>\n            </Card>\n          ) : filteredContacts.length === 0 ? (\n            <Card>\n              <CardContent className=\"p-6 text-center\">\n                <Users className=\"h-12 w-12 mx-auto text-muted-foreground mb-2\" />\n                <p className=\"text-muted-foreground\">No contacts found</p>\n                <p className=\"text-sm text-muted-foreground\">\n                  Start by adding your first contact\n                </p>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3\">\n              {filteredContacts.map((contact) => (\n                <Card key={contact.id} data-testid={`card-contact-${contact.id}`}>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center justify-between\">\n                      <span className=\"truncate\">{contact.name}</span>\n                      <div className=\"flex gap-1\">\n                        {(contact.type === 'customer' || contact.type === 'both') && (\n                          <Badge variant=\"secondary\" className=\"text-xs\">Customer</Badge>\n                        )}\n                        {(contact.type === 'supplier' || contact.type === 'both') && (\n                          <Badge variant=\"outline\" className=\"text-xs\">Supplier</Badge>\n                        )}\n                      </div>\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3\">\n                    {contact.code && (\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <Badge variant=\"outline\" className=\"font-mono\">{contact.code}</Badge>\n                      </div>\n                    )}\n                    \n                    {contact.email && (\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <Mail className=\"h-4 w-4 text-muted-foreground\" />\n                        <span className=\"truncate\">{contact.email}</span>\n                      </div>\n                    )}\n                    \n                    {contact.phone && (\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <Phone className=\"h-4 w-4 text-muted-foreground\" />\n                        <span>{contact.phone}</span>\n                      </div>\n                    )}\n                    \n                    <div className=\"flex items-center gap-4 text-sm\">\n                      <div className=\"flex items-center gap-1\">\n                        <CreditCard className=\"h-4 w-4 text-muted-foreground\" />\n                        <span>{contact.currency}</span>\n                      </div>\n                      <div className=\"flex items-center gap-1\">\n                        <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                        <span>Net {contact.payment_terms_days}</span>\n                      </div>\n                    </div>\n                    \n                    {!contact.is_active && (\n                      <Badge variant=\"secondary\" className=\"text-xs\">Inactive</Badge>\n                    )}\n                    \n                    <div className=\"flex gap-2 pt-2\">\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => handleEdit(contact)}\n                        data-testid={`button-edit-${contact.id}`}\n                      >\n                        <Edit className=\"h-3 w-3 mr-1\" />\n                        Edit\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => handleDelete(contact.id)}\n                        data-testid={`button-delete-${contact.id}`}\n                      >\n                        <Trash2 className=\"h-3 w-3 mr-1\" />\n                        Delete\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":26167},"client/src/pages/ItemsPage.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { useIsMobile } from '@/hooks/use-mobile';\nimport { queryClient, apiRequest } from '@/lib/queryClient';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage, FormDescription } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Switch } from '@/components/ui/switch';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { Package, Plus, Edit, Trash2, Barcode, DollarSign, Tag, Archive, ShoppingCart, TrendingUp } from 'lucide-react';\nimport { z } from 'zod';\nimport { useToast } from '@/hooks/use-toast';\n\n// Item form schema\nconst itemSchema = z.object({\n  type: z.enum(['product', 'service']),\n  code: z.string().min(1, 'Item code is required'),\n  name: z.string().min(2, 'Item name must be at least 2 characters'),\n  description: z.string().optional(),\n  unit: z.string().default('piece'),\n  category: z.string().optional(),\n  barcode: z.string().optional(),\n  is_active: z.boolean(),\n  is_sellable: z.boolean(),\n  is_purchasable: z.boolean(),\n  sale_price: z.string().optional(),\n  purchase_price: z.string().optional(),\n  track_inventory: z.boolean(),\n  stock_quantity: z.string().optional(),\n  minimum_stock: z.string().optional(),\n  reorder_level: z.string().optional(),\n  sales_account_id: z.string().optional(),\n  purchase_account_id: z.string().optional(),\n  inventory_account_id: z.string().optional(),\n  default_tax_id: z.string().optional(),\n});\n\ntype ItemForm = z.infer<typeof itemSchema>;\n\nconst units = [\n  { value: 'piece', label: 'Piece' },\n  { value: 'kg', label: 'Kilogram' },\n  { value: 'liter', label: 'Liter' },\n  { value: 'meter', label: 'Meter' },\n  { value: 'hour', label: 'Hour' },\n  { value: 'day', label: 'Day' },\n  { value: 'box', label: 'Box' },\n  { value: 'pack', label: 'Pack' },\n  { value: 'dozen', label: 'Dozen' },\n];\n\nconst categories = [\n  { value: 'electronics', label: 'Electronics' },\n  { value: 'furniture', label: 'Furniture' },\n  { value: 'clothing', label: 'Clothing' },\n  { value: 'food', label: 'Food & Beverages' },\n  { value: 'stationery', label: 'Stationery' },\n  { value: 'services', label: 'Services' },\n  { value: 'consulting', label: 'Consulting' },\n  { value: 'maintenance', label: 'Maintenance' },\n  { value: 'other', label: 'Other' },\n];\n\nexport default function ItemsPage() {\n  const isMobile = useIsMobile();\n  const { toast } = useToast();\n  const [showDialog, setShowDialog] = useState(false);\n  const [editingItem, setEditingItem] = useState<any>(null);\n  const [activeTab, setActiveTab] = useState('all');\n  const [selectedType, setSelectedType] = useState<'product' | 'service'>('product');\n\n  // Fetch items\n  const { data: items = [], isLoading } = useQuery<any[]>({\n    queryKey: ['/api/items'],\n  });\n\n  // Fetch accounts for dropdowns\n  const { data: accounts = [] } = useQuery<any[]>({\n    queryKey: ['/api/accounts'],\n  });\n\n  // Fetch taxes for dropdown\n  const { data: taxes = [] } = useQuery<any[]>({\n    queryKey: ['/api/taxes'],\n  });\n\n  // Create item mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: ItemForm) => {\n      const processedData = {\n        ...data,\n        sale_price: data.sale_price ? parseFloat(data.sale_price) : null,\n        purchase_price: data.purchase_price ? parseFloat(data.purchase_price) : null,\n        stock_quantity: data.stock_quantity ? parseFloat(data.stock_quantity) : null,\n        minimum_stock: data.minimum_stock ? parseFloat(data.minimum_stock) : null,\n        reorder_level: data.reorder_level ? parseFloat(data.reorder_level) : null,\n      };\n      return await apiRequest('POST', '/api/items', processedData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/items'] });\n      setShowDialog(false);\n      toast({\n        title: 'Item created',\n        description: 'New item has been added successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to create item',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Update item mutation\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<ItemForm> }) => {\n      const processedData = {\n        ...data,\n        sale_price: data.sale_price ? parseFloat(data.sale_price) : null,\n        purchase_price: data.purchase_price ? parseFloat(data.purchase_price) : null,\n        stock_quantity: data.stock_quantity ? parseFloat(data.stock_quantity) : null,\n        minimum_stock: data.minimum_stock ? parseFloat(data.minimum_stock) : null,\n        reorder_level: data.reorder_level ? parseFloat(data.reorder_level) : null,\n      };\n      return await apiRequest('PUT', `/api/items/${id}`, processedData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/items'] });\n      setShowDialog(false);\n      setEditingItem(null);\n      toast({\n        title: 'Item updated',\n        description: 'Item information has been updated successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to update item',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Delete item mutation\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return await apiRequest('DELETE', `/api/items/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/items'] });\n      toast({\n        title: 'Item deleted',\n        description: 'Item has been removed successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to delete item',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const form = useForm<ItemForm>({\n    resolver: zodResolver(itemSchema),\n    defaultValues: editingItem || {\n      type: 'product',\n      code: '',\n      name: '',\n      description: '',\n      unit: 'piece',\n      category: '',\n      barcode: '',\n      is_active: true,\n      is_sellable: true,\n      is_purchasable: true,\n      sale_price: '',\n      purchase_price: '',\n      track_inventory: false,\n      stock_quantity: '',\n      minimum_stock: '',\n      reorder_level: '',\n      sales_account_id: '',\n      purchase_account_id: '',\n      inventory_account_id: '',\n      default_tax_id: '',\n    },\n  });\n\n  const onSubmit = async (data: ItemForm) => {\n    if (editingItem) {\n      await updateMutation.mutateAsync({ id: editingItem.id, data });\n    } else {\n      await createMutation.mutateAsync(data);\n    }\n  };\n\n  const handleEdit = (item: any) => {\n    setEditingItem(item);\n    form.reset({\n      ...item,\n      sale_price: item.sale_price?.toString() || '',\n      purchase_price: item.purchase_price?.toString() || '',\n      stock_quantity: item.stock_quantity?.toString() || '',\n      minimum_stock: item.minimum_stock?.toString() || '',\n      reorder_level: item.reorder_level?.toString() || '',\n    });\n    setSelectedType(item.type);\n    setShowDialog(true);\n  };\n\n  const handleDelete = async (id: string) => {\n    if (confirm('Are you sure you want to delete this item?')) {\n      await deleteMutation.mutateAsync(id);\n    }\n  };\n\n  // Filter items by tab\n  const filteredItems = items.filter((item) => {\n    if (activeTab === 'all') return true;\n    if (activeTab === 'products') return item.type === 'product';\n    if (activeTab === 'services') return item.type === 'service';\n    if (activeTab === 'low-stock') return item.track_inventory && item.stock_quantity <= item.reorder_level;\n    return true;\n  });\n\n  // Calculate statistics\n  const stats = {\n    total: items.length,\n    products: items.filter(i => i.type === 'product').length,\n    services: items.filter(i => i.type === 'service').length,\n    lowStock: items.filter(i => i.track_inventory && i.stock_quantity <= i.reorder_level).length,\n  };\n\n  // Group accounts by type for selection\n  const salesAccounts = accounts.filter(a => a.account_type === 'revenue');\n  const purchaseAccounts = accounts.filter(a => a.account_type === 'expense');\n  const inventoryAccounts = accounts.filter(a => a.account_type === 'asset' && a.account_subtype === 'inventory');\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Items & Services</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Manage your products and services catalog\n          </p>\n        </div>\n        <Dialog open={showDialog} onOpenChange={(open) => {\n          setShowDialog(open);\n          if (!open) {\n            setEditingItem(null);\n            form.reset();\n          }\n        }}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-add-item\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Item\n            </Button>\n          </DialogTrigger>\n          <DialogContent className={`max-w-4xl max-h-[90vh] overflow-y-auto ${isMobile ? 'w-full max-w-full mx-4' : ''}`}>\n            <DialogHeader>\n              <DialogTitle>\n                {editingItem ? 'Edit Item' : 'Create New Item'}\n              </DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                {/* Type Selection */}\n                <FormField\n                  control={form.control}\n                  name=\"type\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Item Type *</FormLabel>\n                      <Select \n                        onValueChange={(value) => {\n                          field.onChange(value);\n                          setSelectedType(value as 'product' | 'service');\n                        }} \n                        defaultValue={field.value}\n                      >\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-item-type\">\n                            <SelectValue placeholder=\"Select type\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"product\">Product</SelectItem>\n                          <SelectItem value=\"service\">Service</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Basic Information */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-sm font-medium text-muted-foreground\">Basic Information</h3>\n                  \n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"code\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Item Code *</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"ITEM001\" data-testid=\"input-item-code\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"name\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Item Name *</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Product or Service Name\" data-testid=\"input-item-name\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <FormField\n                    control={form.control}\n                    name=\"description\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Description</FormLabel>\n                        <FormControl>\n                          <Textarea \n                            placeholder=\"Detailed description of the item\" \n                            data-testid=\"input-item-description\" \n                            {...field} \n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"unit\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Unit of Measure</FormLabel>\n                          <Select onValueChange={field.onChange} defaultValue={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-unit\">\n                                <SelectValue placeholder=\"Select unit\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {units.map((unit) => (\n                                <SelectItem key={unit.value} value={unit.value}>\n                                  {unit.label}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"category\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Category</FormLabel>\n                          <Select onValueChange={field.onChange} value={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-category\">\n                                <SelectValue placeholder=\"Select category\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {categories.map((category) => (\n                                <SelectItem key={category.value} value={category.value}>\n                                  {category.label}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"barcode\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Barcode</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"1234567890\" data-testid=\"input-barcode\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                </div>\n\n                {/* Sales & Purchase */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-sm font-medium text-muted-foreground\">Sales & Purchase</h3>\n                  \n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"is_sellable\"\n                      render={({ field }) => (\n                        <FormItem className=\"flex items-center justify-between rounded-lg border p-3\">\n                          <div className=\"space-y-0.5\">\n                            <FormLabel>Can be Sold</FormLabel>\n                            <FormDescription className=\"text-xs\">\n                              Enable to sell this item to customers\n                            </FormDescription>\n                          </div>\n                          <FormControl>\n                            <Switch\n                              checked={field.value}\n                              onCheckedChange={field.onChange}\n                              data-testid=\"switch-sellable\"\n                            />\n                          </FormControl>\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"is_purchasable\"\n                      render={({ field }) => (\n                        <FormItem className=\"flex items-center justify-between rounded-lg border p-3\">\n                          <div className=\"space-y-0.5\">\n                            <FormLabel>Can be Purchased</FormLabel>\n                            <FormDescription className=\"text-xs\">\n                              Enable to purchase this item from suppliers\n                            </FormDescription>\n                          </div>\n                          <FormControl>\n                            <Switch\n                              checked={field.value}\n                              onCheckedChange={field.onChange}\n                              data-testid=\"switch-purchasable\"\n                            />\n                          </FormControl>\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"sale_price\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Sale Price</FormLabel>\n                          <FormControl>\n                            <Input \n                              type=\"number\" \n                              step=\"0.01\"\n                              placeholder=\"100.00\" \n                              data-testid=\"input-sale-price\" \n                              {...field} \n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"purchase_price\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Purchase Price</FormLabel>\n                          <FormControl>\n                            <Input \n                              type=\"number\" \n                              step=\"0.01\"\n                              placeholder=\"80.00\" \n                              data-testid=\"input-purchase-price\" \n                              {...field} \n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                </div>\n\n                {/* Inventory (only for products) */}\n                {selectedType === 'product' && (\n                  <div className=\"space-y-4\">\n                    <h3 className=\"text-sm font-medium text-muted-foreground\">Inventory</h3>\n                    \n                    <FormField\n                      control={form.control}\n                      name=\"track_inventory\"\n                      render={({ field }) => (\n                        <FormItem className=\"flex items-center justify-between rounded-lg border p-3\">\n                          <div className=\"space-y-0.5\">\n                            <FormLabel>Track Inventory</FormLabel>\n                            <FormDescription className=\"text-xs\">\n                              Monitor stock levels for this product\n                            </FormDescription>\n                          </div>\n                          <FormControl>\n                            <Switch\n                              checked={field.value}\n                              onCheckedChange={field.onChange}\n                              data-testid=\"switch-track-inventory\"\n                            />\n                          </FormControl>\n                        </FormItem>\n                      )}\n                    />\n\n                    {form.watch('track_inventory') && (\n                      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n                        <FormField\n                          control={form.control}\n                          name=\"stock_quantity\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Current Stock</FormLabel>\n                              <FormControl>\n                                <Input \n                                  type=\"number\" \n                                  step=\"0.01\"\n                                  placeholder=\"100\" \n                                  data-testid=\"input-stock-quantity\" \n                                  {...field} \n                                />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                        <FormField\n                          control={form.control}\n                          name=\"minimum_stock\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Minimum Stock</FormLabel>\n                              <FormControl>\n                                <Input \n                                  type=\"number\" \n                                  step=\"0.01\"\n                                  placeholder=\"10\" \n                                  data-testid=\"input-minimum-stock\" \n                                  {...field} \n                                />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                        <FormField\n                          control={form.control}\n                          name=\"reorder_level\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Reorder Level</FormLabel>\n                              <FormControl>\n                                <Input \n                                  type=\"number\" \n                                  step=\"0.01\"\n                                  placeholder=\"20\" \n                                  data-testid=\"input-reorder-level\" \n                                  {...field} \n                                />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                      </div>\n                    )}\n                  </div>\n                )}\n\n                {/* Accounting */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-sm font-medium text-muted-foreground\">Accounting</h3>\n                  \n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"sales_account_id\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Sales Account</FormLabel>\n                          <Select onValueChange={field.onChange} value={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-sales-account\">\n                                <SelectValue placeholder=\"Select account\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {salesAccounts.map((account) => (\n                                <SelectItem key={account.id} value={account.id}>\n                                  {account.code} - {account.name}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"purchase_account_id\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Purchase Account</FormLabel>\n                          <Select onValueChange={field.onChange} value={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-purchase-account\">\n                                <SelectValue placeholder=\"Select account\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {purchaseAccounts.map((account) => (\n                                <SelectItem key={account.id} value={account.id}>\n                                  {account.code} - {account.name}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  {selectedType === 'product' && (\n                    <FormField\n                      control={form.control}\n                      name=\"inventory_account_id\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Inventory Account</FormLabel>\n                          <Select onValueChange={field.onChange} value={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-inventory-account\">\n                                <SelectValue placeholder=\"Select account\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {inventoryAccounts.map((account) => (\n                                <SelectItem key={account.id} value={account.id}>\n                                  {account.code} - {account.name}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  )}\n\n                  <FormField\n                    control={form.control}\n                    name=\"default_tax_id\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Default Tax</FormLabel>\n                        <Select onValueChange={field.onChange} value={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-default-tax\">\n                              <SelectValue placeholder=\"Select tax\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value=\"none\">No Tax</SelectItem>\n                            {taxes.map((tax) => (\n                              <SelectItem key={tax.id} value={tax.id}>\n                                {tax.name} ({tax.rate}%)\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"is_active\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex items-center justify-between rounded-lg border p-3\">\n                      <div className=\"space-y-0.5\">\n                        <FormLabel>Active Item</FormLabel>\n                        <FormDescription>\n                          Active items can be used in transactions\n                        </FormDescription>\n                      </div>\n                      <FormControl>\n                        <Switch\n                          checked={field.value}\n                          onCheckedChange={field.onChange}\n                          data-testid=\"switch-item-active\"\n                        />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n\n                <div className={`flex gap-2 ${isMobile ? 'flex-col' : 'justify-end'}`}>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setShowDialog(false)}\n                    data-testid=\"button-cancel\"\n                  >\n                    Cancel\n                  </Button>\n                  <Button \n                    type=\"submit\" \n                    disabled={createMutation.isPending || updateMutation.isPending}\n                    data-testid=\"button-save-item\"\n                  >\n                    {editingItem ? 'Update' : 'Create'} Item\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Statistics */}\n      <div className=\"grid gap-4 md:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n              <Package className=\"h-4 w-4\" />\n              Total Items\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.total}</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n              <Archive className=\"h-4 w-4 text-blue-600\" />\n              Products\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.products}</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n              <ShoppingCart className=\"h-4 w-4 text-green-600\" />\n              Services\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.services}</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n              <TrendingUp className=\"h-4 w-4 text-orange-600\" />\n              Low Stock\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.lowStock}</div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Tabs for filtering */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList>\n          <TabsTrigger value=\"all\" data-testid=\"tab-all\">All Items</TabsTrigger>\n          <TabsTrigger value=\"products\" data-testid=\"tab-products\">Products</TabsTrigger>\n          <TabsTrigger value=\"services\" data-testid=\"tab-services\">Services</TabsTrigger>\n          <TabsTrigger value=\"low-stock\" data-testid=\"tab-low-stock\">Low Stock</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value={activeTab} className=\"mt-4\">\n          {isLoading ? (\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"animate-pulse space-y-2\">\n                  <div className=\"h-4 bg-muted rounded w-3/4\"></div>\n                  <div className=\"h-4 bg-muted rounded w-1/2\"></div>\n                </div>\n              </CardContent>\n            </Card>\n          ) : filteredItems.length === 0 ? (\n            <Card>\n              <CardContent className=\"p-6 text-center\">\n                <Package className=\"h-12 w-12 mx-auto text-muted-foreground mb-2\" />\n                <p className=\"text-muted-foreground\">No items found</p>\n                <p className=\"text-sm text-muted-foreground\">\n                  Start by adding your products or services\n                </p>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"grid gap-4\">\n              {filteredItems.map((item) => (\n                <Card key={item.id} data-testid={`card-item-${item.id}`}>\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1 space-y-3\">\n                        <div className=\"flex items-start justify-between\">\n                          <div>\n                            <div className=\"flex items-center gap-2\">\n                              <Badge variant=\"outline\" className=\"font-mono\">\n                                {item.code}\n                              </Badge>\n                              <h3 className=\"font-semibold\">{item.name}</h3>\n                              <Badge variant={item.type === 'product' ? 'default' : 'secondary'}>\n                                {item.type}\n                              </Badge>\n                              {!item.is_active && (\n                                <Badge variant=\"secondary\">Inactive</Badge>\n                              )}\n                            </div>\n                            {item.description && (\n                              <p className=\"text-sm text-muted-foreground mt-1\">\n                                {item.description}\n                              </p>\n                            )}\n                          </div>\n                        </div>\n\n                        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\n                          {item.barcode && (\n                            <div className=\"flex items-center gap-1\">\n                              <Barcode className=\"h-4 w-4 text-muted-foreground\" />\n                              <span>{item.barcode}</span>\n                            </div>\n                          )}\n                          \n                          {item.sale_price !== null && (\n                            <div className=\"flex items-center gap-1\">\n                              <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n                              <span>Sale: {item.sale_price}</span>\n                            </div>\n                          )}\n                          \n                          {item.purchase_price !== null && (\n                            <div className=\"flex items-center gap-1\">\n                              <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n                              <span>Cost: {item.purchase_price}</span>\n                            </div>\n                          )}\n                          \n                          {item.track_inventory && (\n                            <div className=\"flex items-center gap-1\">\n                              <Package className=\"h-4 w-4 text-muted-foreground\" />\n                              <span>Stock: {item.stock_quantity} {item.unit}</span>\n                            </div>\n                          )}\n                        </div>\n\n                        <div className=\"flex items-center gap-2\">\n                          {item.category && (\n                            <Badge variant=\"outline\">{item.category}</Badge>\n                          )}\n                          {item.is_sellable && (\n                            <Badge variant=\"outline\" className=\"text-xs\">Sellable</Badge>\n                          )}\n                          {item.is_purchasable && (\n                            <Badge variant=\"outline\" className=\"text-xs\">Purchasable</Badge>\n                          )}\n                          {item.track_inventory && item.stock_quantity <= item.reorder_level && (\n                            <Badge variant=\"destructive\" className=\"text-xs\">Low Stock</Badge>\n                          )}\n                        </div>\n                      </div>\n\n                      <div className=\"flex gap-2\">\n                        <Button\n                          size=\"sm\"\n                          variant=\"ghost\"\n                          onClick={() => handleEdit(item)}\n                          data-testid={`button-edit-${item.id}`}\n                        >\n                          <Edit className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          size=\"sm\"\n                          variant=\"ghost\"\n                          onClick={() => handleDelete(item.id)}\n                          data-testid={`button-delete-${item.id}`}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":39399},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/examples/AppSidebar.tsx":{"content":"import { AppSidebar } from '../AppSidebar';\nimport { SidebarProvider } from '@/components/ui/sidebar';\n\nexport default function AppSidebarExample() {\n  const style = {\n    \"--sidebar-width\": \"20rem\",\n    \"--sidebar-width-icon\": \"4rem\",\n  };\n\n  return (\n    <SidebarProvider style={style as React.CSSProperties}>\n      <div className=\"flex h-96 w-full border rounded-lg overflow-hidden\">\n        <AppSidebar />\n        <div className=\"flex-1 p-4 bg-background\">\n          <h3 className=\"font-semibold mb-2\">App Sidebar</h3>\n          <p className=\"text-muted-foreground text-sm\">\n            Collapsible sidebar with company switcher, navigation menu, and sync status\n          </p>\n        </div>\n      </div>\n    </SidebarProvider>\n  );\n}\n","size_bytes":740},"client/src/components/examples/Dashboard.tsx":{"content":"import { Dashboard } from '../Dashboard';\n\nexport default function DashboardExample() {\n  return (\n    <div className=\"p-4 space-y-4\">\n      <Dashboard />\n    </div>\n  );\n}\n","size_bytes":173},"client/src/components/examples/InvoiceForm.tsx":{"content":"import { InvoiceForm } from '../InvoiceForm';\n\nexport default function InvoiceFormExample() {\n  return (\n    <div className=\"p-4 space-y-4\">\n      <InvoiceForm />\n    </div>\n  );\n}\n","size_bytes":181},"client/src/components/examples/LanguageToggle.tsx":{"content":"import { LanguageToggle } from '../LanguageToggle';\n\nexport default function LanguageToggleExample() {\n  return (\n    <div className=\"p-4 rounded-lg bg-background border\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"font-semibold mb-2\">Language Toggle</h3>\n          <p className=\"text-muted-foreground text-sm\">\n            Switch between 15 supported languages with RTL support\n          </p>\n        </div>\n        <LanguageToggle />\n      </div>\n    </div>\n  );\n}\n","size_bytes":521},"client/src/components/examples/TaxConfiguration.tsx":{"content":"import { TaxConfiguration } from '../TaxConfiguration';\n\nexport default function TaxConfigurationExample() {\n  return (\n    <div className=\"p-4 space-y-4\">\n      <TaxConfiguration />\n    </div>\n  );\n}\n","size_bytes":201},"client/src/components/examples/ThemeProvider.tsx":{"content":"import { ThemeProvider } from '../ThemeProvider';\n\nexport default function ThemeProviderExample() {\n  return (\n    <ThemeProvider>\n      <div className=\"p-4 rounded-lg bg-background border\">\n        <h3 className=\"font-semibold mb-2\">Theme Provider</h3>\n        <p className=\"text-muted-foreground text-sm\">\n          Manages light/dark theme state with system preference detection\n        </p>\n      </div>\n    </ThemeProvider>\n  );\n}\n","size_bytes":436},"client/src/components/examples/ThemeToggle.tsx":{"content":"import { ThemeToggle } from '../ThemeToggle';\nimport { ThemeProvider } from '../ThemeProvider';\n\nexport default function ThemeToggleExample() {\n  return (\n    <ThemeProvider>\n      <div className=\"p-4 rounded-lg bg-background border\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h3 className=\"font-semibold mb-2\">Theme Toggle</h3>\n            <p className=\"text-muted-foreground text-sm\">\n              Switch between light, dark, and system themes\n            </p>\n          </div>\n          <ThemeToggle />\n        </div>\n      </div>\n    </ThemeProvider>\n  );\n}\n","size_bytes":610},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1592},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1202},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":2359},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","size_bytes":1904},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":844},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5741},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":21846},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/pages/banking/AccountsPage.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { queryClient, apiRequest } from '@/lib/queryClient';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Switch } from '@/components/ui/switch';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { \n  Wallet, \n  Plus, \n  Edit, \n  Trash2, \n  CreditCard, \n  Building2, \n  DollarSign,\n  TrendingUp,\n  TrendingDown,\n  ArrowUpRight,\n  ArrowDownRight,\n  AlertCircle,\n  CheckCircle\n} from 'lucide-react';\nimport { z } from 'zod';\nimport { useToast } from '@/hooks/use-toast';\nimport { useIsMobile } from '@/hooks/use-mobile';\n\n// Bank account form schema with proper type coercion\nconst bankAccountSchema = z.object({\n  name: z.string().min(2, 'Account name must be at least 2 characters'),\n  account_number: z.string().min(5, 'Account number is required'),\n  bank_name: z.string().min(2, 'Bank name is required'),\n  branch: z.string().optional(),\n  swift_code: z.string().optional(),\n  iban: z.string().optional(),\n  currency: z.string().default('USD'),\n  account_type: z.enum(['checking', 'savings', 'credit_card', 'cash', 'investment']),\n  opening_balance: z.preprocess(\n    (val) => val === '' || val === undefined ? undefined : Number(val),\n    z.number().optional()\n  ),\n  current_balance: z.preprocess(\n    (val) => val === '' || val === undefined ? undefined : Number(val),\n    z.number().optional()\n  ),\n  is_active: z.boolean(),\n  is_default: z.boolean(),\n});\n\ntype BankAccountForm = z.infer<typeof bankAccountSchema>;\n\nconst accountTypes = [\n  { value: 'checking', label: 'Checking Account', icon: Wallet },\n  { value: 'savings', label: 'Savings Account', icon: DollarSign },\n  { value: 'credit_card', label: 'Credit Card', icon: CreditCard },\n  { value: 'cash', label: 'Cash', icon: DollarSign },\n  { value: 'investment', label: 'Investment', icon: TrendingUp },\n];\n\n// Comprehensive global currency list with symbols\nconst currencies = [\n  // Major World Currencies\n  { code: 'USD', name: 'US Dollar', symbol: '$' },\n  { code: 'EUR', name: 'Euro', symbol: 'â‚¬' },\n  { code: 'GBP', name: 'British Pound', symbol: 'Â£' },\n  { code: 'JPY', name: 'Japanese Yen', symbol: 'Â¥' },\n  { code: 'CHF', name: 'Swiss Franc', symbol: 'CHF' },\n  { code: 'CAD', name: 'Canadian Dollar', symbol: 'C$' },\n  { code: 'AUD', name: 'Australian Dollar', symbol: 'A$' },\n  { code: 'NZD', name: 'New Zealand Dollar', symbol: 'NZ$' },\n  \n  // Arabic & Middle Eastern Currencies\n  { code: 'AED', name: 'UAE Dirham', symbol: 'Ø¯.Ø¥' },\n  { code: 'SAR', name: 'Saudi Riyal', symbol: 'Ø±.Ø³' },\n  { code: 'EGP', name: 'Egyptian Pound', symbol: 'Ø¬.Ù…' },\n  { code: 'SYP', name: 'Syrian Pound', symbol: 'Ù„.Ø³' }, // Syria - specifically requested\n  { code: 'LBP', name: 'Lebanese Pound', symbol: 'Ù„.Ù„' }, // Lebanon\n  { code: 'IQD', name: 'Iraqi Dinar', symbol: 'Ø¹.Ø¯' }, // Iraq\n  { code: 'JOD', name: 'Jordanian Dinar', symbol: 'Ø¯.Ø§' }, // Jordan\n  { code: 'KWD', name: 'Kuwaiti Dinar', symbol: 'Ø¯.Ùƒ' }, // Kuwait\n  { code: 'QAR', name: 'Qatari Riyal', symbol: 'Ø±.Ù‚' }, // Qatar\n  { code: 'BHD', name: 'Bahraini Dinar', symbol: 'Ø¯.Ø¨' }, // Bahrain\n  { code: 'OMR', name: 'Omani Rial', symbol: 'Ø±.Ø¹' }, // Oman\n  { code: 'YER', name: 'Yemeni Rial', symbol: 'Ø±.ÙŠ' }, // Yemen\n  { code: 'MAD', name: 'Moroccan Dirham', symbol: 'Ø¯.Ù…' }, // Morocco\n  { code: 'DZD', name: 'Algerian Dinar', symbol: 'Ø¯.Ø¬' }, // Algeria\n  { code: 'TND', name: 'Tunisian Dinar', symbol: 'Ø¯.Øª' }, // Tunisia\n  { code: 'LYD', name: 'Libyan Dinar', symbol: 'Ù„.Ø¯' }, // Libya\n  { code: 'SDG', name: 'Sudanese Pound', symbol: 'Ø¬.Ø³' }, // Sudan\n  { code: 'ILS', name: 'Israeli Shekel', symbol: 'â‚ª' }, // Israel\n  { code: 'IRR', name: 'Iranian Rial', symbol: 'Ø±' }, // Iran\n  { code: 'TRY', name: 'Turkish Lira', symbol: 'â‚º' }, // Turkey\n  \n  // Asian Currencies\n  { code: 'PHP', name: 'Philippine Peso', symbol: 'â‚±' }, // Philippines - specifically requested\n  { code: 'CNY', name: 'Chinese Yuan', symbol: 'Â¥' }, // China\n  { code: 'KRW', name: 'South Korean Won', symbol: 'â‚©' }, // South Korea\n  { code: 'INR', name: 'Indian Rupee', symbol: 'â‚¹' }, // India\n  { code: 'IDR', name: 'Indonesian Rupiah', symbol: 'Rp' }, // Indonesia\n  { code: 'THB', name: 'Thai Baht', symbol: 'à¸¿' }, // Thailand\n  { code: 'MYR', name: 'Malaysian Ringgit', symbol: 'RM' }, // Malaysia\n  { code: 'SGD', name: 'Singapore Dollar', symbol: 'S$' }, // Singapore\n  { code: 'VND', name: 'Vietnamese Dong', symbol: 'â‚«' }, // Vietnam\n  { code: 'BDT', name: 'Bangladeshi Taka', symbol: 'à§³' }, // Bangladesh\n  { code: 'PKR', name: 'Pakistani Rupee', symbol: 'Rs' }, // Pakistan\n  { code: 'LKR', name: 'Sri Lankan Rupee', symbol: 'Rs' }, // Sri Lanka\n  { code: 'MMK', name: 'Myanmar Kyat', symbol: 'K' }, // Myanmar\n  { code: 'KHR', name: 'Cambodian Riel', symbol: 'áŸ›' }, // Cambodia\n  { code: 'LAK', name: 'Lao Kip', symbol: 'â‚­' }, // Laos\n  { code: 'NPR', name: 'Nepalese Rupee', symbol: 'Rs' }, // Nepal\n  { code: 'BTN', name: 'Bhutanese Ngultrum', symbol: 'Nu' }, // Bhutan\n  { code: 'MNT', name: 'Mongolian Tugrik', symbol: 'â‚®' }, // Mongolia\n  { code: 'KZT', name: 'Kazakhstani Tenge', symbol: 'â‚¸' }, // Kazakhstan\n  { code: 'UZS', name: 'Uzbekistani Som', symbol: 'Ð»Ð²' }, // Uzbekistan\n  { code: 'TJS', name: 'Tajikistani Somoni', symbol: 'Ð…Ðœ' }, // Tajikistan\n  { code: 'KGS', name: 'Kyrgyzstani Som', symbol: 'Ð»Ð²' }, // Kyrgyzstan\n  { code: 'TMT', name: 'Turkmenistan Manat', symbol: 'T' }, // Turkmenistan\n  { code: 'AFN', name: 'Afghan Afghani', symbol: 'Ø‹' }, // Afghanistan\n  \n  // European Currencies\n  { code: 'NOK', name: 'Norwegian Krone', symbol: 'kr' }, // Norway\n  { code: 'SEK', name: 'Swedish Krona', symbol: 'kr' }, // Sweden\n  { code: 'DKK', name: 'Danish Krone', symbol: 'kr' }, // Denmark\n  { code: 'ISK', name: 'Icelandic Krona', symbol: 'kr' }, // Iceland\n  { code: 'PLN', name: 'Polish Zloty', symbol: 'zÅ‚' }, // Poland\n  { code: 'CZK', name: 'Czech Koruna', symbol: 'KÄ' }, // Czech Republic\n  { code: 'HUF', name: 'Hungarian Forint', symbol: 'Ft' }, // Hungary\n  { code: 'RON', name: 'Romanian Leu', symbol: 'lei' }, // Romania\n  { code: 'BGN', name: 'Bulgarian Lev', symbol: 'Ð»Ð²' }, // Bulgaria\n  { code: 'HRK', name: 'Croatian Kuna', symbol: 'kn' }, // Croatia\n  { code: 'RSD', name: 'Serbian Dinar', symbol: 'Ð´Ð¸Ð½' }, // Serbia\n  { code: 'BAM', name: 'Bosnia-Herzegovina Mark', symbol: 'KM' }, // Bosnia\n  { code: 'MKD', name: 'Macedonian Denar', symbol: 'Ð´ÐµÐ½' }, // North Macedonia\n  { code: 'ALL', name: 'Albanian Lek', symbol: 'L' }, // Albania\n  { code: 'MDL', name: 'Moldovan Leu', symbol: 'L' }, // Moldova\n  { code: 'UAH', name: 'Ukrainian Hryvnia', symbol: 'â‚´' }, // Ukraine\n  { code: 'BYN', name: 'Belarusian Ruble', symbol: 'Br' }, // Belarus\n  { code: 'RUB', name: 'Russian Ruble', symbol: 'â‚½' }, // Russia\n  \n  // African Currencies\n  { code: 'ZAR', name: 'South African Rand', symbol: 'R' }, // South Africa\n  { code: 'NGN', name: 'Nigerian Naira', symbol: 'â‚¦' }, // Nigeria\n  { code: 'GHS', name: 'Ghanaian Cedi', symbol: 'â‚µ' }, // Ghana\n  { code: 'KES', name: 'Kenyan Shilling', symbol: 'KSh' }, // Kenya\n  { code: 'UGX', name: 'Ugandan Shilling', symbol: 'USh' }, // Uganda\n  { code: 'TZS', name: 'Tanzanian Shilling', symbol: 'TSh' }, // Tanzania\n  { code: 'ETB', name: 'Ethiopian Birr', symbol: 'Br' }, // Ethiopia\n  { code: 'RWF', name: 'Rwandan Franc', symbol: 'RF' }, // Rwanda\n  { code: 'XOF', name: 'West African CFA Franc', symbol: 'CFA' }, // West Africa CFA\n  { code: 'XAF', name: 'Central African CFA Franc', symbol: 'FCFA' }, // Central Africa CFA\n  { code: 'MZN', name: 'Mozambican Metical', symbol: 'MT' }, // Mozambique\n  { code: 'BWP', name: 'Botswanan Pula', symbol: 'P' }, // Botswana\n  { code: 'NAD', name: 'Namibian Dollar', symbol: 'N$' }, // Namibia\n  { code: 'SZL', name: 'Swazi Lilangeni', symbol: 'E' }, // Eswatini\n  { code: 'LSL', name: 'Lesotho Loti', symbol: 'L' }, // Lesotho\n  \n  // American Currencies\n  { code: 'MXN', name: 'Mexican Peso', symbol: '$' }, // Mexico\n  { code: 'BRL', name: 'Brazilian Real', symbol: 'R$' }, // Brazil\n  { code: 'ARS', name: 'Argentine Peso', symbol: '$' }, // Argentina\n  { code: 'CLP', name: 'Chilean Peso', symbol: '$' }, // Chile\n  { code: 'COP', name: 'Colombian Peso', symbol: '$' }, // Colombia\n  { code: 'PEN', name: 'Peruvian Sol', symbol: 'S/' }, // Peru\n  { code: 'UYU', name: 'Uruguayan Peso', symbol: '$U' }, // Uruguay\n  { code: 'PYG', name: 'Paraguayan Guarani', symbol: 'â‚²' }, // Paraguay\n  { code: 'BOB', name: 'Bolivian Boliviano', symbol: 'Bs' }, // Bolivia\n  { code: 'VED', name: 'Venezuelan BolÃ­var', symbol: 'Bs' }, // Venezuela\n  { code: 'GYD', name: 'Guyanese Dollar', symbol: 'G$' }, // Guyana\n  { code: 'SRD', name: 'Surinamese Dollar', symbol: 'Sr$' }, // Suriname\n];\n\n// Removed mock data - using real API data only\n\nexport default function BankAccountsPage() {\n  const { toast } = useToast();\n  const isMobile = useIsMobile();\n  const [showDialog, setShowDialog] = useState(false);\n  const [editingAccount, setEditingAccount] = useState<any>(null);\n\n  // Fetch bank accounts from API\n  const { \n    data: accounts = [], \n    isLoading: isLoadingAccounts, \n    error: accountsError \n  } = useQuery({\n    queryKey: ['/api/banking/accounts'],\n    select: (data: any[]) => {\n      if (!data) return [];\n      // Normalize numeric fields to ensure proper calculation\n      return data.map(account => ({\n        ...account,\n        current_balance: Number(account.current_balance) || 0,\n        opening_balance: Number(account.opening_balance) || 0,\n      }));\n    }\n  });\n\n  // Fetch recent transactions from API\n  const { \n    data: transactions = [], \n    isLoading: isLoadingTransactions, \n    error: transactionsError \n  } = useQuery({\n    queryKey: ['/api/banking/transactions'],\n    select: (data: any[]) => {\n      if (!data) return [];\n      // Normalize numeric fields\n      return data.map(transaction => ({\n        ...transaction,\n        amount: Number(transaction.amount) || 0,\n      }));\n    }\n  });\n\n  // Create/Update mutation\n  const saveMutation = useMutation({\n    mutationFn: async (data: BankAccountForm) => {\n      // Data is already properly typed thanks to schema preprocessing\n      if (editingAccount) {\n        return apiRequest('PUT', `/api/banking/accounts/${editingAccount.id}`, data);\n      } else {\n        return apiRequest('POST', '/api/banking/accounts', data);\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/banking/accounts'] });\n      toast({\n        title: editingAccount ? 'Account updated' : 'Account created',\n        description: `Bank account has been ${editingAccount ? 'updated' : 'added'} successfully.`,\n      });\n      setShowDialog(false);\n      setEditingAccount(null);\n      form.reset();\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to save account',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Delete mutation\n  const deleteMutation = useMutation({\n    mutationFn: async (accountId: string) => {\n      return apiRequest('DELETE', `/api/banking/accounts/${accountId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/banking/accounts'] });\n      toast({\n        title: 'Account deleted',\n        description: 'Bank account has been removed successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to delete account',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Calculate totals\n  const totalBalance = accounts.reduce((sum, acc) => sum + acc.current_balance, 0);\n  const totalAssets = accounts\n    .filter(acc => acc.account_type !== 'credit_card' && acc.current_balance > 0)\n    .reduce((sum, acc) => sum + acc.current_balance, 0);\n  const totalLiabilities = accounts\n    .filter(acc => acc.account_type === 'credit_card' || acc.current_balance < 0)\n    .reduce((sum, acc) => sum + Math.abs(acc.current_balance), 0);\n\n  const form = useForm<BankAccountForm>({\n    resolver: zodResolver(bankAccountSchema),\n    defaultValues: editingAccount || {\n      name: '',\n      account_number: '',\n      bank_name: '',\n      branch: '',\n      swift_code: '',\n      iban: '',\n      currency: 'USD',\n      account_type: 'checking',\n      opening_balance: '',\n      current_balance: '',\n      is_active: true,\n      is_default: false,\n    },\n  });\n\n  const onSubmit = async (data: BankAccountForm) => {\n    saveMutation.mutate(data);\n  };\n\n  const handleEdit = (account: any) => {\n    setEditingAccount(account);\n    form.reset({\n      ...account,\n      opening_balance: account.opening_balance?.toString() || '',\n      current_balance: account.current_balance?.toString() || '',\n    });\n    setShowDialog(true);\n  };\n\n  const handleDelete = (id: string) => {\n    if (confirm('Are you sure you want to delete this bank account?')) {\n      deleteMutation.mutate(id);\n    }\n  };\n\n  const formatCurrency = (amount: number, currency: string) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: currency,\n    }).format(amount);\n  };\n\n  const getAccountIcon = (type: string) => {\n    const accountType = accountTypes.find(t => t.value === type);\n    return accountType ? accountType.icon : Wallet;\n  };\n\n  // Show loading state for accounts\n  if (isLoadingAccounts) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-foreground\">Bank Accounts</h1>\n            <p className=\"text-muted-foreground mt-1\">Loading accounts...</p>\n          </div>\n        </div>\n        <div className=\"grid gap-4 md:grid-cols-4\">\n          {Array.from({ length: 4 }).map((_, i) => (\n            <Card key={i}>\n              <CardHeader className=\"pb-2\">\n                <div className=\"h-4 bg-muted animate-pulse rounded\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"h-8 bg-muted animate-pulse rounded mb-2\" />\n                <div className=\"h-3 bg-muted animate-pulse rounded\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  // Show error state\n  if (accountsError) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-foreground\">Bank Accounts</h1>\n            <p className=\"text-muted-foreground mt-1\">Error loading accounts</p>\n          </div>\n        </div>\n        <Card>\n          <CardContent className=\"p-6 text-center\">\n            <AlertCircle className=\"h-12 w-12 mx-auto text-muted-foreground mb-2\" />\n            <p className=\"text-muted-foreground\">Failed to load bank accounts. Please try again.</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Bank Accounts</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Manage your bank accounts and cash balances\n          </p>\n        </div>\n        <Dialog open={showDialog} onOpenChange={(open) => {\n          setShowDialog(open);\n          if (!open) {\n            setEditingAccount(null);\n            form.reset();\n          }\n        }}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-add-account\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Account\n            </Button>\n          </DialogTrigger>\n          <DialogContent className={`max-w-2xl ${isMobile ? 'w-full max-w-full mx-4' : ''}`}>\n            <DialogHeader>\n              <DialogTitle>\n                {editingAccount ? 'Edit Bank Account' : 'Add New Bank Account'}\n              </DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"name\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Account Name *</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Main Business Account\" data-testid=\"input-account-name\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"account_type\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Account Type *</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-account-type\">\n                              <SelectValue placeholder=\"Select type\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {accountTypes.map((type) => {\n                              const Icon = type.icon;\n                              return (\n                                <SelectItem key={type.value} value={type.value}>\n                                  <div className=\"flex items-center gap-2\">\n                                    <Icon className=\"h-4 w-4\" />\n                                    {type.label}\n                                  </div>\n                                </SelectItem>\n                              );\n                            })}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"bank_name\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Bank Name *</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"First National Bank\" data-testid=\"input-bank-name\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"branch\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Branch</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Downtown Branch\" data-testid=\"input-branch\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"account_number\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Account Number *</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"1234567890\" data-testid=\"input-account-number\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"currency\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Currency</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-currency\">\n                              <SelectValue placeholder=\"Select currency\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {currencies.map((currency) => (\n                              <SelectItem key={currency.code} value={currency.code}>\n                                {currency.symbol} {currency.code} - {currency.name}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"swift_code\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>SWIFT Code</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"FNBAUS33\" data-testid=\"input-swift\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"iban\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>IBAN</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"US12 3456 7890 1234 5678 90\" data-testid=\"input-iban\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"opening_balance\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Opening Balance</FormLabel>\n                        <FormControl>\n                          <Input \n                            type=\"number\" \n                            step=\"0.01\" \n                            placeholder=\"0.00\" \n                            data-testid=\"input-opening-balance\" \n                            {...field} \n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"current_balance\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Current Balance</FormLabel>\n                        <FormControl>\n                          <Input \n                            type=\"number\" \n                            step=\"0.01\" \n                            placeholder=\"0.00\" \n                            data-testid=\"input-current-balance\" \n                            {...field} \n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"flex gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"is_active\"\n                    render={({ field }) => (\n                      <FormItem className=\"flex items-center justify-between rounded-lg border p-3 flex-1\">\n                        <div className=\"space-y-0.5\">\n                          <FormLabel>Active Account</FormLabel>\n                          <div className=\"text-sm text-muted-foreground\">\n                            Active accounts can be used in transactions\n                          </div>\n                        </div>\n                        <FormControl>\n                          <Switch\n                            checked={field.value}\n                            onCheckedChange={field.onChange}\n                            data-testid=\"switch-active\"\n                          />\n                        </FormControl>\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"is_default\"\n                    render={({ field }) => (\n                      <FormItem className=\"flex items-center justify-between rounded-lg border p-3 flex-1\">\n                        <div className=\"space-y-0.5\">\n                          <FormLabel>Default Account</FormLabel>\n                          <div className=\"text-sm text-muted-foreground\">\n                            Used as default for transactions\n                          </div>\n                        </div>\n                        <FormControl>\n                          <Switch\n                            checked={field.value}\n                            onCheckedChange={field.onChange}\n                            data-testid=\"switch-default\"\n                          />\n                        </FormControl>\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"flex justify-end gap-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setShowDialog(false)}\n                    data-testid=\"button-cancel\"\n                  >\n                    Cancel\n                  </Button>\n                  <Button type=\"submit\" data-testid=\"button-save\">\n                    {editingAccount ? 'Update' : 'Create'} Account\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid gap-4 md:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Balance</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {formatCurrency(totalBalance, 'USD')}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Across all accounts\n            </p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Assets</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">\n              {formatCurrency(totalAssets, 'USD')}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Cash & bank balances\n            </p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Liabilities</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-red-600\">\n              {formatCurrency(totalLiabilities, 'USD')}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Credit cards & overdrafts\n            </p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Active Accounts</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{accounts.filter(a => a.is_active).length}</div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Of {accounts.length} total\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Bank Accounts Grid */}\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n        {accounts.map((account) => {\n          const Icon = getAccountIcon(account.account_type);\n          return (\n            <Card key={account.id} data-testid={`card-account-${account.id}`}>\n              <CardHeader>\n                <CardTitle className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <Icon className=\"h-5 w-5\" />\n                    {account.name}\n                  </div>\n                  <div className=\"flex gap-1\">\n                    {account.is_default && (\n                      <Badge variant=\"default\" className=\"text-xs\">Default</Badge>\n                    )}\n                    {!account.is_active && (\n                      <Badge variant=\"secondary\" className=\"text-xs\">Inactive</Badge>\n                    )}\n                  </div>\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                <div>\n                  <p className=\"text-xs text-muted-foreground\">Bank</p>\n                  <p className=\"font-medium\">{account.bank_name}</p>\n                  {account.branch && (\n                    <p className=\"text-sm text-muted-foreground\">{account.branch}</p>\n                  )}\n                </div>\n                \n                <div>\n                  <p className=\"text-xs text-muted-foreground\">Account Number</p>\n                  <p className=\"font-mono\">{account.account_number}</p>\n                </div>\n                \n                <div>\n                  <p className=\"text-xs text-muted-foreground\">Current Balance</p>\n                  <p className={`text-2xl font-bold ${account.current_balance < 0 ? 'text-red-600' : 'text-green-600'}`}>\n                    {formatCurrency(account.current_balance, account.currency)}\n                  </p>\n                </div>\n                \n                {account.last_transaction_date && (\n                  <div>\n                    <p className=\"text-xs text-muted-foreground\">Last Transaction</p>\n                    <p className=\"text-sm\">{new Date(account.last_transaction_date).toLocaleDateString()}</p>\n                  </div>\n                )}\n                \n                <div className=\"flex gap-2 pt-2\">\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleEdit(account)}\n                    data-testid={`button-edit-${account.id}`}\n                  >\n                    <Edit className=\"h-3 w-3 mr-1\" />\n                    Edit\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    data-testid={`button-reconcile-${account.id}`}\n                  >\n                    <CheckCircle className=\"h-3 w-3 mr-1\" />\n                    Reconcile\n                  </Button>\n                  {!account.is_default && (\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleDelete(account.id)}\n                      data-testid={`button-delete-${account.id}`}\n                    >\n                      <Trash2 className=\"h-3 w-3 mr-1\" />\n                      Delete\n                    </Button>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n\n      {/* Recent Transactions */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Recent Transactions</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoadingTransactions ? (\n            <div className=\"space-y-3\">\n              {Array.from({ length: 3 }).map((_, i) => (\n                <div key={i} className=\"flex items-center justify-between p-3 rounded-lg border\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"h-5 w-5 bg-muted animate-pulse rounded\" />\n                    <div>\n                      <div className=\"h-4 w-32 bg-muted animate-pulse rounded mb-1\" />\n                      <div className=\"h-3 w-24 bg-muted animate-pulse rounded\" />\n                    </div>\n                  </div>\n                  <div className=\"h-5 w-20 bg-muted animate-pulse rounded\" />\n                </div>\n              ))}\n            </div>\n          ) : transactionsError ? (\n            <div className=\"text-center py-6\">\n              <AlertCircle className=\"h-8 w-8 mx-auto text-muted-foreground mb-2\" />\n              <p className=\"text-sm text-muted-foreground\">Failed to load transactions</p>\n            </div>\n          ) : transactions.length === 0 ? (\n            <div className=\"text-center py-6\">\n              <p className=\"text-sm text-muted-foreground\">No recent transactions</p>\n            </div>\n          ) : (\n            <div className=\"space-y-3\">\n              {transactions.map((transaction) => (\n              <div \n                key={transaction.id} \n                className=\"flex items-center justify-between p-3 rounded-lg border\"\n                data-testid={`transaction-${transaction.id}`}\n              >\n                <div className=\"flex items-center gap-3\">\n                  {transaction.type === 'deposit' ? (\n                    <ArrowDownRight className=\"h-5 w-5 text-green-600\" />\n                  ) : (\n                    <ArrowUpRight className=\"h-5 w-5 text-red-600\" />\n                  )}\n                  <div>\n                    <p className=\"font-medium\">{transaction.description}</p>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {transaction.account} â€¢ {new Date(transaction.date).toLocaleDateString()}\n                    </p>\n                  </div>\n                </div>\n                <div className={`text-lg font-bold ${transaction.type === 'deposit' ? 'text-green-600' : 'text-red-600'}`}>\n                  {transaction.type === 'deposit' ? '+' : '-'}\n                  {formatCurrency(transaction.amount, 'USD')}\n                </div>\n              </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":35436},"client/src/pages/banking/PaymentsPage.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { queryClient, apiRequest } from '@/lib/queryClient';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { \n  CreditCard, \n  Plus, \n  MoreHorizontal, \n  Eye, \n  Edit,\n  Copy,\n  Send,\n  Download,\n  CheckCircle,\n  Clock,\n  XCircle,\n  ArrowDownRight,\n  Calendar,\n  Building2,\n  Banknote,\n  FileText,\n  Loader2,\n  Trash2\n} from 'lucide-react';\nimport { format } from 'date-fns';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { useToast } from '@/hooks/use-toast';\nimport { useIsMobile } from '@/hooks/use-mobile';\n\n// Payment form schema\nconst paymentSchema = z.object({\n  vendor_id: z.string().min(1, 'Please select a vendor'),\n  description: z.string().min(2, 'Description must be at least 2 characters'),\n  amount: z.string().min(1, 'Amount is required'),\n  payment_date: z.string().min(1, 'Payment date is required'),\n  payment_method: z.string().min(1, 'Payment method is required'),\n  reference: z.string().optional(),\n  notes: z.string().optional(),\n});\n\ntype PaymentForm = z.infer<typeof paymentSchema>;\n\n\nconst statusConfig = {\n  pending: { label: 'Pending', icon: Clock, color: 'default' },\n  scheduled: { label: 'Scheduled', icon: Calendar, color: 'secondary' },\n  completed: { label: 'Completed', icon: CheckCircle, color: 'success' },\n  failed: { label: 'Failed', icon: XCircle, color: 'destructive' },\n  cancelled: { label: 'Cancelled', icon: XCircle, color: 'secondary' },\n};\n\nconst paymentMethodIcons = {\n  'Bank Transfer': Banknote,\n  'Credit Card': CreditCard,\n  'Check': FileText,\n  'Online Payment': CreditCard,\n  'Cash': Banknote,\n};\n\nexport default function PaymentsPage() {\n  const { toast } = useToast();\n  const isMobile = useIsMobile();\n  const [activeTab, setActiveTab] = useState('all');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [showDialog, setShowDialog] = useState(false);\n  \n  // Fetch contacts (vendors)\n  const { data: contacts = [] } = useQuery<any[]>({\n    queryKey: ['/api/contacts'],\n  });\n\n  const vendors = contacts.filter(contact => \n    contact.type === 'vendor' || contact.type === 'both'\n  );\n\n  // Create payment mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: PaymentForm) => {\n      const processedData = {\n        ...data,\n        amount: parseFloat(data.amount),\n        status: 'pending',\n        payment_number: `PAY-${new Date().toISOString().slice(0, 10)}-${Math.random().toString(36).substr(2, 6).toUpperCase()}`,\n      };\n      return await apiRequest('POST', '/api/banking/payments', processedData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/banking/payments'] });\n      setShowDialog(false);\n      toast({\n        title: 'Payment created',\n        description: 'New payment has been created successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to create payment',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Form\n  const form = useForm<PaymentForm>({\n    resolver: zodResolver(paymentSchema),\n    defaultValues: {\n      vendor_id: '',\n      description: '',\n      amount: '',\n      payment_date: new Date().toISOString().split('T')[0],\n      payment_method: '',\n      reference: '',\n      notes: '',\n    },\n  });\n\n  const onSubmit = (data: PaymentForm) => {\n    createMutation.mutate(data);\n  };\n\n  // Fetch payments data\n  const { data: payments = [], isLoading, error, refetch } = useQuery({\n    queryKey: ['/api/banking/payments'],\n    select: (data: any[]) => {\n      return data.map((payment: any) => ({\n        ...payment,\n        // Normalize status and amounts\n        status: payment.status || 'pending',\n        amount: Number(payment.amount) || 0,\n        // Format date for compatibility \n        payment_date: payment.date ? new Date(payment.date).toISOString().split('T')[0] : new Date().toISOString().split('T')[0]\n      }));\n    }\n  });\n\n  // Delete payment mutation\n  const deletePaymentMutation = useMutation({\n    mutationFn: (id: string) => apiRequest('DELETE', `/api/banking/payments/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/banking/payments'] });\n      toast({\n        title: 'Payment deleted',\n        description: 'Payment has been deleted successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: 'Failed to delete payment. Please try again.',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Filter payments\n  const filteredPayments = payments.filter((payment) => {\n    const matchesSearch = \n      payment.payment_number.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      payment.vendor_name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      payment.reference.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    if (!matchesSearch) return false;\n    \n    switch (activeTab) {\n      case 'pending':\n        return payment.status === 'pending';\n      case 'scheduled':\n        return payment.status === 'scheduled';\n      case 'completed':\n        return payment.status === 'completed';\n      case 'failed':\n        return payment.status === 'failed';\n      default:\n        return true;\n    }\n  });\n\n  // Calculate statistics\n  const stats = {\n    total: payments.length,\n    totalAmount: payments.reduce((sum, p) => sum + p.amount, 0),\n    completed: payments.filter(p => p.status === 'completed').reduce((sum, p) => sum + p.amount, 0),\n    pending: payments.filter(p => p.status === 'pending' || p.status === 'scheduled').reduce((sum, p) => sum + p.amount, 0),\n    failed: payments.filter(p => p.status === 'failed').reduce((sum, p) => sum + p.amount, 0),\n  };\n\n  const handleDeletePayment = (id: string) => {\n    if (confirm('Are you sure you want to delete this payment?')) {\n      deletePaymentMutation.mutate(id);\n    }\n  };\n\n  const handleRetryPayment = (id: string) => {\n    toast({\n      title: 'Payment retried',\n      description: 'Payment has been initiated again.',\n    });\n  };\n\n  const handleCancelPayment = (id: string) => {\n    if (confirm('Are you sure you want to cancel this payment?')) {\n      toast({\n        title: 'Payment cancelled',\n        description: 'The payment has been cancelled successfully.',\n      });\n    }\n  };\n\n  const handleSendRemittance = (id: string) => {\n    toast({\n      title: 'Remittance sent',\n      description: 'Payment remittance has been sent to the vendor.',\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-64\">\n        <Loader2 className=\"h-8 w-8 animate-spin\" />\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"text-center py-12\">\n        <p className=\"text-destructive mb-4\">Failed to load payments</p>\n        <Button onClick={() => refetch()} variant=\"outline\">\n          Try Again\n        </Button>\n      </div>\n    );\n  }\n\n  const getStatusBadge = (status: string) => {\n    const config = statusConfig[status as keyof typeof statusConfig];\n    if (!config) return null;\n    \n    const Icon = config.icon;\n    return (\n      <Badge variant={config.color as any} className=\"gap-1\">\n        <Icon className=\"h-3 w-3\" />\n        {config.label}\n      </Badge>\n    );\n  };\n\n  const getPaymentMethodIcon = (method: string) => {\n    const Icon = paymentMethodIcons[method as keyof typeof paymentMethodIcons] || CreditCard;\n    return Icon;\n  };\n\n  const formatCurrency = (amount: number, currency: string) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: currency,\n    }).format(amount);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className={`${isMobile ? 'space-y-4' : 'flex items-center justify-between'}`}>\n        <div>\n          <h1 className={`${isMobile ? 'text-2xl' : 'text-3xl'} font-bold text-foreground`}>Payments</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            {isMobile ? 'Manage payments' : 'Manage outgoing payments to vendors'}\n          </p>\n        </div>\n        <Dialog open={showDialog} onOpenChange={setShowDialog}>\n          <DialogTrigger asChild>\n            <Button \n              size={isMobile ? 'sm' : 'default'}\n              data-testid=\"button-new-payment\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Payment\n            </Button>\n          </DialogTrigger>\n          <DialogContent className={`max-w-2xl max-h-[90vh] overflow-y-auto ${isMobile ? 'w-full max-w-full mx-4' : ''}`}>\n            <DialogHeader>\n              <DialogTitle>Create New Payment</DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"vendor_id\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Vendor</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Select vendor\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {vendors.map((vendor) => (\n                              <SelectItem key={vendor.id} value={vendor.id}>\n                                {vendor.name}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"payment_date\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Payment Date</FormLabel>\n                        <FormControl>\n                          <Input type=\"date\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"description\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Description</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"Enter payment description\" \n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"amount\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Amount</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            placeholder=\"0.00\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"payment_method\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Payment Method</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Select method\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value=\"Bank Transfer\">Bank Transfer</SelectItem>\n                            <SelectItem value=\"Credit Card\">Credit Card</SelectItem>\n                            <SelectItem value=\"Check\">Check</SelectItem>\n                            <SelectItem value=\"Online Payment\">Online Payment</SelectItem>\n                            <SelectItem value=\"Cash\">Cash</SelectItem>\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"reference\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Reference Number (Optional)</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"Enter reference number\" \n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"notes\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Notes (Optional)</FormLabel>\n                      <FormControl>\n                        <Textarea\n                          placeholder=\"Additional notes...\"\n                          className=\"resize-none\"\n                          rows={3}\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex items-center gap-3 pt-4\">\n                  <Button type=\"submit\" disabled={createMutation.isPending}>\n                    {createMutation.isPending ? 'Creating...' : 'Create Payment'}\n                  </Button>\n                  <Button \n                    type=\"button\" \n                    variant=\"outline\" \n                    onClick={() => setShowDialog(false)}\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Statistics Cards */}\n      <div className={`grid gap-4 ${isMobile ? 'grid-cols-2' : 'grid-cols-2 md:grid-cols-5'}`}>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Payments</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.total}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              This month\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Amount</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {formatCurrency(stats.totalAmount, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              All payments\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Completed</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">\n              {formatCurrency(stats.completed, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Successfully paid\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Pending</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-orange-600\">\n              {formatCurrency(stats.pending, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              In process\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Failed</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-red-600\">\n              {formatCurrency(stats.failed, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Need attention\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <div className=\"flex items-center gap-4\">\n        <div className=\"flex-1\">\n          <Input\n            placeholder=\"Search payments...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"max-w-sm\"\n            data-testid=\"input-search-payments\"\n          />\n        </div>\n      </div>\n\n      {/* Tabs and Table */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList>\n          <TabsTrigger value=\"all\">All Payments</TabsTrigger>\n          <TabsTrigger value=\"pending\">Pending</TabsTrigger>\n          <TabsTrigger value=\"scheduled\">Scheduled</TabsTrigger>\n          <TabsTrigger value=\"completed\">Completed</TabsTrigger>\n          <TabsTrigger value=\"failed\">Failed</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value={activeTab} className=\"mt-4\">\n          <Card>\n            <CardContent className=\"p-0\">\n              <div className={isMobile ? \"mobile-table-container\" : \"\"}>\n                <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Payment #</TableHead>\n                      <TableHead>Vendor</TableHead>\n                      <TableHead>Date</TableHead>\n                      <TableHead>Reference</TableHead>\n                      <TableHead>Method</TableHead>\n                      <TableHead>Amount</TableHead>\n                      <TableHead>Status</TableHead>\n                      <TableHead className=\"text-right\">Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {filteredPayments.map((payment) => {\n                      const PaymentIcon = getPaymentMethodIcon(payment.payment_method);\n                      return (\n                        <TableRow key={payment.id} data-testid={`row-payment-${payment.id}`}>\n                          <TableCell className=\"font-medium\" data-label=\"Payment #\">\n                            <div className=\"flex items-center gap-2\">\n                              <ArrowDownRight className=\"h-4 w-4 text-red-600\" />\n                              {payment.payment_number}\n                            </div>\n                          </TableCell>\n                          <TableCell data-label=\"Vendor\">\n                            <div className=\"flex items-center gap-2\">\n                              <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n                              {payment.vendor_name}\n                            </div>\n                          </TableCell>\n                          <TableCell data-label=\"Date\">\n                            <div className=\"flex items-center gap-2\">\n                              <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                              {format(new Date(payment.payment_date), 'MMM dd, yyyy')}\n                            </div>\n                          </TableCell>\n                          <TableCell data-label=\"Reference\">\n                            <div className=\"flex items-center gap-2\">\n                              <FileText className=\"h-4 w-4 text-muted-foreground\" />\n                              {payment.reference}\n                            </div>\n                          </TableCell>\n                          <TableCell data-label=\"Method\">\n                            <div className=\"flex items-center gap-2\">\n                              <PaymentIcon className=\"h-4 w-4 text-muted-foreground\" />\n                              {payment.payment_method}\n                            </div>\n                          </TableCell>\n                          <TableCell className=\"font-semibold text-red-600\" data-label=\"Amount\">\n                            -{formatCurrency(payment.amount, payment.currency)}\n                          </TableCell>\n                          <TableCell data-label=\"Status\">{getStatusBadge(payment.status)}</TableCell>\n                          <TableCell className=\"text-right\" data-label=\"Actions\">\n                            <DropdownMenu>\n                              <DropdownMenuTrigger asChild>\n                                <Button variant=\"ghost\" size=\"icon\" data-testid={`button-actions-${payment.id}`}>\n                                  <MoreHorizontal className=\"h-4 w-4\" />\n                                </Button>\n                              </DropdownMenuTrigger>\n                              <DropdownMenuContent align=\"end\">\n                                <DropdownMenuItem>\n                                  <Eye className=\"h-4 w-4 mr-2\" />\n                                  View Details\n                                </DropdownMenuItem>\n                                <DropdownMenuItem>\n                                  <Edit className=\"h-4 w-4 mr-2\" />\n                                  Edit\n                                </DropdownMenuItem>\n                                <DropdownMenuItem>\n                                  <Copy className=\"h-4 w-4 mr-2\" />\n                                  Duplicate\n                                </DropdownMenuItem>\n                                {payment.status === 'failed' && (\n                                  <DropdownMenuItem onClick={() => handleRetryPayment(payment.id)}>\n                                    <CheckCircle className=\"h-4 w-4 mr-2\" />\n                                    Retry Payment\n                                  </DropdownMenuItem>\n                                )}\n                                {payment.status === 'completed' && (\n                                  <DropdownMenuItem onClick={() => handleSendRemittance(payment.id)}>\n                                    <Send className=\"h-4 w-4 mr-2\" />\n                                    Send Remittance\n                                  </DropdownMenuItem>\n                                )}\n                                <DropdownMenuItem>\n                                  <Download className=\"h-4 w-4 mr-2\" />\n                                  Download Receipt\n                                </DropdownMenuItem>\n                                <DropdownMenuSeparator />\n                                {(payment.status === 'pending' || payment.status === 'scheduled') && (\n                                  <DropdownMenuItem \n                                    className=\"text-destructive\"\n                                    onClick={() => handleCancelPayment(payment.id)}\n                                  >\n                                    <XCircle className=\"h-4 w-4 mr-2\" />\n                                    Cancel Payment\n                                  </DropdownMenuItem>\n                                )}\n                                <DropdownMenuItem \n                                  className=\"text-destructive\"\n                                  onClick={() => handleDeletePayment(payment.id)}\n                                  disabled={deletePaymentMutation.isPending}\n                                  data-testid={`button-delete-${payment.id}`}\n                                >\n                                  {deletePaymentMutation.isPending ? (\n                                    <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                                  ) : (\n                                    <Trash2 className=\"h-4 w-4 mr-2\" />\n                                  )}\n                                  Delete\n                                </DropdownMenuItem>\n                              </DropdownMenuContent>\n                            </DropdownMenu>\n                          </TableCell>\n                        </TableRow>\n                      );\n                    })}\n                  </TableBody>\n                </Table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":26338},"client/src/pages/banking/ReceiptsPage.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { queryClient, apiRequest } from '@/lib/queryClient';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { \n  Banknote, \n  Plus, \n  MoreHorizontal, \n  Eye, \n  Edit,\n  Copy,\n  Send,\n  Download,\n  CheckCircle,\n  Clock,\n  XCircle,\n  ArrowUpRight,\n  Calendar,\n  User,\n  CreditCard,\n  FileText,\n  Loader2,\n  Trash2\n} from 'lucide-react';\nimport { format } from 'date-fns';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { useToast } from '@/hooks/use-toast';\nimport { useIsMobile } from '@/hooks/use-mobile';\n\n// Receipt form schema\nconst receiptSchema = z.object({\n  customer_id: z.string().min(1, 'Please select a customer'),\n  description: z.string().min(2, 'Description must be at least 2 characters'),\n  amount: z.string().min(1, 'Amount is required'),\n  receipt_date: z.string().min(1, 'Receipt date is required'),\n  payment_method: z.string().min(1, 'Payment method is required'),\n  reference: z.string().optional(),\n  notes: z.string().optional(),\n});\n\ntype ReceiptForm = z.infer<typeof receiptSchema>;\n\n\nconst statusConfig = {\n  pending: { label: 'Pending', icon: Clock, color: 'default' },\n  received: { label: 'Received', icon: CheckCircle, color: 'success' },\n  cleared: { label: 'Cleared', icon: CheckCircle, color: 'success' },\n  bounced: { label: 'Bounced', icon: XCircle, color: 'destructive' },\n};\n\nconst paymentMethodIcons = {\n  'Bank Transfer': Banknote,\n  'Credit Card': CreditCard,\n  'Check': FileText,\n  'Online Payment': CreditCard,\n  'Cash': Banknote,\n};\n\nexport default function ReceiptsPage() {\n  const { toast } = useToast();\n  const isMobile = useIsMobile();\n  const [activeTab, setActiveTab] = useState('all');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [showDialog, setShowDialog] = useState(false);\n  \n  // Fetch contacts (customers)\n  const { data: contacts = [] } = useQuery<any[]>({\n    queryKey: ['/api/contacts'],\n  });\n\n  const customers = contacts.filter(contact => \n    contact.type === 'customer' || contact.type === 'both'\n  );\n\n  // Create receipt mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: ReceiptForm) => {\n      const processedData = {\n        ...data,\n        amount: parseFloat(data.amount),\n        status: 'received',\n        receipt_number: `REC-${new Date().toISOString().slice(0, 10)}-${Math.random().toString(36).substr(2, 6).toUpperCase()}`,\n      };\n      return await apiRequest('POST', '/api/banking/receipts', processedData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/banking/receipts'] });\n      setShowDialog(false);\n      toast({\n        title: 'Receipt created',\n        description: 'New receipt has been created successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to create receipt',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Form\n  const form = useForm<ReceiptForm>({\n    resolver: zodResolver(receiptSchema),\n    defaultValues: {\n      customer_id: '',\n      description: '',\n      amount: '',\n      receipt_date: new Date().toISOString().split('T')[0],\n      payment_method: '',\n      reference: '',\n      notes: '',\n    },\n  });\n\n  const onSubmit = (data: ReceiptForm) => {\n    createMutation.mutate(data);\n  };\n\n  // Fetch receipts data\n  const { data: receipts = [], isLoading, error, refetch } = useQuery({\n    queryKey: ['/api/banking/receipts'],\n    select: (data: any[]) => {\n      return data.map((receipt: any) => ({\n        ...receipt,\n        // Normalize status and amounts\n        status: receipt.status || 'received',\n        amount: Number(receipt.amount) || 0,\n        // Format date for compatibility \n        receipt_date: receipt.date ? new Date(receipt.date).toISOString().split('T')[0] : new Date().toISOString().split('T')[0]\n      }));\n    }\n  });\n\n  // Delete receipt mutation\n  const deleteReceiptMutation = useMutation({\n    mutationFn: (id: string) => apiRequest('DELETE', `/api/banking/receipts/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/banking/receipts'] });\n      toast({\n        title: 'Receipt deleted',\n        description: 'Receipt has been deleted successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: 'Failed to delete receipt. Please try again.',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const handleDeleteReceipt = (id: string) => {\n    if (confirm('Are you sure you want to delete this receipt?')) {\n      deleteReceiptMutation.mutate(id);\n    }\n  };\n\n  // Filter receipts\n  const filteredReceipts = receipts.filter((receipt) => {\n    const matchesSearch = \n      receipt.receipt_number.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      receipt.customer_name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      receipt.reference.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    if (!matchesSearch) return false;\n    \n    switch (activeTab) {\n      case 'pending':\n        return receipt.status === 'pending';\n      case 'received':\n        return receipt.status === 'received';\n      case 'cleared':\n        return receipt.status === 'cleared';\n      case 'bounced':\n        return receipt.status === 'bounced';\n      default:\n        return true;\n    }\n  });\n\n  // Calculate statistics\n  const stats = {\n    total: receipts.length,\n    totalAmount: receipts.reduce((sum, r) => sum + r.amount, 0),\n    received: receipts.filter(r => r.status === 'received' || r.status === 'cleared').reduce((sum, r) => sum + r.amount, 0),\n    pending: receipts.filter(r => r.status === 'pending').reduce((sum, r) => sum + r.amount, 0),\n    todayAmount: receipts.filter(r => r.receipt_date === '2024-02-14').reduce((sum, r) => sum + r.amount, 0),\n  };\n\n  const handleApplyToInvoice = (id: string) => {\n    toast({\n      title: 'Receipt applied',\n      description: 'Receipt has been applied to the invoice successfully.',\n    });\n  };\n\n  const handleSendReceipt = (id: string) => {\n    toast({\n      title: 'Receipt sent',\n      description: 'Receipt confirmation has been sent to the customer.',\n    });\n  };\n\n  const handleRefund = (id: string) => {\n    if (confirm('Are you sure you want to refund this receipt?')) {\n      toast({\n        title: 'Refund initiated',\n        description: 'The refund process has been initiated.',\n      });\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-64\">\n        <Loader2 className=\"h-8 w-8 animate-spin\" />\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"text-center py-12\">\n        <p className=\"text-destructive mb-4\">Failed to load receipts</p>\n        <Button onClick={() => refetch()} variant=\"outline\">\n          Try Again\n        </Button>\n      </div>\n    );\n  }\n\n  const getStatusBadge = (status: string) => {\n    const config = statusConfig[status as keyof typeof statusConfig];\n    if (!config) return null;\n    \n    const Icon = config.icon;\n    return (\n      <Badge variant={config.color as any} className=\"gap-1\">\n        <Icon className=\"h-3 w-3\" />\n        {config.label}\n      </Badge>\n    );\n  };\n\n  const getPaymentMethodIcon = (method: string) => {\n    const Icon = paymentMethodIcons[method as keyof typeof paymentMethodIcons] || CreditCard;\n    return Icon;\n  };\n\n  const formatCurrency = (amount: number, currency: string) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: currency,\n    }).format(amount);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className={`${isMobile ? 'space-y-4' : 'flex items-center justify-between'}`}>\n        <div>\n          <h1 className={`${isMobile ? 'text-2xl' : 'text-3xl'} font-bold text-foreground`}>Receipts</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            {isMobile ? 'Manage incoming payments' : 'Manage incoming payments from customers'}\n          </p>\n        </div>\n        <Dialog open={showDialog} onOpenChange={setShowDialog}>\n          <DialogTrigger asChild>\n            <Button \n              size={isMobile ? 'sm' : 'default'}\n              data-testid=\"button-new-receipt\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Receipt\n            </Button>\n          </DialogTrigger>\n          <DialogContent className={`max-w-2xl max-h-[90vh] overflow-y-auto ${isMobile ? 'w-full max-w-full mx-4' : ''}`}>\n            <DialogHeader>\n              <DialogTitle>Create New Receipt</DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"customer_id\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Customer</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Select customer\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {customers.map((customer) => (\n                              <SelectItem key={customer.id} value={customer.id}>\n                                {customer.name}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"receipt_date\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Receipt Date</FormLabel>\n                        <FormControl>\n                          <Input type=\"date\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"description\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Description</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"Enter receipt description\" \n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"amount\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Amount</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            placeholder=\"0.00\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"payment_method\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Payment Method</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Select method\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value=\"Bank Transfer\">Bank Transfer</SelectItem>\n                            <SelectItem value=\"Credit Card\">Credit Card</SelectItem>\n                            <SelectItem value=\"Check\">Check</SelectItem>\n                            <SelectItem value=\"Online Payment\">Online Payment</SelectItem>\n                            <SelectItem value=\"Cash\">Cash</SelectItem>\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"reference\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Reference Number (Optional)</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"Enter reference number\" \n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"notes\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Notes (Optional)</FormLabel>\n                      <FormControl>\n                        <Textarea\n                          placeholder=\"Additional notes...\"\n                          className=\"resize-none\"\n                          rows={3}\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex items-center gap-3 pt-4\">\n                  <Button type=\"submit\" disabled={createMutation.isPending}>\n                    {createMutation.isPending ? 'Creating...' : 'Create Receipt'}\n                  </Button>\n                  <Button \n                    type=\"button\" \n                    variant=\"outline\" \n                    onClick={() => setShowDialog(false)}\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Statistics Cards */}\n      <div className={`grid gap-4 ${isMobile ? 'grid-cols-2' : 'grid-cols-2 md:grid-cols-5'}`}>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Receipts</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.total}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              This month\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Amount</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {formatCurrency(stats.totalAmount, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              All receipts\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Collected</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">\n              {formatCurrency(stats.received, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Successfully received\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Pending</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-orange-600\">\n              {formatCurrency(stats.pending, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Being processed\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Today</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-blue-600\">\n              {formatCurrency(stats.todayAmount, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Received today\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <div className=\"flex items-center gap-4\">\n        <div className=\"flex-1\">\n          <Input\n            placeholder=\"Search receipts...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"max-w-sm\"\n            data-testid=\"input-search-receipts\"\n          />\n        </div>\n      </div>\n\n      {/* Tabs and Table */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList>\n          <TabsTrigger value=\"all\">All Receipts</TabsTrigger>\n          <TabsTrigger value=\"pending\">Pending</TabsTrigger>\n          <TabsTrigger value=\"received\">Received</TabsTrigger>\n          <TabsTrigger value=\"cleared\">Cleared</TabsTrigger>\n          <TabsTrigger value=\"bounced\">Bounced</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value={activeTab} className=\"mt-4\">\n          <Card>\n            <CardContent className=\"p-0\">\n              <div className={isMobile ? \"mobile-table-container\" : \"\"}>\n                <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Receipt #</TableHead>\n                    <TableHead>Customer</TableHead>\n                    <TableHead>Date</TableHead>\n                    <TableHead>Reference</TableHead>\n                    <TableHead>Method</TableHead>\n                    <TableHead>Amount</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredReceipts.map((receipt) => {\n                    const PaymentIcon = getPaymentMethodIcon(receipt.payment_method);\n                    return (\n                      <TableRow key={receipt.id} data-testid={`row-receipt-${receipt.id}`}>\n                        <TableCell className=\"font-medium\" data-label=\"Receipt #\">\n                          <div className=\"flex items-center gap-2\">\n                            <ArrowUpRight className=\"h-4 w-4 text-green-600\" />\n                            {receipt.receipt_number}\n                          </div>\n                        </TableCell>\n                        <TableCell data-label=\"Customer\">\n                          <div className=\"flex items-center gap-2\">\n                            <User className=\"h-4 w-4 text-muted-foreground\" />\n                            {receipt.customer_name}\n                          </div>\n                        </TableCell>\n                        <TableCell data-label=\"Date\">\n                          <div className=\"flex items-center gap-2\">\n                            <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                            {format(new Date(receipt.receipt_date), 'MMM dd, yyyy')}\n                          </div>\n                        </TableCell>\n                        <TableCell data-label=\"Reference\">\n                          <div className=\"flex items-center gap-2\">\n                            <FileText className=\"h-4 w-4 text-muted-foreground\" />\n                            {receipt.reference}\n                          </div>\n                        </TableCell>\n                        <TableCell data-label=\"Method\">\n                          <div className=\"flex items-center gap-2\">\n                            <PaymentIcon className=\"h-4 w-4 text-muted-foreground\" />\n                            {receipt.payment_method}\n                          </div>\n                        </TableCell>\n                        <TableCell className=\"font-semibold text-green-600\" data-label=\"Amount\">\n                          +{formatCurrency(receipt.amount, receipt.currency)}\n                        </TableCell>\n                        <TableCell data-label=\"Status\">{getStatusBadge(receipt.status)}</TableCell>\n                        <TableCell className=\"text-right\" data-label=\"Actions\">\n                          <DropdownMenu>\n                            <DropdownMenuTrigger asChild>\n                              <Button variant=\"ghost\" size=\"icon\" data-testid={`button-actions-${receipt.id}`}>\n                                <MoreHorizontal className=\"h-4 w-4\" />\n                              </Button>\n                            </DropdownMenuTrigger>\n                            <DropdownMenuContent align=\"end\">\n                              <DropdownMenuItem>\n                                <Eye className=\"h-4 w-4 mr-2\" />\n                                View Details\n                              </DropdownMenuItem>\n                              <DropdownMenuItem>\n                                <Edit className=\"h-4 w-4 mr-2\" />\n                                Edit\n                              </DropdownMenuItem>\n                              <DropdownMenuItem>\n                                <Copy className=\"h-4 w-4 mr-2\" />\n                                Duplicate\n                              </DropdownMenuItem>\n                              {receipt.status === 'pending' && (\n                                <DropdownMenuItem onClick={() => handleApplyToInvoice(receipt.id)}>\n                                  <CheckCircle className=\"h-4 w-4 mr-2\" />\n                                  Apply to Invoice\n                                </DropdownMenuItem>\n                              )}\n                              {receipt.status === 'completed' && (\n                                <DropdownMenuItem onClick={() => handleSendReceipt(receipt.id)}>\n                                  <Send className=\"h-4 w-4 mr-2\" />\n                                  Send Receipt\n                                </DropdownMenuItem>\n                              )}\n                              <DropdownMenuItem>\n                                <Download className=\"h-4 w-4 mr-2\" />\n                                Download PDF\n                              </DropdownMenuItem>\n                              <DropdownMenuSeparator />\n                              {(receipt.status === 'received' || receipt.status === 'cleared') && (\n                                <DropdownMenuItem \n                                  className=\"text-destructive\"\n                                  onClick={() => handleRefund(receipt.id)}\n                                >\n                                  <XCircle className=\"h-4 w-4 mr-2\" />\n                                  Refund\n                                </DropdownMenuItem>\n                              )}\n                              <DropdownMenuItem \n                                className=\"text-destructive\"\n                                onClick={() => handleDeleteReceipt(receipt.id)}\n                                disabled={deleteReceiptMutation.isPending}\n                                data-testid={`button-delete-${receipt.id}`}\n                              >\n                                {deleteReceiptMutation.isPending ? (\n                                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                                ) : (\n                                  <Trash2 className=\"h-4 w-4 mr-2\" />\n                                )}\n                                Delete\n                              </DropdownMenuItem>\n                            </DropdownMenuContent>\n                          </DropdownMenu>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n                </Table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":26072},"client/src/pages/banking/ReconciliationPage.tsx":{"content":"import { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport { \n  CheckCircle2, \n  XCircle, \n  AlertCircle,\n  Calendar,\n  DollarSign,\n  ArrowUpRight,\n  ArrowDownRight,\n  FileText,\n  RefreshCw,\n  CheckSquare,\n  Square\n} from 'lucide-react';\nimport { format } from 'date-fns';\nimport { useToast } from '@/hooks/use-toast';\nimport { useIsMobile } from '@/hooks/use-mobile';\n\n// Mock data\nconst mockTransactions = [\n  {\n    id: '1',\n    date: '2024-02-10',\n    description: 'Payment from Customer ABC',\n    reference: 'INV-2024-001',\n    type: 'deposit',\n    amount: 5000.00,\n    matched: true,\n    bank_amount: 5000.00,\n    difference: 0,\n  },\n  {\n    id: '2',\n    date: '2024-02-12',\n    description: 'Office Supplies Purchase',\n    reference: 'BILL-2024-002',\n    type: 'withdrawal',\n    amount: 350.00,\n    matched: false,\n    bank_amount: null,\n    difference: null,\n  },\n  {\n    id: '3',\n    date: '2024-02-14',\n    description: 'Salary Payment - February',\n    reference: 'SAL-2024-02',\n    type: 'withdrawal',\n    amount: 12000.00,\n    matched: true,\n    bank_amount: 12000.00,\n    difference: 0,\n  },\n  {\n    id: '4',\n    date: '2024-02-15',\n    description: 'Bank Fees',\n    reference: 'FEE-2024-02',\n    type: 'withdrawal',\n    amount: 25.00,\n    matched: false,\n    bank_amount: null,\n    difference: null,\n  },\n  {\n    id: '5',\n    date: '2024-02-16',\n    description: 'Invoice Payment',\n    reference: 'INV-2024-015',\n    type: 'deposit',\n    amount: 3500.00,\n    matched: true,\n    bank_amount: 3500.00,\n    difference: 0,\n  },\n];\n\nconst mockBankTransactions = [\n  {\n    id: 'b1',\n    date: '2024-02-11',\n    description: 'Transfer from Savings',\n    amount: 10000.00,\n    type: 'deposit',\n    matched: false,\n  },\n  {\n    id: 'b2',\n    date: '2024-02-12',\n    description: 'OFFICE DEPOT',\n    amount: -350.00,\n    type: 'withdrawal',\n    matched: false,\n  },\n  {\n    id: 'b3',\n    date: '2024-02-15',\n    description: 'Service Charge',\n    amount: -25.00,\n    type: 'withdrawal',\n    matched: false,\n  },\n];\n\nexport default function ReconciliationPage() {\n  const { toast } = useToast();\n  const isMobile = useIsMobile();\n  const [selectedAccount, setSelectedAccount] = useState('main-business');\n  const [reconciliationDate, setReconciliationDate] = useState('2024-02-29');\n  const [statementBalance, setStatementBalance] = useState('45250.50');\n  const [showMatched, setShowMatched] = useState(true);\n  const [showUnmatched, setShowUnmatched] = useState(true);\n\n  // Calculate reconciliation status\n  const bookBalance = 45250.50;\n  const bankStatementBalance = parseFloat(statementBalance) || 0;\n  const reconciledTransactions = mockTransactions.filter(t => t.matched);\n  const unreconciledTransactions = mockTransactions.filter(t => !t.matched);\n  const unmatchedBankTransactions = mockBankTransactions.filter(t => !t.matched);\n  \n  const totalReconciled = reconciledTransactions.reduce((sum, t) => \n    sum + (t.type === 'deposit' ? t.amount : -t.amount), 0\n  );\n  const totalUnreconciled = unreconciledTransactions.reduce((sum, t) => \n    sum + (t.type === 'deposit' ? t.amount : -t.amount), 0\n  );\n  \n  const difference = bankStatementBalance - bookBalance;\n  const isReconciled = Math.abs(difference) < 0.01;\n\n  const handleMatchTransaction = (bookId: string, bankId: string) => {\n    toast({\n      title: 'Transaction matched',\n      description: 'The transaction has been matched successfully.',\n    });\n  };\n\n  const handleAutoReconcile = () => {\n    toast({\n      title: 'Auto-reconciliation started',\n      description: 'System is matching transactions automatically...',\n    });\n  };\n\n  const handleCompleteReconciliation = () => {\n    if (!isReconciled) {\n      toast({\n        title: 'Cannot complete reconciliation',\n        description: 'There is still a difference between book and bank balances.',\n        variant: 'destructive',\n      });\n      return;\n    }\n    \n    toast({\n      title: 'Reconciliation completed',\n      description: 'Bank reconciliation has been completed successfully.',\n    });\n  };\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: 'USD',\n    }).format(amount);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className={`${isMobile ? 'space-y-4' : 'flex items-center justify-between'}`}>\n        <div>\n          <h1 className={`${isMobile ? 'text-2xl' : 'text-3xl'} font-bold text-foreground`}>Bank Reconciliation</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            {isMobile ? 'Match bank statements' : 'Match your bank statements with your book records'}\n          </p>\n        </div>\n        <div className={`flex gap-2 ${isMobile ? 'w-full' : ''}`}>\n          <Button \n            variant=\"outline\" \n            onClick={handleAutoReconcile}\n            size={isMobile ? 'sm' : 'default'}\n            className={isMobile ? 'flex-1' : ''}\n          >\n            <RefreshCw className=\"h-4 w-4 mr-2\" />\n            Auto Match\n          </Button>\n          <Button \n            onClick={handleCompleteReconciliation}\n            disabled={!isReconciled}\n            data-testid=\"button-complete-reconciliation\"\n            size={isMobile ? 'sm' : 'default'}\n            className={isMobile ? 'flex-1' : ''}\n          >\n            Complete Reconciliation\n          </Button>\n        </div>\n      </div>\n\n      {/* Reconciliation Setup */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Reconciliation Details</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-4 gap-4\">\n            <div>\n              <Label htmlFor=\"account\">Bank Account</Label>\n              <Select value={selectedAccount} onValueChange={setSelectedAccount}>\n                <SelectTrigger id=\"account\" data-testid=\"select-account\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"main-business\">Main Business Account</SelectItem>\n                  <SelectItem value=\"payroll\">Payroll Account</SelectItem>\n                  <SelectItem value=\"savings\">Savings Account</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <Label htmlFor=\"date\">Statement Date</Label>\n              <Input\n                id=\"date\"\n                type=\"date\"\n                value={reconciliationDate}\n                onChange={(e) => setReconciliationDate(e.target.value)}\n                data-testid=\"input-statement-date\"\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"balance\">Statement Balance</Label>\n              <Input\n                id=\"balance\"\n                type=\"number\"\n                step=\"0.01\"\n                value={statementBalance}\n                onChange={(e) => setStatementBalance(e.target.value)}\n                data-testid=\"input-statement-balance\"\n              />\n            </div>\n            <div>\n              <Label>Filters</Label>\n              <div className=\"flex gap-4 mt-2\">\n                <div className=\"flex items-center gap-2\">\n                  <Checkbox\n                    id=\"matched\"\n                    checked={showMatched}\n                    onCheckedChange={(checked) => setShowMatched(checked as boolean)}\n                  />\n                  <Label htmlFor=\"matched\" className=\"text-sm\">Matched</Label>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Checkbox\n                    id=\"unmatched\"\n                    checked={showUnmatched}\n                    onCheckedChange={(checked) => setShowUnmatched(checked as boolean)}\n                  />\n                  <Label htmlFor=\"unmatched\" className=\"text-sm\">Unmatched</Label>\n                </div>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Reconciliation Status */}\n      <div className=\"grid gap-4 md:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Book Balance</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{formatCurrency(bookBalance)}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              As per records\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Bank Balance</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{formatCurrency(bankStatementBalance)}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              As per statement\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Difference</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className={`text-2xl font-bold ${isReconciled ? 'text-green-600' : 'text-red-600'}`}>\n              {formatCurrency(Math.abs(difference))}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              {isReconciled ? 'Reconciled' : 'To reconcile'}\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Status</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center gap-2\">\n              {isReconciled ? (\n                <>\n                  <CheckCircle2 className=\"h-6 w-6 text-green-600\" />\n                  <span className=\"text-green-600 font-semibold\">Balanced</span>\n                </>\n              ) : (\n                <>\n                  <AlertCircle className=\"h-6 w-6 text-orange-600\" />\n                  <span className=\"text-orange-600 font-semibold\">Unbalanced</span>\n                </>\n              )}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              {reconciledTransactions.length} matched, {unreconciledTransactions.length} pending\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Transactions Tables */}\n      <div className=\"grid grid-cols-2 gap-4\">\n        {/* Book Transactions */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Book Transactions</CardTitle>\n          </CardHeader>\n          <CardContent className=\"p-0\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead className=\"w-8\"></TableHead>\n                  <TableHead>Date</TableHead>\n                  <TableHead>Description</TableHead>\n                  <TableHead>Amount</TableHead>\n                  <TableHead>Status</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {mockTransactions\n                  .filter(t => (showMatched && t.matched) || (showUnmatched && !t.matched))\n                  .map((transaction) => (\n                  <TableRow key={transaction.id} data-testid={`row-book-${transaction.id}`}>\n                    <TableCell>\n                      <Checkbox \n                        checked={transaction.matched}\n                        onCheckedChange={() => handleMatchTransaction(transaction.id, '')}\n                      />\n                    </TableCell>\n                    <TableCell>\n                      {format(new Date(transaction.date), 'MMM dd')}\n                    </TableCell>\n                    <TableCell>\n                      <div>\n                        <div className=\"font-medium\">{transaction.description}</div>\n                        <div className=\"text-xs text-muted-foreground\">{transaction.reference}</div>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-1\">\n                        {transaction.type === 'deposit' ? (\n                          <ArrowUpRight className=\"h-3 w-3 text-green-600\" />\n                        ) : (\n                          <ArrowDownRight className=\"h-3 w-3 text-red-600\" />\n                        )}\n                        <span className={transaction.type === 'deposit' ? 'text-green-600' : 'text-red-600'}>\n                          {formatCurrency(transaction.amount)}\n                        </span>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      {transaction.matched ? (\n                        <Badge variant=\"default\" className=\"gap-1 bg-green-100 text-green-800 border-green-200\">\n                          <CheckSquare className=\"h-3 w-3\" />\n                          Matched\n                        </Badge>\n                      ) : (\n                        <Badge variant=\"secondary\" className=\"gap-1\">\n                          <Square className=\"h-3 w-3\" />\n                          Unmatched\n                        </Badge>\n                      )}\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n\n        {/* Bank Statement Transactions */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Bank Statement</CardTitle>\n          </CardHeader>\n          <CardContent className=\"p-0\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead className=\"w-8\"></TableHead>\n                  <TableHead>Date</TableHead>\n                  <TableHead>Description</TableHead>\n                  <TableHead>Amount</TableHead>\n                  <TableHead>Status</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {mockBankTransactions.map((transaction) => (\n                  <TableRow key={transaction.id} data-testid={`row-bank-${transaction.id}`}>\n                    <TableCell>\n                      <Checkbox \n                        checked={transaction.matched}\n                        onCheckedChange={() => handleMatchTransaction('', transaction.id)}\n                      />\n                    </TableCell>\n                    <TableCell>\n                      {format(new Date(transaction.date), 'MMM dd')}\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"font-medium\">{transaction.description}</div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-1\">\n                        {transaction.amount > 0 ? (\n                          <ArrowUpRight className=\"h-3 w-3 text-green-600\" />\n                        ) : (\n                          <ArrowDownRight className=\"h-3 w-3 text-red-600\" />\n                        )}\n                        <span className={transaction.amount > 0 ? 'text-green-600' : 'text-red-600'}>\n                          {formatCurrency(Math.abs(transaction.amount))}\n                        </span>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      {transaction.matched ? (\n                        <Badge variant=\"default\" className=\"gap-1 bg-green-100 text-green-800 border-green-200\">\n                          <CheckSquare className=\"h-3 w-3\" />\n                          Matched\n                        </Badge>\n                      ) : (\n                        <Badge variant=\"secondary\" className=\"gap-1\">\n                          <Square className=\"h-3 w-3\" />\n                          Unmatched\n                        </Badge>\n                      )}\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":16683},"client/src/pages/purchases/BillsPage.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { queryClient, apiRequest } from '@/lib/queryClient';\nimport { Loader2, Trash2 } from 'lucide-react';\nimport type { Bill } from '@shared/schema';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { \n  Receipt, \n  Plus, \n  MoreHorizontal, \n  Eye, \n  Edit, \n  Copy,\n  Send,\n  Download,\n  CheckCircle,\n  Clock,\n  AlertCircle,\n  DollarSign,\n  Calendar,\n  Building2,\n  CreditCard\n} from 'lucide-react';\nimport { format } from 'date-fns';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { useToast } from '@/hooks/use-toast';\nimport { useIsMobile } from '@/hooks/use-mobile';\n\n// Bill form schema\nconst billSchema = z.object({\n  supplier_id: z.string().min(1, 'Please select a supplier'),\n  supplier_reference: z.string().min(1, 'Supplier reference is required'),\n  bill_date: z.string().min(1, 'Bill date is required'),\n  due_date: z.string().min(1, 'Due date is required'),\n  amount: z.string().min(1, 'Amount is required'),\n  description: z.string().min(2, 'Description must be at least 2 characters'),\n  notes: z.string().optional(),\n});\n\ntype BillForm = z.infer<typeof billSchema>;\n\n// Bills status configuration\nconst statusMapping = {\n  draft: 'draft',\n  approved: 'pending', \n  paid: 'paid',\n  overdue: 'overdue',\n  pending: 'pending',\n  partially_paid: 'partially_paid'\n} as const;\n\nconst statusConfig = {\n  draft: { label: 'Draft', icon: Edit, color: 'secondary' },\n  pending: { label: 'Pending', icon: Clock, color: 'default' },\n  partially_paid: { label: 'Partial', icon: DollarSign, color: 'warning' },\n  paid: { label: 'Paid', icon: CheckCircle, color: 'success' },\n  overdue: { label: 'Overdue', icon: AlertCircle, color: 'destructive' },\n  cancelled: { label: 'Cancelled', icon: Clock, color: 'secondary' },\n};\n\nexport default function BillsPage() {\n  const { toast } = useToast();\n  const isMobile = useIsMobile();\n  const [activeTab, setActiveTab] = useState('all');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [showDialog, setShowDialog] = useState(false);\n\n  // Fetch contacts (suppliers)\n  const { data: contacts = [] } = useQuery<any[]>({\n    queryKey: ['/api/contacts'],\n  });\n\n  const suppliers = contacts.filter(contact => \n    contact.type === 'supplier' || contact.type === 'both'\n  );\n\n  // Create bill mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: BillForm) => {\n      const processedData = {\n        ...data,\n        amount: parseFloat(data.amount),\n        status: 'draft',\n      };\n      return await apiRequest('POST', '/api/purchases/bills', processedData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/purchases/bills'] });\n      setShowDialog(false);\n      toast({\n        title: 'Bill created',\n        description: 'New bill has been created successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to create bill',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Form\n  const form = useForm<BillForm>({\n    resolver: zodResolver(billSchema),\n    defaultValues: {\n      supplier_id: '',\n      supplier_reference: '',\n      bill_date: new Date().toISOString().split('T')[0],\n      due_date: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 30 days from now\n      amount: '',\n      description: '',\n      notes: '',\n    },\n  });\n\n  const onSubmit = (data: BillForm) => {\n    createMutation.mutate(data);\n  };\n\n  // Fetch bills data\n  const { data: bills = [], isLoading, error, refetch } = useQuery({\n    queryKey: ['/api/purchases/bills'],\n    select: (data: any[]) => {\n      return data.map((bill: any) => ({\n        ...bill,\n        // Normalize status for UI consistency\n        status: statusMapping[bill.status as keyof typeof statusMapping] || bill.status,\n        // Ensure numeric fields\n        total: Number(bill.total || 0),\n        paid_amount: Number(bill.paid_amount || 0),\n        subtotal: Number(bill.subtotal || 0),\n        tax_total: Number(bill.tax_total || 0)\n      }));\n    }\n  });\n\n  // Delete mutation\n  const deleteMutation = useMutation({\n    mutationFn: (id: string) => apiRequest('DELETE', `/api/purchases/bills/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/purchases/bills'] });\n      toast({\n        title: 'Bill deleted',\n        description: 'Bill has been deleted successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to delete bill.',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Filter bills\n  const filteredBills = bills.filter((bill: any) => {\n    const matchesSearch = \n      bill.bill_number?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      bill.supplier_reference?.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    if (!matchesSearch) return false;\n    \n    switch (activeTab) {\n      case 'draft':\n        return bill.status === 'draft';\n      case 'pending':\n        return bill.status === 'pending';\n      case 'paid':\n        return bill.status === 'paid';\n      case 'overdue':\n        return bill.status === 'overdue';\n      default:\n        return true;\n    }\n  });\n\n  // Calculate statistics\n  const stats = {\n    total: bills.length,\n    totalAmount: bills.reduce((sum: number, b: any) => sum + (Number(b.total) || 0), 0),\n    paidAmount: bills.reduce((sum: number, b: any) => sum + (Number(b.paid_amount) || 0), 0),\n    outstanding: bills.reduce((sum: number, b: any) => sum + ((Number(b.total) || 0) - (Number(b.paid_amount) || 0)), 0),\n    overdue: bills.filter((b: any) => b.status === 'overdue').reduce((sum: number, b: any) => sum + (Number(b.total) || 0), 0),\n  };\n\n  const handlePayBill = (id: string) => {\n    toast({\n      title: 'Payment initiated',\n      description: 'Bill payment has been initiated successfully.',\n    });\n  };\n\n  const handleDuplicate = (id: string) => {\n    toast({\n      title: 'Bill duplicated',\n      description: 'A copy of the bill has been created.',\n    });\n  };\n\n  const handleDelete = (id: string) => {\n    if (confirm('Are you sure you want to delete this bill?')) {\n      deleteMutation.mutate(id);\n    }\n  };\n\n  // Loading state\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center p-8\">\n        <Loader2 className=\"h-8 w-8 animate-spin\" data-testid=\"loading-bills\" />\n      </div>\n    );\n  }\n\n  // Error state\n  if (error) {\n    return (\n      <div className=\"flex flex-col items-center justify-center p-8 text-center\">\n        <AlertCircle className=\"h-12 w-12 text-destructive mb-4\" />\n        <h3 className=\"text-lg font-semibold mb-2\">Error loading bills</h3>\n        <p className=\"text-muted-foreground mb-4\">There was a problem loading your bills data.</p>\n        <Button \n          onClick={() => queryClient.refetchQueries({ queryKey: ['/api/purchases/bills'] })}\n          data-testid=\"button-refresh-bills\"\n        >\n          Refresh\n        </Button>\n      </div>\n    );\n  }\n\n  const getStatusBadge = (status: string) => {\n    const config = statusConfig[status as keyof typeof statusConfig];\n    if (!config) return null;\n    \n    const Icon = config.icon;\n    return (\n      <Badge variant={config.color as any} className=\"gap-1\">\n        <Icon className=\"h-3 w-3\" />\n        {config.label}\n      </Badge>\n    );\n  };\n\n  const formatCurrency = (amount: number, currency: string) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: currency,\n    }).format(amount);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className={`${isMobile ? 'space-y-4' : 'flex items-center justify-between'}`}>\n        <div>\n          <h1 className={`${isMobile ? 'text-2xl' : 'text-3xl'} font-bold text-foreground`}>Bills</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            {isMobile ? 'Manage vendor bills' : 'Manage vendor bills and payables'}\n          </p>\n        </div>\n        <Dialog open={showDialog} onOpenChange={setShowDialog}>\n          <DialogTrigger asChild>\n            <Button \n              size={isMobile ? 'sm' : 'default'}\n              data-testid=\"button-new-bill\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Bill\n            </Button>\n          </DialogTrigger>\n          <DialogContent className={`max-w-2xl max-h-[90vh] overflow-y-auto ${isMobile ? 'w-full max-w-full mx-4' : ''}`}>\n            <DialogHeader>\n              <DialogTitle>Create New Bill</DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                <FormField\n                  control={form.control}\n                  name=\"supplier_id\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Supplier</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select supplier\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {suppliers.map((supplier) => (\n                            <SelectItem key={supplier.id} value={supplier.id}>\n                              {supplier.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"supplier_reference\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Supplier Reference</FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"Supplier's invoice number\" \n                            {...field} \n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"amount\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Amount</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            placeholder=\"0.00\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"bill_date\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Bill Date</FormLabel>\n                        <FormControl>\n                          <Input type=\"date\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"due_date\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Due Date</FormLabel>\n                        <FormControl>\n                          <Input type=\"date\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"description\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Description</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"Enter bill description\" \n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"notes\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Notes (Optional)</FormLabel>\n                      <FormControl>\n                        <Textarea\n                          placeholder=\"Additional notes...\"\n                          className=\"resize-none\"\n                          rows={3}\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex items-center gap-3 pt-4\">\n                  <Button type=\"submit\" disabled={createMutation.isPending}>\n                    {createMutation.isPending ? 'Creating...' : 'Create Bill'}\n                  </Button>\n                  <Button \n                    type=\"button\" \n                    variant=\"outline\" \n                    onClick={() => setShowDialog(false)}\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Statistics Cards */}\n      <div className={`grid gap-4 ${isMobile ? 'grid-cols-2' : 'grid-cols-2 md:grid-cols-4'}`}>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Bills</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.total}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              This month\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Amount</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {formatCurrency(stats.totalAmount, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              All bills\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Outstanding</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-orange-600\">\n              {formatCurrency(stats.outstanding, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              To be paid\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Overdue</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-red-600\">\n              {formatCurrency(stats.overdue, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Past due date\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <div className=\"flex items-center gap-4\">\n        <div className=\"flex-1\">\n          <Input\n            placeholder=\"Search bills...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"max-w-sm\"\n            data-testid=\"input-search-bills\"\n          />\n        </div>\n      </div>\n\n      {/* Tabs and Table */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList>\n          <TabsTrigger value=\"all\">All Bills</TabsTrigger>\n          <TabsTrigger value=\"draft\">Draft</TabsTrigger>\n          <TabsTrigger value=\"pending\">Pending</TabsTrigger>\n          <TabsTrigger value=\"paid\">Paid</TabsTrigger>\n          <TabsTrigger value=\"overdue\">Overdue</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value={activeTab} className=\"mt-4\">\n          <Card>\n            <CardContent className=\"p-0\">\n              <div className={isMobile ? \"mobile-table-container\" : \"\"}>\n                <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Bill Number</TableHead>\n                    <TableHead>Vendor</TableHead>\n                    <TableHead>Category</TableHead>\n                    <TableHead>Bill Date</TableHead>\n                    <TableHead>Due Date</TableHead>\n                    <TableHead>Total</TableHead>\n                    <TableHead>Balance</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredBills.map((bill: any) => (\n                    <TableRow key={bill.id} data-testid={`row-bill-${bill.id}`}>\n                      <TableCell className=\"font-medium\" data-label=\"Bill Number\">\n                        <div className=\"flex items-center gap-2\">\n                          <Receipt className=\"h-4 w-4 text-muted-foreground\" />\n                          {bill.bill_number}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Vendor\">\n                        <div className=\"flex items-center gap-2\">\n                          <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n                          {bill.supplier_reference || 'Supplier'}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Category\">General</TableCell>\n                      <TableCell data-label=\"Bill Date\">\n                        <div className=\"flex items-center gap-2\">\n                          <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                          {format(new Date(bill.date), 'MMM dd, yyyy')}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Due Date\">\n                        {format(new Date(bill.due_date), 'MMM dd, yyyy')}\n                      </TableCell>\n                      <TableCell className=\"font-semibold\" data-label=\"Total\">\n                        {formatCurrency(bill.total || 0, bill.currency || 'USD')}\n                      </TableCell>\n                      <TableCell className=\"font-semibold\" data-label=\"Balance\">\n                        {formatCurrency((bill.total || 0) - (bill.paid_amount || 0), bill.currency || 'USD')}\n                      </TableCell>\n                      <TableCell data-label=\"Status\">{getStatusBadge(bill.status)}</TableCell>\n                      <TableCell className=\"text-right\" data-label=\"Actions\">\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\" data-testid={`button-actions-${bill.id}`}>\n                              <MoreHorizontal className=\"h-4 w-4\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem>\n                              <Eye className=\"h-4 w-4 mr-2\" />\n                              View\n                            </DropdownMenuItem>\n                            <DropdownMenuItem>\n                              <Edit className=\"h-4 w-4 mr-2\" />\n                              Edit\n                            </DropdownMenuItem>\n                            <DropdownMenuItem onClick={() => handleDuplicate(bill.id)}>\n                              <Copy className=\"h-4 w-4 mr-2\" />\n                              Duplicate\n                            </DropdownMenuItem>\n                            {(bill.status === 'pending' || bill.status === 'overdue' || bill.status === 'partially_paid') && (\n                              <DropdownMenuItem onClick={() => handlePayBill(bill.id)}>\n                                <CreditCard className=\"h-4 w-4 mr-2\" />\n                                Make Payment\n                              </DropdownMenuItem>\n                            )}\n                            <DropdownMenuItem>\n                              <Download className=\"h-4 w-4 mr-2\" />\n                              Download PDF\n                            </DropdownMenuItem>\n                            <DropdownMenuSeparator />\n                            <DropdownMenuItem \n                              className=\"text-destructive\"\n                              onClick={() => handleDelete(bill.id)}\n                              disabled={deleteMutation.isPending}\n                              data-testid={`button-delete-${bill.id}`}\n                            >\n                              <Trash2 className=\"h-4 w-4 mr-2\" />\n                              Delete\n                            </DropdownMenuItem>\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n                </Table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":23376},"client/src/pages/purchases/DebitNotesPage.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { queryClient, apiRequest } from '@/lib/queryClient';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { \n  FileText, \n  Plus, \n  MoreHorizontal, \n  Eye, \n  Edit,\n  Copy,\n  Send,\n  Download,\n  RefreshCcw,\n  CheckCircle,\n  Clock,\n  AlertCircle,\n  MinusCircle,\n  Calendar,\n  Building2\n} from 'lucide-react';\nimport { format } from 'date-fns';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { useToast } from '@/hooks/use-toast';\nimport { useIsMobile } from '@/hooks/use-mobile';\n\n// Debit note form schema\nconst debitNoteSchema = z.object({\n  vendor_id: z.string().min(1, 'Please select a vendor'),\n  bill_id: z.string().min(1, 'Please select a related bill'),\n  amount: z.string().min(1, 'Amount is required'),\n  reason: z.string().min(2, 'Reason must be at least 2 characters'),\n  notes: z.string().optional(),\n  issue_date: z.string().min(1, 'Issue date is required'),\n});\n\ntype DebitNoteForm = z.infer<typeof debitNoteSchema>;\n\n// Mock data\nconst mockDebitNotes = [\n  {\n    id: '1',\n    debit_note_number: 'DN-2024-001',\n    vendor_name: 'Tech Suppliers Inc',\n    bill_number: 'BILL-2024-001',\n    issue_date: '2024-02-08',\n    total_amount: 450.00,\n    status: 'applied',\n    reason: 'Defective items',\n    currency: 'USD',\n  },\n  {\n    id: '2',\n    debit_note_number: 'DN-2024-002',\n    vendor_name: 'Office Equipment Co',\n    bill_number: 'BILL-2024-015',\n    issue_date: '2024-02-10',\n    total_amount: 850.00,\n    status: 'pending',\n    reason: 'Price adjustment',\n    currency: 'USD',\n  },\n  {\n    id: '3',\n    debit_note_number: 'DN-2024-003',\n    vendor_name: 'Software Solutions Ltd',\n    bill_number: 'BILL-2024-022',\n    issue_date: '2024-02-06',\n    total_amount: 2200.00,\n    status: 'partially_applied',\n    reason: 'Service cancellation',\n    currency: 'USD',\n  },\n  {\n    id: '4',\n    debit_note_number: 'DN-2024-004',\n    vendor_name: 'Industrial Supplies',\n    bill_number: 'BILL-2024-033',\n    issue_date: '2024-02-12',\n    total_amount: 600.00,\n    status: 'draft',\n    reason: 'Quantity discrepancy',\n    currency: 'USD',\n  },\n  {\n    id: '5',\n    debit_note_number: 'DN-2024-005',\n    vendor_name: 'Marketing Materials Inc',\n    bill_number: 'BILL-2024-041',\n    issue_date: '2024-02-11',\n    total_amount: 3500.00,\n    status: 'void',\n    reason: 'Duplicate billing',\n    currency: 'USD',\n  },\n];\n\nconst statusConfig = {\n  draft: { label: 'Draft', icon: Edit, color: 'secondary' },\n  pending: { label: 'Pending', icon: Clock, color: 'default' },\n  applied: { label: 'Applied', icon: CheckCircle, color: 'success' },\n  partially_applied: { label: 'Partial', icon: MinusCircle, color: 'warning' },\n  void: { label: 'Void', icon: AlertCircle, color: 'destructive' },\n};\n\nexport default function DebitNotesPage() {\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState('all');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [showDialog, setShowDialog] = useState(false);\n  const isMobile = useIsMobile();\n\n  // Fetch contacts (vendors)\n  const { data: contacts = [] } = useQuery<any[]>({\n    queryKey: ['/api/contacts'],\n  });\n\n  // Fetch bills\n  const { data: bills = [] } = useQuery<any[]>({\n    queryKey: ['/api/purchases/bills'],\n  });\n\n  const vendors = contacts.filter(contact => \n    contact.type === 'supplier' || contact.type === 'both'\n  );\n\n  // Create debit note mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: DebitNoteForm) => {\n      const processedData = {\n        ...data,\n        amount: parseFloat(data.amount),\n        status: 'draft',\n      };\n      return await apiRequest('POST', '/api/purchases/debit-notes', processedData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/purchases/debit-notes'] });\n      setShowDialog(false);\n      toast({\n        title: 'Debit note created',\n        description: 'New debit note has been created successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to create debit note',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Form\n  const form = useForm<DebitNoteForm>({\n    resolver: zodResolver(debitNoteSchema),\n    defaultValues: {\n      vendor_id: '',\n      bill_id: '',\n      amount: '',\n      reason: '',\n      notes: '',\n      issue_date: new Date().toISOString().split('T')[0],\n    },\n  });\n\n  const onSubmit = (data: DebitNoteForm) => {\n    createMutation.mutate(data);\n  };\n\n  const debitNotes = mockDebitNotes;\n\n  // Filter debit notes\n  const filteredDebitNotes = debitNotes.filter((note) => {\n    const matchesSearch = \n      note.debit_note_number.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      note.vendor_name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      note.bill_number.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    if (!matchesSearch) return false;\n    \n    switch (activeTab) {\n      case 'draft':\n        return note.status === 'draft';\n      case 'pending':\n        return note.status === 'pending';\n      case 'applied':\n        return note.status === 'applied' || note.status === 'partially_applied';\n      case 'void':\n        return note.status === 'void';\n      default:\n        return true;\n    }\n  });\n\n  // Calculate statistics\n  const stats = {\n    total: debitNotes.length,\n    totalAmount: debitNotes.reduce((sum, dn) => sum + dn.total_amount, 0),\n    applied: debitNotes.filter(dn => dn.status === 'applied').reduce((sum, dn) => sum + dn.total_amount, 0),\n    pending: debitNotes.filter(dn => dn.status === 'pending' || dn.status === 'partially_applied').reduce((sum, dn) => sum + dn.total_amount, 0),\n  };\n\n  const handleApplyToBill = (id: string) => {\n    toast({\n      title: 'Debit applied',\n      description: 'Debit note has been applied to the bill successfully.',\n    });\n  };\n\n  const handleSend = (id: string) => {\n    toast({\n      title: 'Debit note sent',\n      description: 'The debit note has been sent to the vendor.',\n    });\n  };\n\n  const handleVoid = (id: string) => {\n    if (confirm('Are you sure you want to void this debit note?')) {\n      toast({\n        title: 'Debit note voided',\n        description: 'The debit note has been voided successfully.',\n      });\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    const config = statusConfig[status as keyof typeof statusConfig];\n    if (!config) return null;\n    \n    const Icon = config.icon;\n    return (\n      <Badge variant={config.color as any} className=\"gap-1\">\n        <Icon className=\"h-3 w-3\" />\n        {config.label}\n      </Badge>\n    );\n  };\n\n  const formatCurrency = (amount: number, currency: string) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: currency,\n    }).format(amount);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Debit Notes</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Manage debit notes for vendor returns and adjustments\n          </p>\n        </div>\n        <Dialog open={showDialog} onOpenChange={setShowDialog}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-new-debit-note\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Debit Note\n            </Button>\n          </DialogTrigger>\n          <DialogContent className={`max-w-2xl max-h-[90vh] overflow-y-auto ${isMobile ? 'w-full max-w-full mx-4' : ''}`}>\n            <DialogHeader>\n              <DialogTitle>Create New Debit Note</DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"vendor_id\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Vendor</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Select vendor\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {vendors.map((vendor) => (\n                              <SelectItem key={vendor.id} value={vendor.id}>\n                                {vendor.name}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"bill_id\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Related Bill</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Select bill\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {bills.map((bill) => (\n                              <SelectItem key={bill.id} value={bill.id}>\n                                {bill.bill_number} - {bill.supplier_reference}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"amount\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Amount</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            placeholder=\"0.00\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"issue_date\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Issue Date</FormLabel>\n                        <FormControl>\n                          <Input type=\"date\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"reason\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Reason</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Enter reason for debit note\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"notes\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Notes (Optional)</FormLabel>\n                      <FormControl>\n                        <Textarea\n                          placeholder=\"Additional notes...\"\n                          className=\"resize-none\"\n                          rows={3}\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex items-center gap-3 pt-4\">\n                  <Button type=\"submit\" disabled={createMutation.isPending}>\n                    {createMutation.isPending ? 'Creating...' : 'Create Debit Note'}\n                  </Button>\n                  <Button \n                    type=\"button\" \n                    variant=\"outline\" \n                    onClick={() => setShowDialog(false)}\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Statistics Cards */}\n      <div className=\"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Debit Notes</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.total}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              This month\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Amount</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">\n              {formatCurrency(stats.totalAmount, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Debit issued\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Applied</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-blue-600\">\n              {formatCurrency(stats.applied, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              To bills\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Pending</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-orange-600\">\n              {formatCurrency(stats.pending, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              To be applied\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <div className=\"flex items-center gap-4\">\n        <div className=\"flex-1\">\n          <Input\n            placeholder=\"Search debit notes...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"max-w-sm\"\n            data-testid=\"input-search-debit-notes\"\n          />\n        </div>\n      </div>\n\n      {/* Tabs and Table */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList>\n          <TabsTrigger value=\"all\">All</TabsTrigger>\n          <TabsTrigger value=\"draft\">Draft</TabsTrigger>\n          <TabsTrigger value=\"pending\">Pending</TabsTrigger>\n          <TabsTrigger value=\"applied\">Applied</TabsTrigger>\n          <TabsTrigger value=\"void\">Void</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value={activeTab} className=\"mt-4\">\n          <Card>\n            <CardContent className=\"p-0\">\n              <div className={isMobile ? \"mobile-table-container\" : \"\"}>\n                <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Debit Note</TableHead>\n                      <TableHead>Vendor</TableHead>\n                      <TableHead>Related Bill</TableHead>\n                      <TableHead>Issue Date</TableHead>\n                      <TableHead>Reason</TableHead>\n                      <TableHead>Amount</TableHead>\n                      <TableHead>Status</TableHead>\n                      <TableHead className=\"text-right\">Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                <TableBody>\n                  {filteredDebitNotes.map((note) => (\n                    <TableRow key={note.id} data-testid={`row-debit-note-${note.id}`}>\n                      <TableCell className=\"font-medium\" data-label=\"Debit Note\">\n                        <div className=\"flex items-center gap-2\">\n                          <RefreshCcw className=\"h-4 w-4 text-muted-foreground\" />\n                          {note.debit_note_number}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Vendor\">\n                        <div className=\"flex items-center gap-2\">\n                          <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n                          {note.vendor_name}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Related Bill\">\n                        <div className=\"flex items-center gap-2\">\n                          <FileText className=\"h-4 w-4 text-muted-foreground\" />\n                          {note.bill_number}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Issue Date\">\n                        <div className=\"flex items-center gap-2\">\n                          <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                          {format(new Date(note.issue_date), 'MMM dd, yyyy')}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Reason\">{note.reason}</TableCell>\n                      <TableCell className=\"font-semibold text-green-600\" data-label=\"Amount\">\n                        +{formatCurrency(note.total_amount, note.currency)}\n                      </TableCell>\n                      <TableCell data-label=\"Status\">{getStatusBadge(note.status)}</TableCell>\n                      <TableCell className=\"text-right\" data-label=\"Actions\">\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\" data-testid={`button-actions-${note.id}`}>\n                              <MoreHorizontal className=\"h-4 w-4\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem>\n                              <Eye className=\"h-4 w-4 mr-2\" />\n                              View\n                            </DropdownMenuItem>\n                            <DropdownMenuItem>\n                              <Edit className=\"h-4 w-4 mr-2\" />\n                              Edit\n                            </DropdownMenuItem>\n                            <DropdownMenuItem>\n                              <Copy className=\"h-4 w-4 mr-2\" />\n                              Duplicate\n                            </DropdownMenuItem>\n                            {note.status === 'draft' && (\n                              <DropdownMenuItem onClick={() => handleSend(note.id)}>\n                                <Send className=\"h-4 w-4 mr-2\" />\n                                Send\n                              </DropdownMenuItem>\n                            )}\n                            {note.status === 'pending' && (\n                              <DropdownMenuItem onClick={() => handleApplyToBill(note.id)}>\n                                <CheckCircle className=\"h-4 w-4 mr-2\" />\n                                Apply to Bill\n                              </DropdownMenuItem>\n                            )}\n                            <DropdownMenuItem>\n                              <Download className=\"h-4 w-4 mr-2\" />\n                              Download PDF\n                            </DropdownMenuItem>\n                            <DropdownMenuSeparator />\n                            {note.status !== 'void' && (\n                              <DropdownMenuItem \n                                className=\"text-destructive\"\n                                onClick={() => handleVoid(note.id)}\n                              >\n                                <AlertCircle className=\"h-4 w-4 mr-2\" />\n                                Void\n                              </DropdownMenuItem>\n                            )}\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n                </Table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":22530},"client/src/pages/purchases/ExpensesPage.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { queryClient, apiRequest } from '@/lib/queryClient';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Switch } from '@/components/ui/switch';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { \n  Wallet, \n  Plus, \n  MoreHorizontal, \n  Eye, \n  Edit, \n  Copy,\n  CheckCircle,\n  Clock,\n  XCircle,\n  Calendar,\n  User,\n  Tag,\n  CreditCard,\n  Upload,\n  Paperclip\n} from 'lucide-react';\nimport { format } from 'date-fns';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { useToast } from '@/hooks/use-toast';\nimport { useIsMobile } from '@/hooks/use-mobile';\n\n// Expense form schema\nconst expenseSchema = z.object({\n  description: z.string().min(2, 'Description must be at least 2 characters'),\n  category: z.string().min(1, 'Please select a category'),\n  amount: z.string().min(1, 'Amount is required'),\n  date: z.string().min(1, 'Date is required'),\n  paid_by: z.string().min(1, 'Please specify who paid'),\n  payment_method: z.string().min(1, 'Please select payment method'),\n  reimbursable: z.boolean(),\n  notes: z.string().optional(),\n});\n\ntype ExpenseForm = z.infer<typeof expenseSchema>;\n\n// Available categories\nconst expenseCategories = [\n  'Travel',\n  'Office Supplies',\n  'Software',\n  'Entertainment',\n  'Utilities',\n  'Marketing',\n  'Training',\n  'Equipment',\n  'Meals',\n  'Communication',\n  'Other',\n];\n\n// Payment methods\nconst paymentMethods = [\n  'Cash',\n  'Credit Card',\n  'Company Card',\n  'Bank Transfer',\n  'Personal Card',\n  'Petty Cash',\n];\n\n// Mock data\nconst mockExpenses = [\n  {\n    id: '1',\n    expense_number: 'EXP-2024-001',\n    description: 'Business Travel - Client Meeting',\n    category: 'Travel',\n    date: '2024-02-10',\n    amount: 850.00,\n    paid_by: 'John Smith',\n    payment_method: 'Credit Card',\n    status: 'approved',\n    reimbursable: true,\n    currency: 'USD',\n    has_receipt: true,\n  },\n  {\n    id: '2',\n    expense_number: 'EXP-2024-002',\n    description: 'Office Supplies Purchase',\n    category: 'Office Supplies',\n    date: '2024-02-12',\n    amount: 250.00,\n    paid_by: 'Sarah Johnson',\n    payment_method: 'Cash',\n    status: 'pending',\n    reimbursable: true,\n    currency: 'USD',\n    has_receipt: true,\n  },\n  {\n    id: '3',\n    expense_number: 'EXP-2024-003',\n    description: 'Software Subscription - Monthly',\n    category: 'Software',\n    date: '2024-02-01',\n    amount: 299.00,\n    paid_by: 'Company Card',\n    payment_method: 'Company Card',\n    status: 'approved',\n    reimbursable: false,\n    currency: 'USD',\n    has_receipt: true,\n  },\n  {\n    id: '4',\n    expense_number: 'EXP-2024-004',\n    description: 'Client Dinner',\n    category: 'Entertainment',\n    date: '2024-02-14',\n    amount: 420.00,\n    paid_by: 'Mike Wilson',\n    payment_method: 'Credit Card',\n    status: 'rejected',\n    reimbursable: true,\n    currency: 'USD',\n    has_receipt: false,\n  },\n  {\n    id: '5',\n    expense_number: 'EXP-2024-005',\n    description: 'Internet Service - Monthly',\n    category: 'Utilities',\n    date: '2024-02-05',\n    amount: 99.00,\n    paid_by: 'Company Card',\n    payment_method: 'Bank Transfer',\n    status: 'approved',\n    reimbursable: false,\n    currency: 'USD',\n    has_receipt: true,\n  },\n];\n\nconst statusConfig = {\n  pending: { label: 'Pending', icon: Clock, color: 'default' },\n  approved: { label: 'Approved', icon: CheckCircle, color: 'success' },\n  rejected: { label: 'Rejected', icon: XCircle, color: 'destructive' },\n  reimbursed: { label: 'Reimbursed', icon: CreditCard, color: 'secondary' },\n};\n\nconst categoryColors = {\n  'Travel': 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300',\n  'Office Supplies': 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300',\n  'Software': 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300',\n  'Entertainment': 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300',\n  'Utilities': 'bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300',\n};\n\nexport default function ExpensesPage() {\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState('all');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [showDialog, setShowDialog] = useState(false);\n  const isMobile = useIsMobile();\n\n  // Create expense mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: ExpenseForm) => {\n      const processedData = {\n        ...data,\n        amount: parseFloat(data.amount),\n        status: 'pending',\n      };\n      return await apiRequest('POST', '/api/purchases/expenses', processedData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/purchases/expenses'] });\n      setShowDialog(false);\n      toast({\n        title: 'Expense created',\n        description: 'New expense has been created successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to create expense',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Form\n  const form = useForm<ExpenseForm>({\n    resolver: zodResolver(expenseSchema),\n    defaultValues: {\n      description: '',\n      category: '',\n      amount: '',\n      date: new Date().toISOString().split('T')[0],\n      paid_by: '',\n      payment_method: '',\n      reimbursable: true,\n      notes: '',\n    },\n  });\n\n  const onSubmit = (data: ExpenseForm) => {\n    createMutation.mutate(data);\n  };\n\n  const expenses = mockExpenses;\n\n  // Filter expenses\n  const filteredExpenses = expenses.filter((expense) => {\n    const matchesSearch = \n      expense.expense_number.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      expense.description.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      expense.category.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      expense.paid_by.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    if (!matchesSearch) return false;\n    \n    switch (activeTab) {\n      case 'pending':\n        return expense.status === 'pending';\n      case 'approved':\n        return expense.status === 'approved';\n      case 'rejected':\n        return expense.status === 'rejected';\n      case 'reimbursable':\n        return expense.reimbursable;\n      default:\n        return true;\n    }\n  });\n\n  // Calculate statistics\n  const stats = {\n    total: expenses.length,\n    totalAmount: expenses.reduce((sum, e) => sum + e.amount, 0),\n    pending: expenses.filter(e => e.status === 'pending').reduce((sum, e) => sum + e.amount, 0),\n    approved: expenses.filter(e => e.status === 'approved').reduce((sum, e) => sum + e.amount, 0),\n    reimbursable: expenses.filter(e => e.reimbursable && e.status === 'approved').reduce((sum, e) => sum + e.amount, 0),\n  };\n\n  const handleApprove = (id: string) => {\n    toast({\n      title: 'Expense approved',\n      description: 'The expense has been approved successfully.',\n    });\n  };\n\n  const handleReject = (id: string) => {\n    toast({\n      title: 'Expense rejected',\n      description: 'The expense has been rejected.',\n    });\n  };\n\n  const handleReimburse = (id: string) => {\n    toast({\n      title: 'Reimbursement processed',\n      description: 'The expense reimbursement has been initiated.',\n    });\n  };\n\n  const handleUploadReceipt = (id: string) => {\n    toast({\n      title: 'Receipt uploaded',\n      description: 'The receipt has been uploaded successfully.',\n    });\n  };\n\n  const getStatusBadge = (status: string) => {\n    const config = statusConfig[status as keyof typeof statusConfig];\n    if (!config) return null;\n    \n    const Icon = config.icon;\n    return (\n      <Badge variant={config.color as any} className=\"gap-1\">\n        <Icon className=\"h-3 w-3\" />\n        {config.label}\n      </Badge>\n    );\n  };\n\n  const getCategoryBadge = (category: string) => {\n    const colorClass = categoryColors[category as keyof typeof categoryColors] || 'bg-gray-100 text-gray-800';\n    return (\n      <Badge className={`${colorClass} border-0`}>\n        <Tag className=\"h-3 w-3 mr-1\" />\n        {category}\n      </Badge>\n    );\n  };\n\n  const formatCurrency = (amount: number, currency: string) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: currency,\n    }).format(amount);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className={`${isMobile ? 'space-y-4' : 'flex items-center justify-between'}`}>\n        <div>\n          <h1 className={`${isMobile ? 'text-2xl' : 'text-3xl'} font-bold text-foreground`}>Expenses</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            {isMobile ? 'Track business expenses' : 'Track and manage business expenses'}\n          </p>\n        </div>\n        <Dialog open={showDialog} onOpenChange={setShowDialog}>\n          <DialogTrigger asChild>\n            <Button \n              size={isMobile ? 'sm' : 'default'}\n              data-testid=\"button-new-expense\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Expense\n            </Button>\n          </DialogTrigger>\n          <DialogContent className={`max-w-2xl max-h-[90vh] overflow-y-auto ${isMobile ? 'w-full max-w-full mx-4' : ''}`}>\n            <DialogHeader>\n              <DialogTitle>Create New Expense</DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                <FormField\n                  control={form.control}\n                  name=\"description\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Description</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"Enter expense description\" \n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"category\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Category</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Select category\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {expenseCategories.map((category) => (\n                              <SelectItem key={category} value={category}>\n                                {category}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"amount\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Amount</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            placeholder=\"0.00\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"date\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Date</FormLabel>\n                        <FormControl>\n                          <Input type=\"date\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"paid_by\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Paid By</FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"Who paid for this expense?\" \n                            {...field} \n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"payment_method\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Payment Method</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select payment method\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {paymentMethods.map((method) => (\n                            <SelectItem key={method} value={method}>\n                              {method}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"reimbursable\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm\">\n                      <div className=\"space-y-0.5\">\n                        <FormLabel className=\"text-base\">\n                          Reimbursable\n                        </FormLabel>\n                        <div className=\"text-sm text-muted-foreground\">\n                          Should this expense be reimbursed?\n                        </div>\n                      </div>\n                      <FormControl>\n                        <Switch\n                          checked={field.value}\n                          onCheckedChange={field.onChange}\n                        />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"notes\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Notes (Optional)</FormLabel>\n                      <FormControl>\n                        <Textarea\n                          placeholder=\"Additional notes about this expense...\"\n                          className=\"resize-none\"\n                          rows={3}\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex items-center gap-3 pt-4\">\n                  <Button type=\"submit\" disabled={createMutation.isPending}>\n                    {createMutation.isPending ? 'Creating...' : 'Create Expense'}\n                  </Button>\n                  <Button \n                    type=\"button\" \n                    variant=\"outline\" \n                    onClick={() => setShowDialog(false)}\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Statistics Cards */}\n      <div className=\"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-5\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Expenses</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.total}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              This month\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Amount</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {formatCurrency(stats.totalAmount, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              All expenses\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Pending</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-orange-600\">\n              {formatCurrency(stats.pending, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Awaiting approval\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Approved</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">\n              {formatCurrency(stats.approved, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Approved expenses\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Reimbursable</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-blue-600\">\n              {formatCurrency(stats.reimbursable, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              To reimburse\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <div className=\"flex items-center gap-4\">\n        <div className=\"flex-1\">\n          <Input\n            placeholder=\"Search expenses...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"max-w-sm\"\n            data-testid=\"input-search-expenses\"\n          />\n        </div>\n      </div>\n\n      {/* Tabs and Table */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList>\n          <TabsTrigger value=\"all\">All Expenses</TabsTrigger>\n          <TabsTrigger value=\"pending\">Pending</TabsTrigger>\n          <TabsTrigger value=\"approved\">Approved</TabsTrigger>\n          <TabsTrigger value=\"rejected\">Rejected</TabsTrigger>\n          <TabsTrigger value=\"reimbursable\">Reimbursable</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value={activeTab} className=\"mt-4\">\n          <Card>\n            <CardContent className=\"p-0\">\n              <div className={isMobile ? \"mobile-table-container\" : \"\"}>\n                <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Expense #</TableHead>\n                      <TableHead>Description</TableHead>\n                      <TableHead>Category</TableHead>\n                      <TableHead>Date</TableHead>\n                      <TableHead>Paid By</TableHead>\n                      <TableHead>Payment</TableHead>\n                      <TableHead>Amount</TableHead>\n                      <TableHead>Status</TableHead>\n                      <TableHead>Receipt</TableHead>\n                      <TableHead className=\"text-right\">Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                <TableBody>\n                  {filteredExpenses.map((expense) => (\n                    <TableRow key={expense.id} data-testid={`row-expense-${expense.id}`}>\n                      <TableCell className=\"font-medium\" data-label=\"Expense #\">\n                        <div className=\"flex items-center gap-2\">\n                          <Wallet className=\"h-4 w-4 text-muted-foreground\" />\n                          {expense.expense_number}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Description\">\n                        <div className=\"max-w-[200px] truncate\">\n                          {expense.description}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Category\">{getCategoryBadge(expense.category)}</TableCell>\n                      <TableCell data-label=\"Date\">\n                        <div className=\"flex items-center gap-2\">\n                          <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                          {format(new Date(expense.date), 'MMM dd, yyyy')}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Paid By\">\n                        <div className=\"flex items-center gap-2\">\n                          <User className=\"h-4 w-4 text-muted-foreground\" />\n                          {expense.paid_by}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Payment\">{expense.payment_method}</TableCell>\n                      <TableCell className=\"font-semibold\" data-label=\"Amount\">\n                        {formatCurrency(expense.amount, expense.currency)}\n                      </TableCell>\n                      <TableCell data-label=\"Status\">{getStatusBadge(expense.status)}</TableCell>\n                      <TableCell data-label=\"Receipt\">\n                        {expense.has_receipt ? (\n                          <Paperclip className=\"h-4 w-4 text-green-600\" />\n                        ) : (\n                          <span className=\"text-muted-foreground\">-</span>\n                        )}\n                      </TableCell>\n                      <TableCell className=\"text-right\" data-label=\"Actions\">\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\" data-testid={`button-actions-${expense.id}`}>\n                              <MoreHorizontal className=\"h-4 w-4\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem>\n                              <Eye className=\"h-4 w-4 mr-2\" />\n                              View Details\n                            </DropdownMenuItem>\n                            <DropdownMenuItem>\n                              <Edit className=\"h-4 w-4 mr-2\" />\n                              Edit\n                            </DropdownMenuItem>\n                            <DropdownMenuItem>\n                              <Copy className=\"h-4 w-4 mr-2\" />\n                              Duplicate\n                            </DropdownMenuItem>\n                            {!expense.has_receipt && (\n                              <DropdownMenuItem onClick={() => handleUploadReceipt(expense.id)}>\n                                <Upload className=\"h-4 w-4 mr-2\" />\n                                Upload Receipt\n                              </DropdownMenuItem>\n                            )}\n                            {expense.status === 'pending' && (\n                              <>\n                                <DropdownMenuItem onClick={() => handleApprove(expense.id)}>\n                                  <CheckCircle className=\"h-4 w-4 mr-2\" />\n                                  Approve\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => handleReject(expense.id)}>\n                                  <XCircle className=\"h-4 w-4 mr-2\" />\n                                  Reject\n                                </DropdownMenuItem>\n                              </>\n                            )}\n                            {expense.status === 'approved' && expense.reimbursable && (\n                              <DropdownMenuItem onClick={() => handleReimburse(expense.id)}>\n                                <CreditCard className=\"h-4 w-4 mr-2\" />\n                                Reimburse\n                              </DropdownMenuItem>\n                            )}\n                            <DropdownMenuSeparator />\n                            <DropdownMenuItem className=\"text-destructive\">\n                              <XCircle className=\"h-4 w-4 mr-2\" />\n                              Delete\n                            </DropdownMenuItem>\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n                </Table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":26872},"client/src/pages/purchases/OrdersPage.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { queryClient, apiRequest } from '@/lib/queryClient';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { \n  ShoppingBag, \n  Plus, \n  MoreHorizontal, \n  Eye, \n  Edit, \n  Copy,\n  Send,\n  Package,\n  CheckCircle,\n  Clock,\n  XCircle,\n  ArrowRight,\n  Calendar,\n  Building2,\n  Truck\n} from 'lucide-react';\nimport { format } from 'date-fns';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { useToast } from '@/hooks/use-toast';\nimport { useIsMobile } from '@/hooks/use-mobile';\n\n// Purchase order form schema\nconst purchaseOrderSchema = z.object({\n  supplier_id: z.string().min(1, 'Please select a supplier'),\n  order_date: z.string().min(1, 'Order date is required'),\n  expected_date: z.string().min(1, 'Expected delivery date is required'),\n  description: z.string().min(2, 'Description must be at least 2 characters'),\n  amount: z.string().min(1, 'Amount is required'),\n  notes: z.string().optional(),\n});\n\ntype PurchaseOrderForm = z.infer<typeof purchaseOrderSchema>;\n\n// Mock data\nconst mockPurchaseOrders = [\n  {\n    id: '1',\n    po_number: 'PO-2024-001',\n    vendor_name: 'Tech Suppliers Inc',\n    order_date: '2024-02-08',\n    expected_date: '2024-02-20',\n    total_amount: 12500.00,\n    status: 'received',\n    currency: 'USD',\n    items_count: 8,\n    approval_status: 'approved',\n  },\n  {\n    id: '2',\n    po_number: 'PO-2024-002',\n    vendor_name: 'Office Equipment Co',\n    order_date: '2024-02-10',\n    expected_date: '2024-02-25',\n    total_amount: 5800.00,\n    status: 'shipped',\n    currency: 'USD',\n    items_count: 4,\n    approval_status: 'approved',\n  },\n  {\n    id: '3',\n    po_number: 'PO-2024-003',\n    vendor_name: 'Software Solutions Ltd',\n    order_date: '2024-02-12',\n    expected_date: '2024-03-01',\n    total_amount: 25000.00,\n    status: 'pending',\n    currency: 'USD',\n    items_count: 3,\n    approval_status: 'pending',\n  },\n  {\n    id: '4',\n    po_number: 'PO-2024-004',\n    vendor_name: 'Industrial Supplies',\n    order_date: '2024-02-14',\n    expected_date: '2024-02-28',\n    total_amount: 8900.00,\n    status: 'draft',\n    currency: 'USD',\n    items_count: 12,\n    approval_status: 'draft',\n  },\n  {\n    id: '5',\n    po_number: 'PO-2024-005',\n    vendor_name: 'Marketing Materials Inc',\n    order_date: '2024-02-05',\n    expected_date: '2024-02-15',\n    total_amount: 3200.00,\n    status: 'cancelled',\n    currency: 'USD',\n    items_count: 5,\n    approval_status: 'rejected',\n  },\n];\n\nconst statusConfig = {\n  draft: { label: 'Draft', icon: Edit, color: 'secondary' },\n  pending: { label: 'Pending', icon: Clock, color: 'default' },\n  approved: { label: 'Approved', icon: CheckCircle, color: 'success' },\n  shipped: { label: 'Shipped', icon: Truck, color: 'warning' },\n  received: { label: 'Received', icon: Package, color: 'success' },\n  cancelled: { label: 'Cancelled', icon: XCircle, color: 'destructive' },\n};\n\nconst approvalConfig = {\n  draft: { label: 'Draft', color: 'secondary' },\n  pending: { label: 'Pending Approval', color: 'default' },\n  approved: { label: 'Approved', color: 'success' },\n  rejected: { label: 'Rejected', color: 'destructive' },\n};\n\nexport default function PurchaseOrdersPage() {\n  const { toast } = useToast();\n  const isMobile = useIsMobile();\n  const [showDialog, setShowDialog] = useState(false);\n  \n  // Fetch contacts (suppliers)\n  const { data: contacts = [] } = useQuery<any[]>({\n    queryKey: ['/api/contacts'],\n  });\n\n  const suppliers = contacts.filter(contact => \n    contact.type === 'supplier' || contact.type === 'both'\n  );\n\n  // Create purchase order mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: PurchaseOrderForm) => {\n      const processedData = {\n        ...data,\n        amount: parseFloat(data.amount),\n        status: 'draft',\n        approval_status: 'pending',\n      };\n      return await apiRequest('POST', '/api/purchases/orders', processedData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/purchases/orders'] });\n      setShowDialog(false);\n      toast({\n        title: 'Purchase order created',\n        description: 'New purchase order has been created successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to create purchase order',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Form\n  const form = useForm<PurchaseOrderForm>({\n    resolver: zodResolver(purchaseOrderSchema),\n    defaultValues: {\n      supplier_id: '',\n      order_date: new Date().toISOString().split('T')[0],\n      expected_date: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 14 days from now\n      description: '',\n      amount: '',\n      notes: '',\n    },\n  });\n\n  const onSubmit = (data: PurchaseOrderForm) => {\n    createMutation.mutate(data);\n  };\n  const [activeTab, setActiveTab] = useState('all');\n  const [searchTerm, setSearchTerm] = useState('');\n\n  const orders = mockPurchaseOrders;\n\n  // Filter orders\n  const filteredOrders = orders.filter((order) => {\n    const matchesSearch = \n      order.po_number.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      order.vendor_name.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    if (!matchesSearch) return false;\n    \n    switch (activeTab) {\n      case 'draft':\n        return order.status === 'draft';\n      case 'pending':\n        return order.status === 'pending';\n      case 'approved':\n        return order.approval_status === 'approved';\n      case 'received':\n        return order.status === 'received';\n      default:\n        return true;\n    }\n  });\n\n  // Calculate statistics\n  const stats = {\n    total: orders.length,\n    totalValue: orders.reduce((sum, o) => sum + o.total_amount, 0),\n    pending: orders.filter(o => o.status === 'pending').length,\n    approved: orders.filter(o => o.approval_status === 'approved').length,\n    received: orders.filter(o => o.status === 'received').length,\n    avgValue: orders.reduce((sum, o) => sum + o.total_amount, 0) / orders.length,\n  };\n\n  const handleApprove = (id: string) => {\n    toast({\n      title: 'Order approved',\n      description: 'Purchase order has been approved successfully.',\n    });\n  };\n\n  const handleConvertToBill = (id: string) => {\n    toast({\n      title: 'Bill created',\n      description: 'Purchase order has been converted to a bill.',\n    });\n  };\n\n  const handleSend = (id: string) => {\n    toast({\n      title: 'Order sent',\n      description: 'Purchase order has been sent to the vendor.',\n    });\n  };\n\n  const handleCancel = (id: string) => {\n    if (confirm('Are you sure you want to cancel this purchase order?')) {\n      toast({\n        title: 'Order cancelled',\n        description: 'The purchase order has been cancelled.',\n      });\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    const config = statusConfig[status as keyof typeof statusConfig];\n    if (!config) return null;\n    \n    const Icon = config.icon;\n    return (\n      <Badge variant={config.color as any} className=\"gap-1\">\n        <Icon className=\"h-3 w-3\" />\n        {config.label}\n      </Badge>\n    );\n  };\n\n  const getApprovalBadge = (status: string) => {\n    const config = approvalConfig[status as keyof typeof approvalConfig];\n    if (!config) return null;\n    \n    return (\n      <Badge variant={config.color as any}>\n        {config.label}\n      </Badge>\n    );\n  };\n\n  const formatCurrency = (amount: number, currency: string) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: currency,\n    }).format(amount);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className={`${isMobile ? 'space-y-4' : 'flex items-center justify-between'}`}>\n        <div>\n          <h1 className={`${isMobile ? 'text-2xl' : 'text-3xl'} font-bold text-foreground`}>Purchase Orders</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            {isMobile ? 'Manage purchase orders' : 'Manage purchase orders and vendor deliveries'}\n          </p>\n        </div>\n        <Dialog open={showDialog} onOpenChange={setShowDialog}>\n          <DialogTrigger asChild>\n            <Button \n              size={isMobile ? 'sm' : 'default'}\n              data-testid=\"button-new-purchase-order\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Purchase Order\n            </Button>\n          </DialogTrigger>\n          <DialogContent className={`max-w-2xl max-h-[90vh] overflow-y-auto ${isMobile ? 'w-full max-w-full mx-4' : ''}`}>\n            <DialogHeader>\n              <DialogTitle>Create New Purchase Order</DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                <FormField\n                  control={form.control}\n                  name=\"supplier_id\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Supplier</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select supplier\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {suppliers.map((supplier) => (\n                            <SelectItem key={supplier.id} value={supplier.id}>\n                              {supplier.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"order_date\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Order Date</FormLabel>\n                        <FormControl>\n                          <Input type=\"date\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"expected_date\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Expected Delivery</FormLabel>\n                        <FormControl>\n                          <Input type=\"date\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"description\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Description</FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"Enter order description\" \n                            {...field} \n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"amount\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Amount</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            placeholder=\"0.00\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"notes\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Notes (Optional)</FormLabel>\n                      <FormControl>\n                        <Textarea\n                          placeholder=\"Additional notes...\"\n                          className=\"resize-none\"\n                          rows={3}\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex items-center gap-3 pt-4\">\n                  <Button type=\"submit\" disabled={createMutation.isPending}>\n                    {createMutation.isPending ? 'Creating...' : 'Create Purchase Order'}\n                  </Button>\n                  <Button \n                    type=\"button\" \n                    variant=\"outline\" \n                    onClick={() => setShowDialog(false)}\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Statistics Cards */}\n      <div className={`grid gap-4 ${isMobile ? 'grid-cols-2' : 'grid-cols-2 md:grid-cols-4'}`}>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Orders</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.total}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              This month\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Value</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {formatCurrency(stats.totalValue, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Purchase volume\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Pending Approval</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-orange-600\">\n              {stats.pending}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Need review\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Average Value</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {formatCurrency(stats.avgValue, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Per order\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <div className=\"flex items-center gap-4\">\n        <div className=\"flex-1\">\n          <Input\n            placeholder=\"Search purchase orders...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"max-w-sm\"\n            data-testid=\"input-search-purchase-orders\"\n          />\n        </div>\n      </div>\n\n      {/* Tabs and Table */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList>\n          <TabsTrigger value=\"all\">All Orders</TabsTrigger>\n          <TabsTrigger value=\"draft\">Draft</TabsTrigger>\n          <TabsTrigger value=\"pending\">Pending</TabsTrigger>\n          <TabsTrigger value=\"approved\">Approved</TabsTrigger>\n          <TabsTrigger value=\"received\">Received</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value={activeTab} className=\"mt-4\">\n          <Card>\n            <CardContent className=\"p-0\">\n              <div className={isMobile ? \"mobile-table-container\" : \"\"}>\n                <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>PO Number</TableHead>\n                    <TableHead>Vendor</TableHead>\n                    <TableHead>Order Date</TableHead>\n                    <TableHead>Expected Date</TableHead>\n                    <TableHead>Items</TableHead>\n                    <TableHead>Amount</TableHead>\n                    <TableHead>Approval</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredOrders.map((order) => (\n                    <TableRow key={order.id} data-testid={`row-purchase-order-${order.id}`}>\n                      <TableCell className=\"font-medium\" data-label=\"PO Number\">\n                        <div className=\"flex items-center gap-2\">\n                          <ShoppingBag className=\"h-4 w-4 text-muted-foreground\" />\n                          {order.po_number}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Vendor\">\n                        <div className=\"flex items-center gap-2\">\n                          <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n                          {order.vendor_name}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Order Date\">\n                        <div className=\"flex items-center gap-2\">\n                          <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                          {format(new Date(order.order_date), 'MMM dd, yyyy')}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Expected Date\">\n                        {format(new Date(order.expected_date), 'MMM dd, yyyy')}\n                      </TableCell>\n                      <TableCell data-label=\"Items\">{order.items_count} items</TableCell>\n                      <TableCell className=\"font-semibold\" data-label=\"Amount\">\n                        {formatCurrency(order.total_amount, order.currency)}\n                      </TableCell>\n                      <TableCell data-label=\"Approval\">{getApprovalBadge(order.approval_status)}</TableCell>\n                      <TableCell data-label=\"Status\">{getStatusBadge(order.status)}</TableCell>\n                      <TableCell className=\"text-right\" data-label=\"Actions\">\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\" data-testid={`button-actions-${order.id}`}>\n                              <MoreHorizontal className=\"h-4 w-4\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem>\n                              <Eye className=\"h-4 w-4 mr-2\" />\n                              View Details\n                            </DropdownMenuItem>\n                            <DropdownMenuItem>\n                              <Edit className=\"h-4 w-4 mr-2\" />\n                              Edit\n                            </DropdownMenuItem>\n                            <DropdownMenuItem>\n                              <Copy className=\"h-4 w-4 mr-2\" />\n                              Duplicate\n                            </DropdownMenuItem>\n                            {order.approval_status === 'pending' && (\n                              <DropdownMenuItem onClick={() => handleApprove(order.id)}>\n                                <CheckCircle className=\"h-4 w-4 mr-2\" />\n                                Approve\n                              </DropdownMenuItem>\n                            )}\n                            {order.approval_status === 'approved' && order.status === 'draft' && (\n                              <DropdownMenuItem onClick={() => handleSend(order.id)}>\n                                <Send className=\"h-4 w-4 mr-2\" />\n                                Send to Vendor\n                              </DropdownMenuItem>\n                            )}\n                            {order.status === 'received' && (\n                              <DropdownMenuItem onClick={() => handleConvertToBill(order.id)}>\n                                <ArrowRight className=\"h-4 w-4 mr-2\" />\n                                Convert to Bill\n                              </DropdownMenuItem>\n                            )}\n                            <DropdownMenuSeparator />\n                            <DropdownMenuItem \n                              className=\"text-destructive\"\n                              onClick={() => handleCancel(order.id)}\n                            >\n                              <XCircle className=\"h-4 w-4 mr-2\" />\n                              Cancel Order\n                            </DropdownMenuItem>\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n                </Table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":23043},"client/src/pages/reports/BalanceSheetPage.tsx":{"content":"import { useState } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { useIsMobile } from '@/hooks/use-mobile';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport { \n  FileText, \n  Download, \n  Printer, \n  Calendar,\n  TrendingUp,\n  TrendingDown,\n  DollarSign,\n  Building2,\n  CreditCard,\n  Wallet,\n  Loader2\n} from 'lucide-react';\nimport { format } from 'date-fns';\n\n// Mock financial data\nconst mockBalanceSheetData = {\n  date: '2024-02-29',\n  company: 'Acme Corporation',\n  currency: 'USD',\n  assets: {\n    current: [\n      { name: 'Cash and Cash Equivalents', amount: 45250.50 },\n      { name: 'Accounts Receivable', amount: 28500.00 },\n      { name: 'Inventory', amount: 35750.00 },\n      { name: 'Prepaid Expenses', amount: 4200.00 },\n    ],\n    nonCurrent: [\n      { name: 'Property, Plant & Equipment', amount: 125000.00 },\n      { name: 'Less: Accumulated Depreciation', amount: -25000.00 },\n      { name: 'Intangible Assets', amount: 15000.00 },\n      { name: 'Long-term Investments', amount: 20000.00 },\n    ],\n  },\n  liabilities: {\n    current: [\n      { name: 'Accounts Payable', amount: 18500.00 },\n      { name: 'Short-term Loans', amount: 10000.00 },\n      { name: 'Accrued Expenses', amount: 6750.00 },\n      { name: 'Current Portion of Long-term Debt', amount: 5000.00 },\n    ],\n    nonCurrent: [\n      { name: 'Long-term Debt', amount: 50000.00 },\n      { name: 'Deferred Tax Liabilities', amount: 8500.00 },\n      { name: 'Other Long-term Liabilities', amount: 3000.00 },\n    ],\n  },\n  equity: [\n    { name: 'Common Stock', amount: 50000.00 },\n    { name: 'Retained Earnings', amount: 86950.50 },\n    { name: 'Additional Paid-in Capital', amount: 10000.00 },\n  ],\n};\n\nexport default function BalanceSheetPage() {\n  const isMobile = useIsMobile();\n  const [selectedPeriod, setSelectedPeriod] = useState('current');\n  const [compareMode, setCompareMode] = useState(false);\n  const [selectedEndDate, setSelectedEndDate] = useState<Date | undefined>(undefined);\n\n  // Fetch balance sheet data from API\n  const { data: balanceSheetData, isLoading, error } = useQuery({\n    queryKey: ['/api/reports/balance-sheet', selectedEndDate],\n    queryFn: () => {\n      const url = new URL('/api/reports/balance-sheet', window.location.origin);\n      if (selectedEndDate) {\n        url.searchParams.set('endDate', selectedEndDate.toISOString());\n      }\n      return fetch(url.toString()).then(res => res.json());\n    }\n  });\n\n  // Use real data when available, fallback to mock for comparison\n  const balanceSheet = balanceSheetData || {\n    assets: { current: [], nonCurrent: [] },\n    liabilities: { current: [], nonCurrent: [] },\n    equity: [],\n    date: new Date()\n  };\n\n  // Calculate totals from real data with safe array access\n  const totalCurrentAssets = (balanceSheet.assets?.current || []).reduce((sum: number, item: any) => sum + (item.balance || 0), 0);\n  const totalNonCurrentAssets = (balanceSheet.assets?.nonCurrent || []).reduce((sum: number, item: any) => sum + (item.balance || 0), 0);\n  const totalAssets = totalCurrentAssets + totalNonCurrentAssets;\n\n  const totalCurrentLiabilities = (balanceSheet.liabilities?.current || []).reduce((sum: number, item: any) => sum + (item.balance || 0), 0);\n  const totalNonCurrentLiabilities = (balanceSheet.liabilities?.nonCurrent || []).reduce((sum: number, item: any) => sum + (item.balance || 0), 0);\n  const totalLiabilities = totalCurrentLiabilities + totalNonCurrentLiabilities;\n\n  const totalEquity = (balanceSheet.equity || []).reduce((sum: number, item: any) => sum + (item.balance || 0), 0);\n  const totalLiabilitiesAndEquity = totalLiabilities + totalEquity;\n\n  const formatCurrency = (amount: number) => {\n    const formatted = new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: 'USD',\n      minimumFractionDigits: 2,\n    }).format(Math.abs(amount));\n    \n    if (amount < 0) {\n      return `(${formatted})`;\n    }\n    return formatted;\n  };\n\n  const handleExport = (format: 'pdf' | 'excel') => {\n    console.log(`Exporting balance sheet as ${format}`);\n  };\n\n  const handlePrint = () => {\n    window.print();\n  };\n\n  // Show loading state\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-foreground\">Balance Sheet</h1>\n            <p className=\"text-muted-foreground mt-1\">Loading balance sheet data...</p>\n          </div>\n          <div className=\"flex gap-2\">\n            <Skeleton className=\"h-10 w-32\" />\n            <Skeleton className=\"h-10 w-32\" />\n            <Skeleton className=\"h-10 w-20\" />\n          </div>\n        </div>\n        <div className={`grid gap-4 ${isMobile ? 'grid-cols-1' : 'md:grid-cols-3'}`}>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <Skeleton className=\"h-4 w-24\" />\n            </CardHeader>\n            <CardContent>\n              <Skeleton className=\"h-8 w-32\" />\n              <Skeleton className=\"h-4 w-40 mt-1\" />\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <Skeleton className=\"h-4 w-32\" />\n            </CardHeader>\n            <CardContent>\n              <Skeleton className=\"h-8 w-32\" />\n              <Skeleton className=\"h-4 w-40 mt-1\" />\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <Skeleton className=\"h-4 w-24\" />\n            </CardHeader>\n            <CardContent>\n              <Skeleton className=\"h-8 w-32\" />\n              <Skeleton className=\"h-4 w-40 mt-1\" />\n            </CardContent>\n          </Card>\n        </div>\n        <Card>\n          <CardHeader>\n            <Skeleton className=\"h-6 w-48 mx-auto\" />\n            <Skeleton className=\"h-4 w-64 mx-auto\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-2\">\n              {Array.from({ length: 8 }).map((_, i) => (\n                <Skeleton key={i} className=\"h-6 w-full\" />\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  // Show error state\n  if (error) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-foreground\">Balance Sheet</h1>\n            <p className=\"text-muted-foreground mt-1\">Error loading balance sheet data</p>\n          </div>\n        </div>\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"text-center\">\n              <p className=\"text-red-600 mb-4\">Failed to load balance sheet data</p>\n              <Button onClick={() => window.location.reload()}>\n                Try Again\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Balance Sheet</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Statement of Financial Position as of {format(new Date(balanceSheet.date), 'MMMM dd, yyyy')}\n          </p>\n        </div>\n        <div className=\"mobile-button-group\">\n          <Button variant=\"outline\" onClick={() => handleExport('excel')} data-testid=\"button-export-excel\">\n            <Download className=\"h-4 w-4 mr-2\" />\n            Export Excel\n          </Button>\n          <Button variant=\"outline\" onClick={() => handleExport('pdf')} data-testid=\"button-export-pdf\">\n            <FileText className=\"h-4 w-4 mr-2\" />\n            Export PDF\n          </Button>\n          <Button variant=\"outline\" onClick={handlePrint} data-testid=\"button-print\">\n            <Printer className=\"h-4 w-4 mr-2\" />\n            Print\n          </Button>\n        </div>\n      </div>\n\n      {/* Period Selector */}\n      <div className=\"flex items-center gap-4\">\n        <div className=\"flex items-center gap-2\">\n          <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n          <Select value={selectedPeriod} onValueChange={setSelectedPeriod}>\n            <SelectTrigger className=\"w-[200px]\" data-testid=\"select-period\">\n              <SelectValue placeholder=\"Select period\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"current\">Current Month</SelectItem>\n              <SelectItem value=\"lastMonth\">Last Month</SelectItem>\n              <SelectItem value=\"quarter\">Current Quarter</SelectItem>\n              <SelectItem value=\"year\">Current Year</SelectItem>\n              <SelectItem value=\"lastYear\">Last Year</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n        <Button\n          variant={compareMode ? 'default' : 'outline'}\n          onClick={() => setCompareMode(!compareMode)}\n          data-testid=\"button-compare\"\n        >\n          Compare Periods\n        </Button>\n      </div>\n\n      {/* Summary Cards */}\n      <div className={`grid gap-4 ${isMobile ? 'grid-cols-1' : 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-3'}`}>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n              <Wallet className=\"h-4 w-4\" />\n              Total Assets\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{formatCurrency(totalAssets)}</div>\n            <div className=\"flex items-center gap-1 mt-1\">\n              <TrendingUp className=\"h-4 w-4 text-green-600\" />\n              <span className=\"text-sm text-green-600\">+12.5% from last period</span>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n              <CreditCard className=\"h-4 w-4\" />\n              Total Liabilities\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{formatCurrency(totalLiabilities)}</div>\n            <div className=\"flex items-center gap-1 mt-1\">\n              <TrendingDown className=\"h-4 w-4 text-green-600\" />\n              <span className=\"text-sm text-green-600\">-5.2% from last period</span>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n              <Building2 className=\"h-4 w-4\" />\n              Total Equity\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{formatCurrency(totalEquity)}</div>\n            <div className=\"flex items-center gap-1 mt-1\">\n              <TrendingUp className=\"h-4 w-4 text-green-600\" />\n              <span className=\"text-sm text-green-600\">+8.3% from last period</span>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Balance Sheet Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-center\">\n            Company Balance Sheet\n          </CardTitle>\n          <p className=\"text-center text-sm text-muted-foreground\">\n            Balance Sheet as of {format(new Date(balanceSheet.date), 'MMMM dd, yyyy')}\n          </p>\n        </CardHeader>\n        <CardContent>\n          <div className={isMobile ? \"mobile-table-container\" : \"\"}>\n            <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n            <TableHeader>\n              <TableRow>\n                <TableHead className=\"w-[60%]\">Account</TableHead>\n                <TableHead className=\"text-right\">Amount (USD)</TableHead>\n                {compareMode && (\n                  <TableHead className=\"text-right\">Previous Period</TableHead>\n                )}\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {/* Assets Section */}\n              <TableRow>\n                <TableCell colSpan={compareMode ? 3 : 2} className=\"font-bold bg-muted/50\">\n                  ASSETS\n                </TableCell>\n              </TableRow>\n              \n              {/* Current Assets */}\n              {balanceSheet.assets.current.length > 0 && (\n                <>\n                  <TableRow>\n                    <TableCell className=\"font-semibold pl-8\">Current Assets</TableCell>\n                    <TableCell></TableCell>\n                    {compareMode && <TableCell></TableCell>}\n                  </TableRow>\n                  {balanceSheet.assets.current.map((item: any, index: number) => (\n                    <TableRow key={`current-asset-${item.id || index}`}>\n                      <TableCell className=\"pl-12\" data-label=\"Account\">{item.name}</TableCell>\n                      <TableCell className=\"text-right\" data-label=\"Amount\">{formatCurrency(item.balance)}</TableCell>\n                      {compareMode && (\n                        <TableCell className=\"text-right text-muted-foreground\">\n                          {formatCurrency(item.balance * 0.9)}\n                        </TableCell>\n                      )}\n                    </TableRow>\n                  ))}\n                </>\n              )}\n              <TableRow>\n                <TableCell className=\"pl-8 font-semibold\" data-label=\"Account\">Total Current Assets</TableCell>\n                <TableCell className=\"text-right font-semibold\" data-label=\"Amount\">{formatCurrency(totalCurrentAssets)}</TableCell>\n                {compareMode && (\n                  <TableCell className=\"text-right text-muted-foreground font-semibold\">\n                    {formatCurrency(totalCurrentAssets * 0.9)}\n                  </TableCell>\n                )}\n              </TableRow>\n              \n              {/* Non-Current Assets */}\n              {balanceSheet.assets.nonCurrent.length > 0 && (\n                <>\n                  <TableRow>\n                    <TableCell className=\"font-semibold pl-8 pt-4\">Non-Current Assets</TableCell>\n                    <TableCell></TableCell>\n                    {compareMode && <TableCell></TableCell>}\n                  </TableRow>\n                  {balanceSheet.assets.nonCurrent.map((item: any, index: number) => (\n                    <TableRow key={`non-current-asset-${item.id || index}`}>\n                      <TableCell className=\"pl-12\" data-label=\"Account\">{item.name}</TableCell>\n                      <TableCell className=\"text-right\" data-label=\"Amount\">{formatCurrency(item.balance)}</TableCell>\n                      {compareMode && (\n                        <TableCell className=\"text-right text-muted-foreground\">\n                          {formatCurrency(item.balance * 0.95)}\n                        </TableCell>\n                      )}\n                    </TableRow>\n                  ))}\n                </>\n              )}\n              <TableRow>\n                <TableCell className=\"pl-8 font-semibold\" data-label=\"Account\">Total Non-Current Assets</TableCell>\n                <TableCell className=\"text-right font-semibold\" data-label=\"Amount\">{formatCurrency(totalNonCurrentAssets)}</TableCell>\n                {compareMode && (\n                  <TableCell className=\"text-right text-muted-foreground font-semibold\">\n                    {formatCurrency(totalNonCurrentAssets * 0.95)}\n                  </TableCell>\n                )}\n              </TableRow>\n              \n              <TableRow className=\"bg-muted/30\">\n                <TableCell className=\"font-bold\" data-label=\"Account\">TOTAL ASSETS</TableCell>\n                <TableCell className=\"text-right font-bold text-lg\" data-label=\"Amount\">{formatCurrency(totalAssets)}</TableCell>\n                {compareMode && (\n                  <TableCell className=\"text-right text-muted-foreground font-bold\">\n                    {formatCurrency(totalAssets * 0.92)}\n                  </TableCell>\n                )}\n              </TableRow>\n              \n              {/* Liabilities Section */}\n              <TableRow>\n                <TableCell colSpan={compareMode ? 3 : 2} className=\"font-bold bg-muted/50 pt-6\">\n                  LIABILITIES & EQUITY\n                </TableCell>\n              </TableRow>\n              \n              {/* Current Liabilities */}\n              {balanceSheet.liabilities.current.length > 0 && (\n                <>\n                  <TableRow>\n                    <TableCell className=\"font-semibold pl-8\">Current Liabilities</TableCell>\n                    <TableCell></TableCell>\n                    {compareMode && <TableCell></TableCell>}\n                  </TableRow>\n                  {balanceSheet.liabilities.current.map((item: any, index: number) => (\n                    <TableRow key={`current-liability-${item.id || index}`}>\n                      <TableCell className=\"pl-12\">{item.name}</TableCell>\n                      <TableCell className=\"text-right\">{formatCurrency(item.balance)}</TableCell>\n                      {compareMode && (\n                        <TableCell className=\"text-right text-muted-foreground\">\n                          {formatCurrency(item.balance * 1.1)}\n                        </TableCell>\n                      )}\n                    </TableRow>\n                  ))}\n                </>\n              )}\n              <TableRow>\n                <TableCell className=\"pl-8 font-semibold\">Total Current Liabilities</TableCell>\n                <TableCell className=\"text-right font-semibold\">{formatCurrency(totalCurrentLiabilities)}</TableCell>\n                {compareMode && (\n                  <TableCell className=\"text-right text-muted-foreground font-semibold\">\n                    {formatCurrency(totalCurrentLiabilities * 1.1)}\n                  </TableCell>\n                )}\n              </TableRow>\n              \n              {/* Non-Current Liabilities */}\n              {balanceSheet.liabilities.nonCurrent.length > 0 && (\n                <>\n                  <TableRow>\n                    <TableCell className=\"font-semibold pl-8 pt-4\">Non-Current Liabilities</TableCell>\n                    <TableCell></TableCell>\n                    {compareMode && <TableCell></TableCell>}\n                  </TableRow>\n                  {balanceSheet.liabilities.nonCurrent.map((item: any, index: number) => (\n                    <TableRow key={`non-current-liability-${item.id || index}`}>\n                      <TableCell className=\"pl-12\">{item.name}</TableCell>\n                      <TableCell className=\"text-right\">{formatCurrency(item.balance)}</TableCell>\n                      {compareMode && (\n                        <TableCell className=\"text-right text-muted-foreground\">\n                          {formatCurrency(item.balance * 0.95)}\n                        </TableCell>\n                      )}\n                    </TableRow>\n                  ))}\n                </>\n              )}\n              <TableRow>\n                <TableCell className=\"pl-8 font-semibold\">Total Non-Current Liabilities</TableCell>\n                <TableCell className=\"text-right font-semibold\">{formatCurrency(totalNonCurrentLiabilities)}</TableCell>\n                {compareMode && (\n                  <TableCell className=\"text-right text-muted-foreground font-semibold\">\n                    {formatCurrency(totalNonCurrentLiabilities * 0.95)}\n                  </TableCell>\n                )}\n              </TableRow>\n              \n              <TableRow>\n                <TableCell className=\"font-bold pl-4\">Total Liabilities</TableCell>\n                <TableCell className=\"text-right font-bold\">{formatCurrency(totalLiabilities)}</TableCell>\n                {compareMode && (\n                  <TableCell className=\"text-right text-muted-foreground font-bold\">\n                    {formatCurrency(totalLiabilities * 1.02)}\n                  </TableCell>\n                )}\n              </TableRow>\n              \n              {/* Equity Section */}\n              {balanceSheet.equity.length > 0 && (\n                <>\n                  <TableRow>\n                    <TableCell className=\"font-semibold pl-8 pt-4\">Shareholders' Equity</TableCell>\n                    <TableCell></TableCell>\n                    {compareMode && <TableCell></TableCell>}\n                  </TableRow>\n                  {balanceSheet.equity.map((item: any, index: number) => (\n                    <TableRow key={`equity-${item.id || index}`}>\n                      <TableCell className=\"pl-12\">{item.name}</TableCell>\n                      <TableCell className=\"text-right\">{formatCurrency(item.balance)}</TableCell>\n                      {compareMode && (\n                        <TableCell className=\"text-right text-muted-foreground\">\n                          {formatCurrency(item.balance * 0.9)}\n                        </TableCell>\n                      )}\n                    </TableRow>\n                  ))}\n                </>\n              )}\n              <TableRow>\n                <TableCell className=\"font-bold pl-4\">Total Equity</TableCell>\n                <TableCell className=\"text-right font-bold\">{formatCurrency(totalEquity)}</TableCell>\n                {compareMode && (\n                  <TableCell className=\"text-right text-muted-foreground font-bold\">\n                    {formatCurrency(totalEquity * 0.9)}\n                  </TableCell>\n                )}\n              </TableRow>\n              \n              <TableRow className=\"bg-muted/30\">\n                <TableCell className=\"font-bold\">TOTAL LIABILITIES & EQUITY</TableCell>\n                <TableCell className=\"text-right font-bold text-lg\">{formatCurrency(totalLiabilitiesAndEquity)}</TableCell>\n                {compareMode && (\n                  <TableCell className=\"text-right text-muted-foreground font-bold\">\n                    {formatCurrency(totalLiabilitiesAndEquity * 0.92)}\n                  </TableCell>\n                )}\n              </TableRow>\n            </TableBody>\n            </Table>\n          </div>\n          \n          {/* Balance Check */}\n          <div className=\"mt-4 p-4 bg-muted/30 rounded-lg\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"font-semibold\">Balance Check:</span>\n              <Badge variant={Math.abs(totalAssets - totalLiabilitiesAndEquity) < 0.01 ? 'default' : 'destructive'}>\n                {Math.abs(totalAssets - totalLiabilitiesAndEquity) < 0.01 ? 'Balanced' : 'Imbalanced'}\n              </Badge>\n            </div>\n            {Math.abs(totalAssets - totalLiabilitiesAndEquity) >= 0.01 && (\n              <p className=\"text-sm text-destructive mt-2\">\n                Difference: {formatCurrency(totalAssets - totalLiabilitiesAndEquity)}\n              </p>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":23456},"client/src/pages/reports/CashFlowPage.tsx":{"content":"import { useState } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { useIsMobile } from '@/hooks/use-mobile';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport { \n  FileText, \n  Download, \n  Printer, \n  Calendar,\n  TrendingUp,\n  TrendingDown,\n  DollarSign,\n  ArrowUpRight,\n  ArrowDownRight,\n  Loader2\n} from 'lucide-react';\nimport { format } from 'date-fns';\n\n// Mock cash flow data\nconst mockCashFlowData = {\n  period: '2024-02',\n  company: 'Acme Corporation',\n  currency: 'USD',\n  beginningCash: 35250.50,\n  operatingActivities: [\n    { item: 'Net Income', amount: 16500.00, isInflow: true },\n    { item: 'Depreciation & Amortization', amount: 3500.00, isInflow: true },\n    { item: 'Increase in Accounts Receivable', amount: -5000.00, isInflow: false },\n    { item: 'Decrease in Inventory', amount: 2500.00, isInflow: true },\n    { item: 'Increase in Accounts Payable', amount: 3000.00, isInflow: true },\n    { item: 'Decrease in Accrued Expenses', amount: -1500.00, isInflow: false },\n  ],\n  investingActivities: [\n    { item: 'Purchase of Equipment', amount: -15000.00, isInflow: false },\n    { item: 'Sale of Investments', amount: 5000.00, isInflow: true },\n    { item: 'Purchase of Software Licenses', amount: -2500.00, isInflow: false },\n  ],\n  financingActivities: [\n    { item: 'Proceeds from Long-term Loan', amount: 20000.00, isInflow: true },\n    { item: 'Repayment of Short-term Loan', amount: -10000.00, isInflow: false },\n    { item: 'Dividend Payments', amount: -5000.00, isInflow: false },\n    { item: 'Interest Payments', amount: -1500.00, isInflow: false },\n  ],\n};\n\nexport default function CashFlowPage() {\n  const isMobile = useIsMobile();\n  const [selectedPeriod, setSelectedPeriod] = useState('month');\n  const [viewType, setViewType] = useState('indirect');\n\n  // Get current year dates for API call\n  const currentYear = new Date().getFullYear();\n  const startDate = new Date(currentYear, 0, 1).toISOString().split('T')[0]; // Jan 1\n  const endDate = new Date(currentYear, 11, 31).toISOString().split('T')[0]; // Dec 31\n\n  // Fetch cash flow data using React Query\n  const { \n    data: cashFlowData, \n    isLoading, \n    error \n  } = useQuery({\n    queryKey: ['/api/reports/cash-flow', startDate, endDate],\n    queryFn: async () => {\n      const response = await fetch(`/api/reports/cash-flow?startDate=${startDate}&endDate=${endDate}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch cash flow data');\n      }\n      return response.json();\n    },\n  });\n\n  // Use API data if available, fallback to mock data for structure\n  const displayData = cashFlowData || mockCashFlowData;\n\n  // Calculate totals from API data\n  const operatingCashFlow = displayData.operatingCashFlow || displayData.operatingActivities?.reduce((sum: number, item: any) => sum + item.amount, 0) || 0;\n  const investingCashFlow = displayData.investingCashFlow || displayData.investingActivities?.reduce((sum: number, item: any) => sum + item.amount, 0) || 0;\n  const financingCashFlow = displayData.financingCashFlow || displayData.financingActivities?.reduce((sum: number, item: any) => sum + item.amount, 0) || 0;\n  \n  const netCashFlow = displayData.netCashFlow || (operatingCashFlow + investingCashFlow + financingCashFlow);\n  const endingCash = displayData.endingCash || (displayData.beginningCash + netCashFlow);\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: displayData.currency || 'USD',\n    }).format(amount);\n  };\n\n  // Handle loading state\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-foreground\">Cash Flow Statement</h1>\n            <p className=\"text-muted-foreground mt-1\">Loading cash flow data...</p>\n          </div>\n        </div>\n        <div className=\"flex items-center justify-center py-8\">\n          <Loader2 className=\"h-8 w-8 animate-spin\" />\n          <span className=\"ml-2 text-muted-foreground\">Loading cash flow statement...</span>\n        </div>\n      </div>\n    );\n  }\n\n  // Handle error state\n  if (error) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-foreground\">Cash Flow Statement</h1>\n            <p className=\"text-muted-foreground mt-1\">Error loading cash flow data</p>\n          </div>\n        </div>\n        <Card>\n          <CardContent className=\"py-8\">\n            <div className=\"text-center\">\n              <p className=\"text-destructive mb-4\">Failed to load cash flow data: {error.message}</p>\n              <Button onClick={() => window.location.reload()} variant=\"outline\" data-testid=\"button-retry\">\n                Try Again\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const handleExport = (format: 'pdf' | 'excel') => {\n    console.log(`Exporting cash flow statement as ${format}`);\n  };\n\n  const handlePrint = () => {\n    window.print();\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Cash Flow Statement</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Cash flow analysis for {displayData.startDate && displayData.endDate ? format(new Date(displayData.startDate), 'MMMM yyyy') : format(new Date(), 'MMMM yyyy')}\n          </p>\n        </div>\n        <div className=\"mobile-button-group\">\n          <Select value={selectedPeriod} onValueChange={setSelectedPeriod}>\n            <SelectTrigger className=\"w-32\" data-testid=\"select-period\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"month\">This Month</SelectItem>\n              <SelectItem value=\"quarter\">This Quarter</SelectItem>\n              <SelectItem value=\"year\">This Year</SelectItem>\n              <SelectItem value=\"custom\">Custom Range</SelectItem>\n            </SelectContent>\n          </Select>\n          <Select value={viewType} onValueChange={setViewType}>\n            <SelectTrigger className=\"w-32\" data-testid=\"select-view\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"indirect\">Indirect Method</SelectItem>\n              <SelectItem value=\"direct\">Direct Method</SelectItem>\n            </SelectContent>\n          </Select>\n          <Button variant=\"outline\" onClick={() => handleExport('pdf')} data-testid=\"button-export\">\n            <Download className=\"h-4 w-4 mr-2\" />\n            Export\n          </Button>\n          <Button variant=\"outline\" onClick={handlePrint} data-testid=\"button-print\">\n            <Printer className=\"h-4 w-4 mr-2\" />\n            Print\n          </Button>\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-5\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Beginning Cash</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-beginning-cash\">{formatCurrency(displayData.beginningCash || 0)}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Start of period\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Operating Cash</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className={`text-2xl font-bold ${operatingCashFlow >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n              {formatCurrency(Math.abs(operatingCashFlow))}\n            </div>\n            <div className=\"flex items-center text-xs mt-1\">\n              {operatingCashFlow >= 0 ? (\n                <ArrowUpRight className=\"h-3 w-3 mr-1 text-green-600\" />\n              ) : (\n                <ArrowDownRight className=\"h-3 w-3 mr-1 text-red-600\" />\n              )}\n              {operatingCashFlow >= 0 ? 'Inflow' : 'Outflow'}\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Investing Cash</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className={`text-2xl font-bold ${investingCashFlow >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n              {formatCurrency(Math.abs(investingCashFlow))}\n            </div>\n            <div className=\"flex items-center text-xs mt-1\">\n              {investingCashFlow >= 0 ? (\n                <ArrowUpRight className=\"h-3 w-3 mr-1 text-green-600\" />\n              ) : (\n                <ArrowDownRight className=\"h-3 w-3 mr-1 text-red-600\" />\n              )}\n              {investingCashFlow >= 0 ? 'Inflow' : 'Outflow'}\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Financing Cash</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className={`text-2xl font-bold ${financingCashFlow >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n              {formatCurrency(Math.abs(financingCashFlow))}\n            </div>\n            <div className=\"flex items-center text-xs mt-1\">\n              {financingCashFlow >= 0 ? (\n                <ArrowUpRight className=\"h-3 w-3 mr-1 text-green-600\" />\n              ) : (\n                <ArrowDownRight className=\"h-3 w-3 mr-1 text-red-600\" />\n              )}\n              {financingCashFlow >= 0 ? 'Inflow' : 'Outflow'}\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Ending Cash</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-ending-cash\">{formatCurrency(endingCash)}</div>\n            <Badge variant={netCashFlow >= 0 ? \"default\" : \"destructive\"} className=\"text-xs mt-1\">\n              {netCashFlow >= 0 ? '+' : ''}{formatCurrency(netCashFlow)}\n            </Badge>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Detailed Cash Flow Statement */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Cash Flow Statement - {viewType === 'indirect' ? 'Indirect Method' : 'Direct Method'}</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className={isMobile ? \"mobile-table-container\" : \"overflow-x-auto\"}>\n            <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n            <TableHeader>\n              <TableRow>\n                <TableHead className=\"w-[500px]\">Description</TableHead>\n                <TableHead className=\"text-right\">Cash Inflow</TableHead>\n                <TableHead className=\"text-right\">Cash Outflow</TableHead>\n                <TableHead className=\"text-right\">Net Amount</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {/* Beginning Cash */}\n              <TableRow className=\"font-bold bg-muted/50\">\n                <TableCell>BEGINNING CASH BALANCE</TableCell>\n                <TableCell className=\"text-right\"></TableCell>\n                <TableCell className=\"text-right\"></TableCell>\n                <TableCell className=\"text-right\" data-testid=\"text-table-beginning-cash\">{formatCurrency(displayData.beginningCash || 0)}</TableCell>\n              </TableRow>\n\n              {/* Operating Activities */}\n              <TableRow className=\"font-semibold bg-blue-50 dark:bg-blue-900/20\">\n                <TableCell>CASH FLOWS FROM OPERATING ACTIVITIES</TableCell>\n                <TableCell className=\"text-right\"></TableCell>\n                <TableCell className=\"text-right\"></TableCell>\n                <TableCell className=\"text-right\"></TableCell>\n              </TableRow>\n              {(displayData.operatingActivities || []).map((item: any, index: number) => (\n                <TableRow key={index}>\n                  <TableCell className=\"pl-8\">{item.item}</TableCell>\n                  <TableCell className=\"text-right text-green-600\">\n                    {item.isInflow ? formatCurrency(Math.abs(item.amount)) : ''}\n                  </TableCell>\n                  <TableCell className=\"text-right text-red-600\">\n                    {!item.isInflow ? formatCurrency(Math.abs(item.amount)) : ''}\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    <span className={item.amount >= 0 ? 'text-green-600' : 'text-red-600'}>\n                      {formatCurrency(item.amount)}\n                    </span>\n                  </TableCell>\n                </TableRow>\n              ))}\n              <TableRow className=\"font-semibold\">\n                <TableCell>Net Cash from Operating Activities</TableCell>\n                <TableCell className=\"text-right\"></TableCell>\n                <TableCell className=\"text-right\"></TableCell>\n                <TableCell className={`text-right ${operatingCashFlow >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n                  {formatCurrency(operatingCashFlow)}\n                </TableCell>\n              </TableRow>\n\n              {/* Investing Activities */}\n              <TableRow className=\"font-semibold bg-purple-50 dark:bg-purple-900/20\">\n                <TableCell>CASH FLOWS FROM INVESTING ACTIVITIES</TableCell>\n                <TableCell className=\"text-right\"></TableCell>\n                <TableCell className=\"text-right\"></TableCell>\n                <TableCell className=\"text-right\"></TableCell>\n              </TableRow>\n              {(displayData.investingActivities || []).map((item: any, index: number) => (\n                <TableRow key={index}>\n                  <TableCell className=\"pl-8\">{item.item}</TableCell>\n                  <TableCell className=\"text-right text-green-600\">\n                    {item.isInflow ? formatCurrency(Math.abs(item.amount)) : ''}\n                  </TableCell>\n                  <TableCell className=\"text-right text-red-600\">\n                    {!item.isInflow ? formatCurrency(Math.abs(item.amount)) : ''}\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    <span className={item.amount >= 0 ? 'text-green-600' : 'text-red-600'}>\n                      {formatCurrency(item.amount)}\n                    </span>\n                  </TableCell>\n                </TableRow>\n              ))}\n              <TableRow className=\"font-semibold\">\n                <TableCell>Net Cash from Investing Activities</TableCell>\n                <TableCell className=\"text-right\"></TableCell>\n                <TableCell className=\"text-right\"></TableCell>\n                <TableCell className={`text-right ${investingCashFlow >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n                  {formatCurrency(investingCashFlow)}\n                </TableCell>\n              </TableRow>\n\n              {/* Financing Activities */}\n              <TableRow className=\"font-semibold bg-orange-50 dark:bg-orange-900/20\">\n                <TableCell>CASH FLOWS FROM FINANCING ACTIVITIES</TableCell>\n                <TableCell className=\"text-right\"></TableCell>\n                <TableCell className=\"text-right\"></TableCell>\n                <TableCell className=\"text-right\"></TableCell>\n              </TableRow>\n              {(displayData.financingActivities || []).map((item: any, index: number) => (\n                <TableRow key={index}>\n                  <TableCell className=\"pl-8\">{item.item}</TableCell>\n                  <TableCell className=\"text-right text-green-600\">\n                    {item.isInflow ? formatCurrency(Math.abs(item.amount)) : ''}\n                  </TableCell>\n                  <TableCell className=\"text-right text-red-600\">\n                    {!item.isInflow ? formatCurrency(Math.abs(item.amount)) : ''}\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    <span className={item.amount >= 0 ? 'text-green-600' : 'text-red-600'}>\n                      {formatCurrency(item.amount)}\n                    </span>\n                  </TableCell>\n                </TableRow>\n              ))}\n              <TableRow className=\"font-semibold\">\n                <TableCell>Net Cash from Financing Activities</TableCell>\n                <TableCell className=\"text-right\"></TableCell>\n                <TableCell className=\"text-right\"></TableCell>\n                <TableCell className={`text-right ${financingCashFlow >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n                  {formatCurrency(financingCashFlow)}\n                </TableCell>\n              </TableRow>\n\n              {/* Net Change in Cash */}\n              <TableRow className=\"font-bold bg-gray-100 dark:bg-gray-800\">\n                <TableCell>NET CHANGE IN CASH</TableCell>\n                <TableCell className=\"text-right\"></TableCell>\n                <TableCell className=\"text-right\"></TableCell>\n                <TableCell className={`text-right text-lg ${netCashFlow >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n                  {formatCurrency(netCashFlow)}\n                </TableCell>\n              </TableRow>\n\n              {/* Ending Cash */}\n              <TableRow className=\"font-bold bg-green-100 dark:bg-green-900/30 text-lg\">\n                <TableCell>ENDING CASH BALANCE</TableCell>\n                <TableCell className=\"text-right\"></TableCell>\n                <TableCell className=\"text-right\"></TableCell>\n                <TableCell className=\"text-right text-green-600\">\n                  {formatCurrency(endingCash)}\n                </TableCell>\n              </TableRow>\n            </TableBody>\n            </Table>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":18586},"client/src/pages/reports/InventoryPage.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { queryClient, apiRequest } from '@/lib/queryClient';\nimport { useIsMobile } from '@/hooks/use-mobile';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useToast } from '@/hooks/use-toast';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport { \n  Package, \n  Plus, \n  Download, \n  Printer, \n  Calendar,\n  TrendingUp,\n  TrendingDown,\n  AlertTriangle,\n  CheckCircle,\n  BarChart3,\n  ArrowUpRight,\n  ArrowDownRight\n} from 'lucide-react';\nimport { format } from 'date-fns';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\n\n// Inventory item form schema\nconst inventoryItemSchema = z.object({\n  sku: z.string().min(1, 'SKU is required'),\n  name: z.string().min(2, 'Name must be at least 2 characters'),\n  category: z.string().min(1, 'Category is required'),\n  quantity: z.string().min(1, 'Quantity is required'),\n  reorderPoint: z.string().min(1, 'Reorder point is required'),\n  reorderQuantity: z.string().min(1, 'Reorder quantity is required'),\n  unitCost: z.string().min(1, 'Unit cost is required'),\n  unitPrice: z.string().min(1, 'Unit price is required'),\n  location: z.string().optional(),\n});\n\ntype InventoryItemForm = z.infer<typeof inventoryItemSchema>;\n\n// Mock inventory data\nconst mockInventoryData = {\n  period: '2024-02-29',\n  company: 'Acme Corporation',\n  currency: 'USD',\n  items: [\n    {\n      id: '1',\n      sku: 'PRD-001',\n      name: 'Widget Pro X',\n      category: 'Electronics',\n      quantity: 250,\n      reorderPoint: 100,\n      reorderQuantity: 200,\n      unitCost: 45.00,\n      unitPrice: 89.99,\n      value: 11250.00,\n      status: 'in_stock',\n      location: 'Warehouse A',\n      lastRestocked: '2024-02-10',\n    },\n    {\n      id: '2',\n      sku: 'PRD-002',\n      name: 'Widget Standard',\n      category: 'Electronics',\n      quantity: 85,\n      reorderPoint: 100,\n      reorderQuantity: 150,\n      unitCost: 25.00,\n      unitPrice: 49.99,\n      value: 2125.00,\n      status: 'low_stock',\n      location: 'Warehouse A',\n      lastRestocked: '2024-01-25',\n    },\n    {\n      id: '3',\n      sku: 'ACC-001',\n      name: 'Premium Cable Set',\n      category: 'Accessories',\n      quantity: 500,\n      reorderPoint: 200,\n      reorderQuantity: 300,\n      unitCost: 8.50,\n      unitPrice: 19.99,\n      value: 4250.00,\n      status: 'in_stock',\n      location: 'Warehouse B',\n      lastRestocked: '2024-02-05',\n    },\n    {\n      id: '4',\n      sku: 'ACC-002',\n      name: 'Protective Case',\n      category: 'Accessories',\n      quantity: 45,\n      reorderPoint: 50,\n      reorderQuantity: 100,\n      unitCost: 12.00,\n      unitPrice: 29.99,\n      value: 540.00,\n      status: 'critical',\n      location: 'Warehouse B',\n      lastRestocked: '2024-01-15',\n    },\n    {\n      id: '5',\n      sku: 'SRV-001',\n      name: 'Service Package Gold',\n      category: 'Services',\n      quantity: 0,\n      reorderPoint: 0,\n      reorderQuantity: 0,\n      unitCost: 0,\n      unitPrice: 199.99,\n      value: 0,\n      status: 'service',\n      location: 'N/A',\n      lastRestocked: 'N/A',\n    },\n  ],\n  movements: [\n    { date: '2024-02-28', type: 'sale', sku: 'PRD-001', quantity: -5, reference: 'INV-2024-051' },\n    { date: '2024-02-28', type: 'purchase', sku: 'ACC-001', quantity: 100, reference: 'PO-2024-022' },\n    { date: '2024-02-27', type: 'sale', sku: 'PRD-002', quantity: -3, reference: 'INV-2024-050' },\n    { date: '2024-02-27', type: 'adjustment', sku: 'ACC-002', quantity: -2, reference: 'ADJ-2024-003' },\n    { date: '2024-02-26', type: 'sale', sku: 'PRD-001', quantity: -10, reference: 'INV-2024-049' },\n  ],\n  valuationMethod: 'FIFO',\n  categories: [\n    { name: 'Electronics', items: 2, value: 13375.00, percentage: 75.8 },\n    { name: 'Accessories', items: 2, value: 4790.00, percentage: 27.2 },\n    { name: 'Services', items: 1, value: 0, percentage: 0 },\n  ],\n};\n\nconst statusConfig = {\n  in_stock: { label: 'In Stock', icon: CheckCircle, color: 'success' },\n  low_stock: { label: 'Low Stock', icon: AlertTriangle, color: 'warning' },\n  critical: { label: 'Critical', icon: AlertTriangle, color: 'destructive' },\n  out_of_stock: { label: 'Out of Stock', icon: AlertTriangle, color: 'destructive' },\n  service: { label: 'Service', icon: Package, color: 'secondary' },\n};\n\nexport default function InventoryPage() {\n  const { toast } = useToast();\n  const isMobile = useIsMobile();\n  const [selectedCategory, setSelectedCategory] = useState('all');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [activeTab, setActiveTab] = useState('overview');\n  const [showDialog, setShowDialog] = useState(false);\n\n  // Create inventory item mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: InventoryItemForm) => {\n      const processedData = {\n        ...data,\n        quantity: parseInt(data.quantity),\n        reorderPoint: parseInt(data.reorderPoint),\n        reorderQuantity: parseInt(data.reorderQuantity),\n        unitCost: parseFloat(data.unitCost),\n        unitPrice: parseFloat(data.unitPrice),\n        value: parseInt(data.quantity) * parseFloat(data.unitCost),\n        status: 'in_stock',\n        lastRestocked: new Date().toISOString().split('T')[0],\n      };\n      return await apiRequest('POST', '/api/inventory/items', processedData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/inventory/items'] });\n      setShowDialog(false);\n      toast({\n        title: 'Inventory item added',\n        description: 'New inventory item has been added successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to add inventory item',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Form\n  const form = useForm<InventoryItemForm>({\n    resolver: zodResolver(inventoryItemSchema),\n    defaultValues: {\n      sku: '',\n      name: '',\n      category: 'Electronics',\n      quantity: '',\n      reorderPoint: '',\n      reorderQuantity: '',\n      unitCost: '',\n      unitPrice: '',\n      location: '',\n    },\n  });\n\n  const onSubmit = (data: InventoryItemForm) => {\n    createMutation.mutate(data);\n  };\n\n  // Filter inventory\n  const filteredItems = mockInventoryData.items.filter((item) => {\n    const matchesSearch = \n      item.sku.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      item.name.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    const matchesCategory = selectedCategory === 'all' || item.category === selectedCategory;\n    \n    return matchesSearch && matchesCategory;\n  });\n\n  // Calculate statistics\n  const totalItems = mockInventoryData.items.length;\n  const totalValue = mockInventoryData.items.reduce((sum, item) => sum + item.value, 0);\n  const lowStockItems = mockInventoryData.items.filter(item => \n    item.status === 'low_stock' || item.status === 'critical'\n  ).length;\n  const totalQuantity = mockInventoryData.items.reduce((sum, item) => sum + item.quantity, 0);\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: mockInventoryData.currency,\n    }).format(amount);\n  };\n\n  const handleExport = (format: 'pdf' | 'excel') => {\n    console.log(`Exporting inventory report as ${format}`);\n  };\n\n  const handleReorder = (sku: string) => {\n    console.log(`Creating reorder for ${sku}`);\n  };\n\n  const getStatusBadge = (status: string) => {\n    const config = statusConfig[status as keyof typeof statusConfig];\n    if (!config) return null;\n    \n    const Icon = config.icon;\n    return (\n      <Badge variant={config.color as any} className=\"gap-1\">\n        <Icon className=\"h-3 w-3\" />\n        {config.label}\n      </Badge>\n    );\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Inventory Report</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Stock levels as of {format(new Date(mockInventoryData.period), 'MMMM dd, yyyy')}\n          </p>\n        </div>\n        <div className={`flex gap-2 ${isMobile ? 'flex-col' : ''}`}>\n          <Button variant=\"outline\" onClick={() => handleExport('pdf')}>\n            <Download className=\"h-4 w-4 mr-2\" />\n            Export\n          </Button>\n          <Button variant=\"outline\" onClick={() => window.print()}>\n            <Printer className=\"h-4 w-4 mr-2\" />\n            Print\n          </Button>\n          <Dialog open={showDialog} onOpenChange={setShowDialog}>\n            <DialogTrigger asChild>\n              <Button data-testid=\"button-add-item\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Add Item\n              </Button>\n            </DialogTrigger>\n            <DialogContent className={`max-w-2xl max-h-[90vh] overflow-y-auto ${isMobile ? 'w-full max-w-full mx-4' : ''}`}>\n              <DialogHeader>\n                <DialogTitle>Add New Inventory Item</DialogTitle>\n              </DialogHeader>\n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"sku\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>SKU</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"PRD-001\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"name\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Product Name</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Enter product name\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"category\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Category</FormLabel>\n                          <Select onValueChange={field.onChange} defaultValue={field.value}>\n                            <FormControl>\n                              <SelectTrigger>\n                                <SelectValue placeholder=\"Select category\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"Electronics\">Electronics</SelectItem>\n                              <SelectItem value=\"Accessories\">Accessories</SelectItem>\n                              <SelectItem value=\"Services\">Services</SelectItem>\n                              <SelectItem value=\"Raw Materials\">Raw Materials</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"location\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Location (Optional)</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Warehouse A\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"quantity\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Current Quantity</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"number\"\n                              placeholder=\"0\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"reorderPoint\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Reorder Point</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"number\"\n                              placeholder=\"50\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"reorderQuantity\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Reorder Quantity</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"number\"\n                              placeholder=\"100\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"unitCost\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Unit Cost</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"number\"\n                              step=\"0.01\"\n                              placeholder=\"0.00\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"unitPrice\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Unit Price</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"number\"\n                              step=\"0.01\"\n                              placeholder=\"0.00\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <div className=\"flex items-center gap-3 pt-4\">\n                    <Button type=\"submit\" disabled={createMutation.isPending}>\n                      {createMutation.isPending ? 'Adding...' : 'Add Item'}\n                    </Button>\n                    <Button \n                      type=\"button\" \n                      variant=\"outline\" \n                      onClick={() => setShowDialog(false)}\n                    >\n                      Cancel\n                    </Button>\n                  </div>\n                </form>\n              </Form>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Items</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{totalItems}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Unique SKUs\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Value</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{formatCurrency(totalValue)}</div>\n            <div className=\"flex items-center text-xs text-green-600 mt-1\">\n              <TrendingUp className=\"h-3 w-3 mr-1\" />\n              +8.5% from last month\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Quantity</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{totalQuantity.toLocaleString()}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Units in stock\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Low Stock Alert</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-orange-600\">{lowStockItems}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Items need reorder\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Filters */}\n      <div className={`flex gap-4 ${isMobile ? 'flex-col space-y-2' : 'items-center'}`}>\n        <div className=\"flex-1\">\n          <Input\n            placeholder=\"Search by SKU or name...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"max-w-sm\"\n            data-testid=\"input-search-inventory\"\n          />\n        </div>\n        <Select value={selectedCategory} onValueChange={setSelectedCategory}>\n          <SelectTrigger className=\"w-48\" data-testid=\"select-category\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"all\">All Categories</SelectItem>\n            <SelectItem value=\"Electronics\">Electronics</SelectItem>\n            <SelectItem value=\"Accessories\">Accessories</SelectItem>\n            <SelectItem value=\"Services\">Services</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      {/* Tabs */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className={`${isMobile ? 'grid w-full grid-cols-3' : ''}`}>\n          <TabsTrigger value=\"overview\">Overview</TabsTrigger>\n          <TabsTrigger value=\"movements\">Stock Movements</TabsTrigger>\n          <TabsTrigger value=\"valuation\">Valuation</TabsTrigger>\n        </TabsList>\n\n        {/* Overview Tab */}\n        <TabsContent value=\"overview\">\n          <Card>\n            <CardContent className=\"p-0\">\n              <div className={`${isMobile ? 'mobile-table-container' : ''}`}>\n                <Table className={`${isMobile ? 'table-mobile-stack' : ''}`}>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>SKU</TableHead>\n                    <TableHead>Product Name</TableHead>\n                    <TableHead>Category</TableHead>\n                    <TableHead>Location</TableHead>\n                    <TableHead className=\"text-right\">Quantity</TableHead>\n                    <TableHead className=\"text-right\">Reorder Point</TableHead>\n                    <TableHead className=\"text-right\">Unit Cost</TableHead>\n                    <TableHead className=\"text-right\">Total Value</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredItems.map((item) => (\n                    <TableRow key={item.id} data-testid={`row-item-${item.id}`}>\n                      <TableCell className=\"font-medium\" data-label=\"SKU\">{item.sku}</TableCell>\n                      <TableCell data-label=\"Product Name\">{item.name}</TableCell>\n                      <TableCell data-label=\"Category\">\n                        <Badge variant=\"secondary\">{item.category}</Badge>\n                      </TableCell>\n                      <TableCell data-label=\"Location\">{item.location}</TableCell>\n                      <TableCell className=\"text-right font-semibold\" data-label=\"Quantity\">\n                        {item.quantity}\n                      </TableCell>\n                      <TableCell className=\"text-right\" data-label=\"Reorder Point\">\n                        {item.reorderPoint || '-'}\n                      </TableCell>\n                      <TableCell className=\"text-right\" data-label=\"Unit Cost\">\n                        {item.unitCost > 0 ? formatCurrency(item.unitCost) : '-'}\n                      </TableCell>\n                      <TableCell className=\"text-right font-semibold\" data-label=\"Total Value\">\n                        {item.value > 0 ? formatCurrency(item.value) : '-'}\n                      </TableCell>\n                      <TableCell data-label=\"Status\">{getStatusBadge(item.status)}</TableCell>\n                      <TableCell className=\"text-right\" data-label=\"Actions\">\n                        {(item.status === 'low_stock' || item.status === 'critical') && (\n                          <Button \n                            size=\"sm\" \n                            variant=\"outline\"\n                            onClick={() => handleReorder(item.sku)}\n                            data-testid={`button-reorder-${item.id}`}\n                          >\n                            Reorder\n                          </Button>\n                        )}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Stock Movements Tab */}\n        <TabsContent value=\"movements\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Recent Stock Movements</CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              <div className={`${isMobile ? 'mobile-table-container' : ''}`}>\n                <Table className={`${isMobile ? 'table-mobile-stack' : ''}`}>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Date</TableHead>\n                    <TableHead>Type</TableHead>\n                    <TableHead>SKU</TableHead>\n                    <TableHead>Reference</TableHead>\n                    <TableHead className=\"text-right\">Quantity</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {mockInventoryData.movements.map((movement, index) => (\n                    <TableRow key={index}>\n                      <TableCell data-label=\"Date\">\n                        <div className=\"flex items-center gap-2\">\n                          <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                          {format(new Date(movement.date), 'MMM dd, yyyy')}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Type\">\n                        <Badge variant={movement.type === 'purchase' ? 'default' : movement.type === 'sale' ? 'destructive' : 'secondary'}>\n                          {movement.type}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"font-medium\" data-label=\"SKU\">{movement.sku}</TableCell>\n                      <TableCell data-label=\"Reference\">{movement.reference}</TableCell>\n                      <TableCell className=\"text-right\" data-label=\"Quantity\">\n                        <div className=\"flex items-center justify-end gap-1\">\n                          {movement.quantity > 0 ? (\n                            <ArrowUpRight className=\"h-3 w-3 text-green-600\" />\n                          ) : (\n                            <ArrowDownRight className=\"h-3 w-3 text-red-600\" />\n                          )}\n                          <span className={`font-semibold ${movement.quantity > 0 ? 'text-green-600' : 'text-red-600'}`}>\n                            {movement.quantity > 0 ? '+' : ''}{movement.quantity}\n                          </span>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Valuation Tab */}\n        <TabsContent value=\"valuation\">\n          <div className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Inventory Valuation Method</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-lg font-semibold\">{mockInventoryData.valuationMethod}</p>\n                    <p className=\"text-sm text-muted-foreground\">First In, First Out</p>\n                  </div>\n                  <Button variant=\"outline\">Change Method</Button>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Valuation by Category</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className={`${isMobile ? 'mobile-table-container' : ''}`}>\n                  <Table className={`${isMobile ? 'table-mobile-stack' : ''}`}>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Category</TableHead>\n                      <TableHead className=\"text-right\">Items</TableHead>\n                      <TableHead className=\"text-right\">Total Value</TableHead>\n                      <TableHead className=\"text-right\">Percentage</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {mockInventoryData.categories.map((category, index) => (\n                      <TableRow key={index}>\n                        <TableCell className=\"font-medium\" data-label=\"Category\">\n                          <div className=\"flex items-center gap-2\">\n                            <Package className=\"h-4 w-4 text-muted-foreground\" />\n                            {category.name}\n                          </div>\n                        </TableCell>\n                        <TableCell className=\"text-right\" data-label=\"Items\">{category.items}</TableCell>\n                        <TableCell className=\"text-right font-semibold\" data-label=\"Total Value\">\n                          {formatCurrency(category.value)}\n                        </TableCell>\n                        <TableCell className=\"text-right\" data-label=\"Percentage\">\n                          <div className=\"flex items-center justify-end gap-2\">\n                            <div className=\"w-20 bg-gray-200 rounded-full h-2\">\n                              <div \n                                className=\"bg-primary h-2 rounded-full\" \n                                style={{ width: `${category.percentage}%` }}\n                              />\n                            </div>\n                            <span className=\"text-sm font-medium\">{category.percentage}%</span>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                    <TableRow className=\"font-bold\">\n                      <TableCell data-label=\"Category\">Total</TableCell>\n                      <TableCell className=\"text-right\" data-label=\"Items\">{totalItems}</TableCell>\n                      <TableCell className=\"text-right text-green-600\" data-label=\"Total Value\">\n                        {formatCurrency(totalValue)}\n                      </TableCell>\n                      <TableCell className=\"text-right\" data-label=\"Percentage\">100%</TableCell>\n                    </TableRow>\n                  </TableBody>\n                </Table>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":30171},"client/src/pages/reports/ProfitLossPage.tsx":{"content":"import { useState } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { useIsMobile } from '@/hooks/use-mobile';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport { \n  FileText, \n  Download, \n  Printer, \n  Calendar,\n  TrendingUp,\n  TrendingDown,\n  DollarSign,\n  Loader2\n} from 'lucide-react';\nimport { format } from 'date-fns';\n\n// Mock financial data\nconst mockProfitLossData = {\n  period: '2024-02',\n  company: 'Acme Corporation',\n  currency: 'USD',\n  revenue: [\n    { category: 'Sales Revenue', amount: 125500.00, percentage: 85 },\n    { category: 'Service Revenue', amount: 18500.00, percentage: 12.5 },\n    { category: 'Other Income', amount: 3500.00, percentage: 2.5 },\n  ],\n  costOfGoodsSold: [\n    { category: 'Direct Materials', amount: 35000.00 },\n    { category: 'Direct Labor', amount: 28000.00 },\n    { category: 'Manufacturing Overhead', amount: 12000.00 },\n  ],\n  operatingExpenses: [\n    { category: 'Salaries & Wages', amount: 25000.00 },\n    { category: 'Rent & Utilities', amount: 8500.00 },\n    { category: 'Marketing & Advertising', amount: 5500.00 },\n    { category: 'Insurance', amount: 2200.00 },\n    { category: 'Depreciation', amount: 3500.00 },\n    { category: 'Office Supplies', amount: 1800.00 },\n    { category: 'Professional Fees', amount: 3000.00 },\n  ],\n  otherExpenses: [\n    { category: 'Interest Expense', amount: 1500.00 },\n    { category: 'Bank Charges', amount: 250.00 },\n    { category: 'Miscellaneous', amount: 500.00 },\n  ],\n  taxes: 5250.00,\n};\n\nexport default function ProfitLossPage() {\n  const isMobile = useIsMobile();\n  const [selectedPeriod, setSelectedPeriod] = useState('month');\n  const [compareMode, setCompareMode] = useState(false);\n  const [startDate, setStartDate] = useState<Date | undefined>(new Date(new Date().getFullYear(), 0, 1)); // Year start\n  const [endDate, setEndDate] = useState<Date | undefined>(new Date()); // Today\n\n  // Fetch profit loss data from API\n  const { data: profitLossData, isLoading, error } = useQuery({\n    queryKey: ['/api/reports/profit-loss', startDate, endDate],\n    queryFn: () => {\n      const url = new URL('/api/reports/profit-loss', window.location.origin);\n      if (startDate) {\n        url.searchParams.set('startDate', startDate.toISOString());\n      }\n      if (endDate) {\n        url.searchParams.set('endDate', endDate.toISOString());\n      }\n      return fetch(url.toString()).then(res => res.json());\n    }\n  });\n\n  // Use real data when available, fallback to empty structure\n  const profitLoss = profitLossData || {\n    revenue: { operating: [], nonOperating: [] },\n    expenses: { costOfGoodsSold: [], operating: [], nonOperating: [] },\n    startDate: new Date(new Date().getFullYear(), 0, 1),\n    endDate: new Date()\n  };\n\n  // Calculate totals from real data with safe array access\n  const totalOperatingRevenue = (profitLoss.revenue?.operating || []).reduce((sum: number, item: any) => sum + (item.balance || 0), 0);\n  const totalNonOperatingRevenue = (profitLoss.revenue?.nonOperating || []).reduce((sum: number, item: any) => sum + (item.balance || 0), 0);\n  const totalRevenue = totalOperatingRevenue + totalNonOperatingRevenue;\n\n  const totalCOGS = (profitLoss.expenses?.costOfGoodsSold || []).reduce((sum: number, item: any) => sum + (item.balance || 0), 0);\n  const grossProfit = totalRevenue - totalCOGS;\n  const grossProfitMargin = totalRevenue > 0 ? (grossProfit / totalRevenue) * 100 : 0;\n  \n  const totalOperatingExpenses = (profitLoss.expenses?.operating || []).reduce((sum: number, item: any) => sum + (item.balance || 0), 0);\n  const operatingIncome = grossProfit - totalOperatingExpenses;\n  \n  const totalNonOperatingExpenses = (profitLoss.expenses?.nonOperating || []).reduce((sum: number, item: any) => sum + (item.balance || 0), 0);\n  const incomeBeforeTax = operatingIncome - totalNonOperatingExpenses;\n  \n  // For now, we'll assume taxes are 0 since we don't have a separate tax calculation\n  const taxes = 0;\n  const netIncome = incomeBeforeTax - taxes;\n  const netProfitMargin = totalRevenue > 0 ? (netIncome / totalRevenue) * 100 : 0;\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: 'USD',\n    }).format(amount);\n  };\n\n  const handleExport = (format: 'pdf' | 'excel') => {\n    console.log(`Exporting P&L statement as ${format}`);\n  };\n\n  const handlePrint = () => {\n    window.print();\n  };\n\n  // Show loading state\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-foreground\">Profit & Loss Statement</h1>\n            <p className=\"text-muted-foreground mt-1\">Loading profit & loss data...</p>\n          </div>\n          <div className=\"flex gap-2\">\n            <Skeleton className=\"h-8 w-24\" />\n            <Skeleton className=\"h-10 w-32\" />\n            <Skeleton className=\"h-10 w-32\" />\n            <Skeleton className=\"h-10 w-20\" />\n          </div>\n        </div>\n        <div className=\"grid gap-4 md:grid-cols-3\">\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <Skeleton className=\"h-4 w-24\" />\n            </CardHeader>\n            <CardContent>\n              <Skeleton className=\"h-8 w-32\" />\n              <Skeleton className=\"h-4 w-20 mt-1\" />\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <Skeleton className=\"h-4 w-32\" />\n            </CardHeader>\n            <CardContent>\n              <Skeleton className=\"h-8 w-32\" />\n              <Skeleton className=\"h-4 w-32 mt-1\" />\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <Skeleton className=\"h-4 w-24\" />\n            </CardHeader>\n            <CardContent>\n              <Skeleton className=\"h-8 w-32\" />\n              <Skeleton className=\"h-4 w-20 mt-1\" />\n            </CardContent>\n          </Card>\n        </div>\n        <Card>\n          <CardHeader>\n            <Skeleton className=\"h-6 w-48\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-2\">\n              {Array.from({ length: 10 }).map((_, i) => (\n                <Skeleton key={i} className=\"h-6 w-full\" />\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  // Show error state\n  if (error) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-foreground\">Profit & Loss Statement</h1>\n            <p className=\"text-muted-foreground mt-1\">Error loading profit & loss data</p>\n          </div>\n        </div>\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"text-center\">\n              <p className=\"text-red-600 mb-4\">Failed to load profit & loss data</p>\n              <Button onClick={() => window.location.reload()}>\n                Try Again\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Profit & Loss Statement</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Income statement for {format(new Date(mockProfitLossData.period), 'MMMM yyyy')}\n          </p>\n        </div>\n        <div className=\"mobile-button-group\">\n          <Select value={selectedPeriod} onValueChange={setSelectedPeriod}>\n            <SelectTrigger className=\"w-32\" data-testid=\"select-period\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"month\">This Month</SelectItem>\n              <SelectItem value=\"quarter\">This Quarter</SelectItem>\n              <SelectItem value=\"year\">This Year</SelectItem>\n              <SelectItem value=\"custom\">Custom Range</SelectItem>\n            </SelectContent>\n          </Select>\n          <Button variant=\"outline\" onClick={() => setCompareMode(!compareMode)}>\n            <Calendar className=\"h-4 w-4 mr-2\" />\n            Compare\n          </Button>\n          <Button variant=\"outline\" onClick={() => handleExport('pdf')}>\n            <Download className=\"h-4 w-4 mr-2\" />\n            Export\n          </Button>\n          <Button variant=\"outline\" onClick={handlePrint}>\n            <Printer className=\"h-4 w-4 mr-2\" />\n            Print\n          </Button>\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Revenue</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{formatCurrency(totalRevenue)}</div>\n            <div className=\"flex items-center text-xs text-green-600 mt-1\">\n              <TrendingUp className=\"h-3 w-3 mr-1\" />\n              +12% from last month\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Gross Profit</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{formatCurrency(grossProfit)}</div>\n            <Badge variant=\"secondary\" className=\"text-xs mt-1\">\n              {grossProfitMargin.toFixed(1)}% margin\n            </Badge>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Operating Income</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{formatCurrency(operatingIncome)}</div>\n            <div className=\"flex items-center text-xs text-green-600 mt-1\">\n              <TrendingUp className=\"h-3 w-3 mr-1\" />\n              +8% from last month\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Net Income</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className={`text-2xl font-bold ${netIncome >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n              {formatCurrency(netIncome)}\n            </div>\n            <Badge variant={netIncome >= 0 ? \"default\" : \"destructive\"} className=\"text-xs mt-1\">\n              {netProfitMargin.toFixed(1)}% margin\n            </Badge>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Detailed P&L Statement */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Income Statement Details</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className={isMobile ? \"mobile-table-container\" : \"overflow-x-auto\"}>\n            <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n            <TableHeader>\n              <TableRow>\n                <TableHead className=\"w-[400px]\">Account</TableHead>\n                <TableHead className=\"text-right\">Amount (USD)</TableHead>\n                <TableHead className=\"text-right\">% of Revenue</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {/* Revenue Section */}\n              {(profitLoss.revenue.operating.length > 0 || profitLoss.revenue.nonOperating.length > 0) && (\n                <>\n                  <TableRow className=\"font-semibold bg-muted/50\">\n                    <TableCell>REVENUE</TableCell>\n                    <TableCell className=\"text-right\"></TableCell>\n                    <TableCell className=\"text-right\"></TableCell>\n                  </TableRow>\n                  {profitLoss.revenue.operating.map((item: any, index: number) => (\n                    <TableRow key={`operating-revenue-${item.id || index}`}>\n                      <TableCell className=\"pl-8\">{item.name}</TableCell>\n                      <TableCell className=\"text-right\">{formatCurrency(item.balance)}</TableCell>\n                      <TableCell className=\"text-right\">{totalRevenue > 0 ? ((item.balance / totalRevenue) * 100).toFixed(1) : '0.0'}%</TableCell>\n                    </TableRow>\n                  ))}\n                  {profitLoss.revenue.nonOperating.map((item: any, index: number) => (\n                    <TableRow key={`non-operating-revenue-${item.id || index}`}>\n                      <TableCell className=\"pl-8\">{item.name}</TableCell>\n                      <TableCell className=\"text-right\">{formatCurrency(item.balance)}</TableCell>\n                      <TableCell className=\"text-right\">{totalRevenue > 0 ? ((item.balance / totalRevenue) * 100).toFixed(1) : '0.0'}%</TableCell>\n                    </TableRow>\n                  ))}\n                </>\n              )}\n              <TableRow className=\"font-semibold\">\n                <TableCell>Total Revenue</TableCell>\n                <TableCell className=\"text-right\">{formatCurrency(totalRevenue)}</TableCell>\n                <TableCell className=\"text-right\">100.0%</TableCell>\n              </TableRow>\n\n              {/* COGS Section */}\n              {profitLoss.expenses.costOfGoodsSold.length > 0 && (\n                <>\n                  <TableRow className=\"font-semibold bg-muted/50\">\n                    <TableCell>COST OF GOODS SOLD</TableCell>\n                    <TableCell className=\"text-right\"></TableCell>\n                    <TableCell className=\"text-right\"></TableCell>\n                  </TableRow>\n                  {profitLoss.expenses.costOfGoodsSold.map((item: any, index: number) => (\n                    <TableRow key={`cogs-${item.id || index}`}>\n                      <TableCell className=\"pl-8\">{item.name}</TableCell>\n                      <TableCell className=\"text-right\">{formatCurrency(item.balance)}</TableCell>\n                      <TableCell className=\"text-right\">{totalRevenue > 0 ? ((item.balance / totalRevenue) * 100).toFixed(1) : '0.0'}%</TableCell>\n                    </TableRow>\n                  ))}\n                </>\n              )}\n              <TableRow className=\"font-semibold\">\n                <TableCell>Total COGS</TableCell>\n                <TableCell className=\"text-right\">{formatCurrency(totalCOGS)}</TableCell>\n                <TableCell className=\"text-right\">{((totalCOGS / totalRevenue) * 100).toFixed(1)}%</TableCell>\n              </TableRow>\n\n              {/* Gross Profit */}\n              <TableRow className=\"font-bold bg-green-50 dark:bg-green-900/20\">\n                <TableCell>GROSS PROFIT</TableCell>\n                <TableCell className=\"text-right text-green-600\">{formatCurrency(grossProfit)}</TableCell>\n                <TableCell className=\"text-right text-green-600\">{grossProfitMargin.toFixed(1)}%</TableCell>\n              </TableRow>\n\n              {/* Operating Expenses */}\n              {profitLoss.expenses.operating.length > 0 && (\n                <>\n                  <TableRow className=\"font-semibold bg-muted/50\">\n                    <TableCell>OPERATING EXPENSES</TableCell>\n                    <TableCell className=\"text-right\"></TableCell>\n                    <TableCell className=\"text-right\"></TableCell>\n                  </TableRow>\n                  {profitLoss.expenses.operating.map((item: any, index: number) => (\n                    <TableRow key={`operating-expense-${item.id || index}`}>\n                      <TableCell className=\"pl-8\">{item.name}</TableCell>\n                      <TableCell className=\"text-right\">{formatCurrency(item.balance)}</TableCell>\n                      <TableCell className=\"text-right\">{totalRevenue > 0 ? ((item.balance / totalRevenue) * 100).toFixed(1) : '0.0'}%</TableCell>\n                    </TableRow>\n                  ))}\n                </>\n              )}\n              <TableRow className=\"font-semibold\">\n                <TableCell>Total Operating Expenses</TableCell>\n                <TableCell className=\"text-right\">{formatCurrency(totalOperatingExpenses)}</TableCell>\n                <TableCell className=\"text-right\">{((totalOperatingExpenses / totalRevenue) * 100).toFixed(1)}%</TableCell>\n              </TableRow>\n\n              {/* Operating Income */}\n              <TableRow className=\"font-bold bg-blue-50 dark:bg-blue-900/20\">\n                <TableCell>OPERATING INCOME</TableCell>\n                <TableCell className=\"text-right text-blue-600\">{formatCurrency(operatingIncome)}</TableCell>\n                <TableCell className=\"text-right text-blue-600\">{((operatingIncome / totalRevenue) * 100).toFixed(1)}%</TableCell>\n              </TableRow>\n\n              {/* Other Expenses */}\n              {profitLoss.expenses.nonOperating.length > 0 && (\n                <>\n                  <TableRow className=\"font-semibold bg-muted/50\">\n                    <TableCell>OTHER EXPENSES</TableCell>\n                    <TableCell className=\"text-right\"></TableCell>\n                    <TableCell className=\"text-right\"></TableCell>\n                  </TableRow>\n                  {profitLoss.expenses.nonOperating.map((item: any, index: number) => (\n                    <TableRow key={`other-expense-${item.id || index}`}>\n                      <TableCell className=\"pl-8\">{item.name}</TableCell>\n                      <TableCell className=\"text-right\">{formatCurrency(item.balance)}</TableCell>\n                      <TableCell className=\"text-right\">{totalRevenue > 0 ? ((item.balance / totalRevenue) * 100).toFixed(1) : '0.0'}%</TableCell>\n                    </TableRow>\n                  ))}\n                </>\n              )}\n\n              {/* Income Before Tax */}\n              <TableRow className=\"font-semibold\">\n                <TableCell>Income Before Tax</TableCell>\n                <TableCell className=\"text-right\">{formatCurrency(incomeBeforeTax)}</TableCell>\n                <TableCell className=\"text-right\">{((incomeBeforeTax / totalRevenue) * 100).toFixed(1)}%</TableCell>\n              </TableRow>\n\n              {/* Taxes */}\n              <TableRow>\n                <TableCell className=\"pl-8\">Income Tax Expense</TableCell>\n                <TableCell className=\"text-right\">{formatCurrency(taxes)}</TableCell>\n                <TableCell className=\"text-right\">{totalRevenue > 0 ? ((taxes / totalRevenue) * 100).toFixed(1) : '0.0'}%</TableCell>\n              </TableRow>\n\n              {/* Net Income */}\n              <TableRow className={`font-bold text-lg ${netIncome >= 0 ? 'bg-green-100 dark:bg-green-900/30' : 'bg-red-100 dark:bg-red-900/30'}`}>\n                <TableCell>NET INCOME</TableCell>\n                <TableCell className={`text-right ${netIncome >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n                  {formatCurrency(netIncome)}\n                </TableCell>\n                <TableCell className={`text-right ${netIncome >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n                  {netProfitMargin.toFixed(1)}%\n                </TableCell>\n              </TableRow>\n            </TableBody>\n            </Table>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":19788},"client/src/pages/reports/TaxPage.tsx":{"content":"import { useState } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { useIsMobile } from '@/hooks/use-mobile';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport { \n  FileText, \n  Download, \n  Printer, \n  Calendar,\n  TrendingUp,\n  TrendingDown,\n  DollarSign,\n  AlertCircle,\n  CheckCircle,\n  Calculator,\n  Loader2\n} from 'lucide-react';\nimport { format } from 'date-fns';\n\n// Mock tax data\nconst mockTaxData = {\n  period: '2024-Q1',\n  company: 'Acme Corporation',\n  currency: 'USD',\n  salesTax: {\n    totalSales: 147500.00,\n    taxableSales: 125000.00,\n    exemptSales: 22500.00,\n    collectedTax: 12500.00,\n    rates: [\n      { jurisdiction: 'State Tax', rate: 5.0, taxable: 125000.00, tax: 6250.00 },\n      { jurisdiction: 'County Tax', rate: 2.5, taxable: 125000.00, tax: 3125.00 },\n      { jurisdiction: 'City Tax', rate: 2.5, taxable: 125000.00, tax: 3125.00 },\n    ],\n  },\n  purchaseTax: {\n    totalPurchases: 102500.00,\n    taxablePurchases: 85000.00,\n    exemptPurchases: 17500.00,\n    paidTax: 8500.00,\n    recoverable: 7500.00,\n  },\n  incomeTax: {\n    grossIncome: 147500.00,\n    deductions: 102500.00,\n    taxableIncome: 45000.00,\n    estimatedTax: 11250.00,\n    quarterlyPayments: [\n      { quarter: 'Q1', dueDate: '2024-04-15', amount: 2812.50, status: 'paid' },\n      { quarter: 'Q2', dueDate: '2024-06-15', amount: 2812.50, status: 'pending' },\n      { quarter: 'Q3', dueDate: '2024-09-15', amount: 2812.50, status: 'pending' },\n      { quarter: 'Q4', dueDate: '2025-01-15', amount: 2812.50, status: 'pending' },\n    ],\n  },\n  payrollTax: {\n    grossWages: 45000.00,\n    federalWithholding: 5500.00,\n    stateWithholding: 2250.00,\n    socialSecurity: 2790.00,\n    medicare: 652.50,\n    employerContributions: 3442.50,\n    totalPayrollTax: 14635.00,\n  },\n  filings: [\n    { form: 'Form 941', period: 'Q1 2024', dueDate: '2024-04-30', status: 'filed', amount: 14635.00 },\n    { form: 'Sales Tax Return', period: 'March 2024', dueDate: '2024-04-20', status: 'pending', amount: 4000.00 },\n    { form: 'State Income Tax', period: 'Q1 2024', dueDate: '2024-04-15', status: 'filed', amount: 2250.00 },\n    { form: 'Form 1120-W', period: 'Q1 2024', dueDate: '2024-04-15', status: 'filed', amount: 2812.50 },\n  ],\n};\n\nexport default function TaxPage() {\n  const isMobile = useIsMobile();\n  const [selectedPeriod, setSelectedPeriod] = useState('quarter');\n  const [selectedTaxType, setSelectedTaxType] = useState('all');\n\n  // Get current year dates for API call\n  const currentYear = new Date().getFullYear();\n  const startDate = new Date(currentYear, 0, 1).toISOString().split('T')[0]; // Jan 1\n  const endDate = new Date(currentYear, 11, 31).toISOString().split('T')[0]; // Dec 31\n\n  // Fetch tax data using React Query\n  const { \n    data: taxData, \n    isLoading, \n    error \n  } = useQuery({\n    queryKey: ['/api/reports/tax', startDate, endDate],\n    queryFn: async () => {\n      const response = await fetch(`/api/reports/tax?startDate=${startDate}&endDate=${endDate}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch tax data');\n      }\n      return response.json();\n    },\n  });\n\n  // Use API data if available, fallback to mock data for structure\n  const displayData = taxData || mockTaxData;\n\n  // Calculate totals from API data\n  const netSalesTax = displayData.salesTax.collectedTax - displayData.purchaseTax.recoverable;\n  const totalTaxLiability = \n    netSalesTax + \n    displayData.incomeTax.estimatedTax / 4 + \n    displayData.payrollTax.totalPayrollTax;\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: displayData.currency || 'USD',\n    }).format(amount);\n  };\n\n  // Handle loading state\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-foreground\">Tax Reports</h1>\n            <p className=\"text-muted-foreground mt-1\">Loading tax data...</p>\n          </div>\n        </div>\n        <div className=\"flex items-center justify-center py-8\">\n          <Loader2 className=\"h-8 w-8 animate-spin\" />\n          <span className=\"ml-2 text-muted-foreground\">Loading tax reports...</span>\n        </div>\n      </div>\n    );\n  }\n\n  // Handle error state\n  if (error) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-foreground\">Tax Reports</h1>\n            <p className=\"text-muted-foreground mt-1\">Error loading tax data</p>\n          </div>\n        </div>\n        <Card>\n          <CardContent className=\"py-8\">\n            <div className=\"text-center\">\n              <p className=\"text-destructive mb-4\">Failed to load tax data: {error.message}</p>\n              <Button onClick={() => window.location.reload()} variant=\"outline\" data-testid=\"button-retry\">\n                Try Again\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const handleExport = (format: 'pdf' | 'excel') => {\n    console.log(`Exporting tax report as ${format}`);\n  };\n\n  const handleFile = (formType: string) => {\n    console.log(`Filing ${formType}`);\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'filed':\n        return <Badge variant=\"default\" className=\"gap-1\"><CheckCircle className=\"h-3 w-3\" />Filed</Badge>;\n      case 'paid':\n        return <Badge variant=\"default\" className=\"gap-1\"><CheckCircle className=\"h-3 w-3\" />Paid</Badge>;\n      case 'pending':\n        return <Badge variant=\"outline\" className=\"gap-1\"><AlertCircle className=\"h-3 w-3\" />Pending</Badge>;\n      case 'overdue':\n        return <Badge variant=\"destructive\" className=\"gap-1\"><AlertCircle className=\"h-3 w-3\" />Overdue</Badge>;\n      default:\n        return <Badge variant=\"secondary\">{status}</Badge>;\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Tax Reports</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Tax summary for {displayData.period || format(new Date(), 'yyyy-QQQ')}\n          </p>\n        </div>\n        <div className={`flex gap-2 ${isMobile ? 'flex-col w-full' : 'mobile-button-group'}`}>\n          <Select value={selectedPeriod} onValueChange={setSelectedPeriod}>\n            <SelectTrigger className={isMobile ? 'w-full' : 'w-32'} data-testid=\"select-period\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"month\" data-testid=\"option-month\">This Month</SelectItem>\n              <SelectItem value=\"quarter\" data-testid=\"option-quarter\">This Quarter</SelectItem>\n              <SelectItem value=\"year\" data-testid=\"option-year\">This Year</SelectItem>\n              <SelectItem value=\"custom\" data-testid=\"option-custom\">Custom Range</SelectItem>\n            </SelectContent>\n          </Select>\n          <Button \n            variant=\"outline\" \n            onClick={() => handleExport('pdf')} \n            data-testid=\"button-export\"\n            size={isMobile ? 'sm' : 'default'}\n            className={isMobile ? 'flex-1' : ''}\n          >\n            <Download className=\"h-4 w-4 mr-2\" />\n            Export\n          </Button>\n          <Button \n            variant=\"outline\" \n            onClick={() => window.print()} \n            data-testid=\"button-print\"\n            size={isMobile ? 'sm' : 'default'}\n            className={isMobile ? 'flex-1' : ''}\n          >\n            <Printer className=\"h-4 w-4 mr-2\" />\n            Print\n          </Button>\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className={`grid gap-4 ${isMobile ? 'grid-cols-1' : 'grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5'}`}>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Sales Tax</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className={`font-bold ${isMobile ? 'text-xl' : 'text-2xl'}`} data-testid=\"text-sales-tax\">{formatCurrency(displayData.salesTax.collectedTax)}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Collected\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Input Tax</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className={`font-bold ${isMobile ? 'text-xl' : 'text-2xl'}`} data-testid=\"text-input-tax\">{formatCurrency(displayData.purchaseTax.recoverable)}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Recoverable\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Net Tax</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className={`font-bold text-orange-600 ${isMobile ? 'text-xl' : 'text-2xl'}`}>{formatCurrency(netSalesTax)}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Payable\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Income Tax</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className={`font-bold ${isMobile ? 'text-xl' : 'text-2xl'}`} data-testid=\"text-income-tax\">{formatCurrency(displayData.incomeTax.estimatedTax / 4)}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Quarterly\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Liability</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className={`font-bold text-red-600 ${isMobile ? 'text-xl' : 'text-2xl'}`}>{formatCurrency(totalTaxLiability)}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              This period\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Tax Details Tabs */}\n      <Tabs defaultValue=\"sales\" className=\"space-y-4\">\n        <TabsList>\n          <TabsTrigger value=\"sales\" data-testid=\"tab-sales\">Sales Tax</TabsTrigger>\n          <TabsTrigger value=\"purchases\" data-testid=\"tab-purchases\">Purchase Tax</TabsTrigger>\n          <TabsTrigger value=\"income\" data-testid=\"tab-income\">Income Tax</TabsTrigger>\n          <TabsTrigger value=\"payroll\" data-testid=\"tab-payroll\">Payroll Tax</TabsTrigger>\n          <TabsTrigger value=\"filings\" data-testid=\"tab-filings\">Tax Filings</TabsTrigger>\n        </TabsList>\n\n        {/* Sales Tax Tab */}\n        <TabsContent value=\"sales\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Sales Tax Details</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                <div className={`grid gap-4 ${isMobile ? 'grid-cols-2' : 'grid-cols-2 md:grid-cols-4'}`}>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Total Sales</p>\n                    <p className=\"text-lg font-semibold\" data-testid=\"text-total-sales\">{formatCurrency(displayData.salesTax.totalSales)}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Taxable Sales</p>\n                    <p className=\"text-lg font-semibold\" data-testid=\"text-taxable-sales\">{formatCurrency(displayData.salesTax.taxableSales)}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Exempt Sales</p>\n                    <p className=\"text-lg font-semibold\" data-testid=\"text-exempt-sales\">{formatCurrency(displayData.salesTax.exemptSales)}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Tax Collected</p>\n                    <p className=\"text-lg font-semibold text-green-600\" data-testid=\"text-collected-tax\">{formatCurrency(displayData.salesTax.collectedTax)}</p>\n                  </div>\n                </div>\n\n                <div className={isMobile ? \"mobile-table-container\" : \"\"}>\n                  <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Jurisdiction</TableHead>\n                      <TableHead className=\"text-right\">Rate</TableHead>\n                      <TableHead className=\"text-right\">Taxable Amount</TableHead>\n                      <TableHead className=\"text-right\">Tax Amount</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {(displayData.salesTax.rates || []).map((rate: any, index: number) => (\n                      <TableRow key={index}>\n                        <TableCell data-label=\"Jurisdiction\">{rate.jurisdiction}</TableCell>\n                        <TableCell className=\"text-right\" data-label=\"Rate\">{rate.rate}%</TableCell>\n                        <TableCell className=\"text-right\" data-label=\"Taxable Amount\">{formatCurrency(rate.taxable)}</TableCell>\n                        <TableCell className=\"text-right font-semibold\" data-label=\"Tax Amount\">{formatCurrency(rate.tax)}</TableCell>\n                      </TableRow>\n                    ))}\n                    <TableRow className=\"font-semibold\">\n                      <TableCell colSpan={3} data-label=\"Total\">Total Sales Tax</TableCell>\n                      <TableCell className=\"text-right text-green-600\" data-label=\"Amount\">\n                        {formatCurrency(displayData.salesTax.collectedTax)}\n                      </TableCell>\n                    </TableRow>\n                  </TableBody>\n                </Table>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Purchase Tax Tab */}\n        <TabsContent value=\"purchases\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Purchase Tax Details</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className={`grid gap-4 ${isMobile ? 'grid-cols-2' : 'grid-cols-2 md:grid-cols-3 lg:grid-cols-5'}`}>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Total Purchases</p>\n                  <p className=\"text-lg font-semibold\" data-testid=\"text-total-purchases\">{formatCurrency(displayData.purchaseTax.totalPurchases)}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Taxable Purchases</p>\n                  <p className=\"text-lg font-semibold\" data-testid=\"text-taxable-purchases\">{formatCurrency(displayData.purchaseTax.taxablePurchases)}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Exempt Purchases</p>\n                  <p className=\"text-lg font-semibold\" data-testid=\"text-exempt-purchases\">{formatCurrency(displayData.purchaseTax.exemptPurchases)}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Tax Paid</p>\n                  <p className=\"text-lg font-semibold text-red-600\" data-testid=\"text-paid-tax\">{formatCurrency(displayData.purchaseTax.paidTax)}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Recoverable</p>\n                  <p className=\"text-lg font-semibold text-green-600\" data-testid=\"text-recoverable-tax\">{formatCurrency(displayData.purchaseTax.recoverable)}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Income Tax Tab */}\n        <TabsContent value=\"income\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Income Tax Details</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                <div className={`grid gap-4 ${isMobile ? 'grid-cols-2' : 'grid-cols-2 md:grid-cols-4'}`}>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Gross Income</p>\n                    <p className=\"text-lg font-semibold\" data-testid=\"text-gross-income\">{formatCurrency(displayData.incomeTax.grossIncome)}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Deductions</p>\n                    <p className=\"text-lg font-semibold\" data-testid=\"text-deductions\">{formatCurrency(displayData.incomeTax.deductions)}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Taxable Income</p>\n                    <p className=\"text-lg font-semibold\" data-testid=\"text-taxable-income\">{formatCurrency(displayData.incomeTax.taxableIncome)}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Estimated Tax</p>\n                    <p className=\"text-lg font-semibold text-orange-600\" data-testid=\"text-estimated-tax\">{formatCurrency(displayData.incomeTax.estimatedTax)}</p>\n                  </div>\n                </div>\n\n                <div className={isMobile ? \"mobile-table-container\" : \"\"}>\n                  <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Quarter</TableHead>\n                      <TableHead>Due Date</TableHead>\n                      <TableHead className=\"text-right\">Amount</TableHead>\n                      <TableHead>Status</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {(displayData.incomeTax.quarterlyPayments || []).map((payment: any, index: number) => (\n                      <TableRow key={index}>\n                        <TableCell className=\"font-medium\" data-label=\"Quarter\">{payment.quarter}</TableCell>\n                        <TableCell data-label=\"Due Date\">{format(new Date(payment.dueDate), 'MMM dd, yyyy')}</TableCell>\n                        <TableCell className=\"text-right\" data-label=\"Amount\">{formatCurrency(payment.amount)}</TableCell>\n                        <TableCell data-label=\"Status\">{getStatusBadge(payment.status)}</TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Payroll Tax Tab */}\n        <TabsContent value=\"payroll\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Payroll Tax Details</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className={isMobile ? \"mobile-table-container\" : \"\"}>\n                <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Description</TableHead>\n                    <TableHead className=\"text-right\">Amount</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  <TableRow>\n                    <TableCell data-label=\"Description\">Gross Wages</TableCell>\n                    <TableCell className=\"text-right\" data-testid=\"text-gross-wages\" data-label=\"Amount\">{formatCurrency(displayData.payrollTax.grossWages)}</TableCell>\n                  </TableRow>\n                  <TableRow>\n                    <TableCell className=\"pl-8\" data-label=\"Description\">Federal Income Tax Withholding</TableCell>\n                    <TableCell className=\"text-right\" data-testid=\"text-federal-withholding\" data-label=\"Amount\">{formatCurrency(displayData.payrollTax.federalWithholding)}</TableCell>\n                  </TableRow>\n                  <TableRow>\n                    <TableCell className=\"pl-8\" data-label=\"Description\">State Income Tax Withholding</TableCell>\n                    <TableCell className=\"text-right\" data-testid=\"text-state-withholding\" data-label=\"Amount\">{formatCurrency(displayData.payrollTax.stateWithholding)}</TableCell>\n                  </TableRow>\n                  <TableRow>\n                    <TableCell className=\"pl-8\" data-label=\"Description\">Social Security Tax</TableCell>\n                    <TableCell className=\"text-right\" data-testid=\"text-social-security\" data-label=\"Amount\">{formatCurrency(displayData.payrollTax.socialSecurity)}</TableCell>\n                  </TableRow>\n                  <TableRow>\n                    <TableCell className=\"pl-8\" data-label=\"Description\">Medicare Tax</TableCell>\n                    <TableCell className=\"text-right\" data-testid=\"text-medicare\" data-label=\"Amount\">{formatCurrency(displayData.payrollTax.medicare)}</TableCell>\n                  </TableRow>\n                  <TableRow>\n                    <TableCell className=\"pl-8\" data-label=\"Description\">Employer Contributions</TableCell>\n                    <TableCell className=\"text-right\" data-testid=\"text-employer-contributions\" data-label=\"Amount\">{formatCurrency(displayData.payrollTax.employerContributions)}</TableCell>\n                  </TableRow>\n                  <TableRow className=\"font-semibold\">\n                    <TableCell data-label=\"Description\">Total Payroll Tax</TableCell>\n                    <TableCell className=\"text-right text-orange-600\" data-testid=\"text-total-payroll-tax\" data-label=\"Amount\">\n                      {formatCurrency(displayData.payrollTax.totalPayrollTax)}\n                    </TableCell>\n                  </TableRow>\n                </TableBody>\n              </Table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Tax Filings Tab */}\n        <TabsContent value=\"filings\">\n          <Card>\n            <CardContent className=\"p-0\">\n              <div className={isMobile ? \"mobile-table-container\" : \"\"}>\n                <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Form</TableHead>\n                    <TableHead>Period</TableHead>\n                    <TableHead>Due Date</TableHead>\n                    <TableHead className=\"text-right\">Amount</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {(displayData.filings || []).map((filing: any, index: number) => (\n                    <TableRow key={index} data-testid={`row-filing-${index}`}>\n                      <TableCell className=\"font-medium\" data-label=\"Form\">\n                        <div className=\"flex items-center gap-2\">\n                          <FileText className=\"h-4 w-4 text-muted-foreground\" />\n                          {filing.form}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Period\">{filing.period}</TableCell>\n                      <TableCell data-label=\"Due Date\">\n                        <div className=\"flex items-center gap-2\">\n                          <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                          {format(new Date(filing.dueDate), 'MMM dd, yyyy')}\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"text-right font-semibold\" data-label=\"Amount\">\n                        {formatCurrency(filing.amount)}\n                      </TableCell>\n                      <TableCell data-label=\"Status\">{getStatusBadge(filing.status)}</TableCell>\n                      <TableCell className=\"text-right\" data-label=\"Actions\">\n                        {filing.status === 'pending' && (\n                          <Button \n                            size=\"sm\" \n                            onClick={() => handleFile(filing.form)}\n                            data-testid={`button-file-${index}`}\n                          >\n                            File Now\n                          </Button>\n                        )}\n                        {filing.status === 'filed' && (\n                          <Button \n                            size=\"sm\" \n                            variant=\"outline\"\n                            data-testid={`button-view-${index}`}\n                          >\n                            View\n                          </Button>\n                        )}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":25831},"client/src/pages/reports/TrialBalancePage.tsx":{"content":"import { useState } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { useIsMobile } from '@/hooks/use-mobile';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport { \n  FileText, \n  Download, \n  Printer, \n  Calendar,\n  CheckCircle,\n  AlertCircle,\n  DollarSign,\n  Loader2\n} from 'lucide-react';\nimport { format } from 'date-fns';\n\n// Mock trial balance data\nconst mockTrialBalanceData = {\n  period: '2024-02-29',\n  company: 'Acme Corporation',\n  currency: 'USD',\n  accounts: [\n    // Assets\n    { code: '1000', name: 'Cash and Cash Equivalents', type: 'Asset', debit: 45250.50, credit: 0 },\n    { code: '1100', name: 'Accounts Receivable', type: 'Asset', debit: 28500.00, credit: 0 },\n    { code: '1200', name: 'Inventory', type: 'Asset', debit: 35750.00, credit: 0 },\n    { code: '1300', name: 'Prepaid Expenses', type: 'Asset', debit: 4200.00, credit: 0 },\n    { code: '1500', name: 'Property, Plant & Equipment', type: 'Asset', debit: 125000.00, credit: 0 },\n    { code: '1510', name: 'Accumulated Depreciation', type: 'Asset', debit: 0, credit: 25000.00 },\n    { code: '1600', name: 'Intangible Assets', type: 'Asset', debit: 15000.00, credit: 0 },\n    { code: '1700', name: 'Long-term Investments', type: 'Asset', debit: 20000.00, credit: 0 },\n    \n    // Liabilities\n    { code: '2000', name: 'Accounts Payable', type: 'Liability', debit: 0, credit: 18500.00 },\n    { code: '2100', name: 'Short-term Loans', type: 'Liability', debit: 0, credit: 10000.00 },\n    { code: '2200', name: 'Accrued Expenses', type: 'Liability', debit: 0, credit: 6750.00 },\n    { code: '2300', name: 'Current Portion of Long-term Debt', type: 'Liability', debit: 0, credit: 5000.00 },\n    { code: '2500', name: 'Long-term Debt', type: 'Liability', debit: 0, credit: 50000.00 },\n    { code: '2600', name: 'Deferred Tax Liabilities', type: 'Liability', debit: 0, credit: 8500.00 },\n    \n    // Equity\n    { code: '3000', name: 'Common Stock', type: 'Equity', debit: 0, credit: 50000.00 },\n    { code: '3100', name: 'Retained Earnings', type: 'Equity', debit: 0, credit: 86950.50 },\n    { code: '3200', name: 'Additional Paid-in Capital', type: 'Equity', debit: 0, credit: 10000.00 },\n    \n    // Revenue\n    { code: '4000', name: 'Sales Revenue', type: 'Revenue', debit: 0, credit: 125500.00 },\n    { code: '4100', name: 'Service Revenue', type: 'Revenue', debit: 0, credit: 18500.00 },\n    { code: '4200', name: 'Other Income', type: 'Revenue', debit: 0, credit: 3500.00 },\n    \n    // Expenses\n    { code: '5000', name: 'Cost of Goods Sold', type: 'Expense', debit: 75000.00, credit: 0 },\n    { code: '6000', name: 'Salaries & Wages', type: 'Expense', debit: 25000.00, credit: 0 },\n    { code: '6100', name: 'Rent & Utilities', type: 'Expense', debit: 8500.00, credit: 0 },\n    { code: '6200', name: 'Marketing & Advertising', type: 'Expense', debit: 5500.00, credit: 0 },\n    { code: '6300', name: 'Insurance', type: 'Expense', debit: 2200.00, credit: 0 },\n    { code: '6400', name: 'Depreciation', type: 'Expense', debit: 3500.00, credit: 0 },\n    { code: '6500', name: 'Office Supplies', type: 'Expense', debit: 1800.00, credit: 0 },\n    { code: '6600', name: 'Professional Fees', type: 'Expense', debit: 3000.00, credit: 0 },\n    { code: '6700', name: 'Interest Expense', type: 'Expense', debit: 1500.00, credit: 0 },\n    { code: '6800', name: 'Bank Charges', type: 'Expense', debit: 250.00, credit: 0 },\n    { code: '6900', name: 'Income Tax Expense', type: 'Expense', debit: 5250.00, credit: 0 },\n  ],\n};\n\nexport default function TrialBalancePage() {\n  const isMobile = useIsMobile();\n  const [selectedPeriod, setSelectedPeriod] = useState('current');\n  const [selectedEndDate, setSelectedEndDate] = useState<string>('');\n\n  // Fetch trial balance data\n  const { data: trialBalanceData = [], isLoading, error } = useQuery({\n    queryKey: ['/api/reports/trial-balance', selectedEndDate],\n    queryFn: () => {\n      const url = selectedEndDate \n        ? `/api/reports/trial-balance?endDate=${selectedEndDate}`\n        : '/api/reports/trial-balance';\n      return fetch(url).then(res => res.json());\n    }\n  });\n  const [filterType, setFilterType] = useState('all');\n\n  // Filter accounts based on type\n  const filteredAccounts = filterType === 'all' \n    ? trialBalanceData\n    : trialBalanceData.filter((acc: any) => acc.account_type === filterType);\n\n  // Calculate totals\n  const totalDebits = filteredAccounts.reduce((sum: number, acc: any) => sum + (Number(acc.debit) || 0), 0);\n  const totalCredits = filteredAccounts.reduce((sum: number, acc: any) => sum + (Number(acc.credit) || 0), 0);\n  const isBalanced = Math.abs(totalDebits - totalCredits) < 0.01;\n\n  // Group accounts by type\n  const groupedAccounts = {\n    asset: filteredAccounts.filter((acc: any) => acc.account_type === 'asset'),\n    liability: filteredAccounts.filter((acc: any) => acc.account_type === 'liability'),\n    equity: filteredAccounts.filter((acc: any) => acc.account_type === 'equity'),\n    revenue: filteredAccounts.filter((acc: any) => acc.account_type === 'revenue'),\n    expense: filteredAccounts.filter((acc: any) => acc.account_type === 'expense'),\n  };\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: 'USD',\n    }).format(amount);\n  };\n\n  const handleExport = (format: 'pdf' | 'excel') => {\n    console.log(`Exporting trial balance as ${format}`);\n  };\n\n  const handlePrint = () => {\n    window.print();\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Trial Balance</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            As of {format(new Date(mockTrialBalanceData.period), 'MMMM dd, yyyy')}\n          </p>\n        </div>\n        <div className=\"mobile-button-group\">\n          <Select value={selectedPeriod} onValueChange={setSelectedPeriod}>\n            <SelectTrigger className=\"w-32\" data-testid=\"select-period\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"current\">Current Period</SelectItem>\n              <SelectItem value=\"previous\">Previous Period</SelectItem>\n              <SelectItem value=\"yearend\">Year End</SelectItem>\n              <SelectItem value=\"custom\">Custom Date</SelectItem>\n            </SelectContent>\n          </Select>\n          <Select value={filterType} onValueChange={setFilterType}>\n            <SelectTrigger className=\"w-32\" data-testid=\"select-filter\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Accounts</SelectItem>\n              <SelectItem value=\"Asset\">Assets Only</SelectItem>\n              <SelectItem value=\"Liability\">Liabilities Only</SelectItem>\n              <SelectItem value=\"Equity\">Equity Only</SelectItem>\n              <SelectItem value=\"Revenue\">Revenue Only</SelectItem>\n              <SelectItem value=\"Expense\">Expenses Only</SelectItem>\n            </SelectContent>\n          </Select>\n          <Button variant=\"outline\" onClick={() => handleExport('pdf')}>\n            <Download className=\"h-4 w-4 mr-2\" />\n            Export\n          </Button>\n          <Button variant=\"outline\" onClick={handlePrint}>\n            <Printer className=\"h-4 w-4 mr-2\" />\n            Print\n          </Button>\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Debits</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{formatCurrency(totalDebits)}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              All debit entries\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Credits</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{formatCurrency(totalCredits)}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              All credit entries\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Difference</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className={`text-2xl font-bold ${isBalanced ? 'text-green-600' : 'text-red-600'}`}>\n              {formatCurrency(Math.abs(totalDebits - totalCredits))}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              {isBalanced ? 'Balanced' : 'Unbalanced'}\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Status</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center gap-2\">\n              {isBalanced ? (\n                <>\n                  <CheckCircle className=\"h-6 w-6 text-green-600\" />\n                  <span className=\"text-green-600 font-semibold\">Balanced</span>\n                </>\n              ) : (\n                <>\n                  <AlertCircle className=\"h-6 w-6 text-red-600\" />\n                  <span className=\"text-red-600 font-semibold\">Unbalanced</span>\n                </>\n              )}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              {filteredAccounts.length} accounts\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Trial Balance Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Trial Balance Details</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <Loader2 className=\"h-6 w-6 animate-spin\" />\n              <span className=\"ml-2\">Loading trial balance...</span>\n            </div>\n          ) : error ? (\n            <div className=\"text-center py-8 text-red-600\">\n              Failed to load trial balance data\n            </div>\n          ) : trialBalanceData.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              No account data available. Please add some transactions first.\n            </div>\n          ) : (\n            <div className={isMobile ? \"mobile-table-container\" : \"overflow-x-auto\"}>\n              <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n            <TableHeader>\n              <TableRow>\n                <TableHead className=\"w-[100px]\">Account Code</TableHead>\n                <TableHead className=\"w-[400px]\">Account Name</TableHead>\n                <TableHead className=\"w-[100px]\">Type</TableHead>\n                <TableHead className=\"text-right\">Debit</TableHead>\n                <TableHead className=\"text-right\">Credit</TableHead>\n                <TableHead className=\"text-right\">Balance</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {filterType === 'all' ? (\n                // Show grouped accounts\n                Object.entries(groupedAccounts).map(([type, accounts]) => (\n                  accounts.length > 0 && (\n                    <>\n                      <TableRow key={type} className=\"font-semibold bg-muted/50\">\n                        <TableCell colSpan={6}>{type.toUpperCase()}S</TableCell>\n                      </TableRow>\n                      {accounts.map((account: any) => {\n                        const debit = Number(account.debit) || 0;\n                        const credit = Number(account.credit) || 0;\n                        const balance = debit - credit;\n                        return (\n                          <TableRow key={account.code}>\n                            <TableCell className=\"font-medium\">{account.code}</TableCell>\n                            <TableCell className=\"pl-8\">{account.name}</TableCell>\n                            <TableCell>\n                              <Badge variant=\"secondary\" className=\"text-xs\">\n                                {account.account_type}\n                              </Badge>\n                            </TableCell>\n                            <TableCell className=\"text-right\">\n                              {debit > 0 ? formatCurrency(debit) : '-'}\n                            </TableCell>\n                            <TableCell className=\"text-right\">\n                              {credit > 0 ? formatCurrency(credit) : '-'}\n                            </TableCell>\n                            <TableCell className={`text-right font-semibold ${balance >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n                              {formatCurrency(Math.abs(balance))} {balance < 0 ? '(CR)' : '(DR)'}\n                            </TableCell>\n                          </TableRow>\n                        );\n                      })}\n                      <TableRow className=\"font-semibold\">\n                        <TableCell colSpan={3} className=\"text-right\">\n                          Subtotal - {type}s\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          {formatCurrency(accounts.reduce((sum: number, acc: any) => sum + (Number(acc.debit) || 0), 0))}\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          {formatCurrency(accounts.reduce((sum: number, acc: any) => sum + (Number(acc.credit) || 0), 0))}\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          {formatCurrency(Math.abs(\n                            accounts.reduce((sum: number, acc: any) => sum + ((Number(acc.debit) || 0) - (Number(acc.credit) || 0)), 0)\n                          ))}\n                        </TableCell>\n                      </TableRow>\n                    </>\n                  )\n                ))\n              ) : (\n                // Show filtered accounts\n                filteredAccounts.map((account: any) => {\n                  const debit = Number(account.debit) || 0;\n                  const credit = Number(account.credit) || 0;\n                  const balance = debit - credit;\n                  return (\n                    <TableRow key={account.code}>\n                      <TableCell className=\"font-medium\">{account.code}</TableCell>\n                      <TableCell>{account.name}</TableCell>\n                      <TableCell>\n                        <Badge variant=\"secondary\" className=\"text-xs\">\n                          {account.account_type}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        {debit > 0 ? formatCurrency(debit) : '-'}\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        {credit > 0 ? formatCurrency(credit) : '-'}\n                      </TableCell>\n                      <TableCell className={`text-right font-semibold ${balance >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n                        {formatCurrency(Math.abs(balance))} {balance < 0 ? '(CR)' : '(DR)'}\n                      </TableCell>\n                    </TableRow>\n                  );\n                })\n              )}\n\n              {/* Total Row */}\n              <TableRow className={`font-bold text-lg ${isBalanced ? 'bg-green-100 dark:bg-green-900/30' : 'bg-red-100 dark:bg-red-900/30'}`}>\n                <TableCell colSpan={3}>TOTAL</TableCell>\n                <TableCell className=\"text-right\">{formatCurrency(totalDebits)}</TableCell>\n                <TableCell className=\"text-right\">{formatCurrency(totalCredits)}</TableCell>\n                <TableCell className={`text-right ${isBalanced ? 'text-green-600' : 'text-red-600'}`}>\n                  {isBalanced ? 'BALANCED' : formatCurrency(Math.abs(totalDebits - totalCredits))}\n                </TableCell>\n              </TableRow>\n            </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":16938},"client/src/pages/sales/CreditNotesPage.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { queryClient, apiRequest } from '@/lib/queryClient';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { \n  FileText, \n  Plus, \n  MoreHorizontal, \n  Eye, \n  Edit,\n  Copy,\n  Send,\n  Download,\n  RefreshCw,\n  CheckCircle,\n  Clock,\n  AlertCircle,\n  MinusCircle,\n  Calendar,\n  User\n} from 'lucide-react';\nimport { format } from 'date-fns';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { useToast } from '@/hooks/use-toast';\nimport { useIsMobile } from '@/hooks/use-mobile';\n\n// Credit note form schema\nconst creditNoteSchema = z.object({\n  customer_id: z.string().min(1, 'Please select a customer'),\n  invoice_id: z.string().min(1, 'Please select a related invoice'),\n  amount: z.string().min(1, 'Amount is required'),\n  reason: z.string().min(2, 'Reason must be at least 2 characters'),\n  notes: z.string().optional(),\n  issue_date: z.string().min(1, 'Issue date is required'),\n});\n\ntype CreditNoteForm = z.infer<typeof creditNoteSchema>;\n\n// Mock data\nconst mockCreditNotes = [\n  {\n    id: '1',\n    credit_note_number: 'CN-2024-001',\n    customer_name: 'Tech Innovations Ltd',\n    invoice_number: 'INV-2024-001',\n    issue_date: '2024-02-10',\n    total_amount: 550.00,\n    status: 'applied',\n    reason: 'Product return',\n    currency: 'USD',\n  },\n  {\n    id: '2',\n    credit_note_number: 'CN-2024-002',\n    customer_name: 'Global Services Inc',\n    invoice_number: 'INV-2024-015',\n    issue_date: '2024-02-12',\n    total_amount: 1250.00,\n    status: 'pending',\n    reason: 'Price adjustment',\n    currency: 'USD',\n  },\n  {\n    id: '3',\n    credit_note_number: 'CN-2024-003',\n    customer_name: 'Digital Marketing Co',\n    invoice_number: 'INV-2024-022',\n    issue_date: '2024-02-08',\n    total_amount: 3000.00,\n    status: 'partially_applied',\n    reason: 'Service cancellation',\n    currency: 'USD',\n  },\n  {\n    id: '4',\n    credit_note_number: 'CN-2024-004',\n    customer_name: 'Retail Solutions Ltd',\n    invoice_number: 'INV-2024-033',\n    issue_date: '2024-02-14',\n    total_amount: 800.00,\n    status: 'draft',\n    reason: 'Quality issues',\n    currency: 'USD',\n  },\n  {\n    id: '5',\n    credit_note_number: 'CN-2024-005',\n    customer_name: 'Manufacturing Plus',\n    invoice_number: 'INV-2024-041',\n    issue_date: '2024-02-13',\n    total_amount: 5000.00,\n    status: 'void',\n    reason: 'Duplicate billing',\n    currency: 'USD',\n  },\n];\n\nconst statusConfig = {\n  draft: { label: 'Draft', icon: Edit, color: 'secondary' },\n  pending: { label: 'Pending', icon: Clock, color: 'default' },\n  applied: { label: 'Applied', icon: CheckCircle, color: 'success' },\n  partially_applied: { label: 'Partial', icon: MinusCircle, color: 'warning' },\n  void: { label: 'Void', icon: AlertCircle, color: 'destructive' },\n};\n\nexport default function CreditNotesPage() {\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState('all');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [showDialog, setShowDialog] = useState(false);\n  const isMobile = useIsMobile();\n\n  // Fetch contacts (customers)\n  const { data: contacts = [] } = useQuery<any[]>({\n    queryKey: ['/api/contacts'],\n  });\n\n  // Fetch invoices\n  const { data: invoices = [] } = useQuery<any[]>({\n    queryKey: ['/api/sales/invoices'],\n  });\n\n  const customers = contacts.filter(contact => \n    contact.type === 'customer' || contact.type === 'both'\n  );\n\n  // Create credit note mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: CreditNoteForm) => {\n      const processedData = {\n        ...data,\n        amount: parseFloat(data.amount),\n        status: 'draft',\n      };\n      return await apiRequest('POST', '/api/sales/credit-notes', processedData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/sales/credit-notes'] });\n      setShowDialog(false);\n      toast({\n        title: 'Credit note created',\n        description: 'New credit note has been created successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to create credit note',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Form\n  const form = useForm<CreditNoteForm>({\n    resolver: zodResolver(creditNoteSchema),\n    defaultValues: {\n      customer_id: '',\n      invoice_id: '',\n      amount: '',\n      reason: '',\n      notes: '',\n      issue_date: new Date().toISOString().split('T')[0],\n    },\n  });\n\n  const onSubmit = (data: CreditNoteForm) => {\n    createMutation.mutate(data);\n  };\n\n  const creditNotes = mockCreditNotes;\n\n  // Filter credit notes\n  const filteredCreditNotes = creditNotes.filter((note) => {\n    const matchesSearch = \n      note.credit_note_number.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      note.customer_name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      note.invoice_number.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    if (!matchesSearch) return false;\n    \n    switch (activeTab) {\n      case 'draft':\n        return note.status === 'draft';\n      case 'pending':\n        return note.status === 'pending';\n      case 'applied':\n        return note.status === 'applied' || note.status === 'partially_applied';\n      case 'void':\n        return note.status === 'void';\n      default:\n        return true;\n    }\n  });\n\n  // Calculate statistics\n  const stats = {\n    total: creditNotes.length,\n    totalAmount: creditNotes.reduce((sum, cn) => sum + cn.total_amount, 0),\n    applied: creditNotes.filter(cn => cn.status === 'applied').reduce((sum, cn) => sum + cn.total_amount, 0),\n    pending: creditNotes.filter(cn => cn.status === 'pending' || cn.status === 'partially_applied').reduce((sum, cn) => sum + cn.total_amount, 0),\n  };\n\n  const handleApplyToInvoice = (id: string) => {\n    toast({\n      title: 'Credit applied',\n      description: 'Credit note has been applied to the invoice successfully.',\n    });\n  };\n\n  const handleSend = (id: string) => {\n    toast({\n      title: 'Credit note sent',\n      description: 'The credit note has been sent to the customer.',\n    });\n  };\n\n  const handleVoid = (id: string) => {\n    if (confirm('Are you sure you want to void this credit note?')) {\n      toast({\n        title: 'Credit note voided',\n        description: 'The credit note has been voided successfully.',\n      });\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    const config = statusConfig[status as keyof typeof statusConfig];\n    if (!config) return null;\n    \n    const Icon = config.icon;\n    return (\n      <Badge variant={config.color as any} className=\"gap-1\">\n        <Icon className=\"h-3 w-3\" />\n        {config.label}\n      </Badge>\n    );\n  };\n\n  const formatCurrency = (amount: number, currency: string) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: currency,\n    }).format(amount);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Credit Notes</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Manage credit notes for customer returns and adjustments\n          </p>\n        </div>\n        <Dialog open={showDialog} onOpenChange={setShowDialog}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-new-credit-note\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Credit Note\n            </Button>\n          </DialogTrigger>\n          <DialogContent className={`max-w-2xl max-h-[90vh] overflow-y-auto ${isMobile ? 'w-full max-w-full mx-4' : ''}`}>\n            <DialogHeader>\n              <DialogTitle>Create New Credit Note</DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"customer_id\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Customer</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Select customer\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {customers.map((customer) => (\n                              <SelectItem key={customer.id} value={customer.id}>\n                                {customer.name}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"invoice_id\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Related Invoice</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Select invoice\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {invoices.map((invoice) => (\n                              <SelectItem key={invoice.id} value={invoice.id}>\n                                {invoice.invoice_number} - {invoice.customer_reference}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"amount\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Amount</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            placeholder=\"0.00\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"issue_date\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Issue Date</FormLabel>\n                        <FormControl>\n                          <Input type=\"date\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"reason\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Reason</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Enter reason for credit note\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"notes\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Notes (Optional)</FormLabel>\n                      <FormControl>\n                        <Textarea\n                          placeholder=\"Additional notes...\"\n                          className=\"resize-none\"\n                          rows={3}\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex items-center gap-3 pt-4\">\n                  <Button type=\"submit\" disabled={createMutation.isPending}>\n                    {createMutation.isPending ? 'Creating...' : 'Create Credit Note'}\n                  </Button>\n                  <Button \n                    type=\"button\" \n                    variant=\"outline\" \n                    onClick={() => setShowDialog(false)}\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Statistics Cards */}\n      <div className=\"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Credit Notes</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.total}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              This month\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Amount</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-red-600\">\n              {formatCurrency(stats.totalAmount, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Credit issued\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Applied</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">\n              {formatCurrency(stats.applied, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              To invoices\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Pending</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-orange-600\">\n              {formatCurrency(stats.pending, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              To be applied\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <div className=\"flex items-center gap-4\">\n        <div className=\"flex-1\">\n          <Input\n            placeholder=\"Search credit notes...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"max-w-sm\"\n            data-testid=\"input-search-credit-notes\"\n          />\n        </div>\n      </div>\n\n      {/* Tabs and Table */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList>\n          <TabsTrigger value=\"all\">All</TabsTrigger>\n          <TabsTrigger value=\"draft\">Draft</TabsTrigger>\n          <TabsTrigger value=\"pending\">Pending</TabsTrigger>\n          <TabsTrigger value=\"applied\">Applied</TabsTrigger>\n          <TabsTrigger value=\"void\">Void</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value={activeTab} className=\"mt-4\">\n          <Card>\n            <CardContent className=\"p-0\">\n              <div className={isMobile ? \"mobile-table-container\" : \"\"}>\n                <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Credit Note</TableHead>\n                      <TableHead>Customer</TableHead>\n                      <TableHead>Related Invoice</TableHead>\n                      <TableHead>Issue Date</TableHead>\n                      <TableHead>Reason</TableHead>\n                      <TableHead>Amount</TableHead>\n                      <TableHead>Status</TableHead>\n                      <TableHead className=\"text-right\">Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                <TableBody>\n                  {filteredCreditNotes.map((note) => (\n                    <TableRow key={note.id} data-testid={`row-credit-note-${note.id}`}>\n                      <TableCell className=\"font-medium\" data-label=\"Credit Note\">\n                        <div className=\"flex items-center gap-2\">\n                          <RefreshCw className=\"h-4 w-4 text-muted-foreground\" />\n                          {note.credit_note_number}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Customer\">\n                        <div className=\"flex items-center gap-2\">\n                          <User className=\"h-4 w-4 text-muted-foreground\" />\n                          {note.customer_name}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Related Invoice\">\n                        <div className=\"flex items-center gap-2\">\n                          <FileText className=\"h-4 w-4 text-muted-foreground\" />\n                          {note.invoice_number}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Issue Date\">\n                        <div className=\"flex items-center gap-2\">\n                          <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                          {format(new Date(note.issue_date), 'MMM dd, yyyy')}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Reason\">{note.reason}</TableCell>\n                      <TableCell className=\"font-semibold text-red-600\" data-label=\"Amount\">\n                        -{formatCurrency(note.total_amount, note.currency)}\n                      </TableCell>\n                      <TableCell data-label=\"Status\">{getStatusBadge(note.status)}</TableCell>\n                      <TableCell className=\"text-right\" data-label=\"Actions\">\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\" data-testid={`button-actions-${note.id}`}>\n                              <MoreHorizontal className=\"h-4 w-4\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem>\n                              <Eye className=\"h-4 w-4 mr-2\" />\n                              View\n                            </DropdownMenuItem>\n                            <DropdownMenuItem>\n                              <Edit className=\"h-4 w-4 mr-2\" />\n                              Edit\n                            </DropdownMenuItem>\n                            <DropdownMenuItem>\n                              <Copy className=\"h-4 w-4 mr-2\" />\n                              Duplicate\n                            </DropdownMenuItem>\n                            {note.status === 'draft' && (\n                              <DropdownMenuItem onClick={() => handleSend(note.id)}>\n                                <Send className=\"h-4 w-4 mr-2\" />\n                                Send\n                              </DropdownMenuItem>\n                            )}\n                            {note.status === 'pending' && (\n                              <DropdownMenuItem onClick={() => handleApplyToInvoice(note.id)}>\n                                <CheckCircle className=\"h-4 w-4 mr-2\" />\n                                Apply to Invoice\n                              </DropdownMenuItem>\n                            )}\n                            <DropdownMenuItem>\n                              <Download className=\"h-4 w-4 mr-2\" />\n                              Download PDF\n                            </DropdownMenuItem>\n                            <DropdownMenuSeparator />\n                            {note.status !== 'void' && (\n                              <DropdownMenuItem \n                                className=\"text-destructive\"\n                                onClick={() => handleVoid(note.id)}\n                              >\n                                <AlertCircle className=\"h-4 w-4 mr-2\" />\n                                Void\n                              </DropdownMenuItem>\n                            )}\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n                </Table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":22680},"client/src/pages/sales/InvoicesPage.tsx":{"content":"import { useState } from 'react';\nimport { Link } from 'wouter';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { queryClient, apiRequest } from '@/lib/queryClient';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { \n  FileText, \n  Plus, \n  MoreHorizontal, \n  Eye, \n  Edit, \n  Trash2, \n  Send, \n  Download, \n  Copy,\n  DollarSign,\n  Calendar,\n  User,\n  CheckCircle,\n  Clock,\n  XCircle,\n  AlertCircle\n} from 'lucide-react';\nimport { format } from 'date-fns';\nimport { useToast } from '@/hooks/use-toast';\nimport { useIsMobile } from '@/hooks/use-mobile';\n\nconst statusConfig = {\n  draft: { label: 'Draft', icon: Edit, color: 'secondary' },\n  sent: { label: 'Sent', icon: Send, color: 'default' },\n  paid: { label: 'Paid', icon: CheckCircle, color: 'success' },\n  partially_paid: { label: 'Partial', icon: Clock, color: 'warning' },\n  overdue: { label: 'Overdue', icon: AlertCircle, color: 'destructive' },\n  cancelled: { label: 'Cancelled', icon: XCircle, color: 'secondary' },\n};\n\nexport default function InvoicesPage() {\n  const { toast } = useToast();\n  const isMobile = useIsMobile();\n  const [activeTab, setActiveTab] = useState('all');\n  const [searchTerm, setSearchTerm] = useState('');\n\n  // Fetch invoices from API\n  const { \n    data: invoices = [], \n    isLoading, \n    error \n  } = useQuery({\n    queryKey: ['/api/sales/invoices'],\n    select: (data: any[]) => data || []\n  });\n\n  // Delete mutation\n  const deleteMutation = useMutation({\n    mutationFn: async (invoiceId: string) => {\n      return apiRequest(`/api/sales/invoices/${invoiceId}`, 'DELETE');\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/sales/invoices'] });\n      toast({\n        title: 'Invoice deleted',\n        description: 'The invoice has been deleted successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to delete invoice',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Show loading state\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-foreground\">Sales Invoices</h1>\n            <p className=\"text-muted-foreground mt-1\">Loading invoices...</p>\n          </div>\n        </div>\n        <div className=\"grid gap-4 md:grid-cols-4\">\n          {Array.from({ length: 4 }).map((_, i) => (\n            <Card key={i}>\n              <CardHeader className=\"pb-2\">\n                <div className=\"h-4 bg-muted animate-pulse rounded\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"h-8 bg-muted animate-pulse rounded mb-2\" />\n                <div className=\"h-3 bg-muted animate-pulse rounded\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  // Show error state\n  if (error) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-foreground\">Sales Invoices</h1>\n            <p className=\"text-muted-foreground mt-1\">Error loading invoices</p>\n          </div>\n        </div>\n        <Card>\n          <CardContent className=\"p-6 text-center\">\n            <AlertCircle className=\"h-12 w-12 mx-auto text-muted-foreground mb-2\" />\n            <p className=\"text-muted-foreground\">Failed to load invoices. Please try again.</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  // Filter invoices based on tab and search\n  const filteredInvoices = invoices.filter((invoice) => {\n    const matchesSearch = \n      invoice.invoice_number.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      invoice.customer_name.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    if (!matchesSearch) return false;\n    \n    switch (activeTab) {\n      case 'draft':\n        return invoice.status === 'draft';\n      case 'sent':\n        return invoice.status === 'sent';\n      case 'paid':\n        return invoice.status === 'paid';\n      case 'overdue':\n        return invoice.status === 'overdue';\n      default:\n        return true;\n    }\n  });\n\n  // Calculate statistics\n  const stats = {\n    total: invoices.length,\n    totalAmount: invoices.reduce((sum, inv) => sum + inv.total_amount, 0),\n    paidAmount: invoices.reduce((sum, inv) => sum + inv.paid_amount, 0),\n    outstanding: invoices.reduce((sum, inv) => sum + (inv.total_amount - inv.paid_amount), 0),\n    draft: invoices.filter(inv => inv.status === 'draft').length,\n    sent: invoices.filter(inv => inv.status === 'sent').length,\n    paid: invoices.filter(inv => inv.status === 'paid').length,\n    overdue: invoices.filter(inv => inv.status === 'overdue').length,\n  };\n\n  const handleDelete = (id: string) => {\n    if (confirm('Are you sure you want to delete this invoice?')) {\n      deleteMutation.mutate(id);\n    }\n  };\n\n  const handleDuplicate = (id: string) => {\n    toast({\n      title: 'Invoice duplicated',\n      description: 'A copy of the invoice has been created.',\n    });\n  };\n\n  const handleSend = (id: string) => {\n    toast({\n      title: 'Invoice sent',\n      description: 'The invoice has been sent to the customer.',\n    });\n  };\n\n  const getStatusBadge = (status: string) => {\n    const config = statusConfig[status as keyof typeof statusConfig];\n    if (!config) return null;\n    \n    const Icon = config.icon;\n    return (\n      <Badge variant={config.color as any} className=\"gap-1\">\n        <Icon className=\"h-3 w-3\" />\n        {config.label}\n      </Badge>\n    );\n  };\n\n  const formatCurrency = (amount: number, currency: string) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: currency,\n    }).format(amount);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className={`${isMobile ? 'space-y-4' : 'flex items-center justify-between'}`}>\n        <div>\n          <h1 className={`${isMobile ? 'text-2xl' : 'text-3xl'} font-bold text-foreground`}>Sales Invoices</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            {isMobile ? 'Manage customer invoices' : 'Create and manage customer invoices'}\n          </p>\n        </div>\n        <Button \n          asChild \n          size={isMobile ? 'sm' : 'default'}\n          data-testid=\"button-new-invoice\"\n        >\n          <Link href=\"/sales/invoices/new\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            New Invoice\n          </Link>\n        </Button>\n      </div>\n\n      {/* Statistics Cards */}\n      <div className={`grid gap-4 ${isMobile ? 'grid-cols-2' : 'grid-cols-2 md:grid-cols-4'}`}>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Invoices</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.total}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              {stats.draft} draft, {stats.sent} sent\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Amount</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {formatCurrency(stats.totalAmount, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              All invoices\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Paid Amount</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">\n              {formatCurrency(stats.paidAmount, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Collected\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Outstanding</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-orange-600\">\n              {formatCurrency(stats.outstanding, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              To collect\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search and Filters */}\n      <div className=\"flex items-center gap-4\">\n        <div className=\"flex-1\">\n          <Input\n            placeholder=\"Search invoices...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"max-w-sm\"\n            data-testid=\"input-search-invoices\"\n          />\n        </div>\n      </div>\n\n      {/* Tabs and Table */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList>\n          <TabsTrigger value=\"all\" data-testid=\"tab-all\">\n            All ({stats.total})\n          </TabsTrigger>\n          <TabsTrigger value=\"draft\" data-testid=\"tab-draft\">\n            Draft ({stats.draft})\n          </TabsTrigger>\n          <TabsTrigger value=\"sent\" data-testid=\"tab-sent\">\n            Sent ({stats.sent})\n          </TabsTrigger>\n          <TabsTrigger value=\"paid\" data-testid=\"tab-paid\">\n            Paid ({stats.paid})\n          </TabsTrigger>\n          <TabsTrigger value=\"overdue\" data-testid=\"tab-overdue\">\n            Overdue ({stats.overdue})\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value={activeTab} className=\"mt-4\">\n          <Card>\n            <CardContent className=\"p-0\">\n              <div className={isMobile ? \"mobile-table-container\" : \"\"}>\n                <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Invoice #</TableHead>\n                    <TableHead>Customer</TableHead>\n                    <TableHead>Issue Date</TableHead>\n                    <TableHead>Due Date</TableHead>\n                    <TableHead>Amount</TableHead>\n                    <TableHead>Paid</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredInvoices.length === 0 ? (\n                    <TableRow>\n                      <TableCell colSpan={8} className=\"text-center py-8\">\n                        <FileText className=\"h-12 w-12 mx-auto text-muted-foreground mb-2\" />\n                        <p className=\"text-muted-foreground\">No invoices found</p>\n                      </TableCell>\n                    </TableRow>\n                  ) : (\n                    filteredInvoices.map((invoice) => (\n                      <TableRow key={invoice.id} data-testid={`row-invoice-${invoice.id}`}>\n                        <TableCell className=\"font-medium\" data-label=\"Invoice #\">\n                          <Link \n                            href={`/sales/invoices/${invoice.id}`}\n                            className=\"hover:underline\"\n                          >\n                            {invoice.invoice_number}\n                          </Link>\n                        </TableCell>\n                        <TableCell data-label=\"Customer\">\n                          <div className=\"flex items-center gap-2\">\n                            <User className=\"h-4 w-4 text-muted-foreground\" />\n                            {invoice.customer_name}\n                          </div>\n                        </TableCell>\n                        <TableCell data-label=\"Issue Date\">\n                          <div className=\"flex items-center gap-1\">\n                            <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                            {format(new Date(invoice.issue_date), 'MMM dd, yyyy')}\n                          </div>\n                        </TableCell>\n                        <TableCell data-label=\"Due Date\">\n                          {format(new Date(invoice.due_date), 'MMM dd, yyyy')}\n                        </TableCell>\n                        <TableCell data-label=\"Amount\">\n                          <div className=\"font-medium\">\n                            {formatCurrency(invoice.total_amount, invoice.currency)}\n                          </div>\n                        </TableCell>\n                        <TableCell data-label=\"Paid\">\n                          {invoice.paid_amount > 0 ? (\n                            <span className=\"text-green-600\">\n                              {formatCurrency(invoice.paid_amount, invoice.currency)}\n                            </span>\n                          ) : (\n                            <span className=\"text-muted-foreground\">-</span>\n                          )}\n                        </TableCell>\n                        <TableCell data-label=\"Status\">\n                          {getStatusBadge(invoice.status)}\n                        </TableCell>\n                        <TableCell className=\"text-right\" data-label=\"Actions\">\n                          <DropdownMenu>\n                            <DropdownMenuTrigger asChild>\n                              <Button \n                                variant=\"ghost\" \n                                size=\"sm\"\n                                data-testid={`button-actions-${invoice.id}`}\n                              >\n                                <MoreHorizontal className=\"h-4 w-4\" />\n                              </Button>\n                            </DropdownMenuTrigger>\n                            <DropdownMenuContent align=\"end\">\n                              <DropdownMenuItem asChild>\n                                <Link href={`/sales/invoices/${invoice.id}`}>\n                                  <Eye className=\"h-4 w-4 mr-2\" />\n                                  View\n                                </Link>\n                              </DropdownMenuItem>\n                              <DropdownMenuItem asChild>\n                                <Link href={`/sales/invoices/${invoice.id}/edit`}>\n                                  <Edit className=\"h-4 w-4 mr-2\" />\n                                  Edit\n                                </Link>\n                              </DropdownMenuItem>\n                              <DropdownMenuItem onClick={() => handleDuplicate(invoice.id)}>\n                                <Copy className=\"h-4 w-4 mr-2\" />\n                                Duplicate\n                              </DropdownMenuItem>\n                              {invoice.status === 'draft' && (\n                                <DropdownMenuItem onClick={() => handleSend(invoice.id)}>\n                                  <Send className=\"h-4 w-4 mr-2\" />\n                                  Send\n                                </DropdownMenuItem>\n                              )}\n                              <DropdownMenuItem>\n                                <Download className=\"h-4 w-4 mr-2\" />\n                                Download PDF\n                              </DropdownMenuItem>\n                              <DropdownMenuSeparator />\n                              <DropdownMenuItem \n                                onClick={() => handleDelete(invoice.id)}\n                                className=\"text-destructive\"\n                              >\n                                <Trash2 className=\"h-4 w-4 mr-2\" />\n                                Delete\n                              </DropdownMenuItem>\n                            </DropdownMenuContent>\n                          </DropdownMenu>\n                        </TableCell>\n                      </TableRow>\n                    ))\n                  )}\n                </TableBody>\n                </Table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":16889},"client/src/pages/sales/OrdersPage.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { queryClient, apiRequest } from '@/lib/queryClient';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { \n  ShoppingCart, \n  Plus, \n  MoreHorizontal, \n  Eye, \n  Edit, \n  Copy,\n  Truck,\n  Package,\n  CheckCircle,\n  Clock,\n  XCircle,\n  ArrowRight,\n  Calendar,\n  User\n} from 'lucide-react';\nimport { format } from 'date-fns';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { useToast } from '@/hooks/use-toast';\nimport { useIsMobile } from '@/hooks/use-mobile';\n\n// Sales order form schema\nconst salesOrderSchema = z.object({\n  customer_id: z.string().min(1, 'Please select a customer'),\n  order_date: z.string().min(1, 'Order date is required'),\n  delivery_date: z.string().min(1, 'Delivery date is required'),\n  description: z.string().min(2, 'Description must be at least 2 characters'),\n  amount: z.string().min(1, 'Amount is required'),\n  notes: z.string().optional(),\n});\n\ntype SalesOrderForm = z.infer<typeof salesOrderSchema>;\n\n// Mock data\nconst mockOrders = [\n  {\n    id: '1',\n    order_number: 'SO-2024-001',\n    customer_name: 'Tech Innovations Ltd',\n    order_date: '2024-02-10',\n    delivery_date: '2024-02-15',\n    total_amount: 15500.00,\n    status: 'shipped',\n    currency: 'USD',\n    items_count: 5,\n    payment_status: 'paid',\n  },\n  {\n    id: '2',\n    order_number: 'SO-2024-002',\n    customer_name: 'Global Services Inc',\n    order_date: '2024-02-12',\n    delivery_date: '2024-02-20',\n    total_amount: 8250.00,\n    status: 'processing',\n    currency: 'USD',\n    items_count: 3,\n    payment_status: 'partial',\n  },\n  {\n    id: '3',\n    order_number: 'SO-2024-003',\n    customer_name: 'Digital Marketing Co',\n    order_date: '2024-02-08',\n    delivery_date: '2024-02-10',\n    total_amount: 22000.00,\n    status: 'delivered',\n    currency: 'USD',\n    items_count: 8,\n    payment_status: 'paid',\n  },\n  {\n    id: '4',\n    order_number: 'SO-2024-004',\n    customer_name: 'Retail Solutions Ltd',\n    order_date: '2024-02-14',\n    delivery_date: '2024-02-25',\n    total_amount: 5600.00,\n    status: 'pending',\n    currency: 'USD',\n    items_count: 2,\n    payment_status: 'pending',\n  },\n  {\n    id: '5',\n    order_number: 'SO-2024-005',\n    customer_name: 'Manufacturing Plus',\n    order_date: '2024-02-13',\n    delivery_date: '2024-02-18',\n    total_amount: 45000.00,\n    status: 'cancelled',\n    currency: 'USD',\n    items_count: 12,\n    payment_status: 'refunded',\n  },\n];\n\nconst statusConfig = {\n  pending: { label: 'Pending', icon: Clock, color: 'secondary' },\n  processing: { label: 'Processing', icon: Package, color: 'default' },\n  shipped: { label: 'Shipped', icon: Truck, color: 'warning' },\n  delivered: { label: 'Delivered', icon: CheckCircle, color: 'success' },\n  cancelled: { label: 'Cancelled', icon: XCircle, color: 'destructive' },\n};\n\nconst paymentStatusConfig = {\n  pending: { label: 'Pending', color: 'secondary' },\n  partial: { label: 'Partial', color: 'warning' },\n  paid: { label: 'Paid', color: 'success' },\n  refunded: { label: 'Refunded', color: 'destructive' },\n};\n\nexport default function OrdersPage() {\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState('all');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [showDialog, setShowDialog] = useState(false);\n  const isMobile = useIsMobile();\n\n  // Fetch contacts (customers)\n  const { data: contacts = [] } = useQuery<any[]>({\n    queryKey: ['/api/contacts'],\n  });\n\n  const customers = contacts.filter(contact => \n    contact.type === 'customer' || contact.type === 'both'\n  );\n\n  // Create sales order mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: SalesOrderForm) => {\n      const processedData = {\n        ...data,\n        amount: parseFloat(data.amount),\n        status: 'pending',\n      };\n      return await apiRequest('POST', '/api/sales/orders', processedData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/sales/orders'] });\n      setShowDialog(false);\n      toast({\n        title: 'Order created',\n        description: 'New sales order has been created successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to create order',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Form\n  const form = useForm<SalesOrderForm>({\n    resolver: zodResolver(salesOrderSchema),\n    defaultValues: {\n      customer_id: '',\n      order_date: new Date().toISOString().split('T')[0],\n      delivery_date: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 7 days from now\n      description: '',\n      amount: '',\n      notes: '',\n    },\n  });\n\n  const onSubmit = (data: SalesOrderForm) => {\n    createMutation.mutate(data);\n  };\n\n  const orders = mockOrders;\n\n  // Filter orders\n  const filteredOrders = orders.filter((order) => {\n    const matchesSearch = \n      order.order_number.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      order.customer_name.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    if (!matchesSearch) return false;\n    \n    switch (activeTab) {\n      case 'pending':\n        return order.status === 'pending';\n      case 'processing':\n        return order.status === 'processing';\n      case 'shipped':\n        return order.status === 'shipped';\n      case 'delivered':\n        return order.status === 'delivered';\n      case 'cancelled':\n        return order.status === 'cancelled';\n      default:\n        return true;\n    }\n  });\n\n  // Calculate statistics\n  const stats = {\n    total: orders.length,\n    totalValue: orders.reduce((sum, o) => sum + o.total_amount, 0),\n    pending: orders.filter(o => o.status === 'pending').length,\n    processing: orders.filter(o => o.status === 'processing').length,\n    shipped: orders.filter(o => o.status === 'shipped').length,\n    delivered: orders.filter(o => o.status === 'delivered').length,\n  };\n\n  const handleConvertToInvoice = (id: string) => {\n    toast({\n      title: 'Invoice created',\n      description: 'Sales order has been converted to an invoice successfully.',\n    });\n  };\n\n  const handleMarkAsShipped = (id: string) => {\n    toast({\n      title: 'Order shipped',\n      description: 'Order status has been updated to shipped.',\n    });\n  };\n\n  const handleCancelOrder = (id: string) => {\n    if (confirm('Are you sure you want to cancel this order?')) {\n      toast({\n        title: 'Order cancelled',\n        description: 'The order has been cancelled successfully.',\n      });\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    const config = statusConfig[status as keyof typeof statusConfig];\n    if (!config) return null;\n    \n    const Icon = config.icon;\n    return (\n      <Badge variant={config.color as any} className=\"gap-1\">\n        <Icon className=\"h-3 w-3\" />\n        {config.label}\n      </Badge>\n    );\n  };\n\n  const getPaymentStatusBadge = (status: string) => {\n    const config = paymentStatusConfig[status as keyof typeof paymentStatusConfig];\n    if (!config) return null;\n    \n    return (\n      <Badge variant={config.color as any}>\n        {config.label}\n      </Badge>\n    );\n  };\n\n  const formatCurrency = (amount: number, currency: string) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: currency,\n    }).format(amount);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className={`${isMobile ? 'space-y-4' : 'flex items-center justify-between'}`}>\n        <div>\n          <h1 className={`${isMobile ? 'text-2xl' : 'text-3xl'} font-bold text-foreground`}>Sales Orders</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            {isMobile ? 'Manage customer orders' : 'Manage customer orders and deliveries'}\n          </p>\n        </div>\n        <Dialog open={showDialog} onOpenChange={setShowDialog}>\n          <DialogTrigger asChild>\n            <Button \n              size={isMobile ? 'sm' : 'default'}\n              data-testid=\"button-new-order\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Order\n            </Button>\n          </DialogTrigger>\n          <DialogContent className={`max-w-2xl max-h-[90vh] overflow-y-auto ${isMobile ? 'w-full max-w-full mx-4' : ''}`}>\n            <DialogHeader>\n              <DialogTitle>Create New Sales Order</DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                <FormField\n                  control={form.control}\n                  name=\"customer_id\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Customer</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select customer\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {customers.map((customer) => (\n                            <SelectItem key={customer.id} value={customer.id}>\n                              {customer.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"order_date\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Order Date</FormLabel>\n                        <FormControl>\n                          <Input type=\"date\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"delivery_date\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Delivery Date</FormLabel>\n                        <FormControl>\n                          <Input type=\"date\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"description\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Description</FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"Enter order description\" \n                            {...field} \n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"amount\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Amount</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            placeholder=\"0.00\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"notes\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Notes (Optional)</FormLabel>\n                      <FormControl>\n                        <Textarea\n                          placeholder=\"Additional notes...\"\n                          className=\"resize-none\"\n                          rows={3}\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex items-center gap-3 pt-4\">\n                  <Button type=\"submit\" disabled={createMutation.isPending}>\n                    {createMutation.isPending ? 'Creating...' : 'Create Order'}\n                  </Button>\n                  <Button \n                    type=\"button\" \n                    variant=\"outline\" \n                    onClick={() => setShowDialog(false)}\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Statistics Cards */}\n      <div className=\"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-5\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Orders</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.total}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              This month\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Order Value</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {formatCurrency(stats.totalValue, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Total revenue\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Pending</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-orange-600\">\n              {stats.pending}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              To process\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Processing</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-blue-600\">\n              {stats.processing}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              In progress\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Shipped</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">\n              {stats.shipped}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              On the way\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <div className=\"flex items-center gap-4\">\n        <div className=\"flex-1\">\n          <Input\n            placeholder=\"Search orders...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"max-w-sm\"\n            data-testid=\"input-search-orders\"\n          />\n        </div>\n      </div>\n\n      {/* Tabs and Table */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList>\n          <TabsTrigger value=\"all\">All Orders</TabsTrigger>\n          <TabsTrigger value=\"pending\">Pending</TabsTrigger>\n          <TabsTrigger value=\"processing\">Processing</TabsTrigger>\n          <TabsTrigger value=\"shipped\">Shipped</TabsTrigger>\n          <TabsTrigger value=\"delivered\">Delivered</TabsTrigger>\n          <TabsTrigger value=\"cancelled\">Cancelled</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value={activeTab} className=\"mt-4\">\n          <Card>\n            <CardContent className=\"p-0\">\n              <div className={isMobile ? \"mobile-table-container\" : \"\"}>\n                <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Order Number</TableHead>\n                      <TableHead>Customer</TableHead>\n                      <TableHead>Order Date</TableHead>\n                      <TableHead>Delivery Date</TableHead>\n                      <TableHead>Items</TableHead>\n                      <TableHead>Amount</TableHead>\n                      <TableHead>Payment</TableHead>\n                      <TableHead>Status</TableHead>\n                      <TableHead className=\"text-right\">Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                <TableBody>\n                  {filteredOrders.map((order) => (\n                    <TableRow key={order.id} data-testid={`row-order-${order.id}`}>\n                      <TableCell className=\"font-medium\" data-label=\"Order Number\">\n                        <div className=\"flex items-center gap-2\">\n                          <ShoppingCart className=\"h-4 w-4 text-muted-foreground\" />\n                          {order.order_number}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Customer\">\n                        <div className=\"flex items-center gap-2\">\n                          <User className=\"h-4 w-4 text-muted-foreground\" />\n                          {order.customer_name}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Order Date\">\n                        <div className=\"flex items-center gap-2\">\n                          <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                          {format(new Date(order.order_date), 'MMM dd, yyyy')}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Delivery Date\">\n                        {format(new Date(order.delivery_date), 'MMM dd, yyyy')}\n                      </TableCell>\n                      <TableCell data-label=\"Items\">{order.items_count} items</TableCell>\n                      <TableCell className=\"font-semibold\" data-label=\"Amount\">\n                        {formatCurrency(order.total_amount, order.currency)}\n                      </TableCell>\n                      <TableCell data-label=\"Payment\">{getPaymentStatusBadge(order.payment_status)}</TableCell>\n                      <TableCell data-label=\"Status\">{getStatusBadge(order.status)}</TableCell>\n                      <TableCell className=\"text-right\" data-label=\"Actions\">\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\" data-testid={`button-actions-${order.id}`}>\n                              <MoreHorizontal className=\"h-4 w-4\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem>\n                              <Eye className=\"h-4 w-4 mr-2\" />\n                              View Details\n                            </DropdownMenuItem>\n                            <DropdownMenuItem>\n                              <Edit className=\"h-4 w-4 mr-2\" />\n                              Edit\n                            </DropdownMenuItem>\n                            <DropdownMenuItem>\n                              <Copy className=\"h-4 w-4 mr-2\" />\n                              Duplicate\n                            </DropdownMenuItem>\n                            {order.status === 'processing' && (\n                              <DropdownMenuItem onClick={() => handleMarkAsShipped(order.id)}>\n                                <Truck className=\"h-4 w-4 mr-2\" />\n                                Mark as Shipped\n                              </DropdownMenuItem>\n                            )}\n                            {order.status === 'delivered' && order.payment_status === 'paid' && (\n                              <DropdownMenuItem onClick={() => handleConvertToInvoice(order.id)}>\n                                <ArrowRight className=\"h-4 w-4 mr-2\" />\n                                Create Invoice\n                              </DropdownMenuItem>\n                            )}\n                            <DropdownMenuSeparator />\n                            <DropdownMenuItem \n                              className=\"text-destructive\"\n                              onClick={() => handleCancelOrder(order.id)}\n                            >\n                              <XCircle className=\"h-4 w-4 mr-2\" />\n                              Cancel Order\n                            </DropdownMenuItem>\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n                </Table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":22902},"client/src/pages/sales/QuotationsPage.tsx":{"content":"import { useState } from 'react';\nimport { Link } from 'wouter';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { queryClient, apiRequest } from '@/lib/queryClient';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { \n  FileText, \n  Plus, \n  MoreHorizontal, \n  Eye, \n  Edit, \n  Copy,\n  Send,\n  CheckCircle,\n  Clock,\n  XCircle,\n  ArrowRight,\n  Calendar,\n  User,\n  AlertCircle,\n  Loader2,\n  Trash2\n} from 'lucide-react';\nimport { format } from 'date-fns';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { useToast } from '@/hooks/use-toast';\nimport { useIsMobile } from '@/hooks/use-mobile';\n\n// Quotation form schema\nconst quotationSchema = z.object({\n  customer_id: z.string().min(1, 'Please select a customer'),\n  description: z.string().min(2, 'Description must be at least 2 characters'),\n  amount: z.string().min(1, 'Amount is required'),\n  valid_until: z.string().min(1, 'Valid until date is required'),\n  terms: z.string().optional(),\n  notes: z.string().optional(),\n});\n\ntype QuotationForm = z.infer<typeof quotationSchema>;\n\n// Removed mock data - using real API data\n\nconst statusConfig = {\n  draft: { label: 'Draft', icon: Edit, color: 'secondary' },\n  sent: { label: 'Sent', icon: Send, color: 'default' },\n  accepted: { label: 'Accepted', icon: CheckCircle, color: 'success' },\n  rejected: { label: 'Rejected', icon: XCircle, color: 'destructive' },\n  expired: { label: 'Expired', icon: Clock, color: 'secondary' },\n};\n\nexport default function QuotationsPage() {\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState('all');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [showDialog, setShowDialog] = useState(false);\n  const isMobile = useIsMobile();\n\n  // Fetch contacts (customers)\n  const { data: contacts = [] } = useQuery<any[]>({\n    queryKey: ['/api/contacts'],\n  });\n\n  const customers = contacts.filter(contact => \n    contact.type === 'customer' || contact.type === 'both'\n  );\n\n  // Create quotation mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: QuotationForm) => {\n      const processedData = {\n        ...data,\n        amount: parseFloat(data.amount),\n        status: 'draft',\n      };\n      return await apiRequest('POST', '/api/sales/quotations', processedData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/sales/quotations'] });\n      setShowDialog(false);\n      toast({\n        title: 'Quotation created',\n        description: 'New quotation has been created successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to create quotation',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Form\n  const form = useForm<QuotationForm>({\n    resolver: zodResolver(quotationSchema),\n    defaultValues: {\n      customer_id: '',\n      description: '',\n      amount: '',\n      valid_until: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 30 days from now\n      terms: '',\n      notes: '',\n    },\n  });\n\n  const onSubmit = (data: QuotationForm) => {\n    createMutation.mutate(data);\n  };\n\n  // Fetch quotations from API\n  const { \n    data: quotations = [], \n    isLoading, \n    error \n  } = useQuery({\n    queryKey: ['/api/sales/quotations'],\n    select: (data: any[]) => {\n      if (!data) return [];\n      // Normalize numeric fields\n      return data.map((quote: any) => ({\n        ...quote,\n        total: Number(quote.total) || 0,\n        subtotal: Number(quote.subtotal) || 0,\n        tax_total: Number(quote.tax_total) || 0,\n      }));\n    }\n  });\n\n  // Delete mutation\n  const deleteMutation = useMutation({\n    mutationFn: async (quoteId: string) => {\n      return apiRequest('DELETE', `/api/sales/quotations/${quoteId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/sales/quotations'] });\n      toast({\n        title: 'Quote deleted',\n        description: 'The quotation has been deleted successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to delete quotation',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Delete handler\n  const handleDelete = async (quoteId: string) => {\n    if (confirm('Are you sure you want to delete this quotation?')) {\n      deleteMutation.mutate(quoteId);\n    }\n  };\n\n  // Filter quotations\n  const filteredQuotations = quotations.filter((quote: any) => {\n    const matchesSearch = \n      quote.quote_number?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      quote.customer_name?.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    if (!matchesSearch) return false;\n    \n    switch (activeTab) {\n      case 'draft':\n        return quote.status === 'draft';\n      case 'sent':\n        return quote.status === 'sent';\n      case 'accepted':\n        return quote.status === 'accepted';\n      case 'expired':\n        return quote.status === 'expired';\n      default:\n        return true;\n    }\n  });\n\n  // Calculate statistics  \n  const stats = {\n    total: quotations.length,\n    totalValue: quotations.reduce((sum: number, q: any) => sum + (q.total || q.total_amount || 0), 0),\n    accepted: quotations.filter((q: any) => q.status === 'accepted').length,\n    acceptanceRate: quotations.length > 0 ? Math.round((quotations.filter((q: any) => q.status === 'accepted').length / quotations.length) * 100) : 0,\n    avgValue: quotations.length > 0 ? quotations.reduce((sum: number, q: any) => sum + (q.total || q.total_amount || 0), 0) / quotations.length : 0,\n  };\n\n  // Format currency\n  const formatCurrency = (amount: number, currency = 'USD') => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: currency,\n    }).format(amount);\n  };\n\n  // Loading state\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-96\">\n        <div className=\"flex items-center gap-2\">\n          <Loader2 className=\"h-6 w-6 animate-spin\" />\n          <span>Loading quotations...</span>\n        </div>\n      </div>\n    );\n  }\n\n  // Error state\n  if (error) {\n    return (\n      <div className=\"flex items-center justify-center h-96\">\n        <div className=\"text-center\">\n          <AlertCircle className=\"h-8 w-8 mx-auto text-red-500 mb-2\" />\n          <p className=\"text-lg font-medium mb-2\">Failed to load quotations</p>\n          <p className=\"text-muted-foreground mb-4\">Please try refreshing the page</p>\n          <Button \n            onClick={() => queryClient.refetchQueries({ queryKey: ['/api/sales/quotations'] })}\n            data-testid=\"button-refresh-quotations\"\n          >\n            Refresh\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  const handleConvertToInvoice = (id: string) => {\n    toast({\n      title: 'Converted to Invoice',\n      description: 'Quotation has been converted to an invoice successfully.',\n    });\n  };\n\n  const handleDuplicate = (id: string) => {\n    toast({\n      title: 'Quotation duplicated',\n      description: 'A copy of the quotation has been created.',\n    });\n  };\n\n  const handleSend = (id: string) => {\n    toast({\n      title: 'Quotation sent',\n      description: 'The quotation has been sent to the customer.',\n    });\n  };\n\n  const getStatusBadge = (status: string) => {\n    const config = statusConfig[status as keyof typeof statusConfig];\n    if (!config) return null;\n    \n    const Icon = config.icon;\n    return (\n      <Badge variant={config.color as any} className=\"gap-1\">\n        <Icon className=\"h-3 w-3\" />\n        {config.label}\n      </Badge>\n    );\n  };\n\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Quotations</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Create and manage sales quotations for customers\n          </p>\n        </div>\n        <Dialog open={showDialog} onOpenChange={setShowDialog}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-new-quotation\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Quotation\n            </Button>\n          </DialogTrigger>\n          <DialogContent className={`max-w-2xl max-h-[90vh] overflow-y-auto ${isMobile ? 'w-full max-w-full mx-4' : ''}`}>\n            <DialogHeader>\n              <DialogTitle>Create New Quotation</DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                <FormField\n                  control={form.control}\n                  name=\"customer_id\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Customer</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select customer\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {customers.map((customer) => (\n                            <SelectItem key={customer.id} value={customer.id}>\n                              {customer.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"description\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Description</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"Enter quotation description\" \n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"amount\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Amount</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            placeholder=\"0.00\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"valid_until\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Valid Until</FormLabel>\n                        <FormControl>\n                          <Input type=\"date\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"terms\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Terms & Conditions (Optional)</FormLabel>\n                      <FormControl>\n                        <Textarea\n                          placeholder=\"Enter terms and conditions...\"\n                          className=\"resize-none\"\n                          rows={3}\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"notes\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Notes (Optional)</FormLabel>\n                      <FormControl>\n                        <Textarea\n                          placeholder=\"Additional notes...\"\n                          className=\"resize-none\"\n                          rows={3}\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex items-center gap-3 pt-4\">\n                  <Button type=\"submit\" disabled={createMutation.isPending}>\n                    {createMutation.isPending ? 'Creating...' : 'Create Quotation'}\n                  </Button>\n                  <Button \n                    type=\"button\" \n                    variant=\"outline\" \n                    onClick={() => setShowDialog(false)}\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Statistics Cards */}\n      <div className=\"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Quotations</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.total}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              This month\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Value</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {formatCurrency(stats.totalValue, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Potential revenue\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Acceptance Rate</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">\n              {stats.acceptanceRate}%\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              {stats.accepted} accepted\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Average Value</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {formatCurrency(stats.avgValue, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Per quotation\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <div className=\"flex items-center gap-4\">\n        <div className=\"flex-1\">\n          <Input\n            placeholder=\"Search quotations...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"max-w-sm\"\n            data-testid=\"input-search-quotations\"\n          />\n        </div>\n      </div>\n\n      {/* Tabs and Table */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList>\n          <TabsTrigger value=\"all\">All</TabsTrigger>\n          <TabsTrigger value=\"draft\">Draft</TabsTrigger>\n          <TabsTrigger value=\"sent\">Sent</TabsTrigger>\n          <TabsTrigger value=\"accepted\">Accepted</TabsTrigger>\n          <TabsTrigger value=\"expired\">Expired</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value={activeTab} className=\"mt-4\">\n          <Card>\n            <CardContent className=\"p-0\">\n              <div className={isMobile ? \"mobile-table-container\" : \"\"}>\n                <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Quote Number</TableHead>\n                      <TableHead>Customer</TableHead>\n                      <TableHead>Issue Date</TableHead>\n                      <TableHead>Expiry Date</TableHead>\n                      <TableHead>Items</TableHead>\n                      <TableHead>Amount</TableHead>\n                      <TableHead>Status</TableHead>\n                      <TableHead className=\"text-right\">Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                <TableBody>\n                  {filteredQuotations.map((quote) => (\n                    <TableRow key={quote.id} data-testid={`row-quotation-${quote.id}`}>\n                      <TableCell className=\"font-medium\" data-label=\"Quote Number\">\n                        <div className=\"flex items-center gap-2\">\n                          <FileText className=\"h-4 w-4 text-muted-foreground\" />\n                          {quote.quote_number}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Customer\">\n                        <div className=\"flex items-center gap-2\">\n                          <User className=\"h-4 w-4 text-muted-foreground\" />\n                          {quote.customer_name}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Issue Date\">\n                        <div className=\"flex items-center gap-2\">\n                          <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                          {format(new Date(quote.issue_date), 'MMM dd, yyyy')}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Expiry Date\">\n                        {format(new Date(quote.expiry_date), 'MMM dd, yyyy')}\n                      </TableCell>\n                      <TableCell data-label=\"Items\">{quote.items_count} items</TableCell>\n                      <TableCell className=\"font-semibold\" data-label=\"Amount\">\n                        {formatCurrency(quote.total || quote.total_amount || 0, quote.currency || 'USD')}\n                      </TableCell>\n                      <TableCell data-label=\"Status\">{getStatusBadge(quote.status)}</TableCell>\n                      <TableCell className=\"text-right\" data-label=\"Actions\">\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\" data-testid={`button-actions-${quote.id}`}>\n                              <MoreHorizontal className=\"h-4 w-4\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem>\n                              <Eye className=\"h-4 w-4 mr-2\" />\n                              View\n                            </DropdownMenuItem>\n                            <DropdownMenuItem>\n                              <Edit className=\"h-4 w-4 mr-2\" />\n                              Edit\n                            </DropdownMenuItem>\n                            <DropdownMenuItem onClick={() => handleDuplicate(quote.id)}>\n                              <Copy className=\"h-4 w-4 mr-2\" />\n                              Duplicate\n                            </DropdownMenuItem>\n                            {quote.status === 'draft' && (\n                              <DropdownMenuItem onClick={() => handleSend(quote.id)}>\n                                <Send className=\"h-4 w-4 mr-2\" />\n                                Send\n                              </DropdownMenuItem>\n                            )}\n                            {quote.status === 'accepted' && (\n                              <DropdownMenuItem onClick={() => handleConvertToInvoice(quote.id)}>\n                                <ArrowRight className=\"h-4 w-4 mr-2\" />\n                                Convert to Invoice\n                              </DropdownMenuItem>\n                            )}\n                            <DropdownMenuSeparator />\n                            <DropdownMenuItem \n                              className=\"text-destructive\"\n                              onClick={() => handleDelete(quote.id)}\n                              disabled={deleteMutation.isPending}\n                              data-testid={`button-delete-${quote.id}`}\n                            >\n                              <Trash2 className=\"h-4 w-4 mr-2\" />\n                              Delete\n                            </DropdownMenuItem>\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n                </Table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":22616},"client/src/pages/settings/GeneralSettingsPage.tsx":{"content":"import { useState, useMemo } from 'react';\nimport { useIsMobile } from '@/hooks/use-mobile';\nimport { useTranslation } from 'react-i18next';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Switch } from '@/components/ui/switch';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Separator } from '@/components/ui/separator';\nimport { useToast } from '@/hooks/use-toast';\nimport { mapCurrencies, sortByName } from '@/lib/currencies';\nimport { \n  Building2, \n  Globe, \n  Calendar,\n  DollarSign,\n  FileText,\n  Shield,\n  Bell,\n  Mail,\n  Smartphone,\n  Save,\n  Upload\n} from 'lucide-react';\n\nexport default function GeneralSettingsPage() {\n  const isMobile = useIsMobile();\n  const { toast } = useToast();\n  const { t, i18n } = useTranslation();\n  \n  // Get comprehensive currency list from shared utility - sorted for better UX\n  const currencies = useMemo(() => sortByName(mapCurrencies(t)), [t, i18n.resolvedLanguage]);\n  \n  // Company settings\n  const [companyName, setCompanyName] = useState('Acme Corporation');\n  const [companyEmail, setCompanyEmail] = useState('info@acmecorp.com');\n  const [companyPhone, setCompanyPhone] = useState('+1 (555) 123-4567');\n  const [companyAddress, setCompanyAddress] = useState('123 Business Street, Suite 100');\n  const [companyCity, setCompanyCity] = useState('New York');\n  const [companyCountry, setCompanyCountry] = useState('United States');\n  const [companyZip, setCompanyZip] = useState('10001');\n  const [taxId, setTaxId] = useState('12-3456789');\n  \n  // Regional settings\n  const [currency, setCurrency] = useState('USD');\n  const [dateFormat, setDateFormat] = useState('MM/DD/YYYY');\n  const [timeZone, setTimeZone] = useState('America/New_York');\n  const [fiscalYearStart, setFiscalYearStart] = useState('january');\n  \n  // Invoice settings\n  const [invoicePrefix, setInvoicePrefix] = useState('INV-');\n  const [nextInvoiceNumber, setNextInvoiceNumber] = useState('2024-052');\n  const [paymentTerms, setPaymentTerms] = useState('30');\n  const [defaultTaxRate, setDefaultTaxRate] = useState('10');\n  \n  // Notification settings\n  const [emailNotifications, setEmailNotifications] = useState(true);\n  const [smsNotifications, setSmsNotifications] = useState(false);\n  const [invoiceReminders, setInvoiceReminders] = useState(true);\n  const [paymentAlerts, setPaymentAlerts] = useState(true);\n  const [lowStockAlerts, setLowStockAlerts] = useState(true);\n  \n  // Security settings\n  const [twoFactorAuth, setTwoFactorAuth] = useState(false);\n  const [sessionTimeout, setSessionTimeout] = useState('30');\n  const [passwordExpiry, setPasswordExpiry] = useState('90');\n  const [ipRestriction, setIpRestriction] = useState(false);\n\n  const handleSaveSettings = (section: string) => {\n    toast({\n      title: 'Settings saved',\n      description: `${section} settings have been updated successfully.`,\n    });\n  };\n\n  const handleUploadLogo = () => {\n    toast({\n      title: 'Logo uploaded',\n      description: 'Company logo has been updated successfully.',\n    });\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div>\n        <h1 className=\"text-3xl font-bold text-foreground\">General Settings</h1>\n        <p className=\"text-muted-foreground mt-1\">\n          Configure your company information and system preferences\n        </p>\n      </div>\n\n      {/* Settings Tabs */}\n      <Tabs defaultValue=\"company\" className=\"space-y-4\">\n        <TabsList className={`${isMobile ? 'grid w-full grid-cols-5' : ''}`}>\n          <TabsTrigger value=\"company\">Company</TabsTrigger>\n          <TabsTrigger value=\"regional\">Regional</TabsTrigger>\n          <TabsTrigger value=\"invoice\">Invoice</TabsTrigger>\n          <TabsTrigger value=\"notifications\">Notifications</TabsTrigger>\n          <TabsTrigger value=\"security\">Security</TabsTrigger>\n        </TabsList>\n\n        {/* Company Settings */}\n        <TabsContent value=\"company\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Company Information</CardTitle>\n              <CardDescription>\n                Update your company details and branding\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {/* Logo Upload */}\n              <div className={`flex gap-6 ${isMobile ? 'flex-col items-start' : 'items-center'}`}>\n                <div className=\"w-24 h-24 bg-muted rounded-lg flex items-center justify-center\">\n                  <Building2 className=\"h-12 w-12 text-muted-foreground\" />\n                </div>\n                <div>\n                  <Label>Company Logo</Label>\n                  <p className=\"text-sm text-muted-foreground mb-2\">\n                    Upload your company logo (PNG, JPG, max 2MB)\n                  </p>\n                  <Button variant=\"outline\" onClick={handleUploadLogo}>\n                    <Upload className=\"h-4 w-4 mr-2\" />\n                    Upload Logo\n                  </Button>\n                </div>\n              </div>\n\n              <Separator />\n\n              {/* Company Details */}\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"company-name\">Company Name</Label>\n                  <Input\n                    id=\"company-name\"\n                    value={companyName}\n                    onChange={(e) => setCompanyName(e.target.value)}\n                    data-testid=\"input-company-name\"\n                    className=\"min-w-0 w-full\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"tax-id\">Tax ID / VAT Number</Label>\n                  <Input\n                    id=\"tax-id\"\n                    value={taxId}\n                    onChange={(e) => setTaxId(e.target.value)}\n                    data-testid=\"input-tax-id\"\n                    className=\"min-w-0 w-full\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"company-email\">Email</Label>\n                  <Input\n                    id=\"company-email\"\n                    type=\"email\"\n                    value={companyEmail}\n                    onChange={(e) => setCompanyEmail(e.target.value)}\n                    data-testid=\"input-company-email\"\n                    className=\"min-w-0 w-full\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"company-phone\">Phone</Label>\n                  <Input\n                    id=\"company-phone\"\n                    value={companyPhone}\n                    onChange={(e) => setCompanyPhone(e.target.value)}\n                    data-testid=\"input-company-phone\"\n                    className=\"min-w-0 w-full\"\n                  />\n                </div>\n                <div className=\"col-span-2\">\n                  <Label htmlFor=\"company-address\">Address</Label>\n                  <Input\n                    id=\"company-address\"\n                    value={companyAddress}\n                    onChange={(e) => setCompanyAddress(e.target.value)}\n                    data-testid=\"input-company-address\"\n                    className=\"min-w-0 w-full\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"company-city\">City</Label>\n                  <Input\n                    id=\"company-city\"\n                    value={companyCity}\n                    onChange={(e) => setCompanyCity(e.target.value)}\n                    data-testid=\"input-company-city\"\n                    className=\"min-w-0 w-full\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"company-country\">Country</Label>\n                  <Select value={companyCountry} onValueChange={setCompanyCountry}>\n                    <SelectTrigger id=\"company-country\" data-testid=\"select-country\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"United States\">United States</SelectItem>\n                      <SelectItem value=\"Canada\">Canada</SelectItem>\n                      <SelectItem value=\"United Kingdom\">United Kingdom</SelectItem>\n                      <SelectItem value=\"Australia\">Australia</SelectItem>\n                      <SelectItem value=\"Germany\">Germany</SelectItem>\n                      <SelectItem value=\"France\">France</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"company-zip\">ZIP/Postal Code</Label>\n                  <Input\n                    id=\"company-zip\"\n                    value={companyZip}\n                    onChange={(e) => setCompanyZip(e.target.value)}\n                    data-testid=\"input-company-zip\"\n                    className=\"min-w-0 w-full\"\n                  />\n                </div>\n              </div>\n\n              <div className={`flex ${isMobile ? 'flex-col gap-2' : 'justify-end'}`}>\n                <Button onClick={() => handleSaveSettings('Company')}>\n                  <Save className=\"h-4 w-4 mr-2\" />\n                  Save Company Settings\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Regional Settings */}\n        <TabsContent value=\"regional\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Regional Settings</CardTitle>\n              <CardDescription>\n                Configure currency, date format, and timezone preferences\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"currency\">Currency</Label>\n                  <Select value={currency} onValueChange={setCurrency}>\n                    <SelectTrigger id=\"currency\" data-testid=\"select-currency\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {currencies.map((currency) => (\n                        <SelectItem key={currency.code} value={currency.code}>\n                          {currency.code} - {currency.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"date-format\">Date Format</Label>\n                  <Select value={dateFormat} onValueChange={setDateFormat}>\n                    <SelectTrigger id=\"date-format\" data-testid=\"select-date-format\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"MM/DD/YYYY\">MM/DD/YYYY</SelectItem>\n                      <SelectItem value=\"DD/MM/YYYY\">DD/MM/YYYY</SelectItem>\n                      <SelectItem value=\"YYYY-MM-DD\">YYYY-MM-DD</SelectItem>\n                      <SelectItem value=\"DD.MM.YYYY\">DD.MM.YYYY</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"timezone\">Time Zone</Label>\n                  <Select value={timeZone} onValueChange={setTimeZone}>\n                    <SelectTrigger id=\"timezone\" data-testid=\"select-timezone\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"America/New_York\">Eastern Time (ET)</SelectItem>\n                      <SelectItem value=\"America/Chicago\">Central Time (CT)</SelectItem>\n                      <SelectItem value=\"America/Denver\">Mountain Time (MT)</SelectItem>\n                      <SelectItem value=\"America/Los_Angeles\">Pacific Time (PT)</SelectItem>\n                      <SelectItem value=\"Europe/London\">London (GMT)</SelectItem>\n                      <SelectItem value=\"Europe/Paris\">Paris (CET)</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"fiscal-year\">Fiscal Year Start</Label>\n                  <Select value={fiscalYearStart} onValueChange={setFiscalYearStart}>\n                    <SelectTrigger id=\"fiscal-year\" data-testid=\"select-fiscal-year\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"january\">January</SelectItem>\n                      <SelectItem value=\"april\">April</SelectItem>\n                      <SelectItem value=\"july\">July</SelectItem>\n                      <SelectItem value=\"october\">October</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <div className={`flex ${isMobile ? 'flex-col gap-2' : 'justify-end'}`}>\n                <Button onClick={() => handleSaveSettings('Regional')}>\n                  <Save className=\"h-4 w-4 mr-2\" />\n                  Save Regional Settings\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Invoice Settings */}\n        <TabsContent value=\"invoice\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Invoice Settings</CardTitle>\n              <CardDescription>\n                Configure invoice numbering and default terms\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"invoice-prefix\">Invoice Prefix</Label>\n                  <Input\n                    id=\"invoice-prefix\"\n                    value={invoicePrefix}\n                    onChange={(e) => setInvoicePrefix(e.target.value)}\n                    data-testid=\"input-invoice-prefix\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"next-invoice\">Next Invoice Number</Label>\n                  <Input\n                    id=\"next-invoice\"\n                    value={nextInvoiceNumber}\n                    onChange={(e) => setNextInvoiceNumber(e.target.value)}\n                    data-testid=\"input-next-invoice\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"payment-terms\">Default Payment Terms (days)</Label>\n                  <Select value={paymentTerms} onValueChange={setPaymentTerms}>\n                    <SelectTrigger id=\"payment-terms\" data-testid=\"select-payment-terms\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"0\">Due on Receipt</SelectItem>\n                      <SelectItem value=\"15\">Net 15</SelectItem>\n                      <SelectItem value=\"30\">Net 30</SelectItem>\n                      <SelectItem value=\"45\">Net 45</SelectItem>\n                      <SelectItem value=\"60\">Net 60</SelectItem>\n                      <SelectItem value=\"90\">Net 90</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label htmlFor=\"tax-rate\">Default Tax Rate (%)</Label>\n                  <Input\n                    id=\"tax-rate\"\n                    type=\"number\"\n                    step=\"0.1\"\n                    value={defaultTaxRate}\n                    onChange={(e) => setDefaultTaxRate(e.target.value)}\n                    data-testid=\"input-tax-rate\"\n                  />\n                </div>\n              </div>\n\n              <div className={`flex ${isMobile ? 'flex-col gap-2' : 'justify-end'}`}>\n                <Button onClick={() => handleSaveSettings('Invoice')}>\n                  <Save className=\"h-4 w-4 mr-2\" />\n                  Save Invoice Settings\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Notification Settings */}\n        <TabsContent value=\"notifications\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Notification Settings</CardTitle>\n              <CardDescription>\n                Manage how you receive alerts and updates\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label>Email Notifications</Label>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Receive notifications via email\n                    </p>\n                  </div>\n                  <Switch\n                    checked={emailNotifications}\n                    onCheckedChange={setEmailNotifications}\n                    data-testid=\"switch-email-notifications\"\n                  />\n                </div>\n                <Separator />\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label>SMS Notifications</Label>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Receive notifications via SMS\n                    </p>\n                  </div>\n                  <Switch\n                    checked={smsNotifications}\n                    onCheckedChange={setSmsNotifications}\n                    data-testid=\"switch-sms-notifications\"\n                  />\n                </div>\n                <Separator />\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label>Invoice Reminders</Label>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Get reminded about pending invoices\n                    </p>\n                  </div>\n                  <Switch\n                    checked={invoiceReminders}\n                    onCheckedChange={setInvoiceReminders}\n                    data-testid=\"switch-invoice-reminders\"\n                  />\n                </div>\n                <Separator />\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label>Payment Alerts</Label>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Get notified when payments are received\n                    </p>\n                  </div>\n                  <Switch\n                    checked={paymentAlerts}\n                    onCheckedChange={setPaymentAlerts}\n                    data-testid=\"switch-payment-alerts\"\n                  />\n                </div>\n                <Separator />\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label>Low Stock Alerts</Label>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Get notified when inventory is low\n                    </p>\n                  </div>\n                  <Switch\n                    checked={lowStockAlerts}\n                    onCheckedChange={setLowStockAlerts}\n                    data-testid=\"switch-low-stock-alerts\"\n                  />\n                </div>\n              </div>\n\n              <div className={`flex ${isMobile ? 'flex-col gap-2' : 'justify-end'}`}>\n                <Button onClick={() => handleSaveSettings('Notification')}>\n                  <Save className=\"h-4 w-4 mr-2\" />\n                  Save Notification Settings\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Security Settings */}\n        <TabsContent value=\"security\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Security Settings</CardTitle>\n              <CardDescription>\n                Configure security and access control options\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label>Two-Factor Authentication</Label>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Require 2FA for all users\n                    </p>\n                  </div>\n                  <Switch\n                    checked={twoFactorAuth}\n                    onCheckedChange={setTwoFactorAuth}\n                    data-testid=\"switch-2fa\"\n                  />\n                </div>\n                <Separator />\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label>IP Restriction</Label>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Restrict access to specific IP addresses\n                    </p>\n                  </div>\n                  <Switch\n                    checked={ipRestriction}\n                    onCheckedChange={setIpRestriction}\n                    data-testid=\"switch-ip-restriction\"\n                  />\n                </div>\n                <Separator />\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"session-timeout\">Session Timeout (minutes)</Label>\n                    <Select value={sessionTimeout} onValueChange={setSessionTimeout}>\n                      <SelectTrigger id=\"session-timeout\" data-testid=\"select-session-timeout\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"15\">15 minutes</SelectItem>\n                        <SelectItem value=\"30\">30 minutes</SelectItem>\n                        <SelectItem value=\"60\">1 hour</SelectItem>\n                        <SelectItem value=\"120\">2 hours</SelectItem>\n                        <SelectItem value=\"480\">8 hours</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div>\n                    <Label htmlFor=\"password-expiry\">Password Expiry (days)</Label>\n                    <Select value={passwordExpiry} onValueChange={setPasswordExpiry}>\n                      <SelectTrigger id=\"password-expiry\" data-testid=\"select-password-expiry\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"30\">30 days</SelectItem>\n                        <SelectItem value=\"60\">60 days</SelectItem>\n                        <SelectItem value=\"90\">90 days</SelectItem>\n                        <SelectItem value=\"180\">180 days</SelectItem>\n                        <SelectItem value=\"365\">1 year</SelectItem>\n                        <SelectItem value=\"0\">Never</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n              </div>\n\n              <div className={`flex ${isMobile ? 'flex-col gap-2' : 'justify-end'}`}>\n                <Button onClick={() => handleSaveSettings('Security')}>\n                  <Save className=\"h-4 w-4 mr-2\" />\n                  Save Security Settings\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":24177},"client/src/pages/settings/LanguageSettingsPage.tsx":{"content":"import { useState } from 'react';\nimport { useIsMobile } from '@/hooks/use-mobile';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Switch } from '@/components/ui/switch';\nimport { Badge } from '@/components/ui/badge';\nimport { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { useToast } from '@/hooks/use-toast';\nimport { \n  Globe, \n  Languages,\n  Download,\n  Upload,\n  Check,\n  X,\n  MoreHorizontal,\n  Settings,\n  AlertCircle,\n  Plus,\n  Save\n} from 'lucide-react';\n\nconst mockLanguages = [\n  {\n    id: '1',\n    code: 'en',\n    name: 'English',\n    nativeName: 'English',\n    region: 'United States',\n    flag: 'ðŸ‡ºðŸ‡¸',\n    isDefault: true,\n    isActive: true,\n    translationProgress: 100,\n    lastUpdated: '2024-02-15',\n  },\n  {\n    id: '2',\n    code: 'es',\n    name: 'Spanish',\n    nativeName: 'EspaÃ±ol',\n    region: 'Spain',\n    flag: 'ðŸ‡ªðŸ‡¸',\n    isDefault: false,\n    isActive: true,\n    translationProgress: 95,\n    lastUpdated: '2024-02-14',\n  },\n  {\n    id: '3',\n    code: 'fr',\n    name: 'French',\n    nativeName: 'FranÃ§ais',\n    region: 'France',\n    flag: 'ðŸ‡«ðŸ‡·',\n    isDefault: false,\n    isActive: true,\n    translationProgress: 88,\n    lastUpdated: '2024-02-10',\n  },\n  {\n    id: '4',\n    code: 'de',\n    name: 'German',\n    nativeName: 'Deutsch',\n    region: 'Germany',\n    flag: 'ðŸ‡©ðŸ‡ª',\n    isDefault: false,\n    isActive: false,\n    translationProgress: 75,\n    lastUpdated: '2024-02-05',\n  },\n  {\n    id: '5',\n    code: 'zh',\n    name: 'Chinese',\n    nativeName: 'ä¸­æ–‡',\n    region: 'China',\n    flag: 'ðŸ‡¨ðŸ‡³',\n    isDefault: false,\n    isActive: false,\n    translationProgress: 60,\n    lastUpdated: '2024-01-30',\n  },\n];\n\nconst mockTranslationCategories = [\n  { category: 'Dashboard', translated: 45, total: 45, percentage: 100 },\n  { category: 'Sales Module', translated: 120, total: 125, percentage: 96 },\n  { category: 'Purchase Module', translated: 110, total: 115, percentage: 95.6 },\n  { category: 'Banking Module', translated: 85, total: 90, percentage: 94.4 },\n  { category: 'Reports Module', translated: 150, total: 160, percentage: 93.8 },\n  { category: 'Settings Module', translated: 75, total: 80, percentage: 93.8 },\n  { category: 'Common', translated: 200, total: 200, percentage: 100 },\n];\n\nexport default function LanguageSettingsPage() {\n  const isMobile = useIsMobile();\n  const { toast } = useToast();\n  const [selectedLanguage, setSelectedLanguage] = useState('en');\n  const [defaultLanguage, setDefaultLanguage] = useState('en');\n  const [autoDetect, setAutoDetect] = useState(true);\n  const [fallbackLanguage, setFallbackLanguage] = useState('en');\n  const [dateFormatByLanguage, setDateFormatByLanguage] = useState(true);\n  const [currencyByLanguage, setCurrencyByLanguage] = useState(true);\n\n  const languages = mockLanguages;\n  const translationCategories = mockTranslationCategories;\n\n  const handleToggleLanguage = (languageId: string) => {\n    toast({\n      title: 'Language status updated',\n      description: 'Language activation status has been changed.',\n    });\n  };\n\n  const handleSetDefault = (languageCode: string) => {\n    setDefaultLanguage(languageCode);\n    toast({\n      title: 'Default language updated',\n      description: 'Default language has been changed successfully.',\n    });\n  };\n\n  const handleExportTranslations = (languageCode: string) => {\n    toast({\n      title: 'Translations exported',\n      description: `Translations for ${languageCode} have been exported.`,\n    });\n  };\n\n  const handleImportTranslations = () => {\n    toast({\n      title: 'Translations imported',\n      description: 'Translation file has been imported successfully.',\n    });\n  };\n\n  const handleAddLanguage = () => {\n    toast({\n      title: 'Add new language',\n      description: 'Opening language addition dialog...',\n    });\n  };\n\n  const handleSaveSettings = () => {\n    toast({\n      title: 'Settings saved',\n      description: 'Language settings have been updated successfully.',\n    });\n  };\n\n  const getProgressColor = (percentage: number) => {\n    if (percentage >= 90) return 'bg-green-500';\n    if (percentage >= 70) return 'bg-yellow-500';\n    if (percentage >= 50) return 'bg-orange-500';\n    return 'bg-red-500';\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Language Settings</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Manage languages and translations for your application\n          </p>\n        </div>\n        <Button onClick={handleAddLanguage} data-testid=\"button-add-language\">\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Add Language\n        </Button>\n      </div>\n\n      {/* Language Configuration */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Language Configuration</CardTitle>\n          <CardDescription>\n            Configure default language and detection settings\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-6\">\n            <div>\n              <Label htmlFor=\"default-language\">Default Language</Label>\n              <Select value={defaultLanguage} onValueChange={setDefaultLanguage}>\n                <SelectTrigger id=\"default-language\" data-testid=\"select-default-language\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {languages.filter(lang => lang.isActive).map((lang) => (\n                    <SelectItem key={lang.code} value={lang.code}>\n                      <span className=\"flex items-center gap-2\">\n                        <span>{lang.flag}</span>\n                        <span>{lang.name}</span>\n                      </span>\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                This language will be used by default for new users\n              </p>\n            </div>\n\n            <div>\n              <Label htmlFor=\"fallback-language\">Fallback Language</Label>\n              <Select value={fallbackLanguage} onValueChange={setFallbackLanguage}>\n                <SelectTrigger id=\"fallback-language\" data-testid=\"select-fallback-language\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {languages.filter(lang => lang.isActive).map((lang) => (\n                    <SelectItem key={lang.code} value={lang.code}>\n                      <span className=\"flex items-center gap-2\">\n                        <span>{lang.flag}</span>\n                        <span>{lang.name}</span>\n                      </span>\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                Used when translations are missing in selected language\n              </p>\n            </div>\n          </div>\n\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"space-y-0.5\">\n                <Label>Auto-detect Language</Label>\n                <p className=\"text-sm text-muted-foreground\">\n                  Automatically detect user's browser language\n                </p>\n              </div>\n              <Switch\n                checked={autoDetect}\n                onCheckedChange={setAutoDetect}\n                data-testid=\"switch-auto-detect\"\n              />\n            </div>\n\n            <div className=\"flex items-center justify-between\">\n              <div className=\"space-y-0.5\">\n                <Label>Language-specific Date Format</Label>\n                <p className=\"text-sm text-muted-foreground\">\n                  Use date format appropriate for each language\n                </p>\n              </div>\n              <Switch\n                checked={dateFormatByLanguage}\n                onCheckedChange={setDateFormatByLanguage}\n                data-testid=\"switch-date-format\"\n              />\n            </div>\n\n            <div className=\"flex items-center justify-between\">\n              <div className=\"space-y-0.5\">\n                <Label>Language-specific Currency</Label>\n                <p className=\"text-sm text-muted-foreground\">\n                  Display currency based on language region\n                </p>\n              </div>\n              <Switch\n                checked={currencyByLanguage}\n                onCheckedChange={setCurrencyByLanguage}\n                data-testid=\"switch-currency\"\n              />\n            </div>\n          </div>\n\n          <div className=\"flex justify-end\">\n            <Button onClick={handleSaveSettings}>\n              <Save className=\"h-4 w-4 mr-2\" />\n              Save Configuration\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Available Languages */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Available Languages</CardTitle>\n          <CardDescription>\n            Manage available languages and their translation status\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"p-0\">\n          <div className=\"mobile-table-container\">\n            <Table className=\"table-mobile-stack\">\n            <TableHeader>\n              <TableRow>\n                <TableHead>Language</TableHead>\n                <TableHead>Code</TableHead>\n                <TableHead>Region</TableHead>\n                <TableHead>Translation Progress</TableHead>\n                <TableHead>Status</TableHead>\n                <TableHead>Last Updated</TableHead>\n                <TableHead className=\"text-right\">Actions</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {languages.map((language) => (\n                <TableRow key={language.id} data-testid={`row-language-${language.id}`}>\n                  <TableCell data-label=\"Language\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-2xl\">{language.flag}</span>\n                      <div>\n                        <p className=\"font-medium\">{language.name}</p>\n                        <p className=\"text-sm text-muted-foreground\">{language.nativeName}</p>\n                      </div>\n                      {language.isDefault && (\n                        <Badge variant=\"secondary\" className=\"ml-2\">Default</Badge>\n                      )}\n                    </div>\n                  </TableCell>\n                  <TableCell data-label=\"Code\">\n                    <code className=\"text-sm\">{language.code}</code>\n                  </TableCell>\n                  <TableCell data-label=\"Region\">{language.region}</TableCell>\n                  <TableCell data-label=\"Translation Progress\">\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"w-24 bg-gray-200 rounded-full h-2\">\n                        <div \n                          className={`${getProgressColor(language.translationProgress)} h-2 rounded-full transition-all`}\n                          style={{ width: `${language.translationProgress}%` }}\n                        />\n                      </div>\n                      <span className=\"text-sm font-medium\">{language.translationProgress}%</span>\n                    </div>\n                  </TableCell>\n                  <TableCell data-label=\"Status\">\n                    {language.isActive ? (\n                      <Badge variant=\"default\" className=\"gap-1\">\n                        <Check className=\"h-3 w-3\" />\n                        Active\n                      </Badge>\n                    ) : (\n                      <Badge variant=\"secondary\" className=\"gap-1\">\n                        <X className=\"h-3 w-3\" />\n                        Inactive\n                      </Badge>\n                    )}\n                  </TableCell>\n                  <TableCell data-label=\"Last Updated\">{language.lastUpdated}</TableCell>\n                  <TableCell data-label=\"Actions\" className=\"text-right\">\n                    <DropdownMenu>\n                      <DropdownMenuTrigger asChild>\n                        <Button variant=\"ghost\" size=\"icon\" data-testid={`button-actions-${language.id}`}>\n                          <MoreHorizontal className=\"h-4 w-4\" />\n                        </Button>\n                      </DropdownMenuTrigger>\n                      <DropdownMenuContent align=\"end\">\n                        <DropdownMenuItem onClick={() => handleToggleLanguage(language.id)}>\n                          {language.isActive ? 'Deactivate' : 'Activate'}\n                        </DropdownMenuItem>\n                        {!language.isDefault && (\n                          <DropdownMenuItem onClick={() => handleSetDefault(language.code)}>\n                            Set as Default\n                          </DropdownMenuItem>\n                        )}\n                        <DropdownMenuItem>\n                          <Settings className=\"h-4 w-4 mr-2\" />\n                          Configure\n                        </DropdownMenuItem>\n                        <DropdownMenuItem onClick={() => handleExportTranslations(language.code)}>\n                          <Download className=\"h-4 w-4 mr-2\" />\n                          Export Translations\n                        </DropdownMenuItem>\n                        <DropdownMenuItem onClick={handleImportTranslations}>\n                          <Upload className=\"h-4 w-4 mr-2\" />\n                          Import Translations\n                        </DropdownMenuItem>\n                      </DropdownMenuContent>\n                    </DropdownMenu>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n            </Table>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Translation Statistics */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Translation Statistics</CardTitle>\n          <CardDescription>\n            Overview of translation coverage by module\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"mobile-table-container\">\n            <Table className=\"table-mobile-stack\">\n            <TableHeader>\n              <TableRow>\n                <TableHead>Module</TableHead>\n                <TableHead className=\"text-right\">Translated</TableHead>\n                <TableHead className=\"text-right\">Total</TableHead>\n                <TableHead>Coverage</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {translationCategories.map((category, index) => (\n                <TableRow key={index}>\n                  <TableCell data-label=\"Module\" className=\"font-medium\">{category.category}</TableCell>\n                  <TableCell data-label=\"Translated\" className=\"text-right\">{category.translated}</TableCell>\n                  <TableCell data-label=\"Total\" className=\"text-right\">{category.total}</TableCell>\n                  <TableCell data-label=\"Coverage\">\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"w-24 bg-gray-200 rounded-full h-2\">\n                        <div \n                          className={`${getProgressColor(category.percentage)} h-2 rounded-full`}\n                          style={{ width: `${category.percentage}%` }}\n                        />\n                      </div>\n                      <span className=\"text-sm font-medium\">{category.percentage}%</span>\n                    </div>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n            </Table>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":16612},"client/src/pages/settings/UsersPage.tsx":{"content":"import { useState } from 'react';\nimport { useIsMobile } from '@/hooks/use-mobile';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog';\nimport { useToast } from '@/hooks/use-toast';\nimport { \n  Users, \n  UserPlus,\n  Shield,\n  Key,\n  Mail,\n  Phone,\n  Calendar,\n  MoreHorizontal,\n  Edit,\n  Trash2,\n  Lock,\n  Unlock,\n  CheckCircle,\n  XCircle,\n  AlertCircle,\n  Save\n} from 'lucide-react';\nimport { format } from 'date-fns';\n\n// Mock user data\nconst mockUsers = [\n  {\n    id: '1',\n    name: 'John Smith',\n    email: 'john.smith@acmecorp.com',\n    phone: '+1 (555) 123-4567',\n    role: 'Admin',\n    department: 'Management',\n    status: 'active',\n    lastLogin: '2024-02-15 09:30:00',\n    createdDate: '2023-01-15',\n    avatar: 'JS',\n  },\n  {\n    id: '2',\n    name: 'Sarah Johnson',\n    email: 'sarah.j@acmecorp.com',\n    phone: '+1 (555) 234-5678',\n    role: 'Accountant',\n    department: 'Finance',\n    status: 'active',\n    lastLogin: '2024-02-15 14:20:00',\n    createdDate: '2023-03-20',\n    avatar: 'SJ',\n  },\n  {\n    id: '3',\n    name: 'Michael Chen',\n    email: 'michael.chen@acmecorp.com',\n    phone: '+1 (555) 345-6789',\n    role: 'Sales Manager',\n    department: 'Sales',\n    status: 'active',\n    lastLogin: '2024-02-14 16:45:00',\n    createdDate: '2023-05-10',\n    avatar: 'MC',\n  },\n  {\n    id: '4',\n    name: 'Emily Davis',\n    email: 'emily.d@acmecorp.com',\n    phone: '+1 (555) 456-7890',\n    role: 'Viewer',\n    department: 'Marketing',\n    status: 'inactive',\n    lastLogin: '2024-01-30 11:00:00',\n    createdDate: '2023-07-22',\n    avatar: 'ED',\n  },\n  {\n    id: '5',\n    name: 'Robert Wilson',\n    email: 'robert.w@acmecorp.com',\n    phone: '+1 (555) 567-8901',\n    role: 'Purchase Manager',\n    department: 'Procurement',\n    status: 'locked',\n    lastLogin: '2024-02-10 10:15:00',\n    createdDate: '2023-09-05',\n    avatar: 'RW',\n  },\n];\n\n// Mock roles data\nconst mockRoles = [\n  {\n    id: '1',\n    name: 'Admin',\n    description: 'Full system access',\n    userCount: 1,\n    permissions: ['all'],\n    color: 'destructive',\n  },\n  {\n    id: '2',\n    name: 'Accountant',\n    description: 'Access to financial modules',\n    userCount: 1,\n    permissions: ['dashboard', 'sales', 'purchases', 'banking', 'reports'],\n    color: 'default',\n  },\n  {\n    id: '3',\n    name: 'Sales Manager',\n    description: 'Access to sales and customer modules',\n    userCount: 1,\n    permissions: ['dashboard', 'sales', 'customers', 'reports.sales'],\n    color: 'secondary',\n  },\n  {\n    id: '4',\n    name: 'Purchase Manager',\n    description: 'Access to purchase and vendor modules',\n    userCount: 1,\n    permissions: ['dashboard', 'purchases', 'vendors', 'reports.purchases'],\n    color: 'secondary',\n  },\n  {\n    id: '5',\n    name: 'Viewer',\n    description: 'Read-only access',\n    userCount: 1,\n    permissions: ['dashboard', 'reports'],\n    color: 'outline',\n  },\n];\n\nconst statusConfig = {\n  active: { label: 'Active', icon: CheckCircle, color: 'success' },\n  inactive: { label: 'Inactive', icon: XCircle, color: 'secondary' },\n  locked: { label: 'Locked', icon: Lock, color: 'destructive' },\n  pending: { label: 'Pending', icon: AlertCircle, color: 'warning' },\n};\n\nexport default function UsersPage() {\n  const isMobile = useIsMobile();\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState('users');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedRole, setSelectedRole] = useState('all');\n  const [selectedStatus, setSelectedStatus] = useState('all');\n  const [showAddUserDialog, setShowAddUserDialog] = useState(false);\n\n  const users = mockUsers;\n  const roles = mockRoles;\n\n  // Filter users\n  const filteredUsers = users.filter((user) => {\n    const matchesSearch = \n      user.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      user.email.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    const matchesRole = selectedRole === 'all' || user.role === selectedRole;\n    const matchesStatus = selectedStatus === 'all' || user.status === selectedStatus;\n    \n    return matchesSearch && matchesRole && matchesStatus;\n  });\n\n  const handleAddUser = () => {\n    setShowAddUserDialog(true);\n  };\n\n  const handleEditUser = (userId: string) => {\n    toast({\n      title: 'Edit user',\n      description: `Opening edit dialog for user ${userId}`,\n    });\n  };\n\n  const handleDeleteUser = (userId: string) => {\n    if (confirm('Are you sure you want to delete this user?')) {\n      toast({\n        title: 'User deleted',\n        description: 'User has been removed from the system.',\n      });\n    }\n  };\n\n  const handleResetPassword = (userId: string) => {\n    toast({\n      title: 'Password reset',\n      description: 'Password reset link has been sent to the user.',\n    });\n  };\n\n  const handleToggleUserStatus = (userId: string, currentStatus: string) => {\n    const newStatus = currentStatus === 'active' ? 'inactive' : 'active';\n    toast({\n      title: 'Status updated',\n      description: `User status changed to ${newStatus}.`,\n    });\n  };\n\n  const handleSavePermissions = () => {\n    toast({\n      title: 'Permissions saved',\n      description: 'Role permissions have been updated successfully.',\n    });\n  };\n\n  const getStatusBadge = (status: string) => {\n    const config = statusConfig[status as keyof typeof statusConfig];\n    if (!config) return null;\n    \n    const Icon = config.icon;\n    return (\n      <Badge variant={config.color as any} className=\"gap-1\">\n        <Icon className=\"h-3 w-3\" />\n        {config.label}\n      </Badge>\n    );\n  };\n\n  const getInitials = (name: string) => {\n    return name.split(' ').map(n => n[0]).join('').toUpperCase();\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Users & Roles</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Manage user accounts and access permissions\n          </p>\n        </div>\n        <Button onClick={handleAddUser} data-testid=\"button-add-user\">\n          <UserPlus className=\"h-4 w-4 mr-2\" />\n          Add User\n        </Button>\n      </div>\n\n      {/* Statistics */}\n      <div className=\"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Users</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{users.length}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              All registered users\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Active Users</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">\n              {users.filter(u => u.status === 'active').length}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Currently active\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Roles</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{roles.length}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Defined roles\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Last Activity</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">2h ago</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Most recent login\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Tabs */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className={`${isMobile ? 'grid w-full grid-cols-2' : ''}`}>\n          <TabsTrigger value=\"users\">Users</TabsTrigger>\n          <TabsTrigger value=\"roles\">Roles & Permissions</TabsTrigger>\n        </TabsList>\n\n        {/* Users Tab */}\n        <TabsContent value=\"users\" className=\"space-y-4\">\n          {/* Filters */}\n          <div className={`flex gap-4 ${isMobile ? 'flex-col space-y-2' : 'items-center flex-wrap'}`}>\n            <div className={`flex-1 ${isMobile ? 'min-w-0' : ''}`}>\n              <Input\n                placeholder=\"Search users...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className={isMobile ? 'w-full' : 'max-w-sm'}\n                data-testid=\"input-search-users\"\n              />\n            </div>\n            <Select value={selectedRole} onValueChange={setSelectedRole}>\n              <SelectTrigger className={isMobile ? 'w-full' : 'w-48'} data-testid=\"select-role-filter\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Roles</SelectItem>\n                {roles.map((role) => (\n                  <SelectItem key={role.id} value={role.name}>{role.name}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n            <Select value={selectedStatus} onValueChange={setSelectedStatus}>\n              <SelectTrigger className={isMobile ? 'w-full' : 'w-32'} data-testid=\"select-status-filter\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Status</SelectItem>\n                <SelectItem value=\"active\">Active</SelectItem>\n                <SelectItem value=\"inactive\">Inactive</SelectItem>\n                <SelectItem value=\"locked\">Locked</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          {/* Users Table */}\n          <Card>\n            <CardContent className=\"p-0\">\n              <div className={isMobile ? \"mobile-table-container\" : \"\"}>\n                <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>User</TableHead>\n                    <TableHead>Email</TableHead>\n                    <TableHead>Phone</TableHead>\n                    <TableHead>Role</TableHead>\n                    <TableHead>Department</TableHead>\n                    <TableHead>Last Login</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredUsers.map((user) => (\n                    <TableRow key={user.id} data-testid={`row-user-${user.id}`}>\n                      <TableCell data-label=\"User\">\n                        <div className=\"flex items-center gap-3 min-w-0\">\n                          <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                            <span className=\"text-sm font-semibold\">{user.avatar}</span>\n                          </div>\n                          <div className=\"min-w-0 flex-1\">\n                            <p className=\"font-medium truncate\">{user.name}</p>\n                            <p className=\"text-xs text-muted-foreground truncate\">\n                              Joined {format(new Date(user.createdDate), 'MMM dd, yyyy')}\n                            </p>\n                          </div>\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"min-w-0 max-w-[200px]\" data-label=\"Email\">\n                        <div className=\"flex items-center gap-2 min-w-0\">\n                          <Mail className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" />\n                          <span className=\"truncate\">{user.email}</span>\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Phone\">\n                        <div className=\"flex items-center gap-2\">\n                          <Phone className=\"h-4 w-4 text-muted-foreground\" />\n                          {user.phone}\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Role\">\n                        <Badge variant={user.role === 'Admin' ? 'destructive' : 'secondary'}>\n                          {user.role}\n                        </Badge>\n                      </TableCell>\n                      <TableCell data-label=\"Department\">{user.department}</TableCell>\n                      <TableCell data-label=\"Last Login\">\n                        <div className=\"text-sm\">\n                          <p>{format(new Date(user.lastLogin), 'MMM dd, yyyy')}</p>\n                          <p className=\"text-xs text-muted-foreground\">\n                            {format(new Date(user.lastLogin), 'HH:mm')}\n                          </p>\n                        </div>\n                      </TableCell>\n                      <TableCell data-label=\"Status\">{getStatusBadge(user.status)}</TableCell>\n                      <TableCell className=\"text-right\" data-label=\"Actions\">\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\" data-testid={`button-actions-${user.id}`}>\n                              <MoreHorizontal className=\"h-4 w-4\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem onClick={() => handleEditUser(user.id)}>\n                              <Edit className=\"h-4 w-4 mr-2\" />\n                              Edit User\n                            </DropdownMenuItem>\n                            <DropdownMenuItem onClick={() => handleResetPassword(user.id)}>\n                              <Key className=\"h-4 w-4 mr-2\" />\n                              Reset Password\n                            </DropdownMenuItem>\n                            <DropdownMenuItem onClick={() => handleToggleUserStatus(user.id, user.status)}>\n                              {user.status === 'active' ? (\n                                <>\n                                  <Lock className=\"h-4 w-4 mr-2\" />\n                                  Deactivate\n                                </>\n                              ) : (\n                                <>\n                                  <Unlock className=\"h-4 w-4 mr-2\" />\n                                  Activate\n                                </>\n                              )}\n                            </DropdownMenuItem>\n                            <DropdownMenuSeparator />\n                            <DropdownMenuItem \n                              className=\"text-destructive\"\n                              onClick={() => handleDeleteUser(user.id)}\n                            >\n                              <Trash2 className=\"h-4 w-4 mr-2\" />\n                              Delete User\n                            </DropdownMenuItem>\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Roles Tab */}\n        <TabsContent value=\"roles\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle>User Roles</CardTitle>\n              <CardDescription>\n                Define roles and their associated permissions\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className={isMobile ? \"mobile-table-container\" : \"\"}>\n                <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Role Name</TableHead>\n                    <TableHead>Description</TableHead>\n                    <TableHead>Users</TableHead>\n                    <TableHead>Permissions</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {roles.map((role) => (\n                    <TableRow key={role.id}>\n                      <TableCell data-label=\"Role Name\">\n                        <Badge variant={role.color as any}>\n                          <Shield className=\"h-3 w-3 mr-1\" />\n                          {role.name}\n                        </Badge>\n                      </TableCell>\n                      <TableCell data-label=\"Description\">{role.description}</TableCell>\n                      <TableCell data-label=\"Users\">{role.userCount} users</TableCell>\n                      <TableCell data-label=\"Permissions\">\n                        <div className=\"flex flex-wrap gap-1\">\n                          {role.permissions.slice(0, 3).map((perm, index) => (\n                            <Badge key={index} variant=\"outline\" className=\"text-xs\">\n                              {perm}\n                            </Badge>\n                          ))}\n                          {role.permissions.length > 3 && (\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              +{role.permissions.length - 3} more\n                            </Badge>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"text-right\" data-label=\"Actions\">\n                        <Button size=\"sm\" variant=\"outline\">\n                          Configure\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Permissions Matrix */}\n          <Card>\n            <CardHeader>\n              <CardTitle>Permissions Matrix</CardTitle>\n              <CardDescription>\n                Configure module access for each role\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className={isMobile ? \"mobile-table-container\" : \"\"}>\n                <Table className={isMobile ? \"table-mobile-stack\" : \"\"}>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Module</TableHead>\n                    <TableHead className=\"text-center\">Admin</TableHead>\n                    <TableHead className=\"text-center\">Accountant</TableHead>\n                    <TableHead className=\"text-center\">Sales Manager</TableHead>\n                    <TableHead className=\"text-center\">Purchase Manager</TableHead>\n                    <TableHead className=\"text-center\">Viewer</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {['Dashboard', 'Sales', 'Purchases', 'Banking', 'Reports', 'Settings'].map((module) => (\n                    <TableRow key={module}>\n                      <TableCell className=\"font-medium\" data-label=\"Module\">{module}</TableCell>\n                      <TableCell className=\"text-center\" data-label=\"Admin\">\n                        <Checkbox defaultChecked />\n                      </TableCell>\n                      <TableCell className=\"text-center\" data-label=\"Accountant\">\n                        <Checkbox defaultChecked={module !== 'Settings'} />\n                      </TableCell>\n                      <TableCell className=\"text-center\" data-label=\"Sales Manager\">\n                        <Checkbox defaultChecked={module === 'Dashboard' || module === 'Sales'} />\n                      </TableCell>\n                      <TableCell className=\"text-center\" data-label=\"Purchase Manager\">\n                        <Checkbox defaultChecked={module === 'Dashboard' || module === 'Purchases'} />\n                      </TableCell>\n                      <TableCell className=\"text-center\" data-label=\"Viewer\">\n                        <Checkbox defaultChecked={module === 'Dashboard' || module === 'Reports'} />\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n              </div>\n              <div className=\"flex justify-end mt-4\">\n                <Button onClick={handleSavePermissions}>\n                  <Save className=\"h-4 w-4 mr-2\" />\n                  Save Permissions\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n\n      {/* Add User Dialog */}\n      <Dialog open={showAddUserDialog} onOpenChange={setShowAddUserDialog}>\n        <DialogContent className={`${isMobile ? 'w-[calc(100vw-2rem)] max-w-full' : ''}`}>\n          <DialogHeader>\n            <DialogTitle>Add New User</DialogTitle>\n            <DialogDescription>\n              Create a new user account and assign role\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"name\">Full Name</Label>\n              <Input id=\"name\" placeholder=\"Enter full name\" className=\"min-w-0 w-full\" />\n            </div>\n            <div>\n              <Label htmlFor=\"email\">Email</Label>\n              <Input id=\"email\" type=\"email\" placeholder=\"Enter email address\" className=\"min-w-0 w-full\" />\n            </div>\n            <div>\n              <Label htmlFor=\"phone\">Phone</Label>\n              <Input id=\"phone\" placeholder=\"Enter phone number\" className=\"min-w-0 w-full\" />\n            </div>\n            <div>\n              <Label htmlFor=\"role\">Role</Label>\n              <Select>\n                <SelectTrigger id=\"role\">\n                  <SelectValue placeholder=\"Select role\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {roles.map((role) => (\n                    <SelectItem key={role.id} value={role.name}>{role.name}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <Label htmlFor=\"department\">Department</Label>\n              <Input id=\"department\" placeholder=\"Enter department\" className=\"min-w-0 w-full\" />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowAddUserDialog(false)}>\n              Cancel\n            </Button>\n            <Button onClick={() => {\n              setShowAddUserDialog(false);\n              toast({\n                title: 'User created',\n                description: 'New user has been added successfully.',\n              });\n            }}>\n              Add User\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":24269},"client/src/contexts/TranslationContext.tsx":{"content":"import { createContext, useContext, useEffect, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { languages, rtlLanguages } from '../lib/i18n';\nimport '../lib/i18n'; // Initialize i18n\n\nexport interface Language {\n  code: string;\n  name: string;\n  flag: string;\n  direction: string;\n}\n\ninterface TranslationContextType {\n  currentLanguage: Language;\n  changeLanguage: (languageCode: string) => void;\n  t: (key: string, options?: any) => string;\n  isRTL: boolean;\n  availableLanguages: Language[];\n}\n\nconst TranslationContext = createContext<TranslationContextType | null>(null);\n\nexport const TranslationProvider = ({ children }: { children: React.ReactNode }) => {\n  const { t, i18n } = useTranslation();\n  const [currentLanguage, setCurrentLanguage] = useState<Language>(() => {\n    // Get current language from i18n or default to English\n    const currentLang = i18n.language || 'en';\n    return languages.find(lang => lang.code === currentLang) || languages[0];\n  });\n\n  // Check if current language is RTL\n  const isRTL = rtlLanguages.includes(currentLanguage.code);\n\n  const changeLanguage = async (languageCode: string) => {\n    try {\n      const selectedLanguage = languages.find(lang => lang.code === languageCode);\n      if (!selectedLanguage) {\n        console.warn(`Language ${languageCode} not found`);\n        return;\n      }\n\n      // Change language in i18n\n      await i18n.changeLanguage(languageCode);\n      \n      // Update local state\n      setCurrentLanguage(selectedLanguage);\n      \n      // Set document direction for RTL languages\n      document.documentElement.dir = selectedLanguage.direction;\n      document.documentElement.lang = languageCode;\n      \n      // Store in localStorage for persistence\n      localStorage.setItem('log-ledger-language', languageCode);\n      \n      console.log('Language changed to:', languageCode);\n    } catch (error) {\n      console.error('Failed to change language:', error);\n    }\n  };\n\n  // Initialize document direction and language on mount\n  useEffect(() => {\n    document.documentElement.dir = currentLanguage.direction;\n    document.documentElement.lang = currentLanguage.code;\n  }, [currentLanguage]);\n\n  // Listen for i18n language changes (for cases where language is changed elsewhere)\n  useEffect(() => {\n    const handleLanguageChanged = (lng: string) => {\n      const newLanguage = languages.find(lang => lang.code === lng);\n      if (newLanguage && newLanguage.code !== currentLanguage.code) {\n        setCurrentLanguage(newLanguage);\n        document.documentElement.dir = newLanguage.direction;\n        document.documentElement.lang = lng;\n      }\n    };\n\n    i18n.on('languageChanged', handleLanguageChanged);\n    return () => {\n      i18n.off('languageChanged', handleLanguageChanged);\n    };\n  }, [i18n, currentLanguage.code]);\n\n  const value: TranslationContextType = {\n    currentLanguage,\n    changeLanguage,\n    t,\n    isRTL,\n    availableLanguages: languages,\n  };\n\n  return (\n    <TranslationContext.Provider value={value}>\n      {children}\n    </TranslationContext.Provider>\n  );\n};\n\nexport const useTranslationContext = () => {\n  const context = useContext(TranslationContext);\n  if (!context) {\n    throw new Error('useTranslationContext must be used within a TranslationProvider');\n  }\n  return context;\n};","size_bytes":3328},"client/src/lib/i18n.ts":{"content":"import i18n from 'i18next';\nimport { initReactI18next } from 'react-i18next';\nimport LanguageDetector from 'i18next-browser-languagedetector';\n\n// Import all language files\nimport en from '../locales/en/translation.json';\nimport ar from '../locales/ar/translation.json';\nimport tl from '../locales/tl/translation.json';\nimport hi from '../locales/hi/translation.json';\nimport ur from '../locales/ur/translation.json';\nimport fr from '../locales/fr/translation.json';\nimport es from '../locales/es/translation.json';\nimport zh from '../locales/zh/translation.json';\nimport ru from '../locales/ru/translation.json';\nimport bn from '../locales/bn/translation.json';\nimport ms from '../locales/ms/translation.json';\nimport tr from '../locales/tr/translation.json';\nimport pt from '../locales/pt/translation.json';\nimport id from '../locales/id/translation.json';\nimport de from '../locales/de/translation.json';\nimport fa from '../locales/fa/translation.json';\n\n// Language configuration\nexport const languages = [\n  { code: \"en\", name: \"English\", flag: \"ðŸ‡ºðŸ‡¸\", direction: \"ltr\" },\n  { code: \"ar\", name: \"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©\", flag: \"ðŸ‡¸ðŸ‡¦\", direction: \"rtl\" },\n  { code: \"tl\", name: \"Tagalog\", flag: \"ðŸ‡µðŸ‡­\", direction: \"ltr\" },\n  { code: \"hi\", name: \"à¤¹à¤¿à¤¨à¥à¤¦à¥€\", flag: \"ðŸ‡®ðŸ‡³\", direction: \"ltr\" },\n  { code: \"ur\", name: \"Ø§Ø±Ø¯Ùˆ\", flag: \"ðŸ‡µðŸ‡°\", direction: \"rtl\" },\n  { code: \"fr\", name: \"FranÃ§ais\", flag: \"ðŸ‡«ðŸ‡·\", direction: \"ltr\" },\n  { code: \"es\", name: \"EspaÃ±ol\", flag: \"ðŸ‡ªðŸ‡¸\", direction: \"ltr\" },\n  { code: \"zh\", name: \"ä¸­æ–‡\", flag: \"ðŸ‡¨ðŸ‡³\", direction: \"ltr\" },\n  { code: \"ru\", name: \"Ð ÑƒÑÑÐºÐ¸Ð¹\", flag: \"ðŸ‡·ðŸ‡º\", direction: \"ltr\" },\n  { code: \"bn\", name: \"à¦¬à¦¾à¦‚à¦²à¦¾\", flag: \"ðŸ‡§ðŸ‡©\", direction: \"ltr\" },\n  { code: \"ms\", name: \"Bahasa Melayu\", flag: \"ðŸ‡²ðŸ‡¾\", direction: \"ltr\" },\n  { code: \"tr\", name: \"TÃ¼rkÃ§e\", flag: \"ðŸ‡¹ðŸ‡·\", direction: \"ltr\" },\n  { code: \"pt\", name: \"PortuguÃªs\", flag: \"ðŸ‡§ðŸ‡·\", direction: \"ltr\" },\n  { code: \"id\", name: \"Bahasa Indonesia\", flag: \"ðŸ‡®ðŸ‡©\", direction: \"ltr\" },\n  { code: \"de\", name: \"Deutsch\", flag: \"ðŸ‡©ðŸ‡ª\", direction: \"ltr\" },\n  { code: \"fa\", name: \"ÙØ§Ø±Ø³ÛŒ\", flag: \"ðŸ‡®ðŸ‡·\", direction: \"rtl\" },\n];\n\n// RTL languages list\nexport const rtlLanguages = ['ar', 'ur', 'fa'];\n\n// Initialize i18n\ni18n\n  .use(LanguageDetector)\n  .use(initReactI18next)\n  .init({\n    resources: {\n      en: { translation: en },\n      ar: { translation: ar },\n      tl: { translation: tl },\n      hi: { translation: hi },\n      ur: { translation: ur },\n      fr: { translation: fr },\n      es: { translation: es },\n      zh: { translation: zh },\n      ru: { translation: ru },\n      bn: { translation: bn },\n      ms: { translation: ms },\n      tr: { translation: tr },\n      pt: { translation: pt },\n      id: { translation: id },\n      de: { translation: de },\n      fa: { translation: fa },\n    },\n    fallbackLng: 'en',\n    debug: false,\n    \n    detection: {\n      order: ['localStorage', 'navigator', 'htmlTag'],\n      caches: ['localStorage'],\n      lookupLocalStorage: 'log-ledger-language',\n    },\n\n    interpolation: {\n      escapeValue: false, // React already escapes values\n    },\n\n    // Key separator\n    keySeparator: '.',\n    nsSeparator: false,\n  });\n\nexport default i18n;","size_bytes":3273},"client/src/pages/sales/RecurringInvoicesPage.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { queryClient, apiRequest } from '@/lib/queryClient';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { \n  FileText, \n  Plus, \n  MoreHorizontal, \n  Eye, \n  Edit, \n  Copy,\n  Send,\n  Pause,\n  Play,\n  CheckCircle,\n  Clock,\n  XCircle,\n  Calendar,\n  Building2,\n  RotateCcw,\n  CalendarDays\n} from 'lucide-react';\nimport { format } from 'date-fns';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { useToast } from '@/hooks/use-toast';\nimport { useIsMobile } from '@/hooks/use-mobile';\n\n// Recurring invoice form schema\nconst recurringInvoiceSchema = z.object({\n  customer_id: z.string().min(1, 'Please select a customer'),\n  template_name: z.string().min(2, 'Template name must be at least 2 characters'),\n  frequency: z.string().min(1, 'Please select frequency'),\n  start_date: z.string().min(1, 'Start date is required'),\n  end_date: z.string().optional(),\n  amount: z.string().min(1, 'Amount is required'),\n  description: z.string().min(2, 'Description must be at least 2 characters'),\n  payment_terms: z.string().min(1, 'Payment terms are required'),\n  notes: z.string().optional(),\n});\n\ntype RecurringInvoiceForm = z.infer<typeof recurringInvoiceSchema>;\n\n// Mock data\nconst mockRecurringInvoices = [\n  {\n    id: '1',\n    template_name: 'Monthly Software License',\n    customer_name: 'TechCorp Solutions',\n    frequency: 'monthly',\n    next_invoice: '2024-03-01',\n    amount: 2500.00,\n    currency: 'USD',\n    status: 'active',\n    invoices_sent: 8,\n    start_date: '2023-07-01',\n    end_date: null,\n  },\n  {\n    id: '2', \n    template_name: 'Quarterly Consulting',\n    customer_name: 'Innovation Industries',\n    frequency: 'quarterly',\n    next_invoice: '2024-04-01',\n    amount: 15000.00,\n    currency: 'USD',\n    status: 'active',\n    invoices_sent: 3,\n    start_date: '2023-01-01',\n    end_date: '2024-12-31',\n  },\n  {\n    id: '3',\n    template_name: 'Weekly Maintenance',\n    customer_name: 'Local Business Co',\n    frequency: 'weekly',\n    next_invoice: '2024-02-19',\n    amount: 750.00,\n    currency: 'USD',\n    status: 'paused',\n    invoices_sent: 32,\n    start_date: '2023-06-01',\n    end_date: null,\n  },\n];\n\nconst statusConfig = {\n  active: { label: 'Active', icon: CheckCircle, color: 'default' as const },\n  paused: { label: 'Paused', icon: Pause, color: 'secondary' as const },\n  expired: { label: 'Expired', icon: XCircle, color: 'destructive' as const },\n};\n\nconst frequencyOptions = [\n  { value: 'weekly', label: 'Weekly' },\n  { value: 'monthly', label: 'Monthly' },\n  { value: 'quarterly', label: 'Quarterly' },\n  { value: 'yearly', label: 'Yearly' },\n];\n\nexport default function RecurringInvoicesPage() {\n  const { toast } = useToast();\n  const isMobile = useIsMobile();\n  const [activeTab, setActiveTab] = useState('all');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [showDialog, setShowDialog] = useState(false);\n  \n  // Fetch contacts (customers)\n  const { data: contacts = [] } = useQuery<any[]>({\n    queryKey: ['/api/contacts'],\n  });\n\n  const customers = contacts.filter(contact => \n    contact.type === 'customer' || contact.type === 'both'\n  );\n\n  // Create recurring invoice mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: RecurringInvoiceForm) => {\n      const processedData = {\n        ...data,\n        amount: parseFloat(data.amount),\n        status: 'active',\n        invoices_sent: 0,\n      };\n      return await apiRequest('POST', '/api/sales/recurring-invoices', processedData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/sales/recurring-invoices'] });\n      setShowDialog(false);\n      toast({\n        title: 'Recurring invoice created',\n        description: 'New recurring invoice template has been created successfully.',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to create recurring invoice',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Form\n  const form = useForm<RecurringInvoiceForm>({\n    resolver: zodResolver(recurringInvoiceSchema),\n    defaultValues: {\n      customer_id: '',\n      template_name: '',\n      frequency: 'monthly',\n      start_date: new Date().toISOString().split('T')[0],\n      end_date: '',\n      amount: '',\n      description: '',\n      payment_terms: '30',\n      notes: '',\n    },\n  });\n\n  const onSubmit = (data: RecurringInvoiceForm) => {\n    createMutation.mutate(data);\n  };\n\n  // Filter recurring invoices\n  const filteredInvoices = mockRecurringInvoices.filter((invoice) => {\n    const matchesSearch = \n      invoice.template_name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      invoice.customer_name.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    if (!matchesSearch) return false;\n    \n    switch (activeTab) {\n      case 'active':\n        return invoice.status === 'active';\n      case 'paused':\n        return invoice.status === 'paused';\n      case 'expired':\n        return invoice.status === 'expired';\n      default:\n        return true;\n    }\n  });\n\n  // Calculate statistics\n  const stats = {\n    total: mockRecurringInvoices.length,\n    active: mockRecurringInvoices.filter(inv => inv.status === 'active').length,\n    paused: mockRecurringInvoices.filter(inv => inv.status === 'paused').length,\n    totalRevenue: mockRecurringInvoices\n      .filter(inv => inv.status === 'active')\n      .reduce((sum, inv) => sum + inv.amount, 0),\n  };\n\n  const getStatusBadge = (status: string) => {\n    const config = statusConfig[status as keyof typeof statusConfig];\n    if (!config) return null;\n    \n    const Icon = config.icon;\n    return (\n      <Badge variant={config.color} className=\"gap-1\">\n        <Icon className=\"h-3 w-3\" />\n        {config.label}\n      </Badge>\n    );\n  };\n\n  const formatCurrency = (amount: number, currency: string) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: currency,\n    }).format(amount);\n  };\n\n  const handleToggleStatus = (id: string, currentStatus: string) => {\n    const newStatus = currentStatus === 'active' ? 'paused' : 'active';\n    toast({\n      title: `Recurring invoice ${newStatus}`,\n      description: `Template has been ${newStatus === 'active' ? 'resumed' : 'paused'}.`,\n    });\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className={`${isMobile ? 'space-y-4' : 'flex items-center justify-between'}`}>\n        <div>\n          <h1 className={`${isMobile ? 'text-2xl' : 'text-3xl'} font-bold text-foreground`}>Recurring Invoices</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            {isMobile ? 'Manage recurring invoice templates' : 'Manage automated recurring invoice templates and schedules'}\n          </p>\n        </div>\n        <Dialog open={showDialog} onOpenChange={setShowDialog}>\n          <DialogTrigger asChild>\n            <Button \n              size={isMobile ? 'sm' : 'default'}\n              data-testid=\"button-new-recurring-invoice\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Recurring Invoice\n            </Button>\n          </DialogTrigger>\n          <DialogContent className={`max-w-2xl max-h-[90vh] overflow-y-auto ${isMobile ? 'w-full max-w-full mx-4' : ''}`}>\n            <DialogHeader>\n              <DialogTitle>Create Recurring Invoice Template</DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"customer_id\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Customer</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Select customer\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {customers.map((customer) => (\n                              <SelectItem key={customer.id} value={customer.id}>\n                                {customer.name}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"template_name\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Template Name</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Monthly Service Fee\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"frequency\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Frequency</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Select frequency\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {frequencyOptions.map((option) => (\n                              <SelectItem key={option.value} value={option.value}>\n                                {option.label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"amount\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Amount</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            placeholder=\"0.00\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"start_date\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Start Date</FormLabel>\n                        <FormControl>\n                          <Input type=\"date\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"end_date\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>End Date (Optional)</FormLabel>\n                        <FormControl>\n                          <Input type=\"date\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"description\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Description</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"Service description\" \n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"payment_terms\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Payment Terms (Days)</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select terms\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"15\">Net 15</SelectItem>\n                          <SelectItem value=\"30\">Net 30</SelectItem>\n                          <SelectItem value=\"60\">Net 60</SelectItem>\n                          <SelectItem value=\"90\">Net 90</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"notes\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Notes (Optional)</FormLabel>\n                      <FormControl>\n                        <Textarea\n                          placeholder=\"Additional notes...\"\n                          className=\"resize-none\"\n                          rows={3}\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex items-center gap-3 pt-4\">\n                  <Button type=\"submit\" disabled={createMutation.isPending}>\n                    {createMutation.isPending ? 'Creating...' : 'Create Template'}\n                  </Button>\n                  <Button \n                    type=\"button\" \n                    variant=\"outline\" \n                    onClick={() => setShowDialog(false)}\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Statistics Cards */}\n      <div className={`grid gap-4 ${isMobile ? 'grid-cols-2' : 'grid-cols-2 md:grid-cols-4'}`}>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Templates</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats.total}</div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              All templates\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Active Templates</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">\n              {stats.active}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Currently running\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Paused</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-orange-600\">\n              {stats.paused}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              Temporarily stopped\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Monthly Revenue</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {formatCurrency(stats.totalRevenue, 'USD')}\n            </div>\n            <div className=\"text-xs text-muted-foreground mt-1\">\n              From active templates\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search */}\n      <div className=\"flex items-center gap-4\">\n        <div className=\"flex-1\">\n          <Input\n            placeholder=\"Search by template name or customer...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"max-w-md\"\n          />\n        </div>\n      </div>\n\n      {/* Tabs */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList>\n          <TabsTrigger value=\"all\">All ({stats.total})</TabsTrigger>\n          <TabsTrigger value=\"active\">Active ({stats.active})</TabsTrigger>\n          <TabsTrigger value=\"paused\">Paused ({stats.paused})</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value={activeTab} className=\"space-y-4\">\n          <Card>\n            <CardContent className=\"p-0\">\n              <div className={`${isMobile ? 'mobile-table-container' : ''}`}>\n                <Table className={`${isMobile ? 'table-mobile-stack' : ''}`}>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Template</TableHead>\n                      <TableHead>Customer</TableHead>\n                      <TableHead>Frequency</TableHead>\n                      <TableHead>Next Invoice</TableHead>\n                      <TableHead className=\"text-right\">Amount</TableHead>\n                      <TableHead>Status</TableHead>\n                      <TableHead className=\"text-right\">Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {filteredInvoices.map((invoice) => (\n                      <TableRow key={invoice.id}>\n                        <TableCell data-label=\"Template\">\n                          <div>\n                            <div className=\"font-medium\">{invoice.template_name}</div>\n                            <div className=\"text-sm text-muted-foreground\">\n                              {invoice.invoices_sent} invoices sent\n                            </div>\n                          </div>\n                        </TableCell>\n                        <TableCell data-label=\"Customer\">\n                          <div className=\"flex items-center gap-2\">\n                            <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n                            {invoice.customer_name}\n                          </div>\n                        </TableCell>\n                        <TableCell data-label=\"Frequency\">\n                          <div className=\"flex items-center gap-2\">\n                            <RotateCcw className=\"h-4 w-4 text-muted-foreground\" />\n                            <span className=\"capitalize\">{invoice.frequency}</span>\n                          </div>\n                        </TableCell>\n                        <TableCell data-label=\"Next Invoice\">\n                          <div className=\"flex items-center gap-2\">\n                            <CalendarDays className=\"h-4 w-4 text-muted-foreground\" />\n                            {format(new Date(invoice.next_invoice), 'MMM dd, yyyy')}\n                          </div>\n                        </TableCell>\n                        <TableCell className=\"text-right\" data-label=\"Amount\">\n                          <div className=\"font-semibold\">\n                            {formatCurrency(invoice.amount, invoice.currency)}\n                          </div>\n                        </TableCell>\n                        <TableCell data-label=\"Status\">\n                          {getStatusBadge(invoice.status)}\n                        </TableCell>\n                        <TableCell className=\"text-right\" data-label=\"Actions\">\n                          <DropdownMenu>\n                            <DropdownMenuTrigger asChild>\n                              <Button variant=\"ghost\" size=\"sm\">\n                                <MoreHorizontal className=\"h-4 w-4\" />\n                              </Button>\n                            </DropdownMenuTrigger>\n                            <DropdownMenuContent align=\"end\">\n                              <DropdownMenuItem>\n                                <Eye className=\"h-4 w-4 mr-2\" />\n                                View Details\n                              </DropdownMenuItem>\n                              <DropdownMenuItem>\n                                <Edit className=\"h-4 w-4 mr-2\" />\n                                Edit Template\n                              </DropdownMenuItem>\n                              <DropdownMenuItem>\n                                <Copy className=\"h-4 w-4 mr-2\" />\n                                Duplicate\n                              </DropdownMenuItem>\n                              <DropdownMenuSeparator />\n                              <DropdownMenuItem\n                                onClick={() => handleToggleStatus(invoice.id, invoice.status)}\n                              >\n                                {invoice.status === 'active' ? (\n                                  <>\n                                    <Pause className=\"h-4 w-4 mr-2\" />\n                                    Pause Template\n                                  </>\n                                ) : (\n                                  <>\n                                    <Play className=\"h-4 w-4 mr-2\" />\n                                    Resume Template\n                                  </>\n                                )}\n                              </DropdownMenuItem>\n                              <DropdownMenuItem>\n                                <Send className=\"h-4 w-4 mr-2\" />\n                                Send Now\n                              </DropdownMenuItem>\n                            </DropdownMenuContent>\n                          </DropdownMenu>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":24154},"attached_assets/content-1758114119495.md":{"content":"[Skip to main content](https://firebase.google.com/docs/web/setup#main-content)\n\n[![Firebase](https://www.gstatic.com/devrel-devsite/prod/vf0eb6f8ebad49d1e3523c3ee6bef7563a09624802753ccc3d816c9b276e850fd/firebase/images/lockup.svg)](https://firebase.google.com/)\n\n`/`\n\nLanguage\n\n- [English](https://firebase.google.com/docs/web/setup#available-libraries)\n- [Deutsch](https://firebase.google.com/docs/web/setup?hl=de#available-libraries)\n- [EspaÃ±ol â€“ AmÃ©rica Latina](https://firebase.google.com/docs/web/setup?hl=es-419#available-libraries)\n- [FranÃ§ais](https://firebase.google.com/docs/web/setup?hl=fr#available-libraries)\n- [Indonesia](https://firebase.google.com/docs/web/setup?hl=id#available-libraries)\n- [Italiano](https://firebase.google.com/docs/web/setup?hl=it#available-libraries)\n- [Polski](https://firebase.google.com/docs/web/setup?hl=pl#available-libraries)\n- [PortuguÃªs â€“ Brasil](https://firebase.google.com/docs/web/setup?hl=pt-br#available-libraries)\n- [TiÃªÌng ViÃªÌ£t](https://firebase.google.com/docs/web/setup?hl=vi#available-libraries)\n- [TÃ¼rkÃ§e](https://firebase.google.com/docs/web/setup?hl=tr#available-libraries)\n- [Ð ÑƒÑÑÐºÐ¸Ð¹](https://firebase.google.com/docs/web/setup?hl=ru#available-libraries)\n- [×¢×‘×¨×™×ª](https://firebase.google.com/docs/web/setup?hl=he#available-libraries)\n- [Ø§Ù„Ø¹Ø±Ø¨ÙŠÙ‘Ø©](https://firebase.google.com/docs/web/setup?hl=ar#available-libraries)\n- [ÙØ§Ø±Ø³ÛŒ](https://firebase.google.com/docs/web/setup?hl=fa#available-libraries)\n- [à¤¹à¤¿à¤‚à¤¦à¥€](https://firebase.google.com/docs/web/setup?hl=hi#available-libraries)\n- [à¦¬à¦¾à¦‚à¦²à¦¾](https://firebase.google.com/docs/web/setup?hl=bn#available-libraries)\n- [à¸ à¸²à¸©à¸²à¹„à¸—à¸¢](https://firebase.google.com/docs/web/setup?hl=th#available-libraries)\n- [ä¸­æ–‡ â€“ ç®€ä½“](https://firebase.google.com/docs/web/setup?hl=zh-cn#available-libraries)\n- [ä¸­æ–‡ â€“ ç¹é«”](https://firebase.google.com/docs/web/setup?hl=zh-tw#available-libraries)\n- [æ—¥æœ¬èªž](https://firebase.google.com/docs/web/setup?hl=ja#available-libraries)\n- [í•œêµ­ì–´](https://firebase.google.com/docs/web/setup?hl=ko#available-libraries)\n\n[Blog](https://firebase.blog/) [Studio](https://studio.firebase.google.com/) [Go to console](https://console.firebase.google.com/)\n\n[Sign in](https://firebase.google.com/_d/signin?continue=https%3A%2F%2Ffirebase.google.com%2Fdocs%2Fweb%2Fsetup%23available-libraries&prompt=select_account)\n\n- [Documentation](https://firebase.google.com/docs)\n- [Firebase for web platforms](https://firebase.google.com/docs/web)\n\n- On this page\n- [Step 1: Create a Firebase project and register your app](https://firebase.google.com/docs/web/setup#create-firebase-project-and-app)\n- [Step 2: Install the SDK and initialize Firebase](https://firebase.google.com/docs/web/setup#add-sdks-initialize)\n- [Step 3: Access Firebase in your app](https://firebase.google.com/docs/web/setup#access-firebase)\n- [Step 4: Use a module bundler (webpack/Rollup) for size reduction](https://firebase.google.com/docs/web/setup#use-modular-bundler)\n- [Available Firebase services for web](https://firebase.google.com/docs/web/setup#available-libraries)\n- [Next steps](https://firebase.google.com/docs/web/setup#next_steps)\n\n- [Firebase](https://firebase.google.com/)\n- [Documentation](https://firebase.google.com/docs)\n- [Firebase for web platforms](https://firebase.google.com/docs/web)\n- [Fundamentals](https://firebase.google.com/docs/guides)\n\nWas this helpful?\n\n\n\n Send feedback\n\n\n\n# Add Firebase to your JavaScript project  bookmark\\_border   Stay organized with collections     Save and categorize content based on your preferences.\n\n- On this page\n- [Step 1: Create a Firebase project and register your app](https://firebase.google.com/docs/web/setup#create-firebase-project-and-app)\n- [Step 2: Install the SDK and initialize Firebase](https://firebase.google.com/docs/web/setup#add-sdks-initialize)\n- [Step 3: Access Firebase in your app](https://firebase.google.com/docs/web/setup#access-firebase)\n- [Step 4: Use a module bundler (webpack/Rollup) for size reduction](https://firebase.google.com/docs/web/setup#use-modular-bundler)\n- [Available Firebase services for web](https://firebase.google.com/docs/web/setup#available-libraries)\n- [Next steps](https://firebase.google.com/docs/web/setup#next_steps)\n\nGetting started with Firebase for the web - YouTube\n\n[Photo image of Firebase](https://www.youtube.com/channel/UCP4bf6IHJJQehibu6ai__cg?embeds_referring_euri=https%3A%2F%2Ffirebase.google.com%2F&embeds_referring_origin=https%3A%2F%2Ffirebase.google.com)\n\nFirebase\n\n408K subscribers\n\n[Getting started with Firebase for the web](https://www.youtube.com/watch?v=rQvOAnNvcNQ)\n\nFirebase\n\nSearch\n\nWatch later\n\nShare\n\nCopy link\n\nInfo\n\nShopping\n\nTap to unmute\n\nIf playback doesn't begin shortly, try restarting your device.\n\nMore videos\n\n## More videos\n\nYou're signed out\n\nVideos you watch may be added to the TV's watch history and influence TV recommendations. To avoid this, cancel and sign in to YouTube on your computer.\n\nCancelConfirm\n\nShare\n\nInclude playlist\n\nAn error occurred while retrieving sharing information. Please try again later.\n\n[Watch on](https://www.youtube.com/watch?v=rQvOAnNvcNQ&embeds_referring_euri=https%3A%2F%2Ffirebase.google.com%2F&embeds_referring_origin=https%3A%2F%2Ffirebase.google.com)\n\n0:00\n\n0:00 / 10:59\nâ€¢Live\n\nâ€¢\n\nFollow this guide to use the FirebaseJavaScript SDK in your web app or as a client for\nend-user access, for example, in a Node.js desktop or IoT application.\n\n## **Step 1**: Create a Firebase project and register your app\n\nBefore you can add Firebase to your JavaScript app, you need to create a\nFirebase project and register your app with that project. When you register your\napp with Firebase, you'll get a Firebase configuration object that you'll use to\nconnect your app with your Firebase project resources.\n\nVisit [Understand Firebase Projects](https://firebase.google.com/docs/projects/learn-more) to learn more\nabout Firebase projects and best practices for adding apps to projects.\n\n****Create a Firebase project****\n\n[New to Firebase or Cloud](https://firebase.google.com/docs/web/setup#new-to-firebase-or-cloud)[Existing Cloud project](https://firebase.google.com/docs/web/setup#existing-cloud-project)More\n\nFollow these steps if you're new to Firebase or Google Cloud.\n\nYou can also follow these steps if you want to create a wholly new\nFirebase project (and its underlying Google Cloud project).\n\n\n1. Sign into the\n    [Firebase console](https://console.firebase.google.com/).\n\n2. Click the button to create a new Firebase project.\n\n3. In the text field, enter a **project name**.\n\nIf you're part of a Google Cloud org, you can optionally select which\n    folder you create your project in.\n\n\n4. If prompted, review and accept the [Firebase terms](https://firebase.google.com/terms),\n    then click **Continue**.\n\n5. _(Optional)_ Enable AI assistance in the Firebase console\n    (called \"Gemini in Firebase\"), which can help you get started and\n    streamline your development process.\n\n6. _(Optional)_ Set up Google Analytics for your project,\n    which enables an optimal experience using these Firebase products:\n    [Firebase A/B Testing](https://firebase.google.com/docs/ab-testing),\n    [Cloud Messaging](https://firebase.google.com/docs/cloud-messaging),\n    [Crashlytics](https://firebase.google.com/docs/crashlytics),\n    [In-App Messaging](https://firebase.google.com/docs/in-app-messaging), and\n    [Remote Config](https://firebase.google.com/docs/remote-config)\n    (including\n    [Personalization](https://firebase.google.com/docs/remote-config/personalization)).\n\n\nEither select an existing\n    [Google Analytics account](https://support.google.com/analytics/answer/1009618)\n    or create a new account. If you create a new account, select your\n    [Analytics reporting location](https://firebase.google.com/docs/projects/locations),\n    then accept the data sharing settings and Google Analytics terms\n    for your project.\n\n\n7. Click **Create project**.\n\n\nFirebase creates your project, provisions some initial resources, and\nenables important APIs. When the process completes, you'll be taken to the\noverview page for your Firebase project in the Firebase console.\n\n\nFollow these steps if you want to start using Firebase with an existing\nGoogle Cloud project. Learn more about\n[\"adding\\\\\nFirebase\" to an existing Google Cloud project](https://firebase.google.com/docs/projects/use-firebase-with-existing-cloud-project).\n\n\n1. Sign into the\n    [Firebase console](https://console.firebase.google.com/) with the account that gives\n    you access to the existing Google Cloud project.\n\n2. Click the button to create a new Firebase project.\n\n3. At the bottom of the page, click\n    **Add Firebase to Google Cloud project**.\n\n4. In the text field, start entering the **project name** of the\n    existing project, and then select the project from the displayed list.\n\n5. Click **Open project**.\n\n6. If prompted, review and accept the [Firebase terms](https://firebase.google.com/terms),\n    then click **Continue**.\n\n7. _(Optional)_ Enable AI assistance in the Firebase console\n    (called \"Gemini in Firebase\"), which can help you get started and\n    streamline your development process.\n\n8. _(Optional)_ Set up Google Analytics for your project,\n    which enables an optimal experience using these Firebase products:\n    [Firebase A/B Testing](https://firebase.google.com/docs/ab-testing),\n    [Cloud Messaging](https://firebase.google.com/docs/cloud-messaging),\n    [Crashlytics](https://firebase.google.com/docs/crashlytics),\n    [In-App Messaging](https://firebase.google.com/docs/in-app-messaging), and\n    [Remote Config](https://firebase.google.com/docs/remote-config)\n    (including\n    [Personalization](https://firebase.google.com/docs/remote-config/personalization)).\n\n\nEither select an existing\n    [Google Analytics account](https://support.google.com/analytics/answer/1009618)\n    or create a new account. If you create a new account, select your\n    [Analytics reporting location](https://firebase.google.com/docs/projects/locations),\n    then accept the data sharing settings and Google Analytics terms\n    for your project.\n\n\n9. Click **Add Firebase**.\n\n\nFirebase\n[adds\\\\\nFirebase to your existing project](https://firebase.google.com/docs/projects/use-firebase-with-existing-cloud-project#faq_what-happens-when-add-firebase).\nWhen the process completes, you'll be taken to the overview page for your\nFirebase project in the Firebase console.\n\n\n****Register your app****\n\nAfter you have a Firebase project, you can register your web app with that project.\n\n1. In the center of the [Firebase console's project\\\\\n    overview\\\\\n    page](https://console.firebase.google.com/), click the **Web** icon\n    (plat\\_web)\n    to launch the setup workflow.\n\n\nIf you've already added an app to your Firebase project, click **Add app** to\n    display the platform options.\n\n\n2. Enter your app's nickname.\n\n\n    This nickname is an internal, convenience identifier and is only visible to\n    you in the Firebase console.\n\n3. Click **Register app**.\n\n4. Follow the on-screen instructions to add and initialize the Firebase SDK in your app.\n\nYou can also find more detailed instructions for adding, initializing, and using the Firebase\n    SDK in the next steps of this getting started page.\n\n\n\nIf you don't already have a JavaScript project and just want to try out a\nFirebase product, you can download one of our [quickstart samples](https://firebase.google.com/docs/samples).\n\n## **Step 2**: Install the SDK and initialize Firebase\n\nThis page describes setup instructions for the Firebase JS SDK's modular API,\nwhich uses a [JavaScript Module](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules)\nformat.\n\nThis workflow uses npm and requires module bundlers or JavaScript framework\ntooling because the modular API is optimized to work with\n[module bundlers](https://firebase.google.com/docs/web/module-bundling)\nto eliminate unused code (tree-shaking) and decrease SDK size.\n\n1. Install Firebase using npm:\n\n\n\n\n\n\n\n\n```\nnpm install firebase\n```\n\n2. Initialize Firebase in your app and create a Firebase App object:\n\n\n\n\n\n\n\n\n```\nimport { initializeApp } from 'firebase/app';\n\n// TODO: Replace the following with your app's Firebase configuration\nconst firebaseConfig = {\n     //...\n};\n\nconst app = initializeApp(firebaseConfig);\n```\n\n\nA Firebase App is a container-like object that stores common configuration\nand shares authentication across Firebase services. After you initialize a\nFirebase App object in your code, you can add and start using Firebase\nservices.\n\nIf your app includes dynamic features based on server-side rendering (SSR),\nyou'll need to take some additional steps to ensure that your configuration\npersists across server rendering and client rendering passes. In\nyour server logic, implement the\n[`FirebaseServerApp`](https://firebase.google.com/docs/reference/js/app.firebaseserverapp) interface to\noptimize your app's\n[session management with service workers](https://firebase.google.com/docs/auth/web/service-worker-sessions#server_side_changes).\n\n\n## **Step 3**: Access Firebase in your app\n\nFirebase services (like Cloud Firestore, Authentication, Realtime Database,\nRemote Config, and more) are available to import within individual\nsub-packages.\n\nThe example below shows how you could use the Cloud Firestore Lite SDK to retrieve\na list of data.\n\n```\nimport { initializeApp } from 'firebase/app';\nimport { getFirestore, collection, getDocs } from 'firebase/firestore/lite';\n// Follow this pattern to import other Firebase services\n// import { } from 'firebase/<service>';\n\n// TODO: Replace the following with your app's Firebase configuration\nconst firebaseConfig = {\n  //...\n};\n\nconst app = initializeApp(firebaseConfig);\nconst db = getFirestore(app);\n\n// Get a list of cities from your database\nasync function getCities(db) {\n  const citiesCol = collection(db, 'cities');\n  const citySnapshot = await getDocs(citiesCol);\n  const cityList = citySnapshot.docs.map(doc => doc.data());\n  return cityList;\n}\n```\n\n## **Step 4**: Use a module bundler (webpack/Rollup) for size reduction\n\nThe Firebase Web SDK is designed to work with module bundlers to remove any\nunused code (tree-shaking). We strongly recommend using this approach for\nproduction apps. Tools such as the [Angular CLI](https://angular.io/cli),\n[Next.js](https://nextjs.org/), [Vue CLI](https://cli.vuejs.org/), or [Create\\\\\nReact App](https://reactjs.org/docs/create-a-new-react-app.html) automatically\nhandle module bundling for libraries installed through npm and imported into\nyour codebase.\n\nSee our guide [Using module bundlers with Firebase](https://firebase.google.com/docs/web/module-bundling) for more information.\n\n## Available Firebase services for web\n\nNow that you're setup to use Firebase, you can start adding and using any of the\nfollowing available Firebase services in your web app.\n\nThe following commands show how to import Firebase libraries installed locally\nwith [`npm`](https://npmjs.com/). For alternative import options, see the\n[available libraries documentation](https://firebase.google.com/docs/web/learn-more#available-libraries).\n\n**1** _Firebase AIÂ Logic was formerly called_\n_\"VertexÂ AIÂ inÂ Firebase\" with the package_\n_`firebase/vertexai`._\n\n## Next steps\n\n**Learn about Firebase:**\n\n- Explore [sample Firebase apps](https://firebase.google.com/docs/samples).\n\n- Get hands-on experience with the\n[Firebase Web Codelab](https://firebase.google.com/codelabs/firebase-nextjs).\n\n- Explore the [open source code in\\\\\nGitHub](https://github.com/firebase/firebase-js-sdk).\n\n- Review the [supported environments](https://firebase.google.com/docs/web/environments-js-sdk) for the\nFirebaseJavaScript SDK.\n\n- Speed up your development with additional Firebase-maintained open source\nlibraries, like\n[AngularFire](https://firebaseopensource.com/projects/angular/angularfire2/),\n[RxFire](https://github.com/firebase/firebase-js-sdk/tree/master/packages/rxfire#rxfire), and\n[FirebaseUI for web](https://firebaseopensource.com/projects/firebase/firebaseui-web/).\n\n- Prepare to launch your app:\n\n  - Set up [budget\\\\\n    alerts](https://firebase.google.com/docs/projects/billing/avoid-surprise-bills#set-up-budget-alert-emails)\n    for your project in the Google Cloud console.\n  - Monitor the [_Usage and billing_\\\\\n    dashboard](https://console.firebase.google.com/project/_/usage)\n    in the Firebase console to get an overall picture of your project's\n    usage across multiple Firebase services.\n\n  - Review the [Firebase launch checklist](https://firebase.google.com/support/guides/launch-checklist).\n\nWas this helpful?\n\n\n\n Send feedback\n\n\n\nExcept as otherwise noted, the content of this page is licensed under the [Creative Commons Attribution 4.0 License](https://creativecommons.org/licenses/by/4.0/), and code samples are licensed under the [Apache 2.0 License](https://www.apache.org/licenses/LICENSE-2.0). For details, see the [Google Developers Site Policies](https://developers.google.com/site-policies). Java is a registered trademark of Oracle and/or its affiliates.\n\nLast updated 2025-09-09 UTC.\n\n\nNeed to tell us more?\n\n\n\n\n\n\n\\[\\[\\[\"Easy to understand\",\"easyToUnderstand\",\"thumb-up\"\\],\\[\"Solved my problem\",\"solvedMyProblem\",\"thumb-up\"\\],\\[\"Other\",\"otherUp\",\"thumb-up\"\\]\\],\\[\\[\"Missing the information I need\",\"missingTheInformationINeed\",\"thumb-down\"\\],\\[\"Too complicated / too many steps\",\"tooComplicatedTooManySteps\",\"thumb-down\"\\],\\[\"Out of date\",\"outOfDate\",\"thumb-down\"\\],\\[\"Samples / code issue\",\"samplesCodeIssue\",\"thumb-down\"\\],\\[\"Other\",\"otherDown\",\"thumb-down\"\\]\\],\\[\"Last updated 2025-09-09 UTC.\"\\],\\[\\],\\[\\],null,\\[\\]\\]\n\n\n\nChat\n\n\n## Ask about this page\n\nbug\\_reportfullscreenclose\\_fullscreenclose\n\n## Chat\n\n### BETA\n\nrestart\\_alt\n\nSign in","size_bytes":17887},"client/src/lib/firebase.ts":{"content":"import { initializeApp } from \"firebase/app\";\nimport { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, type User as FirebaseUser } from \"firebase/auth\";\nimport { getFirestore, initializeFirestore, connectFirestoreEmulator, doc, setDoc, getDoc, collection, addDoc, updateDoc, deleteDoc, query, where, getDocs, orderBy } from \"firebase/firestore\";\n\n// Firebase configuration using Replit secrets\nconst firebaseConfig = {\n  apiKey: import.meta.env.VITE_FIREBASE_API_KEY,\n  authDomain: `${import.meta.env.VITE_FIREBASE_PROJECT_ID}.firebaseapp.com`,\n  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,\n  storageBucket: `${import.meta.env.VITE_FIREBASE_PROJECT_ID}.firebasestorage.app`,\n  messagingSenderId: \"808599419586\",\n  appId: import.meta.env.VITE_FIREBASE_APP_ID,\n  measurementId: \"G-GCZ55Q5JRB\"\n};\n\n// Initialize Firebase\nconst app = initializeApp(firebaseConfig);\n\n// Initialize Firebase Authentication and get a reference to the service\nexport const auth = getAuth(app);\n\n// Initialize Cloud Firestore with fallback for constrained networks\nlet db: any;\ntry {\n  // For environments like Replit with network constraints\n  db = initializeFirestore(app, {\n    experimentalForceLongPolling: true,\n  });\n  console.log('Firestore initialized with long-polling fallback');\n} catch (error) {\n  console.warn('Firestore long-polling initialization failed, using default:', error);\n  db = getFirestore(app);\n}\n\nexport { db };\n\n// Firestore health check\nexport const checkFirestoreHealth = async (): Promise<boolean> => {\n  try {\n    console.log('Testing Firestore connectivity...');\n    const testDoc = doc(db, 'health', 'test');\n    await setDoc(testDoc, { timestamp: new Date().toISOString(), test: true });\n    const testRead = await getDoc(testDoc);\n    console.log('Firestore health check passed');\n    return testRead.exists();\n  } catch (error: any) {\n    console.error('Firestore health check failed:', {\n      error,\n      message: error?.message,\n      code: error?.code\n    });\n    return false;\n  }\n};\n\n// Auth functions\nexport const signInWithEmail = async (email: string, password: string) => {\n  return await signInWithEmailAndPassword(auth, email, password);\n};\n\nexport const createUserWithEmail = async (email: string, password: string) => {\n  return await createUserWithEmailAndPassword(auth, email, password);\n};\n\nexport const signOutUser = async () => {\n  return await signOut(auth);\n};\n\nexport const onAuthStateChange = (callback: (user: FirebaseUser | null) => void) => {\n  return onAuthStateChanged(auth, callback);\n};\n\n// Firestore helper functions with error handling\nexport const createDocument = async (collectionName: string, data: any, customId?: string) => {\n  try {\n    if (customId) {\n      const docRef = doc(db, collectionName, customId);\n      await setDoc(docRef, data);\n      return { id: customId, ...data };\n    } else {\n      const docRef = await addDoc(collection(db, collectionName), data);\n      return { id: docRef.id, ...data };\n    }\n  } catch (error: any) {\n    console.error(`Failed to create document in ${collectionName}:`, {\n      error,\n      message: error?.message,\n      code: error?.code,\n      customId,\n      collectionName\n    });\n    throw error;\n  }\n};\n\nexport const getDocument = async (collectionName: string, docId: string) => {\n  const docRef = doc(db, collectionName, docId);\n  const docSnap = await getDoc(docRef);\n  \n  if (docSnap.exists()) {\n    return { id: docSnap.id, ...docSnap.data() };\n  } else {\n    return null;\n  }\n};\n\nexport const updateDocument = async (collectionName: string, docId: string, data: any) => {\n  const docRef = doc(db, collectionName, docId);\n  await updateDoc(docRef, data);\n  return { id: docId, ...data };\n};\n\nexport const deleteDocument = async (collectionName: string, docId: string) => {\n  const docRef = doc(db, collectionName, docId);\n  await deleteDoc(docRef);\n  return true;\n};\n\nexport const getCollection = async (collectionName: string, conditions?: any[], orderByField?: string) => {\n  let q = collection(db, collectionName);\n  \n  // Add where conditions if provided\n  if (conditions) {\n    for (const [field, operator, value] of conditions) {\n      q = query(q as any, where(field, operator, value)) as any;\n    }\n  }\n  \n  // Add ordering if provided\n  if (orderByField) {\n    q = query(q as any, orderBy(orderByField)) as any;\n  }\n  \n  const querySnapshot = await getDocs(q as any);\n  const docs: any[] = [];\n  querySnapshot.forEach((docSnap) => {\n    const docData = docSnap.data() || {};\n    docs.push({ id: docSnap.id, ...docData });\n  });\n  \n  return docs;\n};\n\nexport const getUserCompanies = async (userId: string) => {\n  return await getCollection('companies', [['user_id', '==', userId]]);\n};\n\nexport const getCompanyData = async (companyId: string, collectionName: string) => {\n  return await getCollection(collectionName, [['company_id', '==', companyId]]);\n};\n\nexport type { FirebaseUser };","size_bytes":4956},"server/firebaseAdmin.ts":{"content":"import admin from 'firebase-admin';\n\n// Initialize Firebase Admin SDK\nlet app: admin.app.App;\n\nif (!admin.apps.length) {\n  try {\n    // Use environment variable for Firebase project ID\n    const projectId = process.env.FIREBASE_PROJECT_ID || \"log-and-ledger\";\n    console.log('Using Firebase project ID:', projectId);\n    \n    if (!projectId) {\n      throw new Error('FIREBASE_PROJECT_ID environment variable is not set');\n    }\n    \n    app = admin.initializeApp({\n      projectId: projectId,\n    });\n    console.log('Firebase Admin SDK initialized successfully with project:', projectId);\n  } catch (error) {\n    console.error('Failed to initialize Firebase Admin SDK:', error);\n    throw error; // Don't fallback to wrong project - this causes audience mismatch\n  }\n} else {\n  app = admin.app();\n}\n\nexport { admin, app };\nexport const auth = admin.auth();\nexport const firestore = admin.firestore();\n\n// Helper function to verify Firebase token - SECURE VERSION\nexport const verifyFirebaseToken = async (token: string) => {\n  try {\n    const decodedToken = await auth.verifyIdToken(token);\n    return decodedToken;\n  } catch (error: any) {\n    console.error('Firebase token verification failed:', error.message);\n    \n    // Strict security: no fallback in any environment\n    // All tokens must be properly verified through Firebase Admin SDK\n    throw error;\n  }\n};","size_bytes":1370},"client/src/lib/currencies.ts":{"content":"// Comprehensive list of currency codes - single source of truth\nexport const CURRENCY_CODES = [\n  // Major World Currencies\n  'USD', 'EUR', 'GBP', 'JPY', 'CHF', 'CAD', 'AUD', 'NZD',\n  \n  // Arabic & Middle Eastern Currencies\n  'AED', 'SAR', 'EGP', 'SYP', 'LBP', 'IQD', 'JOD', 'KWD', \n  'QAR', 'BHD', 'OMR', 'YER', 'MAD', 'DZD', 'TND', 'LYD', \n  'SDG', 'ILS', 'IRR', 'TRY',\n  \n  // Asian Currencies\n  'PHP', 'CNY', 'KRW', 'INR', 'IDR', 'THB', 'MYR', 'SGD', \n  'VND', 'BDT', 'PKR', 'LKR', 'MMK', 'KHR', 'LAK', 'NPR', \n  'BTN', 'MNT', 'KZT', 'UZS', 'TJS', 'KGS', 'TMT', 'AFN',\n  \n  // European Currencies\n  'NOK', 'SEK', 'DKK', 'ISK', 'PLN', 'CZK', 'HUF', 'RON', \n  'BGN', 'HRK', 'RSD', 'BAM', 'MKD', 'ALL', 'MDL', 'UAH', \n  'BYN', 'RUB',\n  \n  // African Currencies\n  'ZAR', 'NGN', 'GHS', 'KES', 'UGX', 'TZS', 'ETB', 'RWF', \n  'XOF', 'XAF', 'MZN', 'BWP', 'NAD', 'SZL', 'LSL',\n  \n  // American Currencies\n  'MXN', 'BRL', 'ARS', 'CLP', 'COP', 'PEN', 'UYU', 'PYG', \n  'BOB', 'VED', 'GYD', 'SRD'\n];\n\n/**\n * Maps currency codes to objects with code and translated name\n * @param t - Translation function from react-i18next\n * @param ns - Translation namespace (default: 'currencies')\n * @returns Array of currency objects with code and name\n */\nexport function mapCurrencies(t: any, ns: string = 'currencies') {\n  return CURRENCY_CODES.map(code => ({\n    code,\n    name: t(`${ns}.${code}`, { defaultValue: code })\n  }));\n}\n\n/**\n * Sort currencies by name alphabetically\n * @param currencies - Array of currency objects\n * @returns Sorted array of currencies\n */\nexport function sortByName(currencies: { code: string; name: string }[]) {\n  return [...currencies].sort((a, b) => a.name.localeCompare(b.name));\n}","size_bytes":1702}},"version":1}